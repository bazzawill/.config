Okta.startBackgroundScript=function(a,i,u,g){var d=1e3,n=Okta.Q.when,c=Okta.fn.storage.wrapVal,p=Okta.fn.base.timestamp,r=Okta.fn.api.getToSettings,l=Okta.fn.api.prependPath,k=Okta.fn.api.setSessionData,e=Okta._okta,f=e.first,b=e.filter,T=e.isUndefined,y=Okta.Q;function P(e){return"_lock_"+e}function h(){return T(a.isInstalledByUser)?y(!0):a.isInstalledByUser()}function s(e,t,o,n){switch(e){case"getSessionState":return i.get(o.key);case"setSessionState":return i.set(o.key,o.val);case"getPersistentState":return u.get(o.key);case"setPersistentState":return u.set(o.key,o.val);case"clearPersistentState":return u.clear&&u.clear(),o.result=!0,o.browserType=a.getType(),o;case"requestPrivacyPermissions":return T(a.requestPrivacyPermissions)?y({errorCode:"requestPrivacyPermissions is not supported on "+a.getType()}):a.requestPrivacyPermissions();case"getTabId":return t;case"getTabInfo":return T(a.getTabInfo)?y({errorCode:"not supported by this version of the plugin"}):a.getTabInfo(t);case"documentLoaded":return T(a.documentLoaded)?y({errorCode:"not supported by this version of the plugin"}):a.documentLoaded(t,n);case"getBrowserType":return a.getType();case"getBackgroundVersion":return a.getBackgroundVersion();case"unlockSessionKey":return function s(e){return i.set(P(e),null),!0}(o.key);case"lockSessionKey":return function r(e){var t=p(),o=P(e),n=i.get(o);return(!n||t>n.lockTime+d)&&(i.set(o,{lockTime:t}),!0)}(o.key);case"request":return g.ajax(o);case"openTab":return a.openTab(o.url);case"hasPrivacyPermissions":return a.hasPrivacyPermissions?a.hasPrivacyPermissions():y(c(!0));case"openPermissionsPage":return a.openPermissionsPage?a.openPermissionsPage():y({errorCode:"openPermissionsPage is not supported on "+a.getType()});case"openSettingsPage":return a.openSettingsPage?a.openSettingsPage():y({errorCode:"openSettingsPage is not supported on "+a.getType()});case"openOktaNewtab":return a.openOktaNewtab?a.openOktaNewtab():y({errorCode:"openOktaNewtab is not supported on "+a.getType()});case"servePopover":return a.servePopover?a.servePopover():y({errorCode:"servePopover is not supported on "+a.getType()});case"suppressSavePassword":return a.suppressSavePassword?a.suppressSavePassword(t,o):y({errorCode:"suppressSavePassword is not supported on "+a.getType()});case"getPasswordSavingDetails":return a.getPasswordSavingDetails?a.getPasswordSavingDetails():y({errorCode:"getPasswordSavingDetails is not supported on "+a.getType()});case"openTabForAccountChooser":return T(a.openTabForAccountChooser)?y({errorCode:"not supported by this version of the plugin",url:o.url}):a.openTabForAccountChooser(o.url);case"closeTab":return a.closeTab(t);case"getCookies":return T(a.getCookies)?y({errorCode:"not supported by this version of the plugin"}):a.getCookies(o.key.hostUrl,o.key.cookieNames,t);case"getLocalStorageUsage":return T(a.getLocalStorageUsage)?y({errorCode:"not supported by this version of the plugin"}):a.getLocalStorageUsage().fail(function(e){return y({errorCode:"failed to get the local storage usage: "+e})});case"updateBadge":return T(a.updateBadge)?y.resolve():a.updateBadge(o.key);case"downloadExtensionLogs":return T(a.downloadExtensionLogs)?y.resolve():a.downloadExtensionLogs(o.key);case"setUninstallURL":return T(a.setUninstallURL)?y.resolve():a.setUninstallURL(o.url||"");case"isInstalledByUser":return h();case"injectContentScript":return a.injectContentScript&&a.injectContentScript(t,n),y();case"getSessionTabState":return i.get(o.key+"_"+t);case"sendMsgToCurrentTab":return T(a.sendMsgToCurrentTab)?y({errorCode:"sendMsgToCurrentTab not supported on "+a.getType()}):a.sendMsgToCurrentTab(o);default:return y({errorCode:"Unknown msg type: "+e})}}function v(e){u.set("PENDO_ONBOARDING_DATA",{sentTo:e,timestamp:p()})}a.on("injectReady",function(e){a.injectScript(e,null)}),a.on("messageFromContent",function(t){var o=t.msg,e=s(o.type,t.tabId,o.data,t.frameId);n(e,function(e){a.post({msg:{id:o.id,type:o.type,data:e},tabId:t.tabId,portInfo:t.portInfo})}).done()}),a.on("postInstall",function(){return u.set("ONBOARDING_FLOW",!0),h().then(function(e){return Okta.Config.onboardingLaunchNewTab&&e?a.getOrgsWithSessionCookies():y(null)}).then(function(e){if(e)if(e.oktaAccounts&&0!==e.oktaAccounts.length){var t=1===e.oktaAccounts.length;if(!e.sessions||0===e.sessions.length)return a.openTab(t?f(e.oktaAccounts).origin+"/login/login.htm":"https://login.okta.com"),void v(t?"orgLogin":"oktaLogin");var o=b(e.sessions,function(e){return e.tabId!==undefined});if(!t&&0===o.length)return a.openTab("https://login.okta.com"),void v("oktaLogin");var n=f(t?e.sessions:o),s=r(n.domain+l("/settings"),{backgroundVersion:a.getBackgroundVersion(),contentVersion:""});k({sid:n.sid,DT:n.dt,idx:n.idx},s.headers),g.ajax(s).then(function(e){e?(u.set("PLUGIN_SETTINGS",{override:{},orgSettings:e}),e.pluginOnboardingEnabled?n.tabId!==undefined&&n.isDashboardTab?(a.highlightAndRefreshTab(n.tabId),v("refreshDashboard")):(a.openTab(n.domain+"/app/UserHome"),v("openDashboard")):v("none")):v("none")})}else v("zeroOrgs")})})};