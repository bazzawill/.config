(self.webpackChunk=self.webpackChunk||[]).push([[9561],{64078:(e,t,n)=>{n.d(t,{X:()=>N});var i,a=n(59312),o=n(27378),s=n(57050),r=n(19962),l=n(5114),d=n(44060),c=n(67424),m=n(89894),u=n(32096),h=n(40327),p=n(5739),g=n(98403),f=n(49708),b=n(85985),v=n(41398),k=n(24209),y=n(17343),I=n(38194),x=n(598),_=n(50628),w=n(25781),E=n(83078),C=n(18625);!function(e){var t="scrollaction";e.emit=function(e){return self.dispatchEvent(new CustomEvent(t,{detail:e}))},e.observe=C.P((function(){return f.R(self,t)}))}(i||(i={}));var U=n(42103),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._subs=[],t._outOfTarget=function(e){return function(t){return!r.UL.hasPoint(t.getBoundingClientRect(),e)}},t}return(0,a.ZT)(t,e),t.prototype.componentDidMount=function(){this._listenTooltipAppearance()},t.prototype.componentWillUnmount=function(){this._subs.forEach((function(e){return e.unsubscribe()})),this._subs=[],this.context.hide()},t.prototype.render=function(){return o.createElement(p.F.div,{"data-role":"tooltip"},this.context.state.view(this.props.children))},t.prototype._listenTooltipAppearance=function(){var e=this,t=f.R(document,"keydown").pipe(b.h((function(e){return e.keyCode===w.R.ESC_CODE}))),n=f.R(document,"mousedown").pipe(v.M(this.context.state),b.h((function(t){var n=t[0],i=t[1];return(0,h.pipe)(i,l.map((function(e){return e.target})),l.filter((function(){return r.pK(n.target)})),E.wo(e._outOfTarget({x:n.clientX,y:n.clientY})))}))),a=k.T(t,n,f.R(document,"scroll"),i.observe.pipe(b.h((function(e){return"show"===e.detail})))).pipe(y.h(g.PU),I.B());this._subs=[this.context.hasContent.pipe(b.h(Boolean),x.c(a.pipe(_.P()))).subscribe(this.context.hide),this.context.hasContent.pipe(b.h(Boolean),x.c(k.T(g.gw(!0,500),a.pipe(y.h(!1))).pipe(_.P())),b.h(Boolean)).subscribe(this.context.show)]},t.contextType=U.G.Context,t}(o.Component),N=function(){return o.createElement(S,null,(0,s.ls)(l.map((function(e){return o.createElement(c.t.ByAbsoluteRect,(0,a.pi)({rect:r.UL.fromEl(e.target),className:F.container},c.t.Alignment.toSelector(e.alignment),{withPin:!0}),o.createElement("div",{className:F.content},e.content))})),l.toNullable))},M={position:"fixed",zIndex:u.DY,pointerEvents:"none",$nest:{"@media print":{visibility:"hidden"}}},T={padding:"".concat(m.ux.rem(.25)," ").concat(m.ux.rem(1)),borderRadius:m.ux.rem(u.fx),background:d.Il.BackgroundTooltip,color:d.Il.CoreNeutral1,textAlign:"center",whiteSpace:"nowrap",letterSpacing:m.ux.px(.25),fontSize:m.ux.rem(.75),lineHeight:m.ux.rem(1)},F=m.ux.stylesheet({container:[M],content:[T]})},78501:(e,t,n)=>{n.r(t),n.d(t,{createReaderGmailThreadIntegration:()=>Mr});var i,a=n(17771),o=n(57050),s=n(26430),r=n(29511),l=n(34379),d=n(48044),c=n(30625),m=n(70631),u=n(38983);!function(e){e.create=function(e,t,n){return u.h.combine(e,n,t,((e,t,n)=>({threadId:e.threadId,subject:e.subject,loggedUser:e.loggedUser,messageCount:e.messageCount,messageIndexToIdMap:e.messageIndexToIdMap,expandedMessages:(0,o.zG)(e.expandedMessages,d.Su(((i,a)=>({message:(0,o.zG)(a,m.UI((t=>({id:t.id,index:t.index,author:t.context.author,audience:t.context.audience,links:t.context.links,wordCount:(0,c.Y2)(t.textMap.getPlainText()),date:t.context.date,isLastMessage:t.index===e.messageCount-1})))),summary:n.get(i)||(m.VZ(a)||m.IR(a)?a:m.x5),annotations:t.get(i)||(m.VZ(a)||m.IR(a)?a:m.x5)}))))})))}}(i||(i={}));var h,p,g=n(27378),f=n(55415),b=n(8125),v=n(5114);!function(e){e.showContent="showContent",e.hideFilteredMessageContent="hideFilteredMessageContent",e.showFilteredMessageContent="showFilteredMessageContent"}(h||(h={})),function(e){e.overview="overview",e.coreUserJourney="coreUserJourney",e.pinning="pinning"}(p||(p={}));const k=[p.overview,p.coreUserJourney,p.pinning];function y(e){return"collapsed"===e.kind}function I(e){return"collapsed"!==e.kind}function x(e){return"messageView"===e.kind}function _(e){return"pinnedView"===e.kind}function w(e){return"onboardingView"===e.kind}function E(e){return"messageView"===e.kind&&m.d6(e.message)&&(0,o.zG)(e.summary,v.map(f.ei("data")),v.map((0,b.Kg)(m.d6,m.VZ,m.IR)),v.getOrElse(o.W8))&&(0,o.zG)(e.questions,v.map(f.ei("data")),v.map((0,b.Kg)(m.d6,m.VZ,m.IR)),v.getOrElse(o.W8))&&(0,o.zG)(e.links,v.map(f.ei("data")),v.map((0,b.Kg)(m.d6,m.VZ,m.IR)),v.getOrElse(o.W8))}var C=n(77176),U=n(5739),S=n(16027),N=n(60797),M=n(76974),T=n(61922);const F={textBoxPlaceholder:"Share your thoughts here.",textBoxAriaLabel:"Feedback text",submitButton:"Submit",cancelButton:"Close",requiredLabel:"Required"},A={onboarding:{optInButton:"Try it out",optOutButton:"No, thanks",prevIconTooltip:"Previous",nextIconTooltip:"Next",badge:"NEW",betaTermsUrl:"https://www.grammarly.com/beta-feature-terms",stepOfN:e=>`${e} OF 3`,overview:{phase0:{title:"Introducing email recaps",body:"Now Grammarly can automatically summarize key points to help you reply faster."},phase1:{title:"Introducing email recaps",body:"Now Grammarly can automatically summarize key points and follow-up actions."},phase2:{title:"Introducing email recaps",body:"Now Grammarly can automatically recap key points and help you decide whether you need to reply."},videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-overview.gif"},coreUserJourney:{title:"Reply faster",body:"Everything you need at your fingertips. Focus on writing, not hunting for details.",videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-core-user-journey.gif"},pinning:{title:"Choose what's important",body:"Pin key points and things to follow up on while you're reading.",videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-pinning.gif"},disclaimer:{text:"Grammarly collects data from your emails to power recaps. Learn how your information is used and protected in our %link%.",linkPlaceholder:"%link%",link:{text:"data collection policy",URL:"https://www.grammarly.com/recap"}}},expandedPanel:{viewButton:{thread:"Messages",pins:"Pinned"},goLeftIconTooltip:"Previous message",goRightIconTooltip:"Next message",jumpFirstIconTooltip:"Jump to first message",jumpLastIconTooltip:"Jump to last message",actionsButtonTooltip:"Actions",itemMenu:{copyTooltip:"Copy",pinTooltip:"Add pin",unpinTooltip:"Remove pin",dismissTooltip:"Dismiss",likeTooltip:"Helpful",dislikeTooltip:"Unhelpful",itemLikedTooltip:"This item is helpful",itemDislikedTooltip:"This item isn't helpful"},threadView:{summaries:{title:"Summary",empty:{title:"No items found",body:"Did we miss something?",CTA:"Help us improve"},filteredHidden:{title:"Content hidden",body:"Includes content from this message that you may not need.",CTA:"Show anyway"},filteredShown:{title:"Showing content from this message that you may not need."}},followUps:{title:"Follow-ups",empty:{title:"No follow-ups found",body:"Did we miss something?",CTA:"Help us improve"},filteredHidden:{title:"Content hidden",body:"Includes follow-ups from this message that you may not need.",CTA:"Show anyway"},filteredShown:{title:"Showing follow-ups from this message that you may not need."}},links:{title:"Links and attachments",empty:{title:"No links or attachments found",body:"Did we miss something?",CTA:"Help us improve"},filteredHidden:{title:"Content hidden",body:"Includes links and attachments from this message that you may not need.",CTA:"Show anyway"},filteredShown:{title:"Showing links and attachments from this message that you may not need."}}},pinnedView:{summaries:{title:"Summary",empty:{title:"Nothing pinned yet",body:"Pin important summary items to find them more easily.",CTA:"Return to Messages tab"}},followUps:{title:"Follow-ups",empty:{title:"Nothing pinned yet",body:"Pin follow-ups to find them more easily.",CTA:"Return to Messages tab"}},links:{title:"Links and attachments",empty:{title:"Nothing pinned yet",body:"Pin links and attachments to find them more easily.",CTA:"Return to Messages tab"}}}},collapseIconTooltip:"Hide email recap",collapsedNothingToRecap:"Nothing to recap",expandIconTooltip:"Open email recap",recapExpandTooltip:"Open email recap",recapCollapseTooltip:"Hide email recap",sendFeedbackButton:"Send feedback",genericFeedbackDialog:{...F,ratings:["It's not helpful","It could be better","It's okay","It's pretty helpful","It's great"],title:"Is Grammarly Recap helpful?"},tellsUsMoreFeedbackDialog:{...F,cancelButton:"Skip",title:"Tell us more",description:"We'd love to hear what's going well and how we can improve."},notifications:{thankYou:"Thank you for your feedback"},enableInlineHighlights:"Show highlight",disableInlineHighlights:"Hide highlight",inlineOnboarding:{highlight:{title:"Find the key points faster",content:"Important sentences have been highlighted so you can read and act on email more quickly.",next:"Next",close:"Close"},highlightsSwitch:{title:"Hide email highlights",content:"You can turn highlights off when you don't need them.",next:"Next",close:"Close"},panelSwitch:{title:"View full recap",content:"Expand the panel to view email summaries, handy follow-up checklists, and more.",next:"Got it"}}};var G,z,L,O,P,K,R,H,B=n(85985),D=n(22232);!function(e){e.first="first",e.last="last",e.left="left",e.right="right"}(G||(G={})),function(e){e.left="left",e.right="right"}(z||(z={})),function(e){e.onboardingPanel="onboardingPanel",e.readerPanel="readerPanel"}(L||(L={})),function(e){e.collapseButton="collapseButton",e.recapButton="recapButton"}(O||(O={})),function(e){e.expandButton="expandButton",e.recapButton="recapButton",e.replyButton="replyButton"}(P||(P={})),function(e){e.messagesButton="messagesButton",e.emptyPinnedSummaries="emptyPinnedSummaries",e.emptyPinnedFollowUps="emptyPinnedFollowUps",e.emptyPinnedLinks="emptyPinnedLinks"}(K||(K={})),function(e){let t;!function(e){e.panelMounted="panelMounted",e.collapse="collapse",e.expand="expand",e.threadViewNavigate="threadViewNavigate",e.onboardingViewNavigate="onboardingViewNavigate",e.openPinnedView="openPinnedView",e.openMessageView="openMessageView",e.optIn="optIn",e.optOut="optOut",e.closeNotification="closeNotification",e.submitFeedback="submitFeedback",e.skipFeedback="skipFeedback",e.closeFeedback="closeFeedback",e.openFeedback="openFeedback",e.columnScroll="columnScroll",e.itemBlur="itemBlur",e.itemMounted="itemMounted",e.openItemMenu="openItemMenu",e.linkClick="linkClick",e.check="check",e.pin="pin",e.copy="copy",e.dismiss="dismiss",e.like="like",e.dislike="dislike",e.toggleInlineHighlights="toggleInlineHighlights",e.seenInlineHighlightsOnboarding="seenInlineHighlightsOnboarding",e.setInlineHighlightsOnboardingStep="setInlineHighlightsOnboardingStep",e.inlineHighlightOnboardingElementMounted="inlineHighlightOnboardingElementMounted",e.showFilteredContent="showFilteredContent"}(t=e.Kind||(e.Kind={})),e.matchSubmitFeedback=function(e){return t=>{switch(t.source.kind){case"collapsedPanelButton":return e.collapsedPanelButton(t);case"expandedPanelHeaderButton":return e.expandedPanelHeaderButton(t);case"emptySummaryViewButton":case"emptyFollowUpsViewButton":case"emptyLinksViewButton":return e.emptyViewButton(t);case"itemPanelMenu":return e.itemMenu(t);default:(0,D.vE)(t.source)}}},e.itemTypeIs=function(e){return t=>t.itemType===e},e.is=function(e){return t=>t.kind===e}}(R||(R={})),function(e){e.ofType=function(e){return B.h(R.is(e))}}(H||(H={}));var V=n(64757),Z=n(76168);const j=S.UI.Grid.make((({slots:e,notify:t})=>g.createElement(U.F.div,{className:Z.notification},e.icon,e.content,g.createElement(V.zx.Ghost,{name:"close-notification",onClick:t({kind:R.Kind.closeNotification})},g.createElement(T.JO.Close,null))))),q=S.UI.Knot.make(j,{icon:S.UI.Node.make((()=>g.createElement(T.JO.NotificationInfo,null))),content:S.UI.Node.make((()=>g.createElement("span",null,A.notifications.thankYou)))});function W(e){return t=>e.actions.next(t)}function $(e){return S.Z.composeKnot({root:S.Z.fromSideEffect(W(e),null),icon:()=>M.of(null),content:()=>M.of(null)})}const Q=S.UI.Union.make("kind",{thankYou:q}),J=S.UI.Union.asOption(Q);function Y(e){return S.Z.composeUnion({Some:S.Z.composeKnot({value:S.Z.composeUnion({thankYou:$(e)},(()=>e.state.pipe(C.U((e=>e.notification)),N.oA)))}),None:()=>M.of(null)},(()=>e.state.pipe(C.U((e=>e.notification)))))}var X=n(8965),ee=n(23556),te=n(57053),ne=n(22667),ie=n(2844),ae=n(12187),oe=n(78870);const se=e=>S.UI.Grid.make((({slots:t,view:n,notify:i})=>g.createElement("div",{className:oe.dialog},g.createElement("header",{className:oe.header},g.createElement("div",{className:oe.headerGroup},g.createElement(ne.K,{size:16}),"Help us improve"),g.createElement(U.F.Fragment,null,n("source").pipe(C.U((e=>g.createElement(V.zx.Ghost,{onClick:i({kind:"close",source:e}),name:"feedback-dialog-close"},g.createElement(T.JO.Close,null))))))),g.createElement(U.F.Fragment,null,t.title,t.rating,t.description),g.createElement(U.F.div,{role:"textbox",...(0,ae.Sh)(oe.textbox,n("formErrors").pipe(C.U((e=>e.has("textRequired")?oe.requiredTextBox:void 0)))),contentEditable:!0,"aria-placeholder":e.textBoxPlaceholder,"data-placeholder":e.textBoxPlaceholder,"aria-label":e.textBoxAriaLabel,onInput:e=>i({kind:"text",text:e.target.innerText})()}),g.createElement(U.F.Fragment,null,n("formErrors").pipe(C.U((t=>t.has("textRequired")?g.createElement("span",{className:oe.requiredLabel},e.requiredLabel):null)))),g.createElement("div",{className:oe.buttons},g.createElement(U.F.Fragment,null,n("source").pipe(C.U((t=>g.createElement(g.Fragment,null,g.createElement(V.zx.Primary,{onClick:i({kind:"submit",source:t}),name:"feedback-dialog-submit"},e.submitButton),g.createElement(V.zx.Ghost,{onClick:i({kind:"skip",source:t}),name:"feedback-dialog-skip"},e.cancelButton))))))))));function re(e,t){const n=u.h.create({text:"",formErrors:new Set});return S.Z.fromSideEffect((i=>{switch(i.kind){case"text":n.modify((e=>({text:i.text,formErrors:(0,o.zG)(new Set(e.formErrors),(e=>(e.delete("textRequired"),e)))})));break;case"close":n.set({text:"",formErrors:new Set}),e.actions.next({kind:R.Kind.closeFeedback,source:i.source});break;case"skip":n.set({text:"",formErrors:new Set}),e.actions.next({kind:R.Kind.skipFeedback,source:i.source});break;case"submit":{""===n.get().text.trim()&&n.lens("formErrors").set(new Set(["textRequired"]));const a=(0,o.zG)(t,v.chain((e=>e())));0===n.get().formErrors.size&&(v.isNone(t)||v.isSome(a))&&(e.actions.next({kind:R.Kind.submitFeedback,source:i.source,text:n.get().text,scoreResult:a}),n.set({text:"",formErrors:new Set}));break}default:(0,D.vE)(i)}}),ie.aj([e.state.pipe(C.U((e=>e.feedbackDialog)),N.oA),n]).pipe(C.U((([{source:e},{formErrors:t}])=>({source:e,formErrors:t})))))}var le=n(90845),de=n(93508),ce=n(19962),me=n(61033);const ue=({onMount:e})=>g.createElement("div",{ref:e,className:me.panelOverlay}),he=S.UI.Grid.make((({state:e,slots:t})=>{const{ref:n,onMount:i}=le.P.useElWatcher(),a=ie.aj([e,n.pipe(C.U(v.map(ce.UL.fromEl)),N.oA)]).pipe(C.U((([e,t])=>({..."bottom"===e.dialogSide?{top:e.sourceRect.bottom-t.top}:"top"===e.dialogSide?{bottom:t.bottom-e.sourceRect.bottom+e.sourceRect.height}:{},..."right"===e.alignment?{right:t.right-e.sourceRect.right}:"left"===e.alignment?{left:e.sourceRect.left-t.left}:{}}))),de.O({}));return g.createElement(g.Fragment,null,g.createElement(ue,{onMount:i}),g.createElement(U.F.div,{className:me.dialog,style:a},t.content))}));function pe(e){return()=>e.state.pipe(C.U((e=>e.feedbackDialog)),N.oA,C.U((e=>e.position)))}var ge=n(56229);const fe=S.UI.Node.make((({state:e,notify:t})=>g.createElement("div",{className:ge.rating},g.createElement(te.i,{maxRating:A.genericFeedbackDialog.ratings.length,ratingLabels:A.genericFeedbackDialog.ratings,className:ge.ratingContainer,ratingStarsClassName:ge.ratingStars,ratingLegendClassName:ge.ratingLegend,ratingLabelsClassName:ge.ratingLabels,onChange:e=>t({score:e})(),ariaLabel:A.genericFeedbackDialog.title}),g.createElement(U.F.Fragment,null,e.pipe(C.U((e=>e?g.createElement("span",{className:ge.requiredLabel},A.genericFeedbackDialog.requiredLabel):null))))))),be=S.UI.Knot.make(se(A.genericFeedbackDialog),{title:S.UI.Node.make((()=>g.createElement("h1",{className:ge.title},A.genericFeedbackDialog.title))),rating:fe,description:S.UI.Node.empty}),ve=S.UI.Knot.make(he,{content:be}),ke=S.UI.Union.asOption(ve);function ye(e){const t=u.h.create({score:v.none,showRequired:!1});return S.Z.composeKnot({root:re(e,v.some((()=>(0,o.zG)(t.get().score,(e=>(v.isNone(e)&&t.lens("showRequired").set(!0),e)),v.map((e=>({score:e,label:A.genericFeedbackDialog.ratings[e]||""}))))))),title:()=>M.of(null),rating:S.Z.fromSideEffect((e=>t.set({score:v.some(e.score),showRequired:!1})),t.view("showRequired")),description:()=>M.of(null)})}function Ie(e,t){return S.Z.composeUnion({Some:S.Z.composeKnot({value:S.Z.composeKnot({root:pe(e),content:ye(e)})}),None:()=>M.of(null)},(()=>e.state.pipe(C.U((0,o.ls)(f.ei("feedbackDialog"),v.filter(t))))))}var xe=n(32952),_e=n(41398),we=n(2834);const Ee=S.UI.Node.make((({state:e,notify:t})=>{const{ref:n,onMount:i}=le.P.useElWatcher(),a=g.useRef(new xe.xQ);return le.P.useSubscriptionTo(a.current.pipe(_e.M(n),C.U((([e,t])=>v.map(ce.UL.fromEl)(t))),N.oA,we.b((e=>t({kind:"openFeedback",buttonRect:e})())))),g.createElement(U.F.Fragment,null,e.pipe(C.U((({active:e,isSupported:t})=>t?g.createElement(V.zx.Ghost,{mount:i,onClick:()=>a.current.next(),name:"panel-open-feedback-button",title:A.sendFeedbackButton,ariaLabel:A.sendFeedbackButton,active:e},g.createElement(T.JO.AssistantFeedback,null)):null))))}));function Ce(e,t){return S.Z.fromSideEffect((n=>{if("openFeedback"===n.kind)t?e.actions.next({kind:R.Kind.openFeedback,source:{kind:"collapsedPanelButton"},position:{sourceRect:n.buttonRect,dialogSide:"top",alignment:"right"}}):e.actions.next({kind:R.Kind.openFeedback,source:{kind:"expandedPanelHeaderButton"},position:{sourceRect:n.buttonRect,dialogSide:"bottom",alignment:"right"}});else(0,D.vE)(n.kind)}),e.state.pipe(C.U((e=>e.feedbackDialog)),C.U((n=>({active:(0,o.zG)(n,v.fold(o.jv,(({source:e})=>t?"collapsedPanelButton"===e.kind:"expandedPanelHeaderButton"===e.kind))),isSupported:e.isSubmitFeedbackDialogSupported})))))}const Ue=S.UI.Grid.make((({slots:e})=>g.createElement(U.F.Fragment,null,e.button,e.dialog))),Se=S.UI.Knot.make(Ue,{button:Ee,dialog:ke});function Ne(e,t,n){return S.Z.composeKnot({button:Ce(e,t),dialog:Ie(e,n)})}var Me;!function(e){e.InlineHighlightsDisabled=({className:e,width:t=24})=>g.createElement(T.a1,{className:e,width:t,viewBox:"0 0 24 24"},g.createElement("path",{d:"M6.142,16.333L3.449,19.026C3.306,19.169 3.263,19.384 3.34,19.571C3.418,19.758 3.6,19.88 3.802,19.88L7.338,19.88C7.471,19.88 7.598,19.827 7.692,19.733L8.617,18.808L11.784,18.641C11.907,18.635 12.024,18.583 12.111,18.496L20.596,10.01C21.182,9.425 21.182,8.475 20.596,7.889C20.596,7.889 17.061,4.354 17.061,4.354C16.475,3.768 15.525,3.768 14.939,4.354L7.515,11.778L6.454,12.839C6.367,12.926 6.315,13.043 6.309,13.166L6.142,16.333ZM8.222,12.485L12.465,16.728L11.54,17.653C11.54,17.653 8.595,17.808 8.595,17.808C8.595,17.808 7.142,16.355 7.142,16.355L7.297,13.41L8.222,12.485ZM13.172,16.021L8.929,11.778L15.646,5.061C15.842,4.865 16.158,4.865 16.354,5.061L19.889,8.596C20.084,8.791 20.084,9.108 19.889,9.303L13.172,16.021Z",fill:"inherit",stroke:"none"})),e.InlineHighlightsEnabled=({className:e,width:t=24})=>g.createElement(T.a1,{className:e,width:t,viewBox:"0 0 24 24"},g.createElement("path",{d:"M14.939,4.354C15.525,3.768 16.475,3.768 17.061,4.354L20.596,7.889C21.182,8.475 21.182,9.425 20.596,10.01L18.934,11.673C18.533,11.574 18.117,11.516 17.689,11.503L19.889,9.303C20.084,9.108 20.084,8.791 19.889,8.596L16.353,5.061C16.158,4.865 15.842,4.865 15.646,5.061L8.929,11.778L12.078,14.927C11.921,15.257 11.794,15.603 11.699,15.962L8.222,12.485L7.297,13.41L7.142,16.355L8.595,17.808L11.502,17.655C11.51,17.995 11.547,18.327 11.61,18.651L8.616,18.808L7.691,19.733C7.598,19.827 7.47,19.88 7.338,19.88L3.802,19.88C3.6,19.88 3.418,19.758 3.34,19.571C3.263,19.384 3.306,19.169 3.449,19.026L6.141,16.333L6.308,13.166C6.315,13.043 6.367,12.926 6.454,12.839L14.939,4.354Z",fill:"inherit",stroke:"none"}),g.createElement("path",{d:"M22,17.5C22,15.015 19.985,13 17.5,13C15.015,13 13,15.015 13,17.5C13,19.985 15.015,22 17.5,22C19.985,22 22,19.985 22,17.5ZM21,17.5C21,19.433 19.433,21 17.5,21C15.567,21 14,19.433 14,17.5C14,15.567 15.567,14 17.5,14C19.433,14 21,15.567 21,17.5Z",fill:"inherit",stroke:"none"}),g.createElement("path",{d:"M20.015,16.765C20.162,16.619 20.162,16.381 20.015,16.235C19.869,16.088 19.631,16.088 19.485,16.235L17,18.72L16.015,17.735C15.869,17.588 15.631,17.588 15.485,17.735C15.338,17.881 15.338,18.119 15.485,18.265L17,19.78L20.015,16.765Z",fill:"inherit",stroke:"none"}))}(Me||(Me={}));const Te=S.UI.Node.make((({state:e,notify:t})=>{const{onMount:n,ref:i}=le.P.useElWatcher();return le.P.useSubscriptionTo(i.pipe(N.oA,we.b((e=>t({kind:"buttonMounted",node:e})())))),g.createElement(U.F.Fragment,null,e.pipe(C.U((({inlineHighlightsEnabled:e,isSupported:i})=>i?g.createElement("div",{ref:n},g.createElement(V.zx.Ghost,{onClick:t({kind:"toggleInlineHighlights",enabled:!e}),name:"panel-toggle-highlight-button",title:e?A.disableInlineHighlights:A.enableInlineHighlights,ariaLabel:e?A.disableInlineHighlights:A.enableInlineHighlights,key:"inlineHighlightsButton"},e?g.createElement(Me.InlineHighlightsEnabled,null):g.createElement(Me.InlineHighlightsDisabled,null))):null))))}));function Fe(e){return S.Z.fromSideEffect((t=>{"toggleInlineHighlights"===t.kind?e.actions.next({kind:R.Kind.toggleInlineHighlights,enabled:t.enabled}):"buttonMounted"===t.kind?e.actions.next({kind:R.Kind.inlineHighlightOnboardingElementMounted,step:"highlightsSwitch",node:t.node}):(0,D.vE)(t)}),e.inlineHighlightsEnabled.pipe(C.U((t=>({inlineHighlightsEnabled:t,isSupported:e.areInlineHighlightsSupported})))))}var Ae=n(64908),Ge=n(86705),ze=n(53112),Le=n(58120);const Oe=({onClick:e,title:t,focusable:n,browser:i,ariaLabel:a})=>g.createElement(V.zx.Flat,{className:Le.recapButton,onClick:e,name:"recap-button",title:t,ariaLabel:a,tabIndex:n?0:-1},g.createElement(ne.K,{size:22.4,className:Le.logo}),g.createElement(Pe,null),g.createElement(Ge.v,{browser:i})),Pe=({color:e=ze.Z.neutral70})=>g.createElement("svg",{width:"44",height:"10",viewBox:"0 0 44 10",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":"Recap",className:Le.recap},g.createElement("path",{d:"M0 9.54578V0.454902H3.92401C4.53474 0.441273 5.14052 0.567287 5.69515 0.823335C6.18417 1.05365 6.59476 1.42255 6.8759 1.88423C7.168 2.38768 7.31401 2.96257 7.29756 3.54439C7.31546 4.10697 7.17223 4.66295 6.88473 5.14684C6.61248 5.58484 6.21939 5.93477 5.75281 6.15448L7.5994 9.54578H4.9183L3.32033 6.5451H2.46806V9.54578H0ZM2.46804 4.62749H3.33804C3.69403 4.64717 4.04783 4.56065 4.35456 4.37891C4.48182 4.28258 4.58244 4.1554 4.6469 4.00939C4.71137 3.86337 4.73756 3.70334 4.723 3.54439C4.73683 3.38295 4.71041 3.22059 4.64612 3.07185C4.58182 2.92312 4.48164 2.79264 4.35456 2.69212C4.05216 2.49864 3.69646 2.40545 3.33804 2.42578H2.46804V4.62749Z",fill:e}),g.createElement("path",{d:"M8.85059 9.5458V0.454918H15.4024V2.44356H11.3187V4.00606H15.0651V5.99469H11.3187V7.55719H15.3847V9.5458H8.85059Z",fill:e}),g.createElement("path",{d:"M25.1719 3.86399H22.6684C22.6488 3.48459 22.4872 3.12646 22.2156 2.8608C22.0648 2.72733 21.8892 2.6249 21.6988 2.5594C21.5084 2.49389 21.3069 2.46658 21.1059 2.47905C20.8315 2.46406 20.5576 2.51745 20.3089 2.63444C20.0602 2.75143 19.8445 2.92836 19.681 3.14933C19.3227 3.69763 19.15 4.34649 19.1883 5.00036C19.1409 5.66688 19.3157 6.33031 19.6854 6.8869C19.8521 7.09645 20.0662 7.26331 20.3101 7.37369C20.5541 7.48407 20.8208 7.53479 21.0882 7.52167C21.4779 7.542 21.862 7.42235 22.1713 7.18431C22.4451 6.94828 22.6221 6.61948 22.6684 6.26097L25.1719 6.27873C25.1359 6.68719 25.0261 7.08574 24.8479 7.45505C24.4293 8.33025 23.6927 9.01287 22.7883 9.36375C22.1411 9.60001 21.4525 9.70142 20.7647 9.66174C20.0769 9.62206 19.4045 9.44212 18.7888 9.133C18.1238 8.76993 17.5792 8.22072 17.2218 7.5527C16.8183 6.76399 16.6213 5.88584 16.6493 5.00033C16.62 4.11171 16.8219 3.23071 17.2352 2.44351C17.5977 1.77593 18.1468 1.22837 18.8154 0.867676C19.4982 0.504684 20.2616 0.319939 21.0348 0.330567C21.7374 0.318011 22.4343 0.458893 23.0768 0.743384C23.6602 1.00422 24.1608 1.42034 24.5238 1.94633C24.906 2.51684 25.1296 3.17864 25.1719 3.86399Z",fill:e}),g.createElement("path",{d:"M28.3137 9.5458H25.6504L28.6511 0.454918H32.0246L35.0254 9.5458H32.3621L31.8382 7.8058H28.8375L28.3137 9.5458ZM29.3968 5.95918H31.2789L30.3734 2.95847H30.3024L29.3968 5.95918Z",fill:e}),g.createElement("path",{d:"M36.2773 9.54575V0.454869H40.2013C40.8155 0.440928 41.4237 0.578119 41.9724 0.854376C42.4653 1.10813 42.8751 1.49788 43.1532 1.97742C43.4429 2.49314 43.5886 3.07729 43.5749 3.66865C43.5901 4.26188 43.4394 4.84758 43.1399 5.35988C42.852 5.83714 42.4307 6.21979 41.9281 6.46071C41.3612 6.72892 40.7395 6.86116 40.1125 6.8469H38.7453V9.54573L36.2773 9.54575ZM38.7453 4.9293H39.6153C39.9848 4.95083 40.3486 4.83012 40.6319 4.59194C40.7558 4.47337 40.8528 4.32958 40.9164 4.1703C40.9799 4.01102 41.0086 3.83995 41.0003 3.66865C41.0097 3.49854 40.9816 3.32845 40.9179 3.17043C40.8542 3.0124 40.7566 2.87032 40.6319 2.75423C40.3461 2.52145 39.9833 2.40425 39.6153 2.42575H38.7453V4.9293Z",fill:e})),Ke=S.UI.Grid.make((({state:e,slots:t,notify:n})=>(le.P.useEffectOnDidMount(n("panelMounted")),g.createElement(U.F.div,{className:Ae.panelGrid},g.createElement(U.F.div,{className:Ae.header},e.pipe(C.U((({expanded:e,browser:t,focusable:i})=>g.createElement(Oe,{onClick:n(e?"collapse":"expand"),title:e?A.recapCollapseTooltip:A.recapExpandTooltip,ariaLabel:e?A.recapCollapseTooltip:A.recapExpandTooltip,browser:t,focusable:i})))),t.header,g.createElement(U.F.div,{className:Ae.toolbar},t.toolbar)),t.content))));function Re(e){return S.Z.fromSideEffect((t=>{switch(t){case"collapse":e.actions.next({kind:R.Kind.collapse,source:O.recapButton});break;case"expand":e.actions.next({kind:R.Kind.expand,source:P.recapButton});break;case"panelMounted":e.actions.next({kind:R.Kind.panelMounted,subject:L.readerPanel});break;default:(0,D.vE)(t)}}),e.state.pipe(C.U((t=>({expanded:I(t),browser:e.browser,focusable:v.isNone(t.feedbackDialog)})))))}const He=S.UI.Node.make((({state:e,notify:t})=>{const{onMount:n,ref:i}=le.P.useElWatcher();return le.P.useSubscriptionTo(i.pipe(N.oA,we.b((e=>t({kind:"buttonMounted",node:e})())))),g.createElement(U.F.Fragment,null,e.pipe(C.U((({expanded:e,focusable:i})=>g.createElement("div",{ref:n},g.createElement(V.zx.Ghost,{onClick:t(e?{kind:"buttonClicked",state:"collapse"}:{kind:"buttonClicked",state:"expand"}),name:"toggle-panel-button",title:e?A.collapseIconTooltip:A.expandIconTooltip,ariaLabel:e?A.collapseIconTooltip:A.expandIconTooltip,tabIndex:i?0:-1},g.createElement(T.JO.Arrow,{direction:e?T.n4.up:T.n4.down})))))))}));function Be(e){return S.Z.fromSideEffect((t=>{if("buttonClicked"===t.kind)switch(t.state){case"expand":e.actions.next({kind:R.Kind.expand,source:P.expandButton});break;case"collapse":e.actions.next({kind:R.Kind.collapse,source:O.collapseButton});break;default:(0,D.vE)(t.state)}else"buttonMounted"===t.kind?e.actions.next({kind:R.Kind.inlineHighlightOnboardingElementMounted,step:"panelSwitch",node:t.node}):(0,D.vE)(t)}),e.state.pipe(C.U((e=>({expanded:I(e),focusable:v.isNone(e.feedbackDialog)})))))}const De=S.UI.Grid.make((({slots:e})=>g.createElement(U.F.Fragment,null,e.toggleInlineHighlights,e.feedback,e.togglePanel))),Ve=S.UI.Knot.make(De,{feedback:Se,togglePanel:He,toggleInlineHighlights:Te}),Ze=S.UI.Union.make("kind",{loaded:Ve,loading:S.UI.Node.make((()=>g.createElement(X.$,{variation:"blue",size:18,strokeWidth:3,wrapperClassName:ee.spinner})))}),je=S.UI.Node.make((({view:e})=>g.createElement(U.F.div,{className:ee.header},e("nothingToRecap").pipe(C.U((0,b.RN)(g.createElement("div",{className:ee.nothingToRecap},A.collapsedNothingToRecap),g.createElement(g.Fragment,null))))))),qe=S.UI.Knot.make(Ke,{header:je,toolbar:Ze,content:S.UI.Node.empty});function We(e){return S.Z.composeKnot({root:Re(e),header:()=>e.state.pipe(B.h(y)),toolbar:S.Z.composeUnion({loaded:S.Z.composeKnot({feedback:Ne(e,!0,(e=>"collapsedPanelButton"===e.source.kind)),togglePanel:Be(e),toggleInlineHighlights:Fe(e)}),loading:()=>M.of(null)},(()=>e.state.pipe(B.h(y),C.U((e=>({kind:e.loading?"loading":"loaded"})))))),content:()=>M.of(null)})}var $e=n(49708),Qe=n(83771);const Je=(0,ae.xb)((({children:e})=>g.createElement("h6",{className:Qe.sectionTitle},e))),Ye=e=>S.UI.Grid.make((({slots:t,notify:n})=>{const{onMount:i,ref:a}=le.P.useElWatcher();return le.P.useSubscriptionTo(a.pipe(N.cp((e=>$e.R(e,"scroll"))),we.b(n("scroll")))),g.createElement("div",{className:Qe.column,style:{flex:e}},g.createElement("div",{className:Qe.scrollView,ref:i},g.createElement(Je,null,t.title),t.content))})),Xe=S.UI.Grid.make((({slots:e})=>g.createElement(U.F.div,{className:Qe.layout},e.summary,e.questions,e.links))),et=350,tt=307,nt=266;var it=n(26328),at=n(64015),ot=n(62337),st=n(19429),rt=n(28043),lt=n(66310);const dt={URI:"Observable",map:(e,t)=>e.pipe(C.U(t)),ap:(e,t)=>ie.aj([e,t]).pipe(C.U((([e,t])=>e(t)))),of:e=>M.of(e)};function ct(e,t,n){return st.VF((i=>(0,o.zG)(t(i),rt.x(),lt.w((t=>n.traverseWithIndex(dt)(t,((t,n)=>e(n,t)(i.pipe(B.h((e=>e.key===t)),C.U((e=>e.action)))))))),rt.x())))}var mt=n(99094),ut=n(23063),ht=n(93253);function pt(){return S.UI.Grid.make((({state:e,view:t,slots:n,notify:i})=>{const{ref:a,onMount:s}=le.P.useElWatcher(),r=g.useRef(new xe.xQ),l=g.useRef(u.h.create(!1));return g.useEffect((()=>{const e=t("item").pipe(ut.q(1)).subscribe((e=>i({kind:"show",item:e})()));return()=>e.unsubscribe()}),[]),le.P.useSubscriptionTo(r.current.pipe(_e.M(a),C.U((([e,t])=>(0,o.zG)(t,v.map((t=>{let n=0,i=0;const a=t.offsetParent;let o=t;for(;o&&o!==a;)n+=o.scrollTop,i+=o.scrollLeft,o=o.parentElement;return{item:e,top:t.offsetTop-n,left:t.offsetLeft+t.offsetWidth-i,width:t.offsetWidth,height:t.offsetHeight}}))))),N.oA,C.U((({item:e,top:t,left:n,width:a,height:o})=>i({kind:"openMenu",item:e,itemRect:ot.Wm.create({top:t,left:n,width:a,height:o})})())))),g.createElement(U.F.li,{...(0,ae.Sh)(ht.item,e.pipe(C.U((e=>e.item.pinned)),C.U((0,b.RN)(ht.pinned,void 0)))),mount:s,tabIndex:t("focusable").pipe(C.U((e=>e?0:-1))),onFocus:t("item").pipe(C.U((e=>()=>{requestAnimationFrame((()=>{i({kind:"focus",item:e})()}))}))),onBlur:t("item").pipe(C.U((e=>t=>{const n=t.currentTarget;requestAnimationFrame((()=>{var t,a;n.contains(document.activeElement)||n.contains((null===(a=null===(t=document.activeElement)||void 0===t?void 0:t.shadowRoot)||void 0===a?void 0:a.activeElement)||null)||i({kind:"blur",item:e})()}))}))),onKeyDown:e=>{var t,n;"ArrowDown"===e.key&&(null===(t=e.currentTarget)||void 0===t?void 0:t.nextElementSibling)instanceof HTMLElement?e.currentTarget.nextElementSibling.focus():"ArrowUp"===e.key&&(null===(n=e.currentTarget)||void 0===n?void 0:n.previousElementSibling)instanceof HTMLElement&&e.currentTarget.previousElementSibling.focus()},onMouseLeave:()=>{l.current.set(!1)},onMouseOver:()=>{l.current.set(!0)}},g.createElement("label",{className:ht.content},n.title,g.createElement(mt.f.Context.Provider,{value:{hovered:l.current}},n.item)),g.createElement(U.F.div,{className:ht.moreButton},e.pipe(C.U((e=>g.createElement(V.zx.Ghost,{title:A.expandedPanel.actionsButtonTooltip,tabIndex:e.focusable?0:-1,onClick:()=>r.current.next(e.item),ariaLabel:"Actions",name:"actions-button"},g.createElement(T.JO.EllipsisSmall,{className:ht.ellipsis})))))),n.menu,n.feedback)}))}function gt(e,t,n,i,a){return o=>{switch(o.kind){case"show":a(o.item);break;case"focus":t.set(i(o.item));break;case"blur":e.actions.next({kind:R.Kind.itemBlur});break;case"openMenu":e.actions.next({kind:R.Kind.openItemMenu,itemId:i(o.item)}),n.set(v.some(o.itemRect)),t.set(i(o.item));break;default:(0,D.vE)(o)}}}function ft(e,t,n,i){return(n===e||null===n&&0===t)&&v.isNone(i)}var bt,vt=n(81336),kt=n(83078),yt=n(67465);function It(){return S.UI.Node.make((({view:e,state:t,notify:n})=>{const{ref:i,onMount:a}=le.P.useElWatcher(),s=g.useRef(new xe.xQ);return le.P.useSubscriptionTo(s.current.pipe(_e.M(i),C.U((([e,t])=>(0,o.zG)(t,v.map(ce.UL.fromEl),v.map((t=>({...e,buttonRect:t})))))),N.oA,we.b((e=>n(e)())))),g.createElement(U.F.div,{mount:a,...(0,ae.Sh)(yt.menu,e("item").pipe(C.U((e=>e.pinned?yt.pinned:void 0)))),style:e("bottomRightCorner").pipe(C.U(v.fold((()=>({display:"none"})),(e=>({...e,display:"flex"})))))},t.pipe(C.U((({item:e,clipboardSupported:t,feedbackDialogActive:i,feedbackSupported:a})=>{const r=e.rating===vt.DE.liked||(0,o.zG)(i,kt.FX("like")),l=e.rating===vt.DE.disliked||(0,o.zG)(i,kt.FX("dislike"));return g.createElement(g.Fragment,null,t?g.createElement(V.zx.Flat,{name:"copy-button",title:A.expandedPanel.itemMenu.copyTooltip,ariaLabel:A.expandedPanel.itemMenu.copyTooltip,className:yt.button,onClick:n({kind:"copy",item:e})},g.createElement(T.JO.Copy,null)):null,g.createElement(V.zx.Flat,{name:"pin-button",title:e.pinned?A.expandedPanel.itemMenu.unpinTooltip:A.expandedPanel.itemMenu.pinTooltip,ariaLabel:e.pinned?A.expandedPanel.itemMenu.unpinTooltip:A.expandedPanel.itemMenu.pinTooltip,className:yt.button,onClick:n({kind:"pin",item:e,pinned:!e.pinned}),active:e.pinned},g.createElement(T.JO.Pin,null)),g.createElement(V.zx.Flat,{name:"remove-button",title:A.expandedPanel.itemMenu.dismissTooltip,ariaLabel:A.expandedPanel.itemMenu.dismissTooltip,className:yt.button,onClick:n({kind:"dismiss",item:e})},g.createElement(T.JO.Ignore,null)),a?g.createElement(g.Fragment,null,g.createElement("div",{className:yt.separator}),v.isSome(i)||void 0===e.rating?g.createElement(g.Fragment,null,g.createElement(V.zx.Flat,{name:"dislike-button",title:A.expandedPanel.itemMenu.dislikeTooltip,ariaLabel:A.expandedPanel.itemMenu.dislikeTooltip,className:yt.button,onClick:()=>s.current.next({kind:"dislike",item:e}),active:l},l?g.createElement(bt.ThumbsDownFilled,null):g.createElement(bt.ThumbsDown,null)),g.createElement(V.zx.Flat,{name:"like-button",title:A.expandedPanel.itemMenu.likeTooltip,ariaLabel:A.expandedPanel.itemMenu.likeTooltip,className:yt.button,onClick:()=>s.current.next({kind:"like",item:e}),active:r},r?g.createElement(bt.ThumbsUpFilled,null):g.createElement(bt.ThumbsUp,null))):r?g.createElement(bt.ThumbsUpFilled,{className:yt.inactiveIcon}):l?g.createElement(bt.ThumbsDownFilled,{className:yt.inactiveIcon}):null):null)}))))}))}function xt(e,t={dialogSide:"top",alignment:"right"}){return n=>{switch(n.kind){case"copy":e.copy(n.item);break;case"dismiss":e.dismiss(n.item);break;case"pin":e.pin(n.item,n.pinned);break;case"like":e.like(n.item,{sourceRect:n.buttonRect,...t});break;case"dislike":e.dislike(n.item,{sourceRect:n.buttonRect,...t});break;default:(0,D.vE)(n)}}}function _t(e,t,n,i){return v.toNullable(t)===e||(0,o.zG)(n,v.exists(i(e)))}!function(e){e.ThumbsDown=({className:e,width:t=18})=>g.createElement(T.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},g.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.94506 1.49087L3.94129 1.49999L1.22638 7.89292C1.06797 8.31105 1.03966 8.85929 1.01631 9.57841L1.01618 9.58249C1.01167 9.72126 1.00697 9.8662 1.00031 10.0091C1.00591 10.1675 1.08822 10.3603 1.28344 10.5353C1.48809 10.7188 1.74942 10.8182 1.97538 10.8182H8.88923L7.78363 16.1831C7.74404 16.3671 7.78727 16.6111 7.90957 16.807C7.92806 16.8367 7.94592 16.8618 7.96283 16.883C7.97026 16.8765 7.97776 16.87 7.98532 16.8633C8.08412 16.7763 8.18009 16.6875 8.25236 16.6196C8.28819 16.5859 8.31747 16.558 8.33751 16.5387L8.36015 16.5169L8.36114 16.516L13.3603 11.4772C13.5028 11.3373 13.5926 11.1398 13.5926 10.9091V1.81818C13.5926 1.57101 13.483 1.34726 13.3061 1.1944C13.1632 1.07085 12.9836 1 12.7901 1H4.67906C4.66798 1 4.6565 1.00023 4.64528 1.00068M9.06411 17.2273C9.06411 17.2273 8.27026 18 8.10374 18C7.25484 18 6.60509 16.9062 6.80597 15.9727L7.66214 11.8182H1.97538C0.984023 11.8182 0 10.9917 0 9.9917C0.0070643 9.84692 0.0119094 9.6977 0.0168363 9.54596C0.039042 8.86205 0.0629075 8.12702 0.299089 7.51818L3.0208 1.10909C3.03813 1.06714 3.05698 1.02601 3.07728 0.985763C3.28437 0.575142 3.64235 0.257042 4.07809 0.102666C4.2438 0.0439576 4.42076 0.00892764 4.60495 0.00149288C4.62942 0.000509854 4.65435 0 4.67906 0H12.7901C13.2356 0 13.6447 0.165198 13.9601 0.437858C14.3466 0.771997 14.5926 1.26752 14.5926 1.81818V10.9091C14.5926 11.4091 14.3943 11.8636 14.0609 12.1909L9.06411 17.2273ZM4.64528 1.00068C4.56232 1.00405 4.48416 1.01971 4.41203 1.04526C4.22152 1.11276 4.06246 1.25304 3.97014 1.43608C3.96113 1.45395 3.95276 1.47222 3.94506 1.49087M17.3951 1V9.90909H19V1H17.3951ZM16.3951 0.75C16.3951 0.335787 16.7308 0 17.1451 0H19.25C19.6642 0 20 0.335786 20 0.75V10.1591C20 10.5733 19.6642 10.9091 19.25 10.9091H17.1451C16.7308 10.9091 16.3951 10.5733 16.3951 10.1591V0.75Z",stroke:"none"})),e.ThumbsUp=({className:e,width:t=18})=>g.createElement(T.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},g.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.0549 16.5091L16.0587 16.5L18.7736 10.1071C18.932 9.68895 18.9603 9.14071 18.9837 8.42159L18.9838 8.41751C18.9883 8.27874 18.993 8.1338 18.9997 7.99095C18.9941 7.83251 18.9118 7.63967 18.7166 7.46467C18.5119 7.28121 18.2506 7.18182 18.0246 7.18182L11.1108 7.18182L12.2164 1.8169C12.256 1.63292 12.2127 1.38894 12.0904 1.19295C12.0719 1.16332 12.0541 1.13822 12.0372 1.11697C12.0297 1.12346 12.0222 1.13004 12.0147 1.13671C11.9159 1.22375 11.8199 1.31246 11.7476 1.38043C11.7118 1.41412 11.6825 1.44205 11.6625 1.46127L11.6399 1.48305L11.6389 1.48402L6.63965 6.52285C6.49717 6.66269 6.40741 6.86024 6.40741 7.09091L6.40741 16.1818C6.40741 16.429 6.51702 16.6527 6.69386 16.8056C6.83679 16.9291 7.01641 17 7.20987 17L15.3209 17C15.332 17 15.3435 16.9998 15.3547 16.9993M10.9359 0.772727C10.9359 0.772727 11.7297 -7.23009e-07 11.8963 -7.08451e-07C12.7452 -6.34238e-07 13.3949 1.09375 13.194 2.02727L12.3379 6.18182L18.0246 6.18182C19.016 6.18182 20 7.0083 20 8.0083C19.9929 8.15308 19.9881 8.3023 19.9832 8.45404C19.961 9.13795 19.9371 9.87298 19.7009 10.4818L16.9792 16.8909C16.9619 16.9329 16.943 16.974 16.9227 17.0142C16.7156 17.4249 16.3577 17.743 15.9219 17.8973C15.7562 17.956 15.5792 17.9911 15.395 17.9985C15.3706 17.9995 15.3456 18 15.3209 18L7.20987 18C6.76441 18 6.35535 17.8348 6.03991 17.5621C5.65335 17.228 5.40741 16.7325 5.40741 16.1818L5.40741 7.09091C5.40741 6.59091 5.60568 6.13636 5.93913 5.80909L10.9359 0.772727ZM15.3547 16.9993C15.4377 16.996 15.5158 16.9803 15.588 16.9547C15.7785 16.8872 15.9375 16.747 16.0299 16.5639C16.0389 16.5461 16.0472 16.5278 16.0549 16.5091M2.60495 17L2.60495 8.09091L1.00003 8.09091L1.00003 17L2.60495 17ZM3.60495 17.25C3.60495 17.6642 3.26916 18 2.85495 18L0.750031 18C0.335817 18 3.05469e-05 17.6642 3.05831e-05 17.25L3.14057e-05 7.84091C3.14419e-05 7.4267 0.335818 7.09091 0.750031 7.09091L2.85495 7.09091C3.26916 7.09091 3.60495 7.4267 3.60495 7.84091L3.60495 17.25Z",stroke:"none"})),e.ThumbsDownFilled=({className:e,width:t=18})=>g.createElement(T.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},g.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.0208 1.10909C3.03813 1.06714 3.05698 1.02601 3.07728 0.985763C3.28437 0.575142 3.64235 0.257042 4.07809 0.102666C4.2438 0.0439576 4.42076 0.00892764 4.60495 0.00149288C4.62942 0.000509854 4.65435 0 4.67906 0H12.7901C13.2356 0 13.6447 0.165198 13.9601 0.437858C14.3466 0.771997 14.5926 1.26752 14.5926 1.81818V10.9091C14.5926 11.4091 14.3943 11.8636 14.0609 12.1909L9.06411 17.2273C9.06411 17.2273 8.27026 18 8.10374 18C7.25484 18 6.60509 16.9062 6.80597 15.9727L7.66214 11.8182H1.97538C0.984023 11.8182 0 10.9917 0 9.9917C0.0070643 9.84692 0.0119094 9.6977 0.0168363 9.54596C0.039042 8.86205 0.0629075 8.12702 0.299089 7.51818L3.0208 1.10909Z",stroke:"none"}),g.createElement("path",{d:"M17.1451 0C16.7308 0 16.3951 0.335787 16.3951 0.75V10.1591C16.3951 10.5733 16.7308 10.9091 17.1451 10.9091H19.25C19.6642 10.9091 20 10.5733 20 10.1591V0.75C20 0.335786 19.6642 0 19.25 0H17.1451Z",stroke:"none"})),e.ThumbsUpFilled=({className:e,width:t=18})=>g.createElement(T.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},g.createElement("path",{d:"M16.9792 16.8909C16.9618 16.9329 16.943 16.974 16.9227 17.0142C16.7156 17.4249 16.3576 17.743 15.9219 17.8973C15.7562 17.956 15.5792 17.9911 15.395 17.9985C15.3706 17.9995 15.3456 18 15.3209 18L7.20984 18C6.76438 18 6.35532 17.8348 6.03988 17.5621C5.65332 17.228 5.40738 16.7325 5.40738 16.1818L5.40738 7.09091C5.40738 6.59091 5.60565 6.13636 5.9391 5.80909L10.9359 0.772727C10.9359 0.772727 11.7297 0 11.8962 0C12.7451 0 13.3949 1.09375 13.194 2.02727L12.3378 6.18182L18.0246 6.18182C19.0159 6.18182 20 7.0083 20 8.0083C19.9929 8.15308 19.9881 8.3023 19.9831 8.45404C19.9609 9.13795 19.9371 9.87298 19.7009 10.4818L16.9792 16.8909Z",stroke:"none"}),g.createElement("path",{d:"M2.85492 18C3.26913 18 3.60492 17.6642 3.60492 17.25L3.60492 7.84091C3.60492 7.4267 3.26913 7.09091 2.85492 7.09091L0.750001 7.09091C0.335788 7.09091 0 7.42669 0 7.84091V17.25C0 17.6642 0.335787 18 0.75 18H2.85492Z",stroke:"none"}))}(bt||(bt={}));var wt=n(50243);const Et=({children:e})=>g.createElement(U.F.ul,{className:wt.list},e);var Ct=n(39335),Ut=n(38459);const St=S.UI.Node.make((({state:e,notify:t})=>g.createElement(U.F.Fragment,null,e.pipe(C.U((({item:e,focusable:n})=>g.createElement("a",{href:e.url,target:"_blank",rel:"noreferrer",key:Ct.createHash("superfasthash").hash(`${e.url}${e.mimeType?e.mimeType:""}`),className:Ut.linkWrapper,tabIndex:n?0:-1,onClick:t({item:e})},g.createElement("div",{className:Ut.linkAndIcon},function(e,t){switch(e){case"hyperlink":return g.createElement(T.JO.Formatting.Link,{className:Ut.icon});case"email":return g.createElement(T.JO.Attachments.Email,{className:Ut.icon});case"attachment":switch(t){case"text/plain":case"text/html":case"application/msword":case"application/vnd.apple.pages":return g.createElement(T.JO.Attachments.Document,{className:Ut.icon});case"application/vnd.ms-excel":case"application/vnd.apple.numbers":return g.createElement(T.JO.Attachments.Spreadsheet,{className:Ut.icon});case"application/vnd.ms-powerpoint":case"application/vnd.apple.keynote":return g.createElement(T.JO.Attachments.Presentation,{className:Ut.icon});case"application/pdf":return g.createElement(T.JO.Attachments.Pdf,{className:Ut.icon});case"application/zip":case"application/vnd.rar":return g.createElement(T.JO.Attachments.Archive,{className:Ut.icon});default:return t?/^image\/.+/.test(t)?g.createElement(T.JO.Attachments.Image,{className:Ut.icon}):/^video\/.+/.test(t)?g.createElement(T.JO.Attachments.Video,{className:Ut.icon}):g.createElement(T.JO.Attachments.Attachment,{className:Ut.icon}):g.createElement(T.JO.Formatting.Link,{className:Ut.icon})}default:return g.createElement(T.JO.Formatting.Link,{className:Ut.icon})}}(e.type,e.mimeType),g.createElement("span",{className:Ut.link},"hyperlink"===e.type?""!==e.name?e.name:e.url:e.name)))))))));var Nt=n(69566);const Mt=({title:e})=>g.createElement(U.F.div,{className:Nt.title},e),Tt=pt(),Ft=It(),At=S.UI.Knot.make(Tt,{item:St,title:S.UI.Union.asOption(S.UI.Node.make((({state:e})=>g.createElement(Mt,{title:e})))),menu:Ft,feedback:S.UI.Node.empty}),Gt=S.UI.List.make(at.Bk,At),zt=S.UI.Composite.make(S.UI.Grid.make((({slots:e})=>g.createElement(Et,null,e.links))),Gt),Lt=e=>t=>e.actions.next({kind:R.Kind.linkClick,item:t.item});function Ot(e,t,n){const i=u.h.create(null),a=u.h.create(v.none),s=e.state.pipe(B.h((0,b.Kg)(_,x)),C.U((e=>e.activeMenuItemId)));return ct(((r,l)=>{const d=t.pipe(C.U((0,o.ls)(at.hX((e=>e.url===r)),at.YM)),N.oA),c=ie.aj([e.state.view("feedbackDialog"),d,i,s,a]).pipe(C.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:_t(r,i,v.none,(()=>()=>!1)),focusable:ft(r,l,n,e)}))),rt.x());return S.Z.composeKnot({root:S.Z.fromSideEffect(gt(e,i,a,(e=>e.url),(t=>e.actions.next({kind:R.Kind.itemMounted,itemType:"linkItem",item:t}))),c.pipe(C.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:S.Z.fromSideEffect(Lt(e),c.pipe(C.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),title:()=>d.pipe(C.U(n)),menu:S.Z.fromSideEffect(xt({pin:(t,n)=>e.actions.next({kind:R.Kind.pin,pinned:n,itemType:"linkItem",item:t}),copy:t=>e.actions.next({kind:R.Kind.copy,itemType:"linkItem",item:t}),dismiss:t=>e.actions.next({kind:R.Kind.dismiss,itemType:"linkItem",item:t}),like:o.Q1,dislike:o.Q1}),c.pipe(C.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,o.zG)(t.itemRect,v.map(ot.Wm.topLeftPoint)):v.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:!1,feedbackDialogActive:v.none}))))),feedback:()=>M.of(null)})}),(()=>t.pipe(C.U(at.UI(f.ei("url"))))),at.Bk)}var Pt=n(47397);const Kt=({title:e,children:t})=>g.createElement("div",{className:Pt.empty},g.createElement(U.F.div,{className:Pt.title},e),g.createElement(U.F.div,{className:Pt.body},t));var Rt=n(45587);const Ht={lineAndAvatar:Rt.lineAndAvatar,lineAndCheckbox:Rt.lineAndCheckbox,lineOnly:Rt.lineOnly},Bt=({lineCount:e,type:t,className:n})=>g.createElement("div",{className:n},[...Array(e).keys()].map((e=>g.createElement("div",{...(0,ae.Sh)(Rt.itemLoading,Ht[t]),key:e},g.createElement("div",{className:Rt.rect}),g.createElement("div",{className:Rt.line})))));var Dt=n(25756);const Vt=S.UI.Node.make((({state:e,notify:t})=>{const{ref:n,onMount:i}=le.P.useElWatcher(),a=g.useRef(new xe.xQ);return le.P.useSubscriptionTo(a.current.pipe(_e.M(n),C.U((([e,t])=>v.map(ce.UL.fromEl)(t))),N.oA,we.b((e=>t({kind:"openFeedback",buttonRect:e})())))),g.createElement(U.F.Fragment,null,e.pipe(C.U((({isSupported:e,CTA:t,body:n})=>e?g.createElement(g.Fragment,null,n,g.createElement(V.zx.Ghost,{className:Dt.emptyCTAButton,mount:i,onClick:()=>a.current.next(),name:"open-feedback-button"},t)):null))))}));function Zt(e,t,n,i={dialogSide:"top",alignment:"left"}){return S.Z.fromSideEffect((t=>{if("openFeedback"===t.kind)e.actions.next({kind:R.Kind.openFeedback,source:{kind:n},position:{sourceRect:t.buttonRect,...i}});else(0,D.vE)(t.kind)}),{isSupported:e.isSubmitFeedbackDialogSupported,...t})}const jt=S.UI.Grid.make((({slots:e})=>g.createElement(U.F.Fragment,null,e.button,e.dialog))),qt=S.UI.Knot.make(jt,{button:Vt,dialog:ke});function Wt(e,t,n,i){return S.Z.composeKnot({button:Zt(e,t,n,i),dialog:Ie(e,(e=>e.source.kind===n))})}const $t=S.UI.Node.make((({view:e,notify:t})=>g.createElement(Kt,{title:e("title")},e("body"),g.createElement(V.zx.Ghost,{className:Dt.emptyCTAButton,onClick:t("show-anyway"),name:"show-anyway-button"},e("CTA"))))),Qt=S.UI.Grid.make((({view:e,slots:t})=>g.createElement(g.Fragment,null,g.createElement("div",{className:Dt.warningGroup},g.createElement(T.JO.NotificationWarning,{width:16,className:Dt.warningIcon}),g.createElement(U.F.Fragment,null,e("title"))),g.createElement(U.F.Fragment,null,t.content)))),Jt=S.UI.Union.make("viewState",{showContent:S.UI.Group.make({content:zt}),hideFilteredMessageContent:$t,showFilteredMessageContent:S.UI.Knot.make(Qt,{content:zt})}),Yt=S.UI.Composite.make(S.UI.Grid.make((({slots:e})=>g.createElement(Kt,{title:A.expandedPanel.threadView.links.empty.title},e.button))),qt),Xt=S.UI.Union.make("_tag",{None:Yt,Some:S.UI.Group.make({value:Jt})}),en=S.UI.Node.make((()=>g.createElement(Bt,{type:"lineAndAvatar",lineCount:2}))),tn=S.UI.Union.make("type",{InProgress:en,Fatal:Yt,Error:Yt,Success:Xt});function nn(e){const t=e.state.pipe(B.h(x),C.U((e=>e.links)),B.h(v.isSome),C.U((e=>e.value))),n=t.pipe(C.U(f.ei("data")),B.h(m.d6),C.U((e=>e.value))),i=()=>Wt(e,A.expandedPanel.threadView.links.empty,"emptyLinksViewButton",{dialogSide:"top",alignment:"right"});return S.Z.composeUnion({InProgress:()=>M.of(null),Error:i(),Fatal:i(),Success:S.Z.composeUnion({None:i(),Some:S.Z.composeKnot({value:S.Z.composeUnion({showContent:S.Z.composeKnot({content:Ot(e,n,(()=>v.none))}),hideFilteredMessageContent:S.Z.fromSideEffect((t=>e.actions.next({kind:R.Kind.showFilteredContent,column:"links"})),A.expandedPanel.threadView.links.filteredHidden),showFilteredMessageContent:S.Z.composeKnot({root:()=>M.of(A.expandedPanel.threadView.links.filteredShown),content:Ot(e,n,(()=>v.none))})},(()=>t.pipe(C.U((({viewState:e})=>({viewState:e}))))))})},(()=>(0,o.zG)(n,C.U(it.nI))))},(()=>t.pipe(C.U((e=>({type:e.data.type}))))))}var an,on;!function(e){function t(e){return"itemPanelMenu"===e.kind}e.isCollapsedPanelButton=function(e){return"collapsedPanelButton"===e.kind},e.isExpandedPanelHeaderButton=function(e){return"expandedPanelHeaderButton"===e.kind},e.isReaderItemMenu=t,e.isReaderSummaryItemMenu=function(e){return t(e)&&"summaryItem"===e.itemType},e.isReaderQuestionItemMenu=function(e){return t(e)&&"followUpItem"===e.itemType}}(an||(an={})),function(e){function t(e){return an.isReaderItemMenu(e.source)}e.isReaderSummaryItemMenu=function(e){return t(e)&&an.isReaderSummaryItemMenu(e.source)},e.isReaderQuestionItemMenu=function(e){return t(e)&&an.isReaderQuestionItemMenu(e.source)}}(on||(on={}));var sn=n(35115);const rn=S.UI.Knot.make(se(A.tellsUsMoreFeedbackDialog),{title:S.UI.Node.make((()=>g.createElement("h1",{className:sn.title},A.tellsUsMoreFeedbackDialog.title))),rating:S.UI.Node.empty,description:S.UI.Node.make((()=>g.createElement("p",{className:sn.description},A.tellsUsMoreFeedbackDialog.description)))}),ln=S.UI.Knot.make(he,{content:rn}),dn=S.UI.Union.asOption(ln);function cn(e,t){return S.Z.composeUnion({Some:S.Z.composeKnot({value:S.Z.composeKnot({root:pe(e),content:S.Z.composeKnot({root:re(e,v.none),title:()=>M.of(null),rating:()=>M.of(null),description:()=>M.of(null)})})}),None:()=>M.of(null)},(()=>e.state.pipe(C.U((0,o.ls)(f.ei("feedbackDialog"),v.filter(t))))))}var mn=n(31944),un=n(11071);const hn=S.UI.Node.make((({state:e,notify:t})=>g.createElement(U.F.Fragment,null,e.pipe(C.U((({item:e,focusable:n})=>g.createElement(mn.J,{checked:e.checked,labelId:`question-item-${e.itemId}`,className:un.checkboxWrapper,checkboxClassName:un.checkbox,labelClassName:un.label,onChange:n=>t({checked:n,item:e})(),tabIndex:n?0:-1},g.createElement("div",{...(0,ae.Sh)(e.checked?un.textChecked:void 0,un.itemText)},e.text)))))))),pn=pt(),gn=It(),fn=S.UI.Knot.make(pn,{item:hn,title:S.UI.Union.asOption(S.UI.Node.make((({state:e})=>g.createElement(Mt,{title:e})))),menu:gn,feedback:dn}),bn=(S.UI.List.make(at.Bk,fn),S.UI.Composite.make(S.UI.Grid.make((({slots:e})=>g.createElement(Et,null,e.list))),S.UI.List.make(at.Bk,fn))),vn=e=>t=>e.actions.next({kind:R.Kind.check,item:t.item,checked:t.checked}),kn=e=>t=>on.isReaderQuestionItemMenu(t)&&t.source.item.itemId===e;function yn(e,t,n){const i=u.h.create(null),a=u.h.create(v.none),s=e.state.pipe(B.h((0,b.Kg)(_,x)),C.U((e=>e.activeMenuItemId)));return ct(((r,l)=>{const d=t.pipe(C.U((0,o.ls)(at.hX((e=>e.itemId===r)),at.YM)),N.oA),c=ie.aj([e.state.view("feedbackDialog"),d,i,s,a]).pipe(C.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:_t(r,i,e,kn),feedbackDialogActive:(0,o.zG)(e,v.filter(kn(r)),v.map((e=>e.source.action))),focusable:ft(r,l,n,e)}))),rt.x());return S.Z.composeKnot({root:S.Z.fromSideEffect(gt(e,i,a,(e=>e.itemId),(t=>e.actions.next({kind:R.Kind.itemMounted,itemType:"followUpItem",item:t}))),c.pipe(C.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:S.Z.fromSideEffect(vn(e),c.pipe(C.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),title:()=>d.pipe(C.U(n)),menu:S.Z.fromSideEffect(xt({pin:(t,n)=>e.actions.next({kind:R.Kind.pin,pinned:n,itemType:"followUpItem",item:t}),copy:t=>e.actions.next({kind:R.Kind.copy,itemType:"followUpItem",item:t}),dismiss:t=>e.actions.next({kind:R.Kind.dismiss,itemType:"followUpItem",item:t}),like:(t,n)=>e.actions.next({kind:R.Kind.like,itemType:"followUpItem",item:t,position:n}),dislike:(t,n)=>e.actions.next({kind:R.Kind.dislike,itemType:"followUpItem",item:t,position:n})}),c.pipe(C.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,o.zG)(t.itemRect,v.map(ot.Wm.topLeftPoint)):v.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:e.isSubmitFeedbackDialogSupported,feedbackDialogActive:t.feedbackDialogActive}))))),feedback:cn(e,kn(r))})}),(()=>t.pipe(C.U(at.UI(f.ei("itemId"))))),at.Bk)}const In=S.UI.Union.make("viewState",{showContent:S.UI.Group.make({content:bn}),hideFilteredMessageContent:$t,showFilteredMessageContent:S.UI.Knot.make(Qt,{content:bn})}),xn=S.UI.Composite.make(S.UI.Grid.make((({slots:e})=>g.createElement(Kt,{title:A.expandedPanel.threadView.followUps.empty.title},e.button))),qt),_n=S.UI.Union.make("_tag",{None:xn,Some:S.UI.Group.make({value:In})}),wn=S.UI.Node.make((()=>g.createElement(Bt,{type:"lineAndCheckbox",lineCount:2}))),En=S.UI.Union.make("type",{InProgress:wn,Error:xn,Fatal:xn,Success:_n});function Cn(e){const t=e.state.pipe(B.h(x),C.U((e=>e.questions)),B.h(v.isSome),C.U((e=>e.value))),n=t.pipe(C.U(f.ei("data")),B.h(m.d6),C.U((e=>e.value))),i=()=>Wt(e,A.expandedPanel.threadView.followUps.empty,"emptyFollowUpsViewButton");return S.Z.composeUnion({InProgress:()=>M.of(null),Error:i(),Fatal:i(),Success:S.Z.composeUnion({None:i(),Some:S.Z.composeKnot({value:S.Z.composeUnion({showContent:S.Z.composeKnot({content:yn(e,n,(()=>v.none))}),hideFilteredMessageContent:S.Z.fromSideEffect((t=>e.actions.next({kind:R.Kind.showFilteredContent,column:"followUps"})),A.expandedPanel.threadView.followUps.filteredHidden),showFilteredMessageContent:S.Z.composeKnot({root:()=>M.of(A.expandedPanel.threadView.followUps.filteredShown),content:yn(e,n,(()=>v.none))})},(()=>t.pipe(C.U((({viewState:e})=>({viewState:e}))))))})},(()=>(0,o.zG)(n,C.U(it.nI))))},(()=>t.pipe(C.U((e=>({type:e.data.type}))))))}var Un=n(83581);const Sn=pt(),Nn=It(),Mn=S.UI.Knot.make(Sn,{item:S.UI.Node.make((({state:e})=>g.createElement(U.F.div,{className:Un.itemText},e))),title:S.UI.Union.asOption(S.UI.Node.make((({state:e})=>g.createElement(Mt,{title:e})))),menu:Nn,feedback:dn}),Tn=S.UI.List.make(at.Bk,Mn),Fn=S.UI.Composite.make(S.UI.Grid.make((({slots:e})=>g.createElement(Et,null,e.list))),Tn),An=e=>t=>on.isReaderSummaryItemMenu(t)&&t.source.item.itemId===e;function Gn(e,t,n){const i=u.h.create(null),a=u.h.create(v.none),s=e.state.pipe(B.h((0,b.Kg)(_,x)),C.U((e=>e.activeMenuItemId)));return ct(((r,l)=>{const d=t.pipe(C.U((0,o.ls)(at.hX((e=>e.itemId===r)),at.YM)),N.oA),c=ie.aj([e.state.view("feedbackDialog"),d,i,s,a]).pipe(C.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:_t(r,i,e,An),feedbackDialogActive:(0,o.zG)(e,v.filter(An(r)),v.map((e=>e.source.action))),focusable:ft(r,l,n,e)}))),rt.x());return S.Z.composeKnot({root:S.Z.fromSideEffect(gt(e,i,a,(e=>e.itemId),(t=>e.actions.next({kind:R.Kind.itemMounted,itemType:"summaryItem",item:t}))),c.pipe(C.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:()=>d.pipe(C.U((e=>e.text))),title:()=>d.pipe(C.U(n)),menu:S.Z.fromSideEffect(xt({pin:(t,n)=>e.actions.next({kind:R.Kind.pin,pinned:n,itemType:"summaryItem",item:t}),copy:t=>e.actions.next({kind:R.Kind.copy,itemType:"summaryItem",item:t}),dismiss:t=>e.actions.next({kind:R.Kind.dismiss,itemType:"summaryItem",item:t}),like:(t,n)=>e.actions.next({kind:R.Kind.like,itemType:"summaryItem",item:t,position:n}),dislike:(t,n)=>e.actions.next({kind:R.Kind.dislike,itemType:"summaryItem",item:t,position:n})},{dialogSide:"top",alignment:"left"}),c.pipe(C.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,o.zG)(t.itemRect,v.map(ot.Wm.topLeftPoint)):v.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:e.isSubmitFeedbackDialogSupported,feedbackDialogActive:t.feedbackDialogActive}))))),feedback:cn(e,An(r))})}),(()=>t.pipe(C.U(at.UI(f.ei("itemId"))))),at.Bk)}const zn=S.UI.Union.make("viewState",{showContent:S.UI.Group.make({content:Fn}),hideFilteredMessageContent:$t,showFilteredMessageContent:S.UI.Knot.make(Qt,{content:Fn})}),Ln=S.UI.Composite.make(S.UI.Grid.make((({slots:e})=>g.createElement(Kt,{title:A.expandedPanel.threadView.summaries.empty.title},e.button))),qt),On=S.UI.Union.make("_tag",{None:Ln,Some:S.UI.Group.make({value:zn})}),Pn=S.UI.Node.make((()=>g.createElement(Bt,{className:Dt.loader,type:"lineOnly",lineCount:2}))),Kn=S.UI.Union.make("type",{InProgress:Pn,Error:Ln,Fatal:Ln,Success:On});function Rn(e){const t=e.state.pipe(B.h(x),C.U((e=>e.summary)),B.h(v.isSome),C.U((e=>e.value))),n=t.pipe(C.U(f.ei("data")),B.h(m.d6),C.U((e=>e.value))),i=()=>Wt(e,A.expandedPanel.threadView.summaries.empty,"emptySummaryViewButton",{dialogSide:"top",alignment:"left"});return S.Z.composeUnion({InProgress:()=>M.of(null),Error:i(),Fatal:i(),Success:S.Z.composeUnion({None:i(),Some:S.Z.composeKnot({value:S.Z.composeUnion({showContent:S.Z.composeKnot({content:Gn(e,n,(()=>v.none))}),hideFilteredMessageContent:S.Z.fromSideEffect((t=>e.actions.next({kind:R.Kind.showFilteredContent,column:"summary"})),A.expandedPanel.threadView.summaries.filteredHidden),showFilteredMessageContent:S.Z.composeKnot({root:()=>M.of(A.expandedPanel.threadView.summaries.filteredShown),content:Gn(e,n,(()=>v.none))})},(()=>t.pipe(C.U((({viewState:e})=>({viewState:e}))))))})},(()=>(0,o.zG)(n,C.U(it.nI))))},(()=>t.pipe(C.U((e=>({type:e.data.type}))))))}const Hn=S.UI.Knot.make(Ye(et),{content:Kn,title:S.UI.Node.make((()=>g.createElement("span",null,A.expandedPanel.threadView.summaries.title)))}),Bn=S.UI.Knot.make(Ye(tt),{content:En,title:S.UI.Node.make((()=>g.createElement("span",null,A.expandedPanel.threadView.followUps.title)))}),Dn=S.UI.Knot.make(Ye(nt),{content:tn,title:S.UI.Node.make((()=>g.createElement("span",null,A.expandedPanel.threadView.links.title)))}),Vn=S.UI.Union.asOption(Hn),Zn=S.UI.Union.asOption(Bn),jn=S.UI.Union.asOption(Dn),qn=S.UI.Knot.make(Xe,{summary:Vn,questions:Zn,links:jn});function Wn(e){const t=e.state.pipe(B.h(x)),n=t=>e.actions.next({kind:R.Kind.columnScroll}),i=M.of(null);return S.Z.composeKnot({summary:S.Z.composeUnion({Some:S.Z.composeKnot({value:S.Z.composeKnot({root:S.Z.fromSideEffect(n,i),content:Rn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(C.U((e=>e.summary))))),questions:S.Z.composeUnion({Some:S.Z.composeKnot({value:S.Z.composeKnot({root:S.Z.fromSideEffect(n,i),content:Cn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(C.U((e=>e.questions))))),links:S.Z.composeUnion({Some:S.Z.composeKnot({value:S.Z.composeKnot({root:S.Z.fromSideEffect(n,i),content:nn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(C.U((e=>e.links)))))})}var $n=n(37896);function Qn(e){if("parsedDate"===e.kind){const t=new Date(e.timestamp);return`${$n.Rb[t.getMonth()]} ${t.getDate()}`}return e.date}var Jn=n(79579);const Yn=S.UI.Union.make("_tag",{None:S.UI.Node.make((({notify:e})=>g.createElement(Kt,{title:A.expandedPanel.pinnedView.links.empty.title},A.expandedPanel.pinnedView.links.empty.body,g.createElement(V.zx.Ghost,{onClick:e("showMessages"),name:"pinned-mentions-empty-cta",className:Jn.emptyCTAButton},A.expandedPanel.pinnedView.links.empty.CTA)))),Some:S.UI.Group.make({value:zt})});function Xn(e){const t=e.state.pipe(B.h(_),C.U((e=>e.links)),B.h(v.isSome),C.U((e=>e.value)));return S.Z.composeUnion({None:S.Z.fromSideEffect((t=>{if("showMessages"===t)e.actions.next({kind:R.Kind.openMessageView,source:K.emptyPinnedLinks});else(0,D.vE)(t)}),null),Some:S.Z.composeKnot({value:Ot(e,t,(e=>(0,o.zG)(e.messagePinnedFrom,v.map((e=>{var t;return`From ${null!==(t=e.author.name)&&void 0!==t?t:e.author.email}, ${Qn(e.date)}`})))))})},(()=>(0,o.zG)(t,C.U(it.nI))))}const ei=S.UI.Union.make("_tag",{None:S.UI.Node.make((({notify:e})=>g.createElement(Kt,{title:A.expandedPanel.pinnedView.followUps.empty.title},A.expandedPanel.pinnedView.followUps.empty.body,g.createElement(V.zx.Ghost,{onClick:e("showMessages"),name:"pinned-follow-ups-empty-cta",className:Jn.emptyCTAButton},A.expandedPanel.pinnedView.followUps.empty.CTA)))),Some:S.UI.Group.make({value:bn})});function ti(e){const t=e.state.pipe(B.h(_),C.U((e=>e.questions)),B.h(v.isSome),C.U((e=>e.value)));return S.Z.composeUnion({None:S.Z.fromSideEffect((t=>{if("showMessages"===t)e.actions.next({kind:R.Kind.openMessageView,source:K.emptyPinnedFollowUps});else(0,D.vE)(t)}),null),Some:S.Z.composeKnot({value:yn(e,t,(e=>{var t;return v.some(`From ${null!==(t=e.message.author.name)&&void 0!==t?t:e.message.author.email}, ${Qn(e.message.date)}`)}))})},(()=>(0,o.zG)(t,C.U(it.nI))))}const ni=S.UI.Union.make("_tag",{None:S.UI.Node.make((({notify:e})=>g.createElement(Kt,{title:A.expandedPanel.pinnedView.summaries.empty.title},A.expandedPanel.pinnedView.summaries.empty.body,g.createElement(V.zx.Ghost,{onClick:e("showMessages"),name:"pinned-summary-empty-cta",className:Jn.emptyCTAButton},A.expandedPanel.pinnedView.summaries.empty.CTA)))),Some:S.UI.Group.make({value:Fn})});function ii(e){const t=e.state.pipe(B.h(_),C.U((e=>e.summaryItems)),B.h(v.isSome),C.U((e=>e.value)));return S.Z.composeUnion({None:S.Z.fromSideEffect((t=>{if("showMessages"===t)e.actions.next({kind:R.Kind.openMessageView,source:K.emptyPinnedSummaries});else(0,D.vE)(t)}),null),Some:S.Z.composeKnot({value:Gn(e,t,(e=>{var t;return v.some(`From ${null!==(t=e.message.author.name)&&void 0!==t?t:e.message.author.email}, ${Qn(e.message.date)}`)}))})},(()=>(0,o.zG)(t,C.U(it.nI))))}const ai=S.UI.Knot.make(Ye(et),{content:ni,title:S.UI.Node.make((()=>g.createElement("span",null,A.expandedPanel.pinnedView.summaries.title)))}),oi=S.UI.Knot.make(Ye(tt),{content:ei,title:S.UI.Node.make((()=>g.createElement("span",null,A.expandedPanel.pinnedView.followUps.title)))}),si=S.UI.Knot.make(Ye(nt),{content:Yn,title:S.UI.Node.make((()=>g.createElement("span",null,A.expandedPanel.pinnedView.links.title)))}),ri=S.UI.Union.asOption(ai),li=S.UI.Union.asOption(oi),di=S.UI.Union.asOption(si),ci=S.UI.Knot.make(Xe,{summary:ri,questions:li,links:di});function mi(e){const t=e.state.pipe(B.h(_)),n=t=>e.actions.next({kind:R.Kind.columnScroll}),i=M.of(null);return S.Z.composeKnot({summary:S.Z.composeUnion({Some:S.Z.composeKnot({value:S.Z.composeKnot({root:S.Z.fromSideEffect(n,i),content:ii(e),title:()=>i})}),None:()=>i},(()=>t.pipe(C.U((e=>e.summaryItems))))),questions:S.Z.composeUnion({Some:S.Z.composeKnot({value:S.Z.composeKnot({root:S.Z.fromSideEffect(n,i),content:ti(e),title:()=>i})}),None:()=>i},(()=>t.pipe(C.U((e=>e.questions))))),links:S.Z.composeUnion({Some:S.Z.composeKnot({value:S.Z.composeKnot({root:S.Z.fromSideEffect(n,i),content:Xn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(C.U((e=>e.links)))))})}const ui=S.UI.Union.make("kind",{messageView:qn,pinnedView:ci});function hi(e){return S.Z.composeUnion({messageView:Wn(e),pinnedView:mi(e)},(()=>e.state.pipe(B.h((0,b.Kg)(_,x)),C.U((e=>({kind:e.kind}))))))}var pi=n(37903),gi=n(89739);const fi=S.UI.Node.make((({view:e})=>g.createElement("div",{className:gi.activeMailInfo},g.createElement(U.F.span,{className:gi.date},e("date").pipe(C.U(Qn))),g.createElement(U.F.span,{className:gi.author},e("author").pipe(C.U((e=>{var t;return null!==(t=e.name)&&void 0!==t?t:e.email}))))))),bi=S.UI.Node.make((()=>g.createElement("div",{className:gi.activeMailInfo},"Loading..."))),vi=S.UI.Union.make("type",{InProgress:bi,Success:fi,Fatal:S.UI.Node.make((()=>g.createElement("div",{className:gi.activeMailInfo}))),Error:S.UI.Node.make((()=>g.createElement("div",{className:gi.activeMailInfo})))});function ki(e){return S.Z.composeUnion({InProgress:()=>M.of(null),Success:()=>e.state.pipe(B.h(x),C.U((e=>e.header)),B.h(m.d6),C.U((e=>e.value))),Fatal:()=>M.of(null),Error:()=>M.of(null)},(()=>e.state.pipe(B.h(x),C.U((e=>e.header)))))}var yi=n(14692);const Ii=S.UI.Knot.make(S.UI.Grid.make((({slots:e,state:t,notify:n})=>g.createElement(U.F.div,{className:yi.navigationFrame},g.createElement(U.F.div,{className:yi.buttonGroup},t.pipe(C.U((e=>g.createElement(g.Fragment,null,g.createElement(V.zx.Ghost,{onClick:n(G.first),name:"navigate-first",disabled:!e.canGoBack,title:e.canGoBack?A.expandedPanel.jumpFirstIconTooltip:void 0,ariaLabel:e.canGoBack?A.expandedPanel.jumpFirstIconTooltip:void 0,tabIndex:e.focusable?0:-1},g.createElement(T.JO.Exit,{...(0,ae.Sh)(yi.iconJump,yi.iconGoFirst)})),g.createElement(V.zx.Ghost,{onClick:n(G.left),name:"navigate-left",disabled:!e.canGoBack,title:e.canGoBack?A.expandedPanel.goLeftIconTooltip:void 0,ariaLabel:e.canGoBack?A.expandedPanel.goLeftIconTooltip:void 0,tabIndex:e.focusable?0:-1},g.createElement(T.JO.Arrow,{direction:T.n4.left,className:yi.icon}))))))),e.mailInfo,g.createElement(U.F.div,{className:yi.buttonGroup},t.pipe(C.U((e=>g.createElement(g.Fragment,null,g.createElement(V.zx.Ghost,{onClick:n(G.right),name:"navigate-right",disabled:!e.canGoForward,title:e.canGoForward?A.expandedPanel.goRightIconTooltip:void 0,ariaLabel:e.canGoForward?A.expandedPanel.goRightIconTooltip:void 0,tabIndex:e.focusable?0:-1},g.createElement(T.JO.Arrow,{direction:T.n4.right,className:yi.icon})),g.createElement(V.zx.Ghost,{onClick:n(G.last),name:"navigate-last",disabled:!e.canGoForward,title:e.canGoForward?A.expandedPanel.jumpLastIconTooltip:void 0,ariaLabel:e.canGoForward?A.expandedPanel.jumpLastIconTooltip:void 0,tabIndex:e.focusable?0:-1},g.createElement(T.JO.Exit,{className:yi.iconJump})))))))))),{mailInfo:vi});function xi(e){return S.Z.composeKnot({root:S.Z.fromSideEffect((t=>(0,o.zG)(e.getNextActiveMessageIndex(t),kt.bw((n=>e.actions.next({kind:R.Kind.threadViewNavigate,action:t,nextIndex:n}))))),e.state.pipe(B.h(x)).pipe(C.U((e=>({...e.navigation,focusable:v.isNone(e.feedbackDialog)}))))),mailInfo:ki(e)})}var _i=n(16204);const wi=S.UI.Node.make((({state:e,notify:t})=>g.createElement(U.F.Fragment,null,e.pipe(C.U((({activeView:e,focusable:n})=>g.createElement(V.zx.Group,{sticky:!0,className:_i.buttonGroup},g.createElement(V.zx.White,{name:"thread-view",onClick:t("messageView"),active:"messageView"===e,className:_i.button,tabIndex:n?0:-1},A.expandedPanel.viewButton.thread),g.createElement(V.zx.White,{name:"pinned-view",onClick:t("pinnedView"),active:"pinnedView"===e,className:_i.button,tabIndex:n?0:-1},A.expandedPanel.viewButton.pins))))))));function Ei(e){return S.Z.fromSideEffect((t=>{switch(t){case"pinnedView":e.actions.next({kind:R.Kind.openPinnedView});break;case"messageView":e.actions.next({kind:R.Kind.openMessageView,source:K.messagesButton});break;default:(0,D.vE)(t)}}),e.state.pipe(B.h((0,b.Kg)(x,_)),C.U((e=>({activeView:e.kind,focusable:v.isNone(e.feedbackDialog)})))))}const Ci=S.UI.Grid.make((({slots:e})=>g.createElement(U.F.div,{className:pi.header},e.viewButtons,e.frame))),Ui=S.UI.Union.asOption(Ii),Si=S.UI.Union.asOption(wi),Ni=S.UI.Knot.make(Ci,{viewButtons:Si,frame:Ui});function Mi(e){return S.Z.composeKnot({viewButtons:S.Z.composeUnion({None:()=>M.of(null),Some:S.Z.composeKnot({value:Ei(e)})},(()=>e.state.pipe(C.U((e=>(0,b.Kg)(x,_)(e)?v.some(e):v.none))))),frame:S.Z.composeUnion({None:()=>M.of(null),Some:S.Z.composeKnot({value:xi(e)})},(()=>e.state.pipe(C.U((e=>x(e)?v.some(e):v.none)))))})}const Ti=S.UI.Knot.make(Ke,{header:Ni,toolbar:Ve,content:ui});function Fi(e){return S.Z.composeKnot({root:Re(e),header:Mi(e),toolbar:S.Z.composeKnot({feedback:Ne(e,!1,(e=>"expandedPanelHeaderButton"===e.source.kind)),togglePanel:Be(e),toggleInlineHighlights:Fe(e)}),content:hi(e)})}var Ai=n(86885),Gi=n(40349);const zi=S.UI.Node.make((({state:e,notify:t})=>g.createElement("div",{className:Gi.controls},g.createElement("div",{className:Gi.onboardingButtonGroup},g.createElement(V.zx.Primary,{name:"try-it-out-button",onClick:t("optIn"),className:Gi.optInButton},A.onboarding.optInButton),g.createElement(V.zx.Flat,{name:"no-thanks-button",onClick:t("optOut"),className:Gi.optOutButton},A.onboarding.optOutButton)),g.createElement(U.F.div,{className:Gi.navigation},e.pipe(C.U((e=>g.createElement(g.Fragment,null,g.createElement(V.zx.Flat,{name:"left-button",onClick:t(z.left),disabled:k[0]===e,className:Gi.leftButton,title:A.onboarding.prevIconTooltip,ariaLabel:A.onboarding.prevIconTooltip},g.createElement(T.JO.Arrow,{direction:T.n4.left,width:12})),g.createElement(V.zx.Flat,{name:"right-button",onClick:t(z.right),disabled:k[k.length-1]===e,className:Gi.rightButton,title:A.onboarding.nextIconTooltip,ariaLabel:A.onboarding.nextIconTooltip},g.createElement(T.JO.Arrow,{direction:T.n4.right,width:12,className:Gi.arrowRight})),g.createElement("div",{className:Gi.stepOfN},A.onboarding.stepOfN(k.indexOf(e)+1))))))))));var Li=n(86564);const Oi=S.UI.Node.make((()=>{const e=A.onboarding.disclaimer.text.split(A.onboarding.disclaimer.linkPlaceholder);return g.createElement("div",{className:Li.disclaimer},e.map(((e,t,n)=>g.createElement(g.Fragment,null,e,t<n.length-1?g.createElement("a",{target:"_blank",rel:"noreferrer",href:A.onboarding.disclaimer.link.URL},A.onboarding.disclaimer.link.text):null))))}));var Pi=n(57391);const Ki=S.UI.Node.make((({state:e})=>g.createElement(g.Fragment,null,g.createElement("link",{rel:"preload",as:"image",href:A.onboarding.overview.videoSrc}),g.createElement("link",{rel:"preload",as:"image",href:A.onboarding.coreUserJourney.videoSrc}),g.createElement("link",{rel:"preload",as:"image",href:A.onboarding.pinning.videoSrc}),g.createElement(U.F.Fragment,null,e.pipe(C.U((e=>g.createElement("img",{src:A.onboarding[e].videoSrc,key:e,className:Pi.illustration}))))))));var Ri=n(51869),Hi=n(19230);const Bi=({title:e,children:t})=>g.createElement(g.Fragment,null,g.createElement("div",{className:Hi.title},e),g.createElement("div",{className:Hi.body},t)),Di=({features:e,browser:t})=>{const n=e=>g.createElement(g.Fragment,null,e,g.createElement(Ge.v,{browser:t,title:g.createElement("a",{href:A.onboarding.betaTermsUrl,target:"_blank",rel:"noreferrer"},"BETA")}));return e.has("followUps")&&e.has("links")?g.createElement(Bi,{title:n(A.onboarding.overview.phase2.title)},A.onboarding.overview.phase2.body):e.has("followUps")?g.createElement(Bi,{title:n(A.onboarding.overview.phase1.title)},A.onboarding.overview.phase1.body):g.createElement(Bi,{title:n(A.onboarding.overview.phase0.title)},A.onboarding.overview.phase0.body)},Vi=()=>g.createElement(Bi,{title:A.onboarding.coreUserJourney.title},A.onboarding.coreUserJourney.body),Zi=()=>g.createElement(Bi,{title:A.onboarding.pinning.title},A.onboarding.pinning.body),ji=S.UI.Node.make((({state:e})=>g.createElement(U.F.Fragment,null,e.pipe(C.U((e=>{switch(e.step){case p.overview:return g.createElement(Di,{key:"step-overview",features:e.features,browser:e.browser});case p.coreUserJourney:return g.createElement(Vi,{key:"step-core-user-journey"});case p.pinning:return g.createElement(Zi,{key:"step-pinning"});default:(0,D.vE)(e.step)}})))))),qi=({onShow:e,children:t})=>(le.P.useEffectOnDidMount(e),g.createElement("div",{className:Ri.onboarding},t)),Wi=S.UI.Grid.make((({slots:e,notify:t})=>g.createElement(qi,{onShow:t("panelMounted")},g.createElement(U.F.div,null,e.illustrations),g.createElement(ne.K,{size:22.4,className:Ri.logo}),g.createElement("div",{className:Ri.content,"data-grammarly-part":"reader-onboarding-content"},g.createElement("div",{className:Ri.badge},A.onboarding.badge),g.createElement(U.F.div,{className:Ri.steps},e.steps),g.createElement(U.F.div,null,e.controls),g.createElement(U.F.div,null,e.disclaimer))))),$i=S.UI.Knot.make(Wi,{steps:ji,illustrations:Ki,controls:zi,disclaimer:Oi});function Qi(e){return S.Z.fromSideEffect((t=>{const n=t.action;switch(n){case"optIn":e.actions.next({kind:R.Kind.optIn});break;case"optOut":e.actions.next({kind:R.Kind.optOut});break;case z.left:case z.right:e.actions.next({kind:R.Kind.onboardingViewNavigate,action:n});break;case"panelMounted":e.actions.next({kind:R.Kind.panelMounted,subject:L.onboardingPanel});break;default:(0,D.vE)(n)}}),e.state.pipe(B.h(w),C.U((t=>({steps:{step:k[t.step],features:t.features,browser:e.browser},illustrations:k[t.step],controls:k[t.step]})))))}var Ji=n(35300);const Yi=S.UI.Grid.make((({slots:e})=>g.createElement("div",{className:Ji.onboarding,"data-grammarly-part":"reader-onboarding"},g.createElement(U.F.Fragment,null,e.content),g.createElement(U.F.div,{className:Ji.toolbar},e.toolbar)))),Xi=S.UI.Knot.make(Yi,{content:$i,toolbar:He});function ea(e){return S.Z.composeKnot({toolbar:Be(e),content:Qi(e)})}const ta=S.UI.Union.make("kind",{collapsed:qe,expanded:Ti,onboarding:Xi}),na=S.UI.Knot.make(S.UI.Grid.make((({slots:e})=>g.createElement(U.F.div,{className:Ai.panelWrapper,"data-grammarly-part":"reader-panel"},e.content,e.notification))),{content:ta,notification:J});var ia,aa=n(2005),oa=n(77821);!function(e){const t=g.createElement("svg",{viewBox:"0 0 40 48",fill:"none",className:oa["highlightsOnboarding-icon"]},g.createElement("g",null,g.createElement("path",{d:"M28.6883 4.0469C29.4694 3.26586 30.7357 3.26586 31.5168 4.0469L38.7017 11.2318C39.4827 12.0129 39.4827 13.2792 38.7017 14.0602L20.2171 32.5447L10.2038 22.5314L28.6883 4.0469Z",fill:"#79A8F2",stroke:"#0E101A"}),g.createElement("path",{d:"M8.49338 24.2418C8.19961 24.5356 8.00462 24.9136 7.93548 25.3232L6.80716 32.0092L10.7387 35.9407L17.4252 34.813C17.8349 34.7439 18.213 34.5489 18.5068 34.2551L20.9242 31.8377L10.9108 21.8244L8.49338 24.2418Z",fill:"#4A6EE0",stroke:"#0E101A",strokeLinejoin:"round"}),g.createElement("path",{d:"M6.80713 32.009L10.7387 35.9406L8.59296 38.0863L1.08523 37.7309L6.80713 32.009Z",fill:"#79A8F2",stroke:"#0E101A",strokeLinejoin:"round"}),g.createElement("path",{d:"M39.3246 30.9133C39.3246 36.1382 35.0939 40.3268 29.9123 40.3268C24.6867 40.3268 20.5 36.1397 20.5 30.9133C20.5 25.687 24.6867 21.4999 29.9123 21.4999C35.1379 21.4999 39.3246 25.687 39.3246 30.9133Z",fill:"#15C39A",stroke:"#0E101A",strokeMiterlimit:"10"}),g.createElement("path",{d:"M25.2656 31.6833L28.2955 34.6904L34.7437 28.3717",stroke:"white",strokeWidth:"2",strokeLinecap:"round"}),g.createElement("path",{d:"M8 3L9.35045 6.64955L13 8L9.35045 9.35045L8 13L6.64955 9.35045L3 8L6.64955 6.64955L8 3Z",fill:"white"}),g.createElement("path",{d:"M18.5 40L19.4453 42.5547L22 43.5L19.4453 44.4453L18.5 47L17.5547 44.4453L15 43.5L17.5547 42.5547L18.5 40Z",fill:"white"})));function n(e){return S.Z.fromSideEffect((({action:t})=>"next"===t?e.actions.next({kind:R.Kind.setInlineHighlightsOnboardingStep,step:"highlightsSwitch"}):"close"===t?e.actions.next({kind:R.Kind.seenInlineHighlightsOnboarding}):(0,D.vE)(t)),void 0)}function i(e){return S.Z.fromSideEffect((({action:t})=>"next"===t?e.actions.next({kind:R.Kind.setInlineHighlightsOnboardingStep,step:"panelSwitch"}):"close"===t?e.actions.next({kind:R.Kind.seenInlineHighlightsOnboarding}):(0,D.vE)(t)),void 0)}function a(e){return S.Z.fromSideEffect((t=>"inlineHighlightsOnboardingAction"===t.kind?e.actions.next({kind:R.Kind.seenInlineHighlightsOnboarding}):(0,D.vE)(t.kind)),void 0)}function o(e){return S.Z.composeUnion({highlight:n(e),highlightsSwitch:i(e),panelSwitch:a(e)},(()=>e.state.pipe(C.U((({step:e})=>e)),B.h(v.isSome),C.U(kt.MH))))}function s(e){return S.Z.composeKnot({root:()=>e.state.pipe(B.h((e=>v.isSome(e.step))),C.U((({seen:e,step:t})=>({seen:e,step:kt.MH(t)})))),content:o(e)})}e.HighlightStep=S.UI.Node.make((({notify:e})=>g.createElement("div",{className:oa.highlightsOnboarding},t,g.createElement("div",null,g.createElement("h2",{className:oa["highlightsOnboarding-header"]},A.inlineOnboarding.highlight.title),g.createElement("div",{className:oa["highlightsOnboarding-content"]},A.inlineOnboarding.highlight.content),g.createElement("div",{className:oa["highlightsOnboarding-buttons"]},g.createElement(V.zx.Primary,{onClick:e({kind:"inlineHighlightsOnboardingAction",action:"next"}),name:"inline-highlight-onboarding-next-button",ariaLabel:A.inlineOnboarding.highlight.next},A.inlineOnboarding.highlight.next),g.createElement(V.zx.Ghost,{onClick:e({kind:"inlineHighlightsOnboardingAction",action:"close"}),name:"inline-highlight-onboarding-close-button",ariaLabel:A.inlineOnboarding.highlight.close,className:oa["highlightsOnboarding-button"]},A.inlineOnboarding.highlight.close)))))),e.HighlightsSwitchStep=S.UI.Node.make((({notify:e})=>g.createElement("div",{className:oa.highlightsOnboarding},t,g.createElement("div",null,g.createElement("h2",{className:oa["highlightsOnboarding-header"]},A.inlineOnboarding.highlightsSwitch.title),g.createElement("div",{className:oa["highlightsOnboarding-content"]},A.inlineOnboarding.highlightsSwitch.content),g.createElement("div",{className:oa["highlightsOnboarding-buttons"]},g.createElement(V.zx.Primary,{onClick:e({kind:"inlineHighlightsOnboardingAction",action:"next"}),name:"inline-highlight-onboarding-next-button",ariaLabel:A.inlineOnboarding.highlightsSwitch.next},A.inlineOnboarding.highlightsSwitch.next),g.createElement(V.zx.Ghost,{onClick:e({kind:"inlineHighlightsOnboardingAction",action:"close"}),name:"inline-highlight-onboarding-close-button",ariaLabel:A.inlineOnboarding.highlightsSwitch.close,className:oa["highlightsOnboarding-button"]},A.inlineOnboarding.highlightsSwitch.close)))))),e.PanelSwitchStep=S.UI.Node.make((({notify:e})=>g.createElement("div",{className:oa.highlightsOnboarding},t,g.createElement("div",null,g.createElement("h2",{className:oa["highlightsOnboarding-header"]},A.inlineOnboarding.panelSwitch.title),g.createElement("div",{className:oa["highlightsOnboarding-content"]},A.inlineOnboarding.panelSwitch.content),g.createElement("div",{className:oa["highlightsOnboarding-buttons"]},g.createElement(V.zx.Primary,{onClick:e({kind:"inlineHighlightsOnboardingAction",action:"next"}),name:"inline-highlight-onboarding-next-button",ariaLabel:A.inlineOnboarding.panelSwitch.next},A.inlineOnboarding.panelSwitch.next)))))),e.OnboardingContent=S.UI.Union.make("kind",{highlight:e.HighlightStep,highlightsSwitch:e.HighlightsSwitchStep,panelSwitch:e.PanelSwitchStep}),e.createOnboardingContentFlow=o,e.OnboardingGrid=S.UI.Grid.make((({slots:e,state:t})=>g.createElement(U.F.Fragment,null,t.pipe(C.U((({seen:t,step:n})=>t?null:g.createElement(aa.J,{mainContent:g.createElement(U.F.Fragment,null,e.content),isOutsideReferenceElement:!0,outsideReferenceElement:n.anchorElement,backgroundTheme:"dark",placement:"top",includeMainContentPadding:!1,distanceFromReferenceElement:"highlight"===n.kind?12:void 0,style:{zIndex:1},show:!0}))))))),e.OnboardingSome=S.UI.Knot.make(e.OnboardingGrid,{content:e.OnboardingContent}),e.Onboarding=S.UI.Union.make("_tag",{Some:e.OnboardingSome,None:S.UI.Node.empty}),e.createFlow=function(e){return S.Z.composeUnion({Some:s(e),None:()=>M.of(null)},(()=>e.state.pipe(C.U((({step:e})=>e)))))}}(ia||(ia={}));var sa,ra=n(14601);!function(e){e.ViewModelImpl=class{constructor(e,t,n,i){this._readerCSState=e,this._gnar=t,this._sessionUuid=n,this._threadContext=i,this._subscriptions=new ra.w,this._state=u.h.create({step:v.none,seen:this._readerCSState.get().seenInlineHighlightsOnboarding||!1}),this.state=this._state.view(),this.actions=new xe.xQ,this._elements=new Map,this._step=new xe.xQ,this._subscriptions.add(this._handleMounts()),this._subscriptions.add(this._handleNextStepClick()),this._subscriptions.add(this._handleSeen()),this._subscriptions.add(this._handleStepChange()),this._step.next("highlight")}dispose(){this._subscriptions.unsubscribe(),this._elements.clear()}_handleMounts(){return this.actions.pipe(H.ofType(R.Kind.inlineHighlightOnboardingElementMounted)).subscribe((({step:e,node:t})=>this._elements.set(e,t)))}_handleStepChange(){return ie.aj([this._step,this.actions.pipe(H.ofType(R.Kind.inlineHighlightOnboardingElementMounted))]).pipe(C.U((([e])=>({kind:e,anchorElement:this._elements.get(e)}))),B.h((e=>!!e.anchorElement)),C.U(v.some),de.O(v.none)).subscribe((e=>{(0,o.zG)(e,kt.bw((e=>{const t=(0,o.zG)(this._threadContext.get().threadId,v.fromEither,v.toUndefined);switch(e.kind){case"highlight":this._gnar.readerMailInlineHighlightsOnboardingShown(this._sessionUuid,t);break;case"highlightsSwitch":case"panelSwitch":this._gnar.readerMailInlineHighlightsOnboardingNext(this._sessionUuid,t);break;default:(0,D.vE)(e)}}))),this._state.lens("step").set(e)}))}_handleNextStepClick(){return this.actions.pipe(H.ofType(R.Kind.setInlineHighlightsOnboardingStep)).subscribe((({step:e})=>this._step.next(e)))}_handleSeen(){return this.actions.pipe(H.ofType(R.Kind.seenInlineHighlightsOnboarding)).subscribe((()=>{const e=(0,o.zG)(this._threadContext.get().threadId,v.fromEither,v.toUndefined);this._gnar.readerMailInlineHighlightsOnboardingDismissed(this._sessionUuid,e),this._state.lens("seen").set(!0)}))}}}(sa||(sa={}));var la,da,ca=n(45614),ma=n(38348),ua=n(90361),ha=n(85548),pa=n(13444),ga=n(2768),fa=n(24209),ba=n(12126),va=n(77843),ka=n(95195),ya=n(20817),Ia=n(65219),xa=n(91625),_a=n(44760);function wa(e,t=self){return t.navigator&&t.navigator.clipboard&&t.navigator.clipboard.writeText?t.navigator.clipboard.writeText(e):Promise.reject("The Clipboard API is not available.")}function Ea(e){return(t,n)=>i=>(0,o.zG)(i,d.cq(e)(t,(0,o.ls)(v.some,n)),v.getOrElse((()=>(0,o.zG)(i,d.ZQ(e)(t,n(v.none))))))}!function(e){e.thankYou="thankYou"}(la||(la={})),function(e){e.create=function(e,t=6e3){return{kind:e,dismissTimestamp:Date.now()+t}}}(da||(da={}));const Ca=(e,t)=>Ea(Ia.h.Id.eq)(e,t),Ua=(e,t)=>Ea(xa.p.Id.eq)(e,t),Sa=(e,t)=>Ea(ha.A.eq)(e,t);var Na,Ma;!function(e){let t;e.empty=(e,t,n)=>({activeMenuItemId:v.none,activeMessageIndex:v.none,onboardingStep:(null==e?void 0:e.seenOnboarding)?v.none:v.some(0),panelState:n,feedbackDialog:v.none,notification:v.none,activeView:(null==e?void 0:e.seenOnboarding)?"messageView":"onboardingView",showFilteredContent:{summary:!1,followUps:!1,links:!1},annotations:(0,o.zG)(t,v.chain((t=>{var n,i;return v.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.annotations)})),v.fold((()=>new Map),ca.To(new Map,((e,t,n)=>(0,o.zG)(xa.X.decode(n),ka.g_((()=>t),(n=>t.set(e,n)))))))),summaryItems:(0,o.zG)(t,v.chain((t=>{var n,i;return v.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.summaries)})),v.fold((()=>new Map),ca.To(new Map,((e,t,n)=>(0,o.zG)(Ia.k.decode(n),ka.g_((()=>t),(n=>t.set(e,n)))))))),links:(0,o.zG)(t,v.chain((t=>{var n,i;return v.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.links)})),v.fold((()=>new Map),ca.To(new Map,((e,t,n)=>(0,o.zG)(_a.e9.decode(n),ka.g_((()=>t),(n=>t.set(e,n))))))))}),function(e){e.summaryItems=ya.Ri.create((e=>e.summaryItems),((e,t)=>({...t,summaryItems:e}))),e.annotations=ya.Ri.create((e=>e.annotations),((e,t)=>({...t,annotations:e}))),e.links=ya.Ri.create((e=>e.links),((e,t)=>({...t,links:e})))}(t=e.Lens||(e.Lens={}))}(Na||(Na={}));class Ta{constructor(e,t,n,i,a,s,r,l=s.has("feedbackDialog")){var c;this._mailThread=e,this._hasInlineAnnotations=t,this.browser=n,this._gnar=i,this._sessionUuid=a,this._features=s,this._readerCSState=r,this.isSubmitFeedbackDialogSupported=l,this._subscriptions=new ra.w,this.isClipboardSupported=function(e=self){return!!(e.navigator&&e.navigator.clipboard&&e.navigator.clipboard.writeText)}(),this.areInlineHighlightsSupported=this._features.has("inlineHighlights")||this._features.has("inlineCards"),this._state=u.h.create(Na.empty(this._readerCSState.get(),(0,o.zG)(this._mailThread.get().threadId,v.fromEither),!this._features.has("panelExpandedByDefault")&&(null===(c=this._readerCSState.get())||void 0===c?void 0:c.seenOnboarding)&&this.areInlineHighlightsSupported?"collapsed":"expanded")),this._panelInjected=!1,this._onboardingPanelShown=!1,this._userNavigatedInPanel=!1,this.actions=new xe.xQ,this.state=u.h.combine(this._mailThread,this._state,((e,{panelState:t,activeMessageIndex:n,activeView:i,annotations:a,summaryItems:s,links:r,onboardingStep:l,activeMenuItemId:c,feedbackDialog:u,notification:p,showFilteredContent:g})=>{const f=(0,o.zG)(n,v.getOrElse((()=>e.messageCount-1))),k=(0,o.zG)(v.fromNullable(e.messageIndexToIdMap.get(f)),v.chain((t=>v.fromNullable(e.expandedMessages.get(t)))));if("collapsed"===t)return{kind:"collapsed",loading:"onboardingView"!==i&&!Ga(e),feedbackDialog:u,notification:p,nothingToRecap:"onboardingView"!==i&&(0,o.zG)(k,v.fold(o.jv,za))};const y=(0,o.zG)(k,v.fold(o.jv,La));return{feedbackDialog:u,notification:p,..."onboardingView"===i?{kind:"onboardingView",step:(0,o.zG)(l,v.getOrElse((()=>0))),features:this._features}:"pinnedView"===i?{kind:"pinnedView",summaryItems:(0,o.zG)(s,d.hX((e=>!e.dismissed&&e.pinned)),d.VO(Ia.h.ord),Pa(this._features,"summaries")),questions:(0,o.zG)(a,d.hX((e=>!e.dismissed&&e.pinned)),d.VO(xa.p.ord),Pa(this._features,"followUps")),links:(0,o.zG)((0,o.zG)(r,d.hX((0,b.W9)((e=>!e.dismissed),_a.kP)),d.VO(_a.WO.ord)),Pa(this._features,"links")),activeMenuItemId:c}:"messageView"===i?{kind:"messageView",header:(0,o.zG)(k,v.fold((()=>m.x5),(e=>(0,o.zG)(e.message,m.UI((e=>({author:e.author,date:e.date}))))))),navigation:{canGoBack:f>0,canGoForward:f<e.messageCount-1},message:(0,o.zG)(k,v.fold((()=>m.x5),(e=>(0,o.zG)(e.message,m.UI((e=>({id:e.id,date:e.date,wordCount:e.wordCount,isLastMessage:e.isLastMessage}))))))),summary:(0,o.zG)(Ka(k,s),Pa(this._features,"summaries"),v.map((e=>({data:e,viewState:y?g.summary?h.showFilteredMessageContent:h.hideFilteredMessageContent:h.showContent})))),questions:(0,o.zG)(Ra(k,a),Pa(this._features,"followUps"),v.map((e=>({data:e,viewState:y?g.followUps?h.showFilteredMessageContent:h.hideFilteredMessageContent:h.showContent})))),links:(0,o.zG)(Ha(k,r),Pa(this._features,"links"),v.map((e=>({data:e,viewState:y?g.links?h.showFilteredMessageContent:h.hideFilteredMessageContent:h.showContent})))),activeMenuItemId:c}:(0,D.vE)(i)}})),this.inlineHighlightsEnabled=this._readerCSState.view((({inlineHighlightsEnabled:e})=>(0,o.zG)(v.fromNullable(e),v.getOrElse((()=>!0))))),this._maybeThreadId=(0,o.zG)(this._mailThread.get().threadId,v.fromEither,v.toUndefined),this._subscriptions.add(this._mailThread.view("messageCount").subscribe((e=>this._state.lens("activeMessageIndex").modify(v.map((t=>Math.max(0,Math.min(t,e-1)))))))),this._subscriptions.add(this._trackMessageShow()),this._subscriptions.add(this._autoDismissNotifications()),this._subscriptions.add(this._handleCollapseButtonClick()),this._subscriptions.add(this._handleExpandButtonClick()),this._subscriptions.add(this._handlePanelMounted()),this._subscriptions.add(this._handleThreadViewNavigate()),this._subscriptions.add(this._handleOpenPinnedView()),this._subscriptions.add(this._handleOpenMessageView()),this._subscriptions.add(this._handleOnboardingViewNavigate()),this._subscriptions.add(this._handleCheckQuestionItem()),this._subscriptions.add(this._handleColumnScroll()),this._subscriptions.add(this._handleItemBlur()),this._subscriptions.add(this._handleOpenItemMenu()),this._subscriptions.add(this._handleLinkItemClick()),this._subscriptions.add(this._handlePin()),this._subscriptions.add(this._handleDismiss()),this._subscriptions.add(this._handleCopy()),this._subscriptions.add(this._handleRating()),this._subscriptions.add(this._handleOptIn()),this._subscriptions.add(this._handleOptOut()),this._subscriptions.add(this._handleCloseNotification()),this._subscriptions.add(this._handleOpenFeedbackDialog()),this._subscriptions.add(this._handleSubmitFeedbackDialog()),this._subscriptions.add(this._handleSkipFeedbackDialog()),this._subscriptions.add(this._handleCloseFeedbackDialog()),this._subscriptions.add(this._handleInlineHighlightsToggle()),this._subscriptions.add(this._handleShowFilteredContent()),this._subscriptions.add(this._autoExpand())}_autoExpand(){return this._mailThread.pipe(pa.g(0),ga.R(fa.T(this.actions.pipe(H.ofType(R.Kind.collapse)),this.actions.pipe(H.ofType(R.Kind.expand)),this._hasInlineAnnotations.pipe(B.h(ua.fQ)))),C.U((e=>(0,o.zG)(v.fromNullable(e.messageIndexToIdMap.get(e.messageCount-1)),v.chain((t=>v.fromNullable(e.expandedMessages.get(t)))),v.fold(o.jv,(({annotations:e,summary:t})=>!m.n2(e)&&(Fa(e)||Aa(t))))))),B.h(ua.fQ)).subscribe((()=>this._state.lens("panelState").set("expanded")))}_handlePanelMounted(){return this.actions.pipe(H.ofType(R.Kind.panelMounted)).subscribe((({subject:e})=>{e===L.readerPanel?this._panelInjected||"onboardingView"===this._state.get().activeView||(this._gnar.readerMailPanelShow(this._sessionUuid,this._maybeThreadId),this._panelInjected=!0):e===L.onboardingPanel?this._onboardingPanelShown||(this._gnar.readerMailOnboardingPanelShow(this._sessionUuid,this._maybeThreadId),this._onboardingPanelShown=!0):(0,D.vE)(e)}))}_handleExpandButtonClick(){return this.actions.pipe(H.ofType(R.Kind.expand)).subscribe((({source:e})=>{switch(this._state.modify((e=>({...e,panelState:"expanded",feedbackDialog:v.none,notification:v.none}))),e){case P.expandButton:this._gnar.readerMailPanelExpandButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId);break;case P.recapButton:this._gnar.readerMailRecapExpandButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId);break;case P.replyButton:this._gnar.readerMailEmailClientReplyButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId);break;default:(0,D.vE)(e)}}))}_handleCollapseButtonClick(){return this.actions.pipe(H.ofType(R.Kind.collapse)).subscribe((({source:e})=>{switch(this._state.modify((e=>({...e,panelState:"collapsed",feedbackDialog:v.none,notification:v.none}))),e){case O.collapseButton:this._gnar.readerMailPanelCollapseButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId);break;case O.recapButton:this._gnar.readerMailRecapCollapseButtonClick(this._sessionUuid,this._maybeThreadId);break;default:(0,D.vE)(e)}}))}_handleOptIn(){return this.actions.pipe(H.ofType(R.Kind.optIn)).subscribe((()=>{this._state.modify((e=>({...e,activeView:"messageView",onboardingStep:v.none}))),this._gnar.readerMailOnboardingPanelOptInButtonClick(this._sessionUuid,this._maybeThreadId)}))}_handleOptOut(){return this.actions.pipe(H.ofType(R.Kind.optOut)).subscribe((()=>{this._state.modify((e=>({...e,panelState:"collapsed",onboardingStep:v.none,feedbackDialog:v.none,notification:v.none}))),this._gnar.readerMailOnboardingPanelOptOutButtonClick(this._sessionUuid,this._maybeThreadId)}))}_handleOnboardingViewNavigate(){return this.actions.pipe(H.ofType(R.Kind.onboardingViewNavigate)).subscribe((({action:e})=>{const t=(0,o.zG)(this._state.get().onboardingStep,v.getOrElse((()=>0)),(t=>{switch(e){case z.left:return Math.max(t-1,0);case z.right:return Math.min(t+1,2);default:(0,D.vE)(e)}}));this._state.lens("onboardingStep").set(v.some(t)),this._gnar.readerMailOnboardingPanelNavigationButtonClick(this._sessionUuid,k[t],this._maybeThreadId)}))}getNextActiveMessageIndex(e){return function(e,t,n){if(e===G.left&&t>0)return v.some(t-1);if(e===G.right&&t<n-1)return v.some(t+1);if(e===G.first&&t>0)return v.some(0);if(e===G.last&&t<n-1)return v.some(n-1);return v.none}(e,(0,o.zG)(this._state.get().activeMessageIndex,v.getOrElse((()=>this._mailThread.get().messageCount-1))),this._mailThread.get().messageCount)}_handleThreadViewNavigate(){return this.actions.pipe(H.ofType(R.Kind.threadViewNavigate)).subscribe((({action:e,nextIndex:t})=>{this._userNavigatedInPanel=!0,this._state.lens("activeMessageIndex").set(v.some(t)),this._gnar.readerMailPanelNavigationButtonClick(e,this._sessionUuid,this._maybeThreadId)}))}_handleOpenPinnedView(){return this.actions.pipe(H.ofType(R.Kind.openPinnedView)).subscribe((()=>{this._state.lens("activeView").set("pinnedView"),this._gnar.readerMailPanelPinnedButtonClick(this._sessionUuid,this._maybeThreadId)}))}_handleOpenMessageView(){return this.actions.pipe(H.ofType(R.Kind.openMessageView)).subscribe((({source:e})=>{switch(this._state.lens("activeView").set("messageView"),e){case K.messagesButton:this._gnar.readerMailPanelMessagesButtonClick(this._sessionUuid,this._maybeThreadId);break;case K.emptyPinnedSummaries:case K.emptyPinnedFollowUps:case K.emptyPinnedLinks:this._gnar.readerMailPanelReturnToMessagesButtonClick(this._sessionUuid,e,this._maybeThreadId);break;default:(0,D.vE)(e)}}))}_handleCheckQuestionItem(){return this.actions.pipe(H.ofType(R.Kind.check)).subscribe((({item:e,checked:t})=>{this._state.lens(Na.Lens.annotations).modify(Ua(e.itemId,(0,o.ls)(v.getOrElse((()=>e)),(e=>({...e,checked:t}))))),this._gnar.readerMailPanelQuestionItemCheck(e.message.id,this._state.get().activeView,this._sessionUuid,t,this._maybeThreadId)}))}_handlePin(){return this.actions.pipe(H.ofType(R.Kind.pin)).subscribe((({item:e,itemType:t,pinned:n})=>{switch(t){case"summaryItem":this._state.lens(Na.Lens.summaryItems).modify(Ca(e.itemId,(0,o.ls)(v.getOrElse((()=>e)),(e=>({...e,pinned:n}))))),this._gnar.readerMailPanelSummaryItemPin(e.message.id,this._sessionUuid,n,this._maybeThreadId);break;case"followUpItem":this._state.lens(Na.Lens.annotations).modify(Ua(e.itemId,(0,o.ls)(v.getOrElse((()=>e)),(e=>({...e,pinned:n}))))),this._gnar.readerMailPanelQuestionItemPin(e.message.id,this._sessionUuid,n,this._maybeThreadId);break;case"linkItem":this._state.lens(Na.Lens.links).modify(Sa(e.url,(0,o.ls)(v.getOrElse((()=>e)),(e=>({...e,pinned:n,messagePinnedFrom:n?v.some(e.message):v.none}))))),this._gnar.readerMailPanelLinkItemPin(e.message.id,this._sessionUuid,n,this._maybeThreadId);break;default:(0,D.vE)(e)}this._setActiveItemId(null)}))}_handleCopy(){return this.actions.pipe(H.ofType(R.Kind.copy)).subscribe((({item:e,itemType:t})=>{switch(t){case"summaryItem":this._subscriptions.add(ba.D(wa(e.text)).subscribe()),this._gnar.readerMailPanelSummaryItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId);break;case"followUpItem":this._subscriptions.add(ba.D(wa(e.text)).subscribe()),this._gnar.readerMailPanelQuestionItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId);break;case"linkItem":this._subscriptions.add(ba.D(wa(e.name)).subscribe()),this._gnar.readerMailPanelLinkItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId);break;default:(0,D.vE)(e)}this._setActiveItemId(null)}))}_handleDismiss(){return this.actions.pipe(H.ofType(R.Kind.dismiss)).subscribe((({item:e,itemType:t})=>{switch(t){case"summaryItem":this._state.lens(Na.Lens.summaryItems).modify(Ca(e.itemId,(0,o.ls)(v.getOrElse((()=>e)),(e=>({...e,dismissed:!0}))))),this._gnar.readerMailPanelSummaryItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId);break;case"followUpItem":this._state.lens(Na.Lens.annotations).modify(Ua(e.itemId,(0,o.ls)(v.getOrElse((()=>e)),(e=>({...e,dismissed:!0}))))),this._gnar.readerMailPanelQuestionItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId);break;case"linkItem":this._state.lens(Na.Lens.links).modify(Sa(e.url,(0,o.ls)(v.getOrElse((()=>e)),(e=>({...e,dismissed:!0}))))),this._gnar.readerMailPanelLinkItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId);break;default:(0,D.vE)(e)}this._setActiveItemId(null)}))}_handleRating(){return this.actions.pipe(B.h((0,b.Kg)(R.is(R.Kind.like),R.is(R.Kind.dislike)))).subscribe((({kind:e,item:t,itemType:n,position:i})=>{switch(n){case"summaryItem":this._state.lens(Na.Lens.summaryItems).modify(Ca(t.itemId,(0,o.ls)(v.getOrElse((()=>t)),(t=>({...t,rating:Oa(e)}))))),this.actions.next({kind:R.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"summaryItem",item:t,action:e},position:i});break;case"followUpItem":this._state.lens(Na.Lens.annotations).modify(Ua(t.itemId,(0,o.ls)(v.getOrElse((()=>t)),(t=>({...t,rating:Oa(e)}))))),this.actions.next({kind:R.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"followUpItem",item:t,action:e},position:i});break;default:(0,D.vE)(t)}}))}_setActiveItemId(e){this._state.lens("activeMenuItemId").set(v.fromNullable(e))}_handleOpenItemMenu(){return this.actions.pipe(H.ofType(R.Kind.openItemMenu)).subscribe((({itemId:e})=>this._setActiveItemId(e)))}_handleColumnScroll(){return this.actions.pipe(H.ofType(R.Kind.columnScroll)).subscribe((()=>this._setActiveItemId(null)))}_handleItemBlur(){return this.actions.pipe(H.ofType(R.Kind.itemBlur)).subscribe((()=>this._setActiveItemId(null)))}_handleOpenFeedbackDialog(){return this.actions.pipe(H.ofType(R.Kind.openFeedback)).subscribe((({source:e,position:t})=>this._state.lens("feedbackDialog").set(v.some({source:e,position:t}))))}_handleCloseFeedbackDialog(){return this.actions.pipe(H.ofType(R.Kind.closeFeedback)).subscribe((()=>this._state.modify((e=>({...e,feedbackDialog:v.none,activeMenuItemId:v.none})))))}_handleSkipFeedbackDialog(){return this.actions.pipe(H.ofType(R.Kind.skipFeedback)).subscribe((()=>this._state.modify((e=>({...e,feedbackDialog:v.none,activeMenuItemId:v.none})))))}_handleSubmitFeedbackDialog(){return this.actions.pipe(H.ofType(R.Kind.submitFeedback)).subscribe((()=>this._state.modify((e=>({...e,feedbackDialog:v.none,activeMenuItemId:v.none,notification:v.some(da.create(la.thankYou))})))))}_handleCloseNotification(){return this.actions.pipe(H.ofType(R.Kind.closeNotification)).subscribe((()=>this._state.lens("notification").set(v.none)))}_handleLinkItemClick(){return this.actions.pipe(H.ofType(R.Kind.linkClick)).subscribe((({item:e})=>{this._gnar.readerMailPanelLinkItemClick(e.message.id,this._sessionUuid,this._maybeThreadId)}))}_handleInlineHighlightsToggle(){return this.actions.pipe(H.ofType(R.Kind.toggleInlineHighlights)).subscribe((({enabled:e})=>{e?this._gnar.readerMailInlineHighlightsDisable(this._sessionUuid,this._maybeThreadId):this._gnar.readerMailInlineHighlightsEnable(this._sessionUuid,this._maybeThreadId)}))}_handleShowFilteredContent(){return this.actions.pipe(H.ofType(R.Kind.showFilteredContent)).subscribe((e=>this._state.lens("showFilteredContent",e.column).set(!0)))}dispose(){this._subscriptions.unsubscribe()}_autoDismissNotifications(){return va.F(1e3).pipe(_e.M(this._state),B.h((([e,t])=>(0,o.zG)(t.notification,v.fold(o.jv,(e=>Date.now()>=e.dismissTimestamp)))))).subscribe((()=>this._state.lens("notification").modify(v.filter((e=>Date.now()<e.dismissTimestamp)))))}_trackMessageShow(){return this.state.pipe(B.h(E),rt.x(((e,t)=>s.Rb.eq.equals(e.message.value,t.message.value)))).subscribe((e=>{const t=(0,o.zG)(e.summary,v.map(f.ei("data")),v.filter(m.d6),v.fold((()=>0),(e=>e.value.length))),n=(0,o.zG)(e.questions,v.map(f.ei("data")),v.filter(m.d6),v.fold((()=>0),(e=>e.value.length))),i=(0,o.zG)(e.links,v.map(f.ei("data")),v.filter(m.d6),v.fold((()=>0),(e=>e.value.length)));this._gnar.readerMailPanelMessageShow(Array.from(this._features),e.message.value.isLastMessage,i,e.message.value.id,n,this._sessionUuid,this._userNavigatedInPanel?"navigation":"firstLoad",t,e.message.value.wordCount,"parsedDate"===e.message.value.date.kind?e.message.value.date.timestamp:void 0,this._maybeThreadId)}))}}function Fa(e){return m.d6(e)&&(0,o.zG)(e.value,v.exists((e=>e.annotations.length>0&&v.isNone(e.filteringInfo))))}function Aa(e){return m.d6(e)&&(0,o.zG)(e.value,v.exists((e=>e.summary.length>0&&v.isNone(e.filteringInfo))))}function Ga(e){return(0,o.zG)(v.fromNullable(e.messageIndexToIdMap.get(e.messageCount-1)),v.chain((t=>v.fromNullable(e.expandedMessages.get(t)))),v.fold(o.jv,(({annotations:e,summary:t})=>Fa(e)||Aa(t)||!m.n2(e)&&!m.n2(t))))}function za(e){const t=!m.n2(e.annotations)&&(0,o.zG)((0,c.zk)(e.annotations),v.flatten,v.map(f.ei("annotations")),v.fold(o.W8,(e=>0===e.length))),n=!m.n2(e.summary)&&(0,o.zG)((0,c.zk)(e.summary),v.flatten,v.map(f.ei("summary")),v.fold(o.W8,(e=>0===e.length)));return t&&n}function La(e){return(0,o.zG)((0,c.zk)(e.annotations),v.flatten,v.chain((e=>e.filteringInfo)),v.alt((()=>(0,o.zG)((0,c.zk)(e.summary),v.flatten,v.chain((e=>e.filteringInfo))))),v.isSome)}function Oa(e){return"like"===e?vt.DE.liked:"dislike"===e?vt.DE.disliked:(0,D.vE)(e)}function Pa(e,t){return e.has(t)?v.some:(0,o.a9)(v.none)}function Ka(e,t){return(0,o.zG)(e,v.fold((()=>m.x5),(e=>(0,o.zG)(a.Y(m.$w)({summary:e.summary,message:e.message}),m.UI((({summary:e,message:n})=>(0,o.zG)(e,v.fold((()=>[]),(0,o.ls)(f.ei("summary"),at.UI((e=>{var i,a;const o=Ia.h.Id.create(e.id),s=t.get(o);return{message:{id:n.id,author:n.author,date:n.date,index:n.index},itemId:o,text:e.text,pinned:null!==(i=null==s?void 0:s.pinned)&&void 0!==i&&i,dismissed:null!==(a=null==s?void 0:s.dismissed)&&void 0!==a&&a,rating:null==s?void 0:s.rating}})),at.hX((e=>!e.dismissed)))))))))))}function Ra(e,t){return(0,o.zG)(e,v.fold((()=>m.x5),(e=>(0,o.zG)(a.Y(m.$w)({annotations:e.annotations,message:e.message}),m.UI((({annotations:e,message:n})=>(0,o.zG)(e,v.fold((()=>[]),(0,o.ls)(f.ei("annotations"),at.UI((e=>{var i,a,o;const s=xa.p.Id.create(e.id),r=t.get(s);return{message:{id:n.id,author:n.author,date:n.date,index:n.index},itemId:s,text:e.text,type:e.type,pinned:null!==(i=null==r?void 0:r.pinned)&&void 0!==i&&i,checked:null!==(a=null==r?void 0:r.checked)&&void 0!==a&&a,dismissed:null!==(o=null==r?void 0:r.dismissed)&&void 0!==o&&o,rating:null==r?void 0:r.rating}})),at.hX((e=>!e.dismissed)),at.hX((e=>"question"===e.type||"action_item"===e.type)))))))))))}function Ha(e,t){return(0,o.zG)(e,v.fold((()=>m.x5),(e=>(0,o.zG)(e.message,m.tS((e=>m.Vp(e.links.map((n=>{var i,a,o;const s=t.get(n.url);return{message:{id:e.id,author:e.author,date:e.date,index:e.index},messagePinnedFrom:null!==(i=null==s?void 0:s.messagePinnedFrom)&&void 0!==i?i:v.none,name:n.name,url:n.url,type:n.type,mimeType:ma.q.isAttachment(n)?n.mimeType:void 0,pinned:null!==(a=null==s?void 0:s.pinned)&&void 0!==a&&a,dismissed:null!==(o=null==s?void 0:s.dismissed)&&void 0!==o&&o,rating:null==s?void 0:s.rating}})).filter((e=>!e.dismissed)))))))))}!function(e){e.Mock=class{constructor(e,t=!0,n=!0){this._state=e,this.isSubmitFeedbackDialogSupported=t,this.areInlineHighlightsSupported=n,this._subscriptions=new ra.w,this.inlineHighlightsEnabled=u.h.create(!0),this.actions=new xe.xQ,this.browser="chrome",this.isClipboardSupported=!0,this.state=this._state.view(),this._subscriptions.add(this.actions.pipe(B.h((0,b.Kg)(R.is(R.Kind.submitFeedback),R.is(R.Kind.skipFeedback),R.is(R.Kind.closeFeedback)))).subscribe((()=>this._updateFeedback(v.none)))),this._subscriptions.add(this.actions.pipe(H.ofType(R.Kind.openFeedback)).subscribe((({source:e,position:t})=>this._updateFeedback(v.some({source:e,position:t}))))),this._subscriptions.add(this.actions.pipe(B.h((0,b.Kg)(R.is(R.Kind.columnScroll),R.is(R.Kind.itemBlur)))).subscribe((()=>this._setActiveItemId(null)))),this._subscriptions.add(this.actions.pipe(H.ofType(R.Kind.openItemMenu)).subscribe((({itemId:e})=>this._setActiveItemId(e)))),this._subscriptions.add(this.actions.pipe(B.h((0,b.Kg)(R.is(R.Kind.like),R.is(R.Kind.dislike)))).subscribe((({kind:e,item:t,itemType:n,position:i})=>{switch(n){case"summaryItem":this.actions.next({kind:R.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"summaryItem",item:t,action:e},position:i});break;case"followUpItem":this.actions.next({kind:R.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"followUpItem",item:t,action:e},position:i});break;default:(0,D.vE)(t)}})))}getNextActiveMessageIndex(e){return v.none}dispose(){this._subscriptions.unsubscribe()}_setActiveItemId(e){this._state.modify((t=>x(t)||_(t)?{...t,activeMenuItemId:v.fromNullable(e)}:t))}_updateFeedback(e){this._state.modify((t=>"collapsed"!==t.kind&&"onboardingView"!==t.kind?{...t,activeMenuItemId:v.isNone(e)?v.none:t.activeMenuItemId,feedbackDialog:e}:"collapsed"===t.kind?{...t,feedbackDialog:e}:t))}}}(Ma||(Ma={}));var Ba=n(84603),Da=n(66319),Va=n(75420),Za=n(29567),ja=n(74850),qa=n(19751),Wa=n(40151),$a=n(17343),Qa=n(16118),Ja=n(78674),Ya=n(71032),Xa=n(85321),eo=n(67434),to=n(71249),no=n(69243),io=n(73975);const ao=no.OT(no.dt({filteringVersion:no.pk,filteredMessages:no.OT(no.IM(s.Rb.Id.codec,no.Bk(no.Z_)))}));var oo;!function(e){e.eq=io.MW({filteringVersion:io.lr,filteringReasons:to.Eh(io.yv)})}(oo||(oo={}));const so=no.OT(no.dt({s:no.pk,e:no.pk})),ro=no.G0([no.i0("main_point"),no.i0("date"),no.i0("question"),no.i0("action_item")]);var lo;!function(e){let t;!function(e){e.codec=no.UQ(no.Z_,(e=>"string"==typeof e),"ReaderAnnotationId"),e.create=function(e,t,n){return`${e}|${t.s}-${t.e}-${n}`}}(t=e.Id||(e.Id={}))}(lo||(lo={}));const co=no.jV([no.r$({filteringInfo:ao}),no.dt({annotations:no.IX(no.jV([no.dt({message_id:s.Rb.Id.codec,span:so,type:ro}),no.r$({id:lo.Id.codec})]))})]);new no.Dy("ReaderAnnotations",co.is,co.validate,(e=>e.annotations.reduce(((t,n)=>{var i;return t[n.message_id]={messageId:n.message_id,annotations:((null===(i=t[n.message_id])||void 0===i?void 0:i.annotations)||[]).concat({id:n.id||lo.Id.create(n.message_id,n.span,n.type),span:n.span,type:n.type}),filteringInfo:(0,o.zG)(v.fromNullable(e.filteringInfo),v.chain((t=>{var i,o;return a.Y(v.option)({filteringReasons:v.fromNullable(null===(i=t.filteredMessages)||void 0===i?void 0:i[n.message_id]),filteringVersion:v.fromNullable(null===(o=e.filteringInfo)||void 0===o?void 0:o.filteringVersion)})})))},t}),{})));var mo;!function(e){e.eq=io.MW({id:io.yv,span:io.MW({s:io.lr,e:io.lr}),type:io.yv})}(lo||(lo={})),function(e){let t;!function(e){e.create=function(e){return e}}(t=e.Id||(e.Id={}))}(mo||(mo={}));var uo=n(25691);class ho{constructor(e=ja.Y.create("Reader-Card-Controller")){this._logger=e,this._hovered=new xe.xQ,this._dismissed=new xe.xQ,this.cardHovered=this._hovered.pipe((0,de.O)(!1),(0,rt.x)()),this.cardDismissed=this._dismissed.pipe((0,rt.x)()),this._activeCardModel=u.h.create(null),this.view=(0,ie.aj)([this._activeCardModel]).pipe((0,C.U)((([e])=>(null==e?void 0:e.annotation)?g.createElement(uo.W,{anchorRect:e.highlightRect},g.createElement("div",{style:{background:"white",borderRadius:10,padding:10,fontSize:"12px",fontFamily:"sans-serif",boxShadow:"0px 2px 10px rgba(0, 0, 0, 0.6)"}},g.createElement("b",null,"Annotation"),g.createElement("pre",{style:{maxWidth:400,whiteSpace:"pre-wrap"}},JSON.stringify(e.annotation,null,4)))):null))),this._logger.debug("Created")}show(e){this._activeCardModel.set(e)}hide(){this._activeCardModel.set(null),this._hovered.next(!1)}dispose(){this.hide()}}var po=n(34311);class go{constructor(e){this._annotationsStateService=e}getHoveredStateBehavior(e){return this._annotationsStateService.getHighlightedAnnotation().pipe((0,C.U)((t=>t&&t.highlightIds.includes(e)?po.pc.hovered:po.pc.none)))}}var fo,bo=n(50628),vo=n(24755),ko=n(95300),yo=n(95343),Io=n(11407),xo=n(28728),_o=n(15555),wo=n(13718);!function(e){e.eq=io.f7(((e,t)=>e&&t?e.annotationId===t.annotationId:e===t))}(fo||(fo={}));class Eo{constructor(e,t=ja.Y.create(Eo.name)){this._options=e,this._log=t,this._rawHighlightedAnnotation=()=>this._options.mouseData.pipe(wo.U(Io.S.hz30),qa.skipBy(xo.Z.eq),C.U((({client:e,offset:t})=>{if(e&&t&&function(e,t){var n;let i=t.ownerDocument.elementFromPoint(e.left,e.top);(null===(n=null==i?void 0:i.shadowRoot)||void 0===n?void 0:n.elementFromPoint)&&(i=i.shadowRoot.elementFromPoint(e.left,e.top));return t.contains(i)}(e,this._options.textNode)){const e=this._options.highlightGeometry.geometry.get();return Array.from(e.keys()).reduce(((n,i)=>{const a=e.get(i);if(a){const e=a.rects&&(null===a.meta.highlightDisplayFormat||_o.jk.isInteractable(a.meta.highlightDisplayFormat))&&a.rects.find((e=>ot.UL.contains(t,e)));if(e)return{annotationId:a.meta.annotationId,activeHighlightId:a.meta.highlightId,activeHighlightRect:e,highlightIds:[]}}return n}),null)}return null})),qa.skipBy(fo.eq),C.U((e=>{if(!e)return null;const t=this._options.highlightGeometry.geometry.get(),n=[];return t.forEach(((t,i)=>{t.meta.annotationId===e.annotationId&&n.push(i)})),{...e,highlightIds:n}}))),this._offByUpdatedGeometry=e=>this._options.highlightGeometry.geometry.pipe(C.U((t=>e&&t.has(e.activeHighlightId)?e:null)),B.h((e=>null===e)),$a.h(null),we.b((e=>this._log.trace("OffByUpdatedGeometry",e)))),this._offByTextPositionChange=()=>fa.T(this._options.textNodeLayout.rect.changes.pipe(we.b((()=>this._log.trace("Text field position, size has been changed")))),this._options.textNodeLayout.scroll.changes.pipe(we.b((()=>this._log.trace("Text field scroll has been changed")))),$e.R(self,"scroll").pipe(we.b((()=>this._log.trace("Window scroll detected"))))).pipe(bo.P(),$a.h(null))}getActiveAnnotation(){throw new Error("Not implemented")}getHighlightedAnnotation(){throw new Error("Not implemented")}}class Co extends Eo{constructor(e,t=ja.Y.create(Co.name)){super(e,t)}getActiveAnnotation(){return this.getHighlightedAnnotation().pipe(qa.skipBy(fo.eq))}getHighlightedAnnotation(){return this._rawHighlightedAnnotation().pipe(qa.skipBy(fo.eq),lt.w((e=>e?fa.T(this._offByUpdatedGeometry(e),this._offByTextPositionChange()).pipe(we.b((()=>this._log.trace("Active state was overriden by text or geometry change"))),bo.P(),de.O(e)):M.of(null))),qa.skipBy(fo.eq),vo.O(new ko.X(null)),yo.x())}}var Uo=n(93356),So=n(76331),No=n(40327),Mo=n(10166),To=n(4432);class Fo{constructor(){}create(e,t){return{getRects:()=>{var n;const i=[];let a,o=e.start,s=!1;do{const r=t.getFragmentAtOrBeforeOffset(o);if(r&&a!==o){a=o;if(null===(n=r.node.textContent)||void 0===n?void 0:n.replace(/\s/g,"")){const n=To.M.createRange(t,o,Math.min(r.endOffset,e.end));n&&i.push(...Array.from(n.getClientRects()))}o=r.endOffset===o?r.endOffset+1:r.endOffset}else s=!0}while(o<e.end&&!s);return(0,No.pipe)(i,Mo.e,Mo.y,to.UI(ot.Pf.create))}}}getClientRects(e){return e.getRects()}getIsInvalid(e){return!1}getIsConsistent(e,t,n){return!0}dispose(e){}}var Ao=n(13116),Go=n(28094),zo=n(95981),Lo=n(63919),Oo=n(25924),Po=n(18505),Ko=n(2780),Ro=n(68383),Ho=n(92783),Bo=n(57356),Do=n(51655),Vo=n(70718),Zo=n(13822);function jo(e,t,n,i=!1){const a=(0,Do.Me)(e).body,o=(0,Do.Jj)(e);let s={left:"0px",top:"0px"};if(t.fieldPaintingPositioning===Bo.Q.nonPositioned&&t.positionedAncestor===a){const e=o.getComputedStyle(a);s={left:e.marginLeft||"0px",top:e.marginRight||"0px"}}else if(t.positionedAncestor!==a){const e=o.getComputedStyle(t.positionedAncestor);s={left:e.borderLeftWidth&&`-${e.borderLeftWidth}`||"0px",top:e.borderTopWidth&&`-${e.borderTopWidth}`||"0px"}}return a=>{a.style.position="absolute",a.style.top=s.top,a.style.left=i?"auto":s.left,a.style.right=i?s.left:"auto",a.style.pointerEvents="none",function({subjectElement:e,isPositioned:t,subjectElementStyle:n,integrationRoot:i,positionedAncestor:a}){t?(i.style.zIndex=n.zIndex,e.insertAdjacentElement("afterend",i)):a.insertAdjacentElement("afterbegin",i)}({subjectElement:e,isPositioned:t.fieldPaintingPositioning===Bo.Q.positioned,subjectElementStyle:n,integrationRoot:a,positionedAncestor:t.positionedAncestor})}}function qo(e){return ot.Pf.create({...e.client,...e.size})}class Wo{constructor(e){this._highlightsSubject=e,this.getFieldPositionRelativeToViewport=()=>{const e=this._highlightsSubject.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height}},this._prepareHighlights=(e,t=(0,Do.is)(e))=>{const n=(0,Do.o)(e),i=(0,Vo.fL)(e,!1,n,t);return{layout:i,rootInjector:jo(e,i,n),enableHighlightsBlendingOnRoot:(0,Go.$)(e,n)}},this._prepareInnerElements=(e,t=(0,Do.is)(e),n)=>{const i=(0,Do.o)(e),a=n||(0,Vo.fL)(e,!1,i,t);return{layout:a,rootInjector:jo(e,a,i,!0)}},this._highlights=this._prepareHighlights(this._highlightsSubject),this._innerElements=this._prepareInnerElements(this._highlightsSubject,void 0,this._highlights.layout),this._win=(0,Do.Jj)(this._highlightsSubject),this._createTextNodeRect=e=>({page:Lo.Cv.fromClient(e.client,{top:this._win.scrollY,left:this._win.scrollX}),offset:e.offset,client:e.client,size:e.size,padding:e.padding}),this.textNode={rect:this._highlights.layout.textField.paddingRect.map(this._createTextNodeRect),visibleRect:this._highlights.layout.textField.visibleRect.map(this._createTextNodeRect),scroll:this._highlights.layout.textField.scroll,scrollSize:this._highlights.layout.textField.scrollSize,scroller:(0,l.iX)(this._highlightsSubject,{rect:this._highlights.layout.textField.paddingRect.map(this._createTextNodeRect),scrollSize:this._highlights.layout.textField.scrollSize})},this.highlightHeightOffset=0,this.mouse=(0,ie.aj)([this._highlights.layout.textField.paddingRect.behavior,this._highlights.layout.textField.scroll.behavior]).pipe((0,C.U)((([e,t])=>({rect:qo(e),scroll:t}))),(0,lt.w)((({rect:e,scroll:t})=>(0,Ho.Am)()?(0,Oo.q7)(this._win,e,t):(0,Oo.B0)(this._win,e,t))),(0,rt.x)(ua.fS))}createGeometryLayout(){return new zo.D((()=>qo(this._highlights.layout.textField.paddingRect.getCurrent())),(()=>this._highlights.layout.textField.scroll.getCurrent()),(()=>qo(this._highlights.layout.textField.paddingRect.getApproximate())),(()=>this._highlights.layout.textField.scroll.getApproximate()))}render(e,t){const n={position:"absolute",top:0,left:0},i={position:"absolute",top:0,right:0},a=()=>e.innerElements?g.createElement(e.innerElements,null):null,o=(0,Do.Me)(this._highlightsSubject),s=Po.VB.get({monitorAs:"highlights"}).inject(Ko.EM.fromDocument(o,"grammarly-extension"),(e=>{t.highlightsBlendingEnabled&&this._highlights.enableHighlightsBlendingOnRoot(e),this._highlights.rootInjector(e)}),Ro.G7.showWhenLoaded(g.createElement((()=>g.createElement(g.Fragment,null,e.highlights&&g.createElement("div",{"data-grammarly-part":"highlights",style:n},g.createElement(Zo.V,{layout:this._highlights.layout},g.createElement("div",{style:n},g.createElement(e.highlights,null)))))),null))),r=Po.VB.get({monitorAs:"inner-elements"}).inject(Ko.EM.fromDocument(o,"grammarly-extension"),this._innerElements.rootInjector,Ro.G7.showWhenLoaded(g.createElement((()=>e.innerElements?g.createElement("div",{"data-grammarly-part":"inner-elements",style:i},g.createElement(a,null)):null),null))),l=e.outerElements&&Po.VB.get({monitorAs:"outer-elements"}).inject(Ko.EM.fromDocument(o,"grammarly-popups"),Ko.zs.appendChild(o.documentElement),Ro.G7.showWhenLoaded(g.createElement(e.outerElements,null)),{eventPropagationHandler:t.eventPropagationHandler});return{dispose:()=>{s&&s.dispose(),l&&l.dispose(),r&&r.dispose()}}}}var $o,Qo=n(43675),Jo=n(92843),Yo=n(37881),Xo=n(22679),es=n(87965),ts=n(50663),ns=n(48189),is=n(49468);class as{constructor(e,t,n,i){this._layout=e,this._highlights=t,this._annotationCards=n,this._getHoveredStateBehavior=i,this._highlightHoverStateBehavior=e=>this._getHoveredStateBehavior(e),this._getHighlightsContainer=e=>g.createElement(U.F.div,{style:this._layout.textNode.scrollSize.behavior.pipe((0,C.U)((e=>({height:e.height,width:e.width}))))},e),this.highlights=()=>this._getHighlightsContainer(g.createElement(g.Fragment,null,g.createElement(Yo.$v,{key:"aqua-highlights",highlightHeightOffset:0,highlights:this._highlights.geometry.view((e=>Array.from(e.values()))),getHoverState:this._highlightHoverStateBehavior}))),this.outerElements=()=>{const e=this._annotationCards;return g.createElement(is.o,{style:{zIndex:Xo.op,position:"absolute",top:0,left:0,width:"100%"}},g.createElement(es.p,null,g.createElement("div",{style:{position:"fixed",visibility:"hidden"}}),g.createElement(U.F.Fragment,null,e),g.createElement(ts.G,null),g.createElement(ns.p,{regular:!0,bold:!0})))}}}!function(e){e.eq=io.Uz((e=>({annotations:e.annotations,messageId:e.messageId,bodyNode:e.bodyNode})))(io.MW({messageId:io.yv,annotations:to.Eh(lo.eq),bodyNode:io.w4}))}($o||($o={}));class os{constructor(e,t,n,i,s=ja.Y.create("Reader-Gmail-Annotations")){this._annotatedMessages=e,this._features=n,this._onboardingVM=i,this._logger=s,this._subscriptions=new ra.w,this._currentAnnotations=new Map,this._geometryProvider=new Fo,this._state=new Map,this._bodyNodeToMessageId=new WeakMap,this._annotationIdsForMessageId=new Map,this._hiddenMessages=new WeakMap,this._annotationsChanged=new xe.xQ,this.annotations=this._annotationsChanged.pipe(C.U((()=>Array.from(this._currentAnnotations.values()))));const r=new xe.xQ,l=fa.T(this._annotatedMessages.pipe(de.O(new Map),Qa.G(),C.U((([e,t])=>(0,o.zG)(Qo.yi($o.eq)(e,t),Jo.v.reduce([],((e,{messageId:t})=>e.concat({kind:"remove",messageId:t})),((e,t,n)=>e.concat({kind:"update",prevAnnotations:t.annotations,...n})),((e,t)=>e.concat({kind:"add",...t})))))),Xa.zg(o.yR)),r);this._intersectionObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?(0,o.zG)(v.fromNullable(this._hiddenMessages.get(e.target)),kt.bw((t=>{this._hiddenMessages.delete(e.target),r.next({kind:"add",...t})}))):(0,o.zG)(v.fromNullable(this._bodyNodeToMessageId.get(e.target)),v.chain((e=>v.fromNullable(this._state.get(e)))),kt.bw((({message:t})=>{const{messageId:n,bodyNode:i}=t;this._logger.debug(`Message ${n} hidden, clearing annotations`),r.next({kind:"remove",messageId:n}),this._hiddenMessages.set(e.target,t),this._intersectionObserver.observe(i)})))}))}),{root:t}),this._subscriptions.add(l.subscribe((e=>{var t;const n=this._state.get(e.messageId);if(n&&("update"===e.kind?e.prevAnnotations.forEach((t=>{const n=mo.Id.create(t.id);this._currentAnnotations.delete(n),this._annotationsChanged.next(null),(0,o.zG)(v.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),kt.bw((e=>{e.delete(n)})))})):"remove"===e.kind&&((0,o.zG)(v.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),kt.bw((e=>{for(const t of e.values())this._currentAnnotations.delete(t),this._annotationsChanged.next(null)}))),this._annotationIdsForMessageId.delete(e.messageId),this._bodyNodeToMessageId.delete(n.message.bodyNode),this._state.delete(e.messageId)),n.disposables.forEach((e=>e.dispose())),this._logger.trace(`Annotations for ${e.messageId} cleared`)),"add"===e.kind||"update"===e.kind){const n=v.fromNullable(this._features.has("inlineCards")?new ho:null),i=new Wo(e.bodyNode),s=new So.C(this._geometryProvider,i.createGeometryLayout(),(()=>e.textMap),(0,Uo.u)(),(0,po.WF)(i.textNode)),r=(0,o.zG)(n,v.map((()=>new Co({textNode:e.bodyNode,textNodeLayout:i.textNode,mouseData:i.mouse,highlightGeometry:s})))),l=(0,o.zG)(r,v.map((e=>new go(e)))),d=(0,o.zG)(a.Y(v.option)({stateService:r,controller:n}),v.map((({stateService:e,controller:t})=>e.getActiveAnnotation().subscribe((e=>{if(e){const n=this._currentAnnotations.get(e.annotationId);n&&t.show({highlightRect:(0,Ao.Z)(e.activeHighlightRect,i.textNode.rect.getApproximate().client,i.textNode.scroll.getApproximate()),annotation:n})}else t.hide()}))))),c=(null===(t=this._onboardingVM)||void 0===t?void 0:t.state.get().seen)?null:s.geometry.pipe(B.h((e=>e.size>0)),ut.q(1),we.b((e=>{(0,o.zG)(Array.from(e.values()),to.YM,v.map(f.ei("rects")),v.chain(to.YM),kt.bw((e=>{var t;null===(t=this._onboardingVM)||void 0===t||t.actions.next({kind:R.Kind.inlineHighlightOnboardingElementMounted,step:"highlight",node:{getBoundingClientRect:()=>{const t=(0,Ao.Z)(e,i.textNode.rect.getCurrent().client,i.textNode.scroll.getCurrent());return DOMRect.fromRect({x:t.left,y:t.top,width:0,height:t.height})}}})})))}))).subscribe(),m=new as(i,s,(0,o.zG)(n,v.map((e=>e.view)),v.getOrElse((()=>M.of(null)))),(e=>(0,o.zG)(l,v.map((t=>t.getHoveredStateBehavior(e))),v.getOrElse((()=>M.of(po.pc.none))))));this._intersectionObserver.observe(e.bodyNode),this._state.set(e.messageId,{message:e,disposables:[s,i.render(m,{}),{dispose:()=>this._intersectionObserver.unobserve(e.bodyNode)},{dispose:()=>null==c?void 0:c.unsubscribe()},...(0,o.zG)(n,v.map((e=>[e])),v.getOrElse((()=>[]))),...(0,o.zG)(d,v.map((e=>[{dispose:()=>e.unsubscribe()}])),v.getOrElse((()=>[])))]}),this._bodyNodeToMessageId.set(e.bodyNode,e.messageId);const u=(0,o.zG)(v.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),v.getOrElse((()=>{const t=new Set;return this._annotationIdsForMessageId.set(e.messageId,t),t})));e.annotations.filter((e=>"main_point"===e.type)).forEach((e=>{const t=po.y$.Id.create(e.id),n=mo.Id.create(e.id);this._logger.trace("Adding annotation highlight",t),this._currentAnnotations.set(n,e),this._annotationsChanged.next(null),u.add(n),s.addHighlight(t,{start:e.span.s,end:e.span.e},{highlightId:t,annotationId:n,highlightColor:_o.hE.Preset.create(_o.al.blue),highlightDisplayFormat:_o.jk.background,highlightLiveliness:this._features.has("inlineCards")?_o.iY.animated:_o.iY.static})}))}})))}dispose(){this._subscriptions.unsubscribe();for(const{disposables:e}of this._state.values())e.forEach((e=>e.dispose()));this._currentAnnotations.clear(),this._annotationsChanged.next(null),this._state.clear(),this._annotationIdsForMessageId.clear(),this._intersectionObserver.disconnect()}}var ss=n(85089),rs=n(89068),ls=n(91224),ds=n(73572),cs=n(18347),ms=n(44586),us=n(17733),hs=n(79582);function ps(e,t){return new ms.y((function(n){var i=e.length;if(0!==i)for(var a=new Array(i),o=0,s=0,r=function(r){var l=(0,ba.D)(e[r]),d=!1;n.add(l.subscribe({next:function(e){d||(d=!0,s++),a[r]=e},error:function(e){return n.error(e)},complete:function(){++o!==i&&d||(s===i&&n.next(t?t.reduce((function(e,t,n){return e[t]=a[n],e}),{}):a),n.complete())}}))},l=0;l<i;l++)r(l);else n.complete()}))}var gs,fs,bs,vs=n(55822),ks=n(16169),ys=n(44923),Is=n(68477),xs=n(60655),_s=n(66081),ws=n(78146),Es=n(44212),Cs=n(86400);function Us(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function Ss(e){const t=e.match(/(?<name>.*?)\s*<(?<email>.*?)>/);if(null==t?void 0:t.groups){const e=t.groups.email,n=t.groups.name;return(0,o.zG)(Za.G.create(e),ka.Yo((()=>"No email address found")),ka.UI((e=>({email:e,name:(0,o.zG)(n,Us,(e=>""===e?void 0:e))}))))}return(0,o.zG)(Za.G.create(e.trim()),v.map((e=>({name:void 0,email:e}))),ka.Yo((()=>`Malformed user [${e}]`)))}function Ns(e){const t=e.includes("<")&&e.includes(">");return(0,o.zG)(t?e.split(/>\s*,\s*/):e.split(/\s*,\s*/),(e=>e.length>1&&t?e.map((e=>e+">")):e),to.hX((e=>!e.match(/^undisclosed/))),to.UI(Ss),to.IX.sequence(ka.wE))}function Ms(e){try{const t=e.split(/\n{2,}/)[0];return t?(0,o.zG)(function(e){const t=e.split(/\n+/),n=[];for(const e of t)if(/^\s+/.test(e))n.length>0&&(n[n.length-1].value+=e.trimStart());else{const t=e.match(/(.*?):\s*(.*)/);t&&t.length>=3&&n.push({header:String(t[1]).toLowerCase(),value:t[2]})}return n.reduce(((e,{header:t,value:n})=>({...e,[t]:n})),{})}(t),(e=>{var t,n,i,s;return a.Y(ka.wE)({id:(0,o.zG)(null===(n=null===(t=e["message-id"])||void 0===t?void 0:t.match(/<(.*?)>/))||void 0===n?void 0:n[1],ka.ij("No Message-ID header")),inReplyTo:ka.F2(null===(s=null===(i=e["in-reply-to"])||void 0===i?void 0:i.match(/<(.*?)>/))||void 0===s?void 0:s[1]),date:(0,o.zG)(e.date,ka.ij("No Date header"),ka.UI((e=>new Date(e)))),from:(0,o.zG)(e.from,ka.ij("No From header"),ka.tS(Ss)),to:(0,o.zG)(e.to,ka.ij("No To header"),ka.tS(Ns)),cc:(0,o.zG)(e.cc,(e=>e?Ns(e):ka.F2(void 0))),bcc:(0,o.zG)(e.bcc,(e=>e?Ns(e):ka.F2(void 0))),subject:(0,o.zG)(e.subject,ka.ij("No Subject header")),deliveredTo:(0,o.zG)(e["delivered-to"],ka.F2),replyTo:(0,o.zG)(e["reply-to"],(e=>e?Ns(e):ka.F2(void 0))),listUnsubscribe:(0,o.zG)(e["list-unsubscribe"],(e=>e?function(e){const t=(0,Cs.rL)(e,/<([^<>]+)>/g,(e=>e[1]));return t.length?t:void 0}(e):void 0),ka.F2),headers:ka.F2(e)})})):ka.t$("Expected headers")}catch(e){return ka.t$(String(e))}}async function Ts(e,t,n){const i=await async function(e,t,n){var i,a,o,s;const r=(null===(a=null===(i=/^(?<url>.*?)\/?[#\?]/.exec(e))||void 0===i?void 0:i.groups)||void 0===a?void 0:a.url)||"https://mail.google.com/mail/u/0";try{const e=await fetch(`${r}/?ik=${encodeURIComponent(t)}&view=om&permmsgid=${encodeURIComponent(n)}`),i=await e.text(),a=null===(s=null===(o=/<pre[\s\S]*?id="raw_message_text"[\s\S]*?>(?<orig_msg>[\s\S]*?)<\/pre>/m.exec(i))||void 0===o?void 0:o.groups)||void 0===s?void 0:s.orig_msg;return a?ka.ij({message:"Could not decode message"})((0,c.l_)(a.trim())):ka.t$({message:"Could not extract message from response",mimeMessageNotFound:!0})}catch(e){return ka.t$({message:String(e)})}}(n,t,e);return(0,o.zG)(i,ka.tS((e=>(0,o.zG)(Ms(e),ka.Vn((e=>({message:e})))))))}class Fs{constructor(e,t,n,i,s=ja.Y.create("Reader-Gmail-Thread-Context")){var r;this._doc=e,this._messageList=t,this._telemetry=i,this._logger=s,this._subscriptions=new ra.w,this._state=u.h.create((0,o.zG)(function(e){const t=ka.ij(new vs.DH("Cannot find thread subject container"))(e.querySelector(ds.Av)||e.querySelector(ds.cE));return{threadId:(0,o.zG)(t,ka.tS((e=>ka.ij(new vs.DH("Cannot find thread ID"))(e.getAttribute("data-thread-perm-id"))))),subject:(0,o.zG)(t,ka.tS((e=>ka.ij(new vs.DH("Cannot find thread Subject"))(e.textContent)))),loggedUser:(0,o.zG)(ka.ij(new vs.DH("Cannot extract user from avatar"))(Ba.x.getAuthor()),ka.tS((e=>(0,o.zG)(Za.G.create(e.email),v.map((t=>({name:e.name?e.name:void 0,email:t}))),ka.Yo((()=>new vs.DH("No email address found in avatar")))))))}}(this._doc),(e=>({threadId:e.threadId,subject:e.subject,loggedUser:e.loggedUser,messageCount:Rs(this._messageList).length,expandedMessages:new Map,messageIndexToIdMap:new Map})))),this.threadContext=this._state.view(),(0,o.zG)(this._state.get(),(e=>a.Y(ka.wE)({threadId:e.threadId,subject:e.subject,loggedUser:e.loggedUser})),ka.Vn((e=>{this._telemetry.readerGmail.warning("threadInfoExtraction",e.message),this._logger.warn("Static thread info extraction error",e)}))),this._subscriptions.add((0,o.zG)((r=this._messageList,new ms.y((e=>{const t=new ra.w,n=new Map,i=new ko.X(new Map),a=new xe.xQ,s=new IntersectionObserver((e=>e.forEach((e=>{e.isIntersecting||a.next(e.target)}))),{root:null});return t.add(Da.x.create(r,{childList:!0}).pipe(C.U((e=>({added:e.flatMap((e=>Array.from(e.addedNodes))).filter(Hs),removed:e.flatMap((e=>Array.from(e.removedNodes))).filter(Hs)}))),de.O({added:Rs(r),removed:new Array})).subscribe((({added:e,removed:t})=>{t.forEach((e=>{var t;null===(t=n.get(e))||void 0===t||t.unsubscribe(),i.next((0,o.zG)(d.EG(io.w4)(e)(i.value),As(r)))})),e.forEach((e=>{var t;null===(t=n.get(e))||void 0===t||t.unsubscribe();const l=function(e,t,n){return new ms.y((i=>{const a=new ra.w,s=new ko.X({bodyNode:(0,o.zG)(Bs(n),v.map((e=>({node:e,rev:0})))),messageId:Ds(n)});return v.isNone(s.value.bodyNode)&&a.add(Da.x.create(n,{attributes:!0,attributeFilter:["aria-expanded","tabindex"]}).pipe(C.U((()=>Bs(n))),N.oA,ut.q(1)).subscribe((e=>s.next({bodyNode:v.some({node:e,rev:0}),messageId:(0,o.zG)(s.value.messageId,v.alt((()=>Ds(n))))})))),a.add(s.subscribe((({bodyNode:t,messageId:n})=>{(0,o.zG)(t,kt.bw((t=>e.observe(t.node)))),i.next({bodyNode:t,messageId:n})}))),a.add(t.pipe(B.h((e=>(0,o.zG)(s.value.bodyNode,v.map((e=>e.node)),kt.FX(e))&&!document.contains(e)))).subscribe((t=>{e.unobserve(t),s.next({bodyNode:(0,o.zG)(Bs(n),v.map((e=>({node:e,rev:0})))),messageId:s.value.messageId})}))),()=>a.unsubscribe()})).pipe(lt.w((({bodyNode:e,messageId:t})=>(0,o.zG)(e,v.fold((()=>M.of({bodyNode:v.none,messageId:t})),(e=>Da.x.create(e.node,{subtree:!0,childList:!0,attributes:!1,characterData:!0}).pipe(eo.R((e=>e+1),e.rev),de.O(0),C.U((n=>({bodyNode:v.some({node:e.node,rev:n}),messageId:t}))))))))))}(s,a,e).pipe(de.O({bodyNode:v.none,messageId:v.none}),Qa.G()).subscribe((([{bodyNode:t},{bodyNode:n,messageId:a}])=>{v.isSome(t)&&v.isNone(n)?i.next((0,o.zG)(d.EG(io.w4)(e)(i.value),As(r))):i.next((0,o.zG)(i.value,d.cq(io.w4)(e,(e=>({...e,bodyNode:n,messageId:a}))),v.getOrElse((()=>d.ZQ(io.w4)(e,{messageNode:e,bodyNode:n,messageId:a,index:i.value.size})(i.value)))))}));n.set(e,l)}))}))),t.add(i.subscribe((t=>e.next(t)))),()=>{t.unsubscribe();for(const e of n.values())e.unsubscribe();s.disconnect()}}))),we.b((e=>this._state.lens("messageCount").set(e.size))),_s.e(50),we.b((e=>this._logger.debug("message nodes map updated",e))),C.U(d.hX(fs.isExpanded)),de.O(d.cS),Qa.G(),C.U((([e,t])=>function(e,t){return(0,o.zG)(Qo.yi(bs.eqByBodyNodeAndRev)(e,t),Jo.v.reduce({messages:new Map(Array.from(t.values()).map((e=>[e.messageId.value,e]))),added:new Set,updated:new Set,removed:new Set},((e,t)=>({...e,removed:e.removed.add(t.messageId.value)})),((e,t,n)=>({...e,updated:e.updated.add(n.messageId.value)})),((e,t)=>({...e,added:e.added.add(t.messageId.value)}))))}(e,t))),B.h((e=>e.added.size>0||e.updated.size>0||e.removed.size>0)),we.b((({added:e,updated:t,removed:n,messages:i})=>{this._logger.info(`Expanded messages changed - added [${Array.from(e).join(", ")}] - updated [${Array.from(t).join(", ")}] - removed [${Array.from(n).join(", ")}]`),this._state.modify((n=>({...n,expandedMessages:(0,o.zG)(i,d.DZ((i=>e.has(i.messageId.value)?v.some(m.x5):t.has(i.messageId.value)?(0,o.zG)(v.fromNullable(n.expandedMessages.get(i.messageId.value)),v.map((e=>m.VZ(e)||m.IR(e)?m.x5:e))):v.fromNullable(n.expandedMessages.get(i.messageId.value))))),messageIndexToIdMap:new Map(Array.from(i.values()).map((({index:e,messageId:t})=>[e,t.value])))})))})),C.U((({added:e,updated:t,messages:n})=>(0,o.zG)(Array.from(e).concat(Array.from(t)),to.DZ((e=>v.fromNullable(n.get(e)))),to.UI((e=>({id:e.messageId.value,index:e.index,messageNode:e.messageNode})))))),B.h((e=>e.length>0)),Xa.zg(n),we.b((({message:{id:e,messageNode:t,index:n},context:i})=>this._state.lens("expandedMessages").modify((a=>new Map(a).set(e,(0,o.zG)(i,ka.g_((t=>{const n=`Could not extract context for #${e}: ${String(t)}`;return this._logger.warn(n),m.kH(new vs.DH(n))}),(i=>(0,o.zG)(Bs(t),v.fold((()=>{const n=`Could not find message body for #${e}`;return this._logger.warn(n,t),m.kH(new vs.DH(n))}),(a=>{this._logger.trace(`Message #${e} extracted`),this._logger.trace(`Got ${i.links.length} links`);const s=zs(a);return m.Vp({id:e,index:n,messageNode:t,bodyNode:a,context:i,textMap:s,semanticInformation:{...i.semanticInformation,...(0,o.zG)(Gs(a),(e=>void 0!==e?{tableTextCoverage:e}:{}))}})})))))))))))).subscribe())}dispose(){this._subscriptions.unsubscribe()}}function As(e){const t=new Map(Rs(e).map(((e,t)=>[e,t])));return e=>(0,o.zG)(e,d.Su(((e,n)=>(0,o.zG)(v.fromNullable(t.get(e)),v.fold((()=>n),(e=>({...n,index:e})))))))}function Gs(e){const t=[];e.querySelectorAll("table").forEach((e=>{0!==t.length&&t[t.length-1].contains(e)||t.push(e)}));const n=e.innerText.replace(/\s+/g,""),i=t.map((e=>e.innerText.replace(/\s+/g,"")));let a=n;for(const e of i)a=a.replace(e,"");const o=Math.max(0,Math.min(1,(n.length-a.length)/n.length));return Number.isNaN(o)?void 0:o}function zs(e){return new ks.Z(e,((e,t)=>ks.Z.defaultFilterNodeAllowList(["PRE","CODE","BLOCKQUOTE"])(e,t)&&!ys.W.maybeGmailHistoryQuote(e)),void 0,ks.Z.isBlockNodeFromTagList((0,o.zG)(new Set(ks.Z.blockTags),cs.Od(io.yv)("CODE"))),void 0,void 0,((e,t)=>e instanceof Element&&"false"===e.getAttribute("aria-expanded")),ys.W.gmailNodeFormatting,void 0,void 0,!1)}function Ls(e){return a.Y(ka.wE)({email:(0,o.zG)(ka.ij(new vs.DH("No email found"))(null==e?void 0:e.getAttribute("email")),ka.tS((e=>ka.Yo((()=>new vs.DH("Invalid email address")))(Za.G.create(e))))),name:(0,o.zG)(ka.ij(new vs.DH("No name found"))(null==e?void 0:e.getAttribute("name")),ka.UI((e=>e||void 0)))})}!function(e){e.eq=io.MW({node:io.w4,rev:io.lr})}(gs||(gs={})),function(e){e.isExpanded=function(e){return v.isSome(e.bodyNode)&&v.isSome(e.messageId)}}(fs||(fs={})),function(e){e.eqByBodyNodeAndRev=io.Uz(f.ei("bodyNode"))(v.getEq(gs.eq))}(bs||(bs={}));function Os(e,t,n=6e3){return i=>fa.T(...e.map((e=>i.pipe(B.h((t=>t.message.id===e.id)),(0,c.Vh)(n),ls.K((n=>M.of({message:e,context:ka.t$(new vs.DH(t+((0,Is.H)(n)?` [${n.message}]`:"")))})))))))}function Ps(e,t,n,i,s,r=5){return l=>{const{left:d,right:c}=(0,o.zG)(l,to.uK(i));return fa.T((0,o.zG)(d,Ks(e),Os(d,"DOM-only extraction timeout")),fa.T((0,o.zG)(c,Ks(e),Os(c,"DOM extraction timeout"),C.U((e=>({...e,kind:"fromDOM"})))),(0,o.zG)(c,function(e,t,n,i=5){const a=new xe.xQ,s=new Map;return r=>fa.T(M.of(r),a).pipe(lt.w((e=>ba.D(e.reduce(((e,t)=>(e.length>0&&e[e.length-1].length<i?e[e.length-1].push(t):e.push([t]),e)),[])))),_e.M(e),Ya.b((([e,n])=>function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if((0,us.k)(n))return ps(n,null);if((0,hs.K)(n)&&Object.getPrototypeOf(n)===Object.prototype){var i=Object.keys(n);return ps(i.map((function(e){return n[e]})),i)}}if("function"==typeof e[e.length-1]){var a=e.pop();return ps(e=1===e.length&&(0,us.k)(e[0])?e[0]:e,null).pipe((0,C.U)((function(e){return a.apply(void 0,e)})))}return ps(e,null)}(e.map((e=>ba.D(Ts(e.id,n,t())).pipe(C.U((t=>({message:e,headers:t}))))))))),Ya.b((e=>e)),lt.w((({message:e,headers:t})=>(0,o.zG)(t,ka.g_((t=>{n.warn(`Error accessing MIME headers for #${e.id}:`,t.message);const i=s.get(e.id)||0,o=1;return t.mimeMessageNotFound&&i<o?(n.warn(`Retrying to fetch MIME headers for #${e.id}`),s.set(e.id,i+1),a.next([e]),Wa.E):M.of({message:e,context:ka.t$(new vs.DH(t.message))})}),(t=>M.of({message:e,context:ka.F2({date:{kind:"parsedDate",timestamp:t.date.getTime()},author:t.from,audience:t.to.concat(t.cc||[]).concat(t.bcc||[]),replyTo:t.replyTo||[],links:[],isFromMailingList:!1,semanticInformation:{isWholeHTMLDocument:/^text\/html\b/.test(t.headers["content-type"])}})})))))))}(t,n,s,r),Os(c,"MIME headers extraction timeout"),C.U((e=>({...e,kind:"fromHeaders"}))))).pipe(ws.v((e=>e.message.id)),Xa.zg((e=>e.pipe(we.b((e=>(0,o.zG)(e.context,ka.Vn((t=>s.warn(`Context extraction error [${e.kind}] for ${e.message.id}`,t)))))),eo.R(((e,t)=>({...e,message:t.message,[t.kind]:t.context})),{}),B.h((e=>!!(null==e?void 0:e.message)&&!!(null==e?void 0:e.fromDOM)&&!!(null==e?void 0:e.fromHeaders))),C.U((e=>(0,o.zG)(a.Y(ka.wE)({fromDOM:e.fromDOM,fromHeaders:e.fromHeaders}),ka.UI((({fromDOM:e,fromHeaders:t})=>{var n,i;return{...e,isFromMailingList:e.isFromMailingList,replyTo:t.replyTo,semanticInformation:{isWholeHTMLDocument:null===(n=t.semanticInformation)||void 0===n?void 0:n.isWholeHTMLDocument,tableTextCoverage:null===(i=e.semanticInformation)||void 0===i?void 0:i.tableTextCoverage}}})),ka.wp((()=>e.fromDOM)),ka.wp((()=>e.fromHeaders)),(t=>({message:e.message,context:t})))))))))).pipe(we.b((e=>(0,o.zG)(e.context,ka.g_((t=>s.warn(`Context extraction error for ${e.message.id}`,t)),(t=>s.info(`Context extracted for ${e.message.id}`,t)))))))}}function Ks(e){return t=>M.of(t).pipe(Es.u(),Xa.zg((t=>{var n;const i=(0,o.zG)(ka.ij(new vs.DH("No message date found"))(null===(n=t.messageNode.querySelector(ds.ms))||void 0===n?void 0:n.getAttribute("title")),ka.UI((t=>(0,o.zG)(new Date(t),(n=>{var i;return Number.isNaN(n.valueOf())?{kind:"unparsedDate",date:t,locale:(null===(i=e.querySelector(ds.Gg))||void 0===i?void 0:i.getAttribute(ds.sC))||void 0}:{kind:"parsedDate",timestamp:n.getTime()}}))))),a=(0,o.zG)(ka.ij(new vs.DH("No message author found"))(t.messageNode.querySelector(ds.OL)),ka.tS(Ls)),s=(0,o.zG)(ka.ij(new vs.DH("No <to> field found in message"))(t.messageNode.querySelectorAll(ds.VN)),ka.tS((e=>(0,o.zG)(Array.from(e),to.UI(Ls),to.IX.sequence(ka.wE))))),r=(0,o.zG)(t.messageNode.querySelector(ds.hZ),(e=>ka.F2(!!e)));return ie.aj([M.of({message:t,date:i,author:a,audience:s,isFromMailingList:r}),(l=t.messageNode,ie.aj([M.of(Vs(l)),(0,o.zG)(Array.from(l.querySelectorAll(ds.Mz)).map((e=>function(e,t=4e3){return(0,o.zG)(e.getAttribute("href")||"",v.fromPredicate((e=>!/^https?:\/\/docs\.google\.[^./]+\//.test(e))),v.map((n=>new ms.y((t=>{var n;(0,o.zG)(v.fromNullable(null===(n=e.parentElement)||void 0===n?void 0:n.getAttribute("download_url")),v.filter((e=>!!e)),v.fold((()=>t.error("Attachment not found")),(()=>{t.next(!0),t.complete()})))})).pipe((0,c.WV)(t/200,200),rs.V(t),ls.K((()=>M.of(!1))),C.U((t=>{var n;return(0,o.zG)(v.fromNullable(null===(n=e.parentElement)||void 0===n?void 0:n.getAttribute("download_url")),v.chain(Zs),v.alt((()=>js(e))))}))))),v.getOrElse((()=>M.of(js(e)))),N.oA)}(e))),(e=>e.length>0?ie.aj(e):M.of([])))]).pipe(C.U((([e,t])=>Array.from(e.concat(t).reduce(((e,t)=>e.set(t.url,t)),new Map).values())))))]);var l})),C.U((([{message:e,date:t,author:n,audience:i,isFromMailingList:o},s])=>({message:e,context:a.Y(ka.wE)({date:t,author:n,audience:i,replyTo:ka.F2([]),links:ka.F2(s),isFromMailingList:o})}))))}function Rs(e){return Array.from(e.children).filter(Hs)}function Hs(e){return e instanceof HTMLDivElement&&(e.matches("[aria-expanded]")&&!!e.innerText||!e.matches("[aria-expanded]"))}function Bs(e){return(0,o.zG)(v.fromNullable(e.querySelector(ds.xR)),v.filter(Va.Re))}function Ds(e){var t,n;return v.fromNullable(null===(n=null===(t=e.querySelector(ds.k2))||void 0===t?void 0:t.getAttribute(ds.bq))||void 0===n?void 0:n.slice(1))}function Vs(e){return(0,o.zG)(Array.from(e.querySelectorAll(ds.rf)),to.DZ((0,o.ls)(v.fromPredicate((e=>!e.closest(ds.A4)&&!e.matches(ds.wJ))),v.chain((e=>(0,o.zG)(ha.A.create(e.getAttribute("href")),v.map((t=>({url:t,name:(0,o.zG)(v.fromNullable(e.getAttribute("aria-label")),v.getOrElse((()=>e.innerText.trim()))),type:t.startsWith("mailto:")?ma.Q.email:ma.Q.hyperlink})))))))))}function Zs(e){return(0,o.zG)(v.fromNullable(e),v.chain((e=>v.fromNullable(/^([^:]+):([^:]+):(https?:\/\/.+)?(https?:\/\/.+)$/.exec(e)))),v.chain((([e,t,n,i,a])=>(0,o.zG)(ha.A.create(a),v.map((e=>({name:decodeURIComponent(n),url:e,type:ma.Q.attachment,mimeType:v.toUndefined(xs.I.create(t))})))))))}function js(e){return(0,o.zG)(ha.A.create(e.getAttribute("href")),v.map((t=>{var n;return{name:e.getAttribute("data-tooltip")||(null===(n=e.querySelector("div"))||void 0===n?void 0:n.innerText)||e.innerText,url:t,type:ma.Q.attachment,mimeType:void 0}})))}function qs(e){return e instanceof HTMLDivElement&&!!e.querySelector(ds.k2)}function Ws(e){const t=null===e.querySelector(ds.Py);return Array.from(e.querySelectorAll(t?ds.KL:ds.Py)).filter(qs).length}var $s;function Qs(e){const t=e.querySelector(ds.bK)||e.querySelector(ds.Gc),n=t?Rs(t).length:0;if(!t||0===n)return M.of(ka.t$("No messages"));if(Ws(e)===n)return M.of(ka.F2($s.noExpansionNeeded));const i=e.querySelector(ds.p4)||e.querySelector(ds.Vz);return null==i||i.click(),(0,o.zG)((a=t,ss.rl(a,{subtree:!0,childList:!1,attributes:!0,attributeFilter:["role","aria-expanded"]}).pipe(de.O(null))),Ja.b(10),B.h((()=>Ws(e)===n)),rs.V(3e3),ut.q(1),$a.h(ka.F2($s.expanded)),ls.K((e=>M.of(ka.t$(e.message)))));var a}!function(e){e.expanded="expanded",e.noExpansionNeeded="noExpansionNeeded"}($s||($s={}));var Js=n(35214),Ys=n(32426),Xs=n(45701),er=Js.getFunctionMonoid(v.getApplyMonoid({concat:(0,Ys.getJoinSemigroup)(Xs.ordNumber).concat,empty:0}))();function tr(e){return function(t){return t.iterNumber>=e?v.none:v.some(0)}}function nr(e){return function(t){return v.some(e*Math.pow(2,t.iterNumber))}}var ir={iterNumber:0,cumulativeDelay:0,previousDelay:v.none};var ar=er,or=n(2788);class sr{constructor(e){this._rpc=e,this.getReaderAnnotations=this._rpc.getReaderAnnotations,this.getReaderSummaries=this._rpc.getReaderSummaries,this.sendReaderEvents=this._rpc.sendReaderEvents,this.sendReaderSurvey=this._rpc.sendReaderSurvey}}var rr=n(99596),lr=n(99950),dr=n(62965);function cr(e,t,n){var i=Js.fold(ar)(t);return ms.y.create((function(t){var a=!1,o=function(s){return(0,No.pipe)(dr.dk((function(){return t.next(m.x5)})),dr.a1(e),dr.g_((function(e){var r=!a&&n(e)?function(e,t){var n=e(t);return{iterNumber:t.iterNumber+1,cumulativeDelay:t.cumulativeDelay+v.getOrElse((function(){return 0}))(n),previousDelay:n}}(i,s):ir;return(0,No.pipe)(r.previousDelay,v.fold((function(){return dr.t$(e)}),(function(n){return t.next(m.vU(e,{cumulativeDelay:r.cumulativeDelay,iterNumber:r.iterNumber,previousDelay:n})),(0,No.pipe)(dr.F2(r),lr.delay(n),dr.tS((function(t){return a?dr.t$(e):o(t)})))})))}),dr.F2))};return(0,No.pipe)(o(ir),dr.Pd((function(e){return t.next(m.kH(e))}),(function(e){return t.next(m.Vp(e))})))().then((function(){return t.complete()}),(function(e){return t.error(e)})),function(){return a=!0}}))}var mr=n(17160);class ur{constructor(e,t,n,i,a,o=r.O,s,l=ja.Y.create("Reader-Gmail-Feedback-Manager")){this._actions=e,this._threadRemoteDataManager=t,this._threadContext=n,this._sessionUuid=i,this._featuresAndExperiments=a,this._getEnv=o,this._telemetry=s,this._logger=l,this._subscriptions=new ra.w,this._rpcClient=(0,ua.Vo)((()=>new sr(this._getEnv().bgRpc.api))),this._subscriptions.add(this._handleUIEvents()),this._subscriptions.add(this._handleSubmitFeedbackEvents())}_handleSubmitFeedbackEvents(){return this._actions.pipe(H.ofType(R.Kind.submitFeedback),B.h((()=>this._featuresAndExperiments.features.has("feedbackDialog"))),Xa.zg((0,o.ls)(R.matchSubmitFeedback({itemMenu:hr,collapsedPanelButton:pr,expandedPanelHeaderButton:pr,emptyViewButton:pr}),(e=>a.Y(ka.wE)({threadId:this._threadContext.get().threadId,reader:(0,o.zG)(this._threadContext.get().loggedUser,ka.UI(or.R)),feedback:ka.F2(e)})),ka.UI((({threadId:e,reader:t,feedback:n})=>({threadId:e,features:Array.from(this._featuresAndExperiments.features),readerExperiment:this._featuresAndExperiments.experimentNames[0],sessionUuid:this._sessionUuid,reader:t,feedback:n,supportsFilteredContent:this._featuresAndExperiments.features.has("filteredContent")}))),ka.g_((e=>M.of(m.kH(e))),(e=>cr((()=>this._rpcClient.get().sendReaderSurvey(e)),[tr(3),nr(5e3)],(e=>e instanceof rr.Lu||e instanceof rr.Bb&&e.code>=500))))))).subscribe(m.g_({onInProgress:o.Q1,onSuccess:o.Q1,onError:o.Q1,onFatal:e=>{this._logger.warn("Survey error",e),this._telemetry.readerGmail.warning("feedback","Survey error",e)}}))}_handleUIEvents(){return this._actions.pipe(B.h((0,b.Kg)((0,b.W9)((0,b.Kg)(R.is(R.Kind.copy),R.is(R.Kind.pin),R.is(R.Kind.dismiss),R.is(R.Kind.itemMounted)),(0,b.Kg)(R.itemTypeIs("summaryItem"),R.itemTypeIs("followUpItem"))),R.is(R.Kind.like),R.is(R.Kind.dislike),R.is(R.Kind.check))),B.h((()=>this._featuresAndExperiments.features.has("feedbackEvents"))),C.U((e=>(0,o.zG)(function(e,t,n,i){return(0,o.zG)(v.fromNullable(e.expandedMessages.get(n)),v.chain(c.zk),v.map((a=>{var s,r;return{emailText:a.textMap.getPlainText(),emailSubject:ka.fS((()=>""))(e.subject),emailIsFromMailingList:a.context.isFromMailingList,emailIsWholeHTMLDocument:null===(s=a.semanticInformation)||void 0===s?void 0:s.isWholeHTMLDocument,emailTableTextCoverage:null===(r=a.semanticInformation)||void 0===r?void 0:r.tableTextCoverage,...(0,o.zG)(gr(t,n,i),v.map((e=>({emailReaderFilteringVersion:e.filteringVersion,emailReaderFilteringReasons:e.filteringReasons}))))}})))}(this._threadContext.get(),this._threadRemoteDataManager,e.item.message.id,e.kind===R.Kind.check?"followUpItem":e.itemType),v.map((t=>({type:e.kind===R.Kind.itemMounted?"show":e.kind!==R.Kind.pin||e.pinned?e.kind!==R.Kind.check||e.checked?e.kind:"uncheck":"unpin",subject:e.kind===R.Kind.check?"followUpItem":e.itemType,id:e.item.itemId,messageId:e.item.message.id,itemText:e.item.text,...t})))))),N.oA,mr.e(100),B.h((e=>e.length>0)),Xa.zg((e=>(0,o.zG)(a.Y(ka.wE)({threadId:this._threadContext.get().threadId,reader:(0,o.zG)(this._threadContext.get().loggedUser,ka.UI(or.R))}),ka.UI((({threadId:t,reader:n})=>({threadId:t,features:Array.from(this._featuresAndExperiments.features),readerExperiment:this._featuresAndExperiments.experimentNames[0],sessionUuid:this._sessionUuid,reader:n,events:e,supportsFilteredContent:this._featuresAndExperiments.features.has("filteredContent")}))),ka.g_((e=>M.of(m.kH(e))),(e=>cr((()=>this._rpcClient.get().sendReaderEvents(e)),[tr(3),nr(5e3)],(e=>e instanceof rr.Lu||e instanceof rr.Bb&&e.code>=500)))))))).subscribe(m.g_({onInProgress:o.Q1,onSuccess:o.Q1,onError:o.Q1,onFatal:e=>{this._logger.warn("Feedback error",e),this._telemetry.readerGmail.warning("feedback","Feedback error",e)}}))}dispose(){this._subscriptions.unsubscribe()}}function hr(e){return{type:"tellUsMoreFeedback",feedbackText:e.text,messageId:e.source.item.message.id,subject:e.source.itemType,action:e.source.action,id:e.source.item.itemId,itemText:e.source.item.text}}function pr(e){return{type:"genericFeedback",placement:e.source.kind,feedbackText:e.text,score:(0,o.zG)(e.scoreResult,v.map((e=>e.score)),v.toUndefined),scoreLabel:(0,o.zG)(e.scoreResult,v.map((e=>e.label)),v.toUndefined)}}function gr(e,t,n){return"followUpItem"===n?(0,o.zG)(e.annotations.get().get(t),m.g_({onInProgress:(0,o.a9)(v.none),onSuccess:v.chain((e=>e.filteringInfo)),onFatal:(0,o.a9)(v.none),onError:(0,o.a9)(v.none)})):"summaryItem"===n?(0,o.zG)(e.summaries.get().get(t),m.g_({onInProgress:(0,o.a9)(v.none),onSuccess:v.chain((e=>e.filteringInfo)),onFatal:(0,o.a9)(v.none),onError:(0,o.a9)(v.none)})):void(0,D.vE)(n)}var fr=n(77150);class br{constructor(e,t,n,i=r.O,a,s=ja.Y.create("Reader-Gmail-Remote-Data")){this._threadContext=e,this._features=t,this._useCaching=n,this._getEnv=i,this._telemetry=a,this._logger=s,this._subscriptions=new ra.w,this._rpcClient=(0,ua.Vo)((()=>new sr(this._getEnv().bgRpc.api))),this._summariesToFetch=new xe.xQ,this._annotationsToFetch=new xe.xQ,this._summariesReadyToFetch=new xe.xQ,this._annotationsReadyToFetch=new xe.xQ,this._summaries=u.h.create(new Map),this._annotations=u.h.create(new Map),this.summaries=this._summaries.view(),this.annotations=this._annotations.view(),this._subscriptions.add(this._summariesToFetch.pipe(vr(this._threadContext)).subscribe((e=>this._summariesReadyToFetch.next(e)))),this._subscriptions.add(this._annotationsToFetch.pipe(vr(this._threadContext)).subscribe((e=>this._annotationsReadyToFetch.next(e)))),this._subscriptions.add(this._summariesReadyToFetch.pipe(Xa.zg((e=>this._getSummaries(e).pipe(C.U((t=>({requestedIds:e,response:t}))))))).subscribe((({requestedIds:e,response:t})=>{this._summaries.modify((n=>Array.from(e).reduce(((e,i)=>e.set(i,(0,o.zG)(m.n2(t)?(0,o.zG)(v.fromNullable(n.get(i)),v.getOrElse((()=>m.x5))):t,m.UI((e=>v.fromNullable(e[i])))))),new Map(n))))}))),this._subscriptions.add(this._annotationsReadyToFetch.pipe(Xa.zg((e=>this._getAnnotations(e).pipe(C.U((t=>({requestedIds:e,response:t}))))))).subscribe((({requestedIds:e,response:t})=>{this._annotations.modify((n=>Array.from(e).reduce(((e,i)=>e.set(i,(0,o.zG)(m.n2(t)?(0,o.zG)(v.fromNullable(n.get(i)),v.getOrElse((()=>m.x5))):t,m.UI((e=>v.fromNullable(e[i])))))),new Map(n))))})))}fetchSummaries(e){this._logger.debug(`requesting summaries for [${String(Array.from(e))}]`),this._summariesToFetch.next(e)}fetchAnnotations(e){this._logger.debug(`requesting annotations for [${String(Array.from(e))}]`),this._annotationsToFetch.next(e)}dispose(){this._subscriptions.unsubscribe()}_getThreadInfoForBackend(){return(0,o.zG)(this._threadContext.get(),(e=>a.Y(ka.wE)({id:e.threadId,subject:e.subject,messageCount:ka.F2(e.messageCount),messages:ka.F2(Array.from(e.expandedMessages.values()).filter(m.d6).map((e=>e.value))),loggedUser:e.loggedUser})),ka.UI((e=>({...e,messages:e.messages.reduce(((t,n)=>(t[n.id]={id:n.id,index:n.index,subject:e.subject,body:n.textMap.getRichText(),plainText:n.textMap.getPlainText(),date:n.context.date,author:n.context.author,audience:n.context.audience,replyTo:n.context.replyTo,semanticInformation:n.semanticInformation,links:n.context.links,isFromMailingList:n.context.isFromMailingList},t)),{})}))))}_getSummaries(e){return(0,o.zG)(this._getThreadInfoForBackend(),ka.g_((e=>M.of(m.kH(e))),(t=>cr((()=>(this._logger.debug(`Fetching summaries for [${String(Array.from(e))}]`),this._rpcClient.get().getReaderSummaries({thread:{id:t.id,subject:t.subject,messages:(0,o.zG)(t.messages,ca.u4({},((e,t)=>(e[t.index]=(0,s.fH)(t),e)))),num_messages:t.messageCount},reader:(0,or.R)(t.loggedUser),requestedMessageIds:Array.from(e),useCache:this._useCaching.get(),supportsFilteredContent:this._features.has("filteredContent")}).then((e=>((0,o.zG)(e,ka.Pd((e=>{this._telemetry.readerGmail.warning("summariesResponse",e.message,e),this._logger.warn("Summaries error",e.message)}),(e=>{this._logger.debug("Received summaries",e)}))),e))))),[tr(3),nr(5e3)],(e=>e instanceof rr.Lu||e instanceof rr.Bb&&e.code>=500)))))}_getAnnotations(e){return(0,o.zG)(this._getThreadInfoForBackend(),ka.g_((e=>M.of(m.kH(e))),(t=>cr((()=>(this._logger.debug(`Fetching annotations for [${String(Array.from(e))}]`),this._rpcClient.get().getReaderAnnotations({thread:{id:t.id,subject:t.subject,messages:(0,o.zG)(t.messages,ca.u4({},((e,t)=>(e[t.index]=(0,s.fH)(t),e)))),num_messages:t.messageCount},reader:(0,or.R)(t.loggedUser),requestedMessageIds:Array.from(e),useCache:this._useCaching.get(),supportsFilteredContent:this._features.has("filteredContent")}).then((e=>((0,o.zG)(e,ka.Pd((e=>{this._telemetry.readerGmail.warning("annotationsResponse",e.message,e),this._logger.warn("Annotations error",e.message)}),(e=>{this._logger.debug("Received annotations",e)}))),e))).then(ka.UI((0,o.ls)(ca.Su(((e,n)=>{var i;const a=null===(i=t.messages[e])||void 0===i?void 0:i.plainText;return{...n,annotations:void 0!==a?n.annotations.map((e=>({...e,text:a.slice(e.span.s,e.span.e)}))):[]}}))))))),[tr(3),nr(5e3)],(e=>e instanceof rr.Lu||e instanceof rr.Bb&&e.code>=500)))))}}function vr(e){return t=>{const n=new xe.xQ;return(0,o.zG)(t,Ya.b((e=>ba.D(Array.from(e)))),Xa.zg((t=>e.pipe(C.U((e=>(0,o.zG)(v.fromNullable(e.expandedMessages.get(t)),v.fold(o.jv,m.d6)))),B.h(ua.fQ),ut.q(1),$a.h(t)))),we.b((()=>n.next())),fr.R((()=>n.pipe(Ja.b(200)))),C.U((e=>new Set(e))),B.h((e=>e.size>0)))}}var kr=n(41263),yr=n(86620),Ir=n(92132),xr=n(33678),_r=n(15073),wr=n(42103),Er=n(64078);const Cr=({env:e,children:t,className:n})=>g.createElement(is.o,{className:n},g.createElement(es.p,null,g.createElement(xr.a.Context.Provider,{value:new yr.C(e)},g.createElement(Ir.Q,{remSize:M.of(16),setter:e=>_r.u.setRootCssVar(document.documentElement,e)},g.createElement(wr.G.DefaultProvider,null,t,g.createElement(ns.p,{regular:!0,bold:!0}),g.createElement(ts.G,null),g.createElement(Er.X,null))))));var Ur=n(16782);const Sr=`${ds.k2} > div + div`;class Nr{constructor(e,t,n,i=ja.Y.create("Reader-Gmail-Panel")){this._logger=i,this._mounted=new Ur.t(1),this.elementRef=g.createRef(),this.mounted=this._mounted.asObservable(),this._injectionSub=e.pipe(lt.w((e=>new ms.y((()=>(0,o.zG)(v.fromNullable(e.querySelector(Sr)),v.filter((e=>e instanceof HTMLElement)),v.fold((()=>o.Q1),(e=>{const i=Po.VB.get({monitorAs:"reader-panel"}).inject(Ko.EM.fromDocument(e.ownerDocument,"grammarly-extension"),Ko.zs.appendChild(e),(()=>g.createElement(kr.L,{chunkName:"readerGmailThreadIntegration"},g.createElement(Cr,{env:(0,r.O)()},g.createElement("div",{style:{marginTop:"2rem"},ref:this.elementRef},g.createElement(t,null),n?g.createElement(n,null):null)))));return this._mounted.next(),this._logger.debug("Panel injected"),()=>{i.dispose(),this._logger.debug("Panel disposed")}})))))))).subscribe()}dispose(){this._injectionSub.unsubscribe()}}function Mr(e,t,n,m,h,p,g,k,y,x=r.O,_=ja.Y.create("Reader-Gmail-Thread-Integration")){const E=ua.iy.create(),U=new Fs(h.doc,e,Ps(h.doc,t,(()=>h.url),(e=>0===e.index),_),y),T=new br(U.threadContext,n.features,m,x,y),F=u.h.create(null),A=F.pipe(lt.w((e=>e?e.annotations:M.of([])))),z=(L=n.features).has("summaries")||L.has("followUps")||L.has("links")?new Ta(i.create(U.threadContext,T.summaries,T.annotations),A.pipe(C.U((e=>e.length>0))),h.config.bundleInfo.browser,k,E,n.features,p):null;var L;const O=z?new sa.ViewModelImpl(p,k,E,U.threadContext):null,K=p.view((({inlineHighlightsEnabled:t})=>{F.modify((i=>(null==i||i.dispose(),!1!==t&&O&&(n.features.has("inlineCards")||n.features.has("inlineHighlights"))?new os(function(e,t,n){return ie.aj([e.annotations,t.threadContext,n.view((e=>(0,o.zG)(t.threadContext.get().threadId,v.fromEither,v.chain((t=>{var n,i;return(0,o.zG)(v.fromNullable(null===(i=null===(n=e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.annotations),v.map((0,o.ls)(ca.UI((0,o.ls)((e=>xa.X.decode(e)),v.fromEither)),ca.oA,ca.u4(new Set,((e,t)=>t.dismissed?e.add(t.itemId):e)))))})),v.getOrElse((()=>new Set)))))]).pipe(C.U((([e,t,n])=>(0,o.zG)(e,d.Su(((e,i)=>(0,o.zG)(a.Y(v.option)({annotations:(0,o.zG)(i,c.zk,v.flatten,v.map(f.ei("annotations")),v.map(at.hX((e=>!n.has(xa.p.Id.create(e.id))))),v.chain(it.nI)),message:(0,o.zG)(v.fromNullable(t.expandedMessages.get(e)),v.chain(c.zk))}),v.map((({annotations:e,message:t})=>({messageId:t.id,textMap:t.textMap,bodyNode:t.bodyNode,annotations:e})))))),d.DZ(o.yR)))))}(T,U,p),e,n.features,O):null)))})).subscribe(),H=new xe.xQ,V=e=>t=>{const n=`${e} promise rejection: ${String(t)}`;_.error(n),y.readerGmail.warning("promiseRejection",n,t)},Z=z&&O?function(e,t,n,i){const a=new ra.w;return a.add(t.pipe(B.h(R.is(R.Kind.seenInlineHighlightsOnboarding))).subscribe((()=>{n.seenReaderInlineHighlightsOnboarding().catch(i("CSActions.seenReaderInlineHighlightsOnboarding"))}))),a.add(e.pipe(B.h(R.is(R.Kind.inlineHighlightOnboardingElementMounted))).subscribe((({step:e,node:n})=>t.next({kind:R.Kind.inlineHighlightOnboardingElementMounted,step:e,node:n})))),a}(z.actions,O.actions,g,V):null,j=z?function(e,t,n,i,a){const s=new ra.w,r=e=>(0,o.zG)(n.get().threadId,v.fromEither,kt.bw(e));return s.add(e.pipe(B.h((0,b.Kg)(R.is(R.Kind.optIn),R.is(R.Kind.optOut)))).subscribe((({kind:e})=>{t.seenReaderGmailOnboarding(e).catch(a("CSActions.seenReaderGmailOnboarding"))}))),s.add(e.pipe(B.h(R.is(R.Kind.threadViewNavigate))).subscribe((({action:e,nextIndex:t})=>i.next({nextActiveIndex:t,navigationAction:e})))),s.add(e.pipe(B.h((0,b.Kg)(R.is(R.Kind.check),(0,b.W9)((0,b.Kg)(R.is(R.Kind.pin),R.is(R.Kind.dismiss),R.is(R.Kind.like),R.is(R.Kind.dislike)),R.itemTypeIs("followUpItem")))),C.U((e=>e.kind===R.Kind.check?{...e.item,checked:e.checked}:Tr(e)))).subscribe((e=>r((n=>{t.readerGmailUpdateAnnotationItem({threadId:n,item:e}).catch(a("CSActions.readerGmailUpdateAnnotationItem"))}))))),s.add(e.pipe(B.h((0,b.W9)((0,b.Kg)(R.is(R.Kind.pin),R.is(R.Kind.dismiss),R.is(R.Kind.like),R.is(R.Kind.dislike)),R.itemTypeIs("summaryItem"))),C.U(Tr)).subscribe((e=>r((n=>{t.readerGmailUpdateSummaryItem({threadId:n,item:e}).catch(a("CSActions.readerGmailUpdateSummaryItem"))}))))),s.add(e.pipe(B.h((0,b.W9)((0,b.Kg)(R.is(R.Kind.pin),R.is(R.Kind.dismiss)),R.itemTypeIs("linkItem"))),C.U(Tr)).subscribe((e=>r((n=>{t.readerGmailUpdateLinkItem({threadId:n,item:e}).catch(a("CSActions.readerGmailUpdateLinkItem"))}))))),s.add(e.pipe(B.h(R.is(R.Kind.toggleInlineHighlights))).subscribe((({enabled:e})=>{t.toggleReaderInlineHighlights(e).catch(a("CSActions.toggleReaderInlineHighlights"))}))),s}(z.actions.asObservable(),g,U.threadContext,H,V):null,q=new ur((null==z?void 0:z.actions)||Wa.E,T,U.threadContext,E,n,x,y),W=z?new Nr(U.threadContext.view((e=>e.messageCount)).pipe(C.U((()=>(0,o.zG)(Rs(e),(e=>v.fromNullable(e[e.length-1]))))),N.oA,rt.x()),(()=>{return S.UI.mount(na,(e=z,S.Z.composeKnot({content:S.Z.composeUnion({collapsed:We(e),expanded:Fi(e),onboarding:ea(e)},(()=>e.state.pipe(C.U((e=>({kind:w(e)?"onboarding":I(e)?"expanded":"collapsed"})))))),notification:Y(e)})));var e}),O?()=>S.UI.mount(ia.Onboarding,ia.createFlow(O)):void 0):null,$=H.pipe(lt.w((()=>Qs(h.doc))),we.b(ka.Pd((e=>_.warn("Error while expanding messages",e)),(e=>{switch(e){case $s.expanded:return _.trace("Messages expanded");case $s.noExpansionNeeded:return _.trace("Thread already expanded");default:(0,D.vE)(e)}}))),qa.shareReplay({bufferSize:1,refCount:!0})),Q=U.threadContext.pipe(C.U((e=>(0,o.zG)(v.fromNullable(e.messageIndexToIdMap.get(e.messageCount-1)),v.chain((t=>v.fromNullable(e.expandedMessages.get(t)))),v.chain(c.zk),v.map((t=>({lastMessage:t,ctx:e})))))),N.oA,ut.q(1),we.b((({lastMessage:e,ctx:t})=>{k.readerMailSessionStart(e.id,e.context.audience.length,(0,c.Y2)(e.textMap.getPlainText()),t.messageCount,E,v.toUndefined((0,c.jS)(e.context.author.email,e.context.audience.map((e=>e.email)))),(0,o.zG)(t.threadId,v.fromEither,v.toUndefined))}))).subscribe(),J=(0,l.W$)(e),X=J?fa.T(H.pipe(C.U((e=>{var t;return(null===(t=null==W?void 0:W.elementRef)||void 0===t?void 0:t.current)?W.elementRef.current.getBoundingClientRect().top:null}))),$.pipe($a.h(null))).pipe(Qa.G()).subscribe((([e,t])=>{var n;if((null===(n=null==W?void 0:W.elementRef)||void 0===n?void 0:n.current)&&null===t&&null!==e){const t=W.elementRef.current.getBoundingClientRect().top;J.scrollTop=J.scrollTop+t-e}})):null,ee=$.subscribe(),te=p.pipe(lt.w((e=>e.seenOnboarding?M.of(!!e.enabled):p.pipe(B.h((e=>!!e.seenOnboarding)),C.U((e=>!!e.enabled))))),ut.q(1)),ne=n.features.has("summaries")&&W?fa.T(H,W.mounted.pipe(C.U((e=>({nextActiveIndex:1/0,navigationAction:G.last}))),(0,c.Gx)(te))).pipe(Ja.b(100),Ya.b((({nextActiveIndex:e,navigationAction:t})=>{const n=U.threadContext.get().messageCount,i=e=>e>=0&&e<n;switch(t){case G.left:return ba.D([e-1,e].filter(i));case G.right:return ba.D([e,e+1].filter(i));case G.first:return ba.D([0,1].filter(i));case G.last:return ba.D([n-2,n-1].filter(i));default:(0,D.vE)(t)}})),Xa.zg((e=>U.threadContext.view((t=>t.messageIndexToIdMap.get(e))).pipe(B.h(ua.fQ),ut.q(1)))),eo.R(((e,t)=>new Set(e).add(t)),new Set),(0,c.Yp)(s.Rb.Id.eq)).subscribe((e=>T.fetchSummaries(e))):null,ae=n.features.has("followUps")||n.features.has("inlineCards")||n.features.has("inlineHighlights")?U.threadContext.view((e=>new Set(e.expandedMessages.keys()))).pipe(eo.R(((e,t)=>new Set(Array.from(e).concat(Array.from(t)))),new Set),(0,c.Yp)(s.Rb.Id.eq),(0,c.Gx)(te)).subscribe((e=>T.fetchAnnotations(e))):null;"prod"!==h.config.bundleInfo.env&&(0,c.h$)(h.doc,{threadContextManager:U,threadRemoteDataManager:T,panelViewModel:z});const oe=Date.now(),se=fa.T(Da.x.create(e,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["contenteditable"]}).pipe(C.U((e=>v.fromNullable(e.reduce(((e,t)=>null!==e?e:"attributes"==t.type&&(0,Va.Re)(t.target)?t.target.matches(ds.kO)?t.target:null:Array.from(t.addedNodes).filter(Va.Re).reduce(((e,t)=>null!==e?e:t.matches(ds.kO)?t:t.querySelector(ds.kO)),null)),null))))),ba.D(Array.from(e.querySelectorAll(ds.kO)).map(v.some))).pipe(N.oA,rt.x(),C.U((e=>(0,o.zG)(v.fromNullable(e.closest(ds.e8)),v.chain((t=>{var n,i;return a.Y(v.option)({formEl:v.fromNullable(null===(n=t.closest(ds.KC))||void 0===n?void 0:n.querySelector(ds.ZA)),buttonEl:v.fromNullable(t.querySelector(ds.DM)),messageId:(0,o.zG)(v.fromNullable(null===(i=e.closest(ds.n4))||void 0===i?void 0:i.querySelector(ds.k2)),v.chain((e=>{var t;return v.fromNullable(null===(t=e.getAttribute(ds.bq))||void 0===t?void 0:t.slice(1))}))),startTime:v.some(Date.now()-oe)})}))))),N.oA,_e.M(U.threadContext),we.b((([e,t])=>{k.readerMailReplyStart(t.messageCount,E,Date.now()-oe,(0,o.zG)(t.threadId,v.fromEither,v.toUndefined)),null==z||z.actions.next({kind:R.Kind.expand,source:P.replyButton})})),Xa.zg((([e])=>$e.R(e.buttonEl,"click").pipe(_e.M(M.of(e),Ba.x.getRecipientsContextEventObservable(e.formEl,null),U.threadContext),B.h((([e,t,n])=>n.length>0)),we.b((([e,t,n,i])=>{(0,o.zG)(v.fromNullable(i.expandedMessages.get(t.messageId)),v.chain(c.zk),kt.bw((e=>{k.readerMailReplySent(i.messageCount,e.textMap.getPlainText().length,e.context.audience.length,n.length,E,Date.now()-t.startTime,(0,o.zG)(v.fromEither(i.loggedUser),v.chain((e=>(0,c.jS)(e.email,(0,o.zG)(n,to.UI((e=>Za.G.create(e.email))),to.oA)))),v.toUndefined),(0,o.zG)(i.threadId,v.fromEither,v.toUndefined))})))})))))).subscribe();return _.debug("page integration created"),()=>{k.readerMailSessionEnd(E,(0,o.zG)(U.threadContext.get().threadId,v.fromEither,v.toUndefined)),q.dispose(),null==ae||ae.unsubscribe(),null==ne||ne.unsubscribe(),Q.unsubscribe(),ee.unsubscribe(),null==X||X.unsubscribe(),null==W||W.dispose(),null==z||z.dispose(),F.modify((e=>(null==e||e.dispose(),null))),K.unsubscribe(),T.dispose(),U.dispose(),se.unsubscribe(),null==j||j.unsubscribe(),null==Z||Z.unsubscribe(),_.debug("page integration disposed")}}function Tr(e){switch(e.kind){case R.Kind.pin:switch(e.itemType){case"linkItem":case"summaryItem":case"followUpItem":return{...e.item,pinned:e.pinned};default:(0,D.vE)(e.itemType)}break;case R.Kind.dismiss:return{...e.item,dismissed:!0};case R.Kind.like:case R.Kind.dislike:return{...e.item,rating:Oa(e.kind)};default:(0,D.vE)(e)}}},86620:(e,t,n)=>{n.d(t,{C:()=>d,U:()=>i});var i,a=n(27378),o=n(29511),s=n(33678),r=n(88056),l=n(95574);!function(e){let t;!function(e){e.isAppleSystem="isAppleSystem"}(t=e.SidebarFlag||(e.SidebarFlag={})),e.Flag={...t,...s.a.Flag},e.Context=a.createContext(r.Y.invariantContent("Environment"))}(i||(i={}));class d{constructor(e=(0,o.O)()){this._flags=new Set,this.actions={openUrl:e=>l.vM((()=>{document.location.href=e.toString()})),openPopup:e=>l.vM((()=>{const t=self.open(e.toString(),void 0,"noreferrer");t&&(t.opener=null)}))},e.config.systemInfo.os.isMac&&this._flags.add(i.Flag.isAppleSystem),this._flags.add(i.Flag.supportsSVGDominantBaseline),this._flags.add(i.Flag.onlyTrustedEvents)}has(e){return this._flags.has(e)}}},92132:(e,t,n)=>{n.d(t,{Q:()=>l});var i=n(27378),a=n(15073),o=n(60797),s=n(95300),r=n(5114);const l=({children:e,remSize:t,setter:n})=>(d+=1,i.useEffect((()=>{const e=t.subscribe((e=>{c.next(r.some(e)),n(r.some(e))}));return()=>{e.unsubscribe(),d-=1,0===d&&(c.next(r.none),n(r.none))}}),[t]),i.createElement(a.u.Context.Provider,{value:c.pipe(o.oA)},e));let d=0;const c=new s.X(r.none)},86705:(e,t,n)=>{n.d(t,{v:()=>o});var i=n(27378),a=n(80895);const o=({browser:e,className:t,title:n="BETA"})=>"safari"!==e?i.createElement(a.C,{title:n,className:t}):null},31944:(e,t,n)=>{n.d(t,{J:()=>r});var i=n(57050),a=n(27378),o=n(12187),s=n(22536);const r=({onChange:e,labelId:t,className:n,checkboxClassName:r,labelClassName:l,checked:d,children:c,disabled:m,dataGrammarlyPart:u="ui-kit-checkbox",tabIndex:h=0})=>{const[p,g]=a.useState(null!=d&&d);a.useEffect((()=>{g(Boolean(d))}),[d]);const f=t=>{t.preventDefault(),t.stopPropagation(),g(!p),null==e||e(!p)};return a.createElement("div",{"data-grammarly-part":u,...(0,o.Sh)(s.checkboxContainer,n)},a.createElement("div",{...(0,o.Sh)(s.checkbox,r,p?s.checkboxChecked:null),role:"checkbox","aria-checked":p,tabIndex:h,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&f(e)},onClick:m?i.Q1:f},p?a.createElement("div",{className:s.checkboxCheckmark}):null),a.createElement("label",{id:t,onClick:f,className:l},c))}},57053:(e,t,n)=>{n.d(t,{i:()=>s});var i=n(27378),a=n(12187),o=n(39070);const s=({maxRating:e=5,ratingLabels:t=["Not at all valuable","Slightly valuable","Somewhat valuable","Very valuable","Extremely valuable"],onChange:n,value:s,ariaLabel:r="Rating",className:l,ratingStarsClassName:d,ratingLegendClassName:c,ratingLabelsClassName:m})=>{const[u,h]=i.useState(s),[p,g]=i.useState(void 0);i.useEffect((()=>{h(s)}),[s]),i.useEffect((()=>{void 0!==u&&n(u)}),[u]);const f=[...Array(e).keys()].map((e=>e+1)),b=void 0!==p?p:u;return i.createElement("div",{"data-grammarly-part":"ui-kit-rating",role:"radiogroup","aria-label":r,...(0,a.Sh)(o.rating,l)},i.createElement("div",{...(0,a.Sh)(o.ratingStars,d),onMouseLeave:()=>g(void 0)},f.map((e=>{const t=void 0!==b&&b>=e;return i.createElement("input",{key:`rating-${e}`,id:`rating-${e}`,type:"radio",name:"rating",checked:u===e,onChange:e=>h(parseInt(e.target.value,10)),value:e,onMouseEnter:e=>{const t=e.target;g(parseInt(t.value,10))},...(0,a.Sh)(o.ratingStar,t?o.ratingStarFilled:null)})}))),i.createElement("div",{...(0,a.Sh)(o.ratingLabels,m)},f.map((e=>i.createElement("label",{key:`rating-label-${e}`,htmlFor:`rating-${e}`,...(0,a.Sh)(b===e?o.ratingLabelVisible:o.ratingLabelNotVisible)},t[e-1])))),void 0!==b?null:i.createElement("div",{...(0,a.Sh)(o.ratingLegend,c)},i.createElement("div",null,t[0]),i.createElement("div",null,t[f.length-1])))}},18347:(e,t,n)=>{n.d(t,{Eh:()=>a,Od:()=>o,nI:()=>s});var i=n(13853),a=(i.ZN,new Set,i.AO,i.Eh);i.G,i.UI,i.yW,i.tS,i.KX;i.t9,i.G0,i.jV,i.tV,i.e5,i.Lf,i.oP,i.u4,i.Lx,i.ri,i.$T;var o=i.Od;var s=i.nI;i.oA,i.xu,i.DZ},83771:e=>{e.exports={layout:"_1hKpE",column:"_1rBJw",scrollView:"_1wR-W",sectionTitle:"-RBKX"}},47397:e=>{e.exports={empty:"_1XVf-",title:"_2AfjV",body:"_21gih"}},93253:e=>{e.exports={item:"_27MUw",content:"e2xP-",moreButton:"_2is65",pinned:"_1L-Hp",ellipsis:"_2TIW4"}},67465:e=>{e.exports={menu:"_1f4lm",pinned:"_1uRyx",button:"_12QVt",separator:"Q9ySg",inactiveIcon:"_2taPz"}},50243:e=>{e.exports={list:"u22ST"}},38459:e=>{e.exports={linkAndIcon:"_2mO4u",link:"_3djIE",linkWrapper:"kGyxh",icon:"_26TDA"}},45587:e=>{e.exports={itemLoading:"KdASy",lineOnly:"_3gA50",line:"_3btGG",lineLoading:"_3W_2s",rect:"_2Ln0z",rectLoading:"_1pxCc",lineAndCheckbox:"_3ZgMs",lineAndAvatar:"_1j1Dr"}},69566:e=>{e.exports={title:"rOb7m"}},11071:e=>{e.exports={textChecked:"_1Sg3F",checkboxWrapper:"_45wj5",label:"_1ybvy",checkbox:"T4rHe",itemText:"pqhgN"}},83581:e=>{e.exports={itemText:"_3h7i6"}},25756:e=>{e.exports={loader:"rfHCU",emptyCTAButton:"ZMDnY",warningGroup:"_1eJrv",warningIcon:"_3c_5k"}},79579:e=>{e.exports={emptyCTAButton:"_3kUpB"}},78870:e=>{e.exports={dialog:"_2-QQ0",header:"_1EWW5",headerGroup:"_1JdLn",buttons:"_3p63M",textbox:"_1CLrn",requiredTextBox:"_2T8Ox",requiredLabel:"_3HHRw"}},61033:e=>{e.exports={panelOverlay:"_1qTMO",dialog:"yOM_O"}},56229:e=>{e.exports={title:"_2k48T",rating:"_3V8Jf",ratingContainer:"_3T2eO",ratingStars:"_1WWyq",ratingLegend:"_9LsLz",ratingLabels:"_1j0UE",requiredLabel:"yOJki"}},35115:e=>{e.exports={title:"_57M23",description:"_2sj__"}},89739:e=>{e.exports={activeMailInfo:"_31J8M",date:"fHbk9",author:"BD2pG"}},37903:e=>{e.exports={header:"_1mfP5"}},14692:e=>{e.exports={navigationFrame:"v_SsT",buttonGroup:"_3n1p4",iconJump:"_22-y3",iconGoFirst:"_2OzZD",icon:"_3hVGV"}},16204:e=>{e.exports={buttonGroup:"_2tWWr",button:"_1jXO0"}},76168:e=>{e.exports={notification:"_1xXpR"}},40349:e=>{e.exports={controls:"_2Hipc",onboardingButtonGroup:"_-9OmU",optInButton:"_5OTjn",optOutButton:"_30tah",navigation:"_1jU2d",leftButton:"P6wpw",rightButton:"_3CBvI",arrowRight:"D-jgQ",stepOfN:"_1HJSf"}},86564:e=>{e.exports={disclaimer:"Y6xYb"}},57391:e=>{e.exports={illustration:"fcee3"}},51869:e=>{e.exports={onboarding:"_2ODbM",logo:"Lr1qJ",content:"_3-26v",badge:"_3POlX",steps:"_31CBV"}},77821:e=>{e.exports={highlightsOnboarding:"_1kj0B","highlightsOnboarding-button":"_1BN-s","highlightsOnboarding-icon":"_1ZhuO","highlightsOnboarding-header":"_17c8S","highlightsOnboarding-content":"_3bcKa","highlightsOnboarding-buttons":"_3kg0R"}},19230:e=>{e.exports={title:"gf4R_",body:"_2Vehu"}},23556:e=>{e.exports={header:"_3kzGL",nothingToRecap:"_3Y1Tm",spinner:"_3eEte"}},86885:e=>{e.exports={panelWrapper:"dVcQ2"}},35300:e=>{e.exports={onboarding:"_1hppt",toolbar:"_38d_I"}},64908:e=>{e.exports={panelGrid:"_1oojw",header:"_15T_5",toolbar:"_3jOrT"}},58120:e=>{e.exports={recapButton:"_318vF",logo:"Tn0sZ",recap:"_3L1sH"}},22536:e=>{e.exports={checkboxContainer:"_3bj_g",checkbox:"xrB8R",checkboxChecked:"Uhddy",checkboxCheckmark:"_1qI2g",spin:"_3S_a3"}},39070:e=>{e.exports={rating:"_2oJv0",ratingStars:"_3FAXT",ratingStar:"_1p53S",ratingStarFilled:"_1E3qz",ratingLabels:"jzPuo",ratingLabelVisible:"_3yF9v",ratingLabelNotVisible:"_2zNv4",ratingLegend:"_1XbY_",spin:"fu5_3"}},39335:(e,t,n)=>{var i={superfasthash:n(11028),murmurhash3:n(13786)};e.exports={createHash:function(e){e=e.replace(/![a-zA-z0-9]/g,"").toLowerCase();try{return i[e]}catch(e){throw new Error(e)}}}},13786:(e,t,n)=>{var i=n(81314);function a(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function o(e,t){return e<<t|e>>>32-t}function s(e){return e=a(e^=e>>>16,2246822507),e=a(e^=e>>>13,3266489909),e^=e>>>16}function r(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function l(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function d(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function c(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function m(e,t){return[e[0]^t[0],e[1]^t[1]]}function u(e){return e=m(e,[0,e[0]>>>1]),e=m(e=l(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=m(e=l(e,[3301882366,444984403]),[0,e[0]>>>1])}var h=function(e,t){e=""+e||"";var n=i.toU8IntArray(e);t=t||0;for(var a=(e={charCodeAt:function(e){return n[e]},length:n.length}).length%16,o=e.length-a,s=[0,t],h=[0,t],p=[0,0],g=[0,0],f=[2277735313,289559509],b=[1291169091,658871167],v=0;v<o;v+=16)p=[255&e.charCodeAt(v+4)|(255&e.charCodeAt(v+5))<<8|(255&e.charCodeAt(v+6))<<16|(255&e.charCodeAt(v+7))<<24,255&e.charCodeAt(v)|(255&e.charCodeAt(v+1))<<8|(255&e.charCodeAt(v+2))<<16|(255&e.charCodeAt(v+3))<<24],g=[255&e.charCodeAt(v+12)|(255&e.charCodeAt(v+13))<<8|(255&e.charCodeAt(v+14))<<16|(255&e.charCodeAt(v+15))<<24,255&e.charCodeAt(v+8)|(255&e.charCodeAt(v+9))<<8|(255&e.charCodeAt(v+10))<<16|(255&e.charCodeAt(v+11))<<24],p=d(p=l(p,f),31),s=r(s=d(s=m(s,p=l(p,b)),27),h),s=r(l(s,[0,5]),[0,1390208809]),g=d(g=l(g,b),33),h=r(h=d(h=m(h,g=l(g,f)),31),s),h=r(l(h,[0,5]),[0,944331445]);switch(p=[0,0],g=[0,0],a){case 15:g=m(g,c([0,e.charCodeAt(v+14)],48));case 14:g=m(g,c([0,e.charCodeAt(v+13)],40));case 13:g=m(g,c([0,e.charCodeAt(v+12)],32));case 12:g=m(g,c([0,e.charCodeAt(v+11)],24));case 11:g=m(g,c([0,e.charCodeAt(v+10)],16));case 10:g=m(g,c([0,e.charCodeAt(v+9)],8));case 9:g=l(g=m(g,[0,e.charCodeAt(v+8)]),b),h=m(h,g=l(g=d(g,33),f));case 8:p=m(p,c([0,e.charCodeAt(v+7)],56));case 7:p=m(p,c([0,e.charCodeAt(v+6)],48));case 6:p=m(p,c([0,e.charCodeAt(v+5)],40));case 5:p=m(p,c([0,e.charCodeAt(v+4)],32));case 4:p=m(p,c([0,e.charCodeAt(v+3)],24));case 3:p=m(p,c([0,e.charCodeAt(v+2)],16));case 2:p=m(p,c([0,e.charCodeAt(v+1)],8));case 1:p=l(p=m(p,[0,e.charCodeAt(v)]),f),s=m(s,p=l(p=d(p,31),b))}return s=r(s=m(s,[0,e.length]),h=m(h,[0,e.length])),h=r(h,s),s=r(s=u(s),h=u(h)),h=r(h,s),("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8)+("00000000"+(h[0]>>>0).toString(16)).slice(-8)+("00000000"+(h[1]>>>0).toString(16)).slice(-8)};e.exports={x86Hash32:function(e,t){e=""+e||"";var n=i.toU8IntArray(e);t=t||0;for(var r=(e={charCodeAt:function(e){return n[e]},length:n.length}).length%4,l=e.length-r,d=t,c=0,m=3432918353,u=461845907,h=0;h<l;h+=4)c=a(c=255&e.charCodeAt(h)|(255&e.charCodeAt(h+1))<<8|(255&e.charCodeAt(h+2))<<16|(255&e.charCodeAt(h+3))<<24,m),c=a(c=o(c,15),u),d=a(d=o(d^=c,13),5)+3864292196;switch(c=0,r){case 3:c^=(255&e.charCodeAt(h+2))<<16;case 2:c^=(255&e.charCodeAt(h+1))<<8;case 1:c=a(c^=255&e.charCodeAt(h),m),d^=c=a(c=o(c,15),u)}return((d=s(d^=e.length))>>>0).toString(16)},x86Hash128:function(e,t){e=""+e||"";var n=i.toU8IntArray(e);t=t||0;for(var r=(e={charCodeAt:function(e){return n[e]},length:n.length}).length%16,l=e.length-r,d=t,c=t,m=t,u=t,h=0,p=0,g=0,f=0,b=597399067,v=2869860233,k=951274213,y=2716044179,I=0;I<l;I+=16)h=255&e.charCodeAt(I)|(255&e.charCodeAt(I+1))<<8|(255&e.charCodeAt(I+2))<<16|(255&e.charCodeAt(I+3))<<24,p=255&e.charCodeAt(I+4)|(255&e.charCodeAt(I+5))<<8|(255&e.charCodeAt(I+6))<<16|(255&e.charCodeAt(I+7))<<24,g=255&e.charCodeAt(I+8)|(255&e.charCodeAt(I+9))<<8|(255&e.charCodeAt(I+10))<<16|(255&e.charCodeAt(I+11))<<24,f=255&e.charCodeAt(I+12)|(255&e.charCodeAt(I+13))<<8|(255&e.charCodeAt(I+14))<<16|(255&e.charCodeAt(I+15))<<24,h=o(h=a(h,b),15),d=o(d^=h=a(h,v),19),d=a(d+=c,5)+1444728091,p=o(p=a(p,v),16),c=o(c^=p=a(p,k),17),c=a(c+=m,5)+197830471,g=o(g=a(g,k),17),m=o(m^=g=a(g,y),15),m=a(m+=u,5)+2530024501,f=o(f=a(f,y),18),u=o(u^=f=a(f,b),13),u=a(u+=d,5)+850148119;switch(h=0,p=0,g=0,f=0,r){case 15:f^=e.charCodeAt(I+14)<<16;case 14:f^=e.charCodeAt(I+13)<<8;case 13:f=a(f^=e.charCodeAt(I+12),y),u^=f=a(f=o(f,18),b);case 12:g^=e.charCodeAt(I+11)<<24;case 11:g^=e.charCodeAt(I+10)<<16;case 10:g^=e.charCodeAt(I+9)<<8;case 9:g=a(g^=e.charCodeAt(I+8),k),m^=g=a(g=o(g,17),y);case 8:p^=e.charCodeAt(I+7)<<24;case 7:p^=e.charCodeAt(I+6)<<16;case 6:p^=e.charCodeAt(I+5)<<8;case 5:p=a(p^=e.charCodeAt(I+4),v),c^=p=a(p=o(p,16),k);case 4:h^=e.charCodeAt(I+3)<<24;case 3:h^=e.charCodeAt(I+2)<<16;case 2:h^=e.charCodeAt(I+1)<<8;case 1:h=a(h^=e.charCodeAt(I),b),d^=h=a(h=o(h,15),v)}return d^=e.length,d+=c^=e.length,d+=m^=e.length,c+=d+=u^=e.length,m+=d,u+=d,d=s(d),d+=c=s(c),d+=m=s(m),c+=d+=u=s(u),m+=d,u+=d,("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(c>>>0).toString(16)).slice(-8)+("00000000"+(m>>>0).toString(16)).slice(-8)+("00000000"+(u>>>0).toString(16)).slice(-8)},x64Hash64:function(e,t){return h(e,t).slice(8)},x64Hash128:h,hash:function(e,t){return h(e,t)}}},11028:(e,t,n)=>{var i=n(81314);function a(e,t){return e[t]<<8|e[t+1]}e.exports={hash:function(e){var t,n=i.toU8IntArray(e+""),o=0;if(!e)return o.toString(16);var s=n.length,r=0;t=3&s,s>>>=2;for(var l=0;l<s;l++)o=(o+=a(n,r))<<16^(a(n,r+2)<<11^o),r+=4,o+=o>>11;switch(t){case 3:o+=a(n,r),o^=o<<16,o^=n[r+2]<<18,o+=o>>11;break;case 2:o+=a(n,r),o^=o<<11,o+=o>>17;break;case 1:o+=n[r],o^=o<<10,o+=o>>1}return o^=o<<3,o+=o>>5,o^=o<<4,o+=o>>17,o^=o<<25,o+=o>>6,i.intToUnsignedHex(o)}}},81314:e=>{e.exports={toU8IntArray:function(e){for(var t=[],n=[],i=0;i<e.length;i++){var a,o=e.charCodeAt(i);for(n.length=0;(a=255&o)||o;)n.push(a),o>>>=8;t=t.concat(n.reverse())}return t},intToUnsignedHex:function(e){for(var t,n=[];(t=65535&e)||e;)t=t.toString(16),t="0000".slice(t.length)+t,n.push(t),e>>>=16;return n.reverse().join("")}}}}]);