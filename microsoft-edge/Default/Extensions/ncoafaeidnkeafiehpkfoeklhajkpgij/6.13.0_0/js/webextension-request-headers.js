Okta.RequestHeaders=function(e,r,s){var t={};var i=Okta.Constants.Auth0;var u=Okta.fn.url.isOktaEndUserHomeHref;var a=Okta._okta;var d=Okta.Url;var l=a.find;var c=a.isNumber;var n=Okta.fn.browserType;var o=n.isSafariWebExt(r);var v=Okta.fn.storage.syncStorageData;var f=Okta.fn.bg.getPendingConsentAccount;var h=Okta.fn.url.isCustomEndUserHomeHref;var m="X-Okta-User-Agent-Extended";var g="okta-browser-plugin/"+e;var p="X-Okta-User-Agent-Account-Data";var k="DOMAINS";var S=String.fromCharCode.apply(null,[79,75,84,65,95,65,67,67,79,85,78,84,95,87,72,73,84,69,95,76,73,83,84]);var H="DBG_PLUGIN_SETTINGS";var C={domains:{key:k,val:null},dbgPluginSettings:{key:H,val:null},allowListedAccounts:{key:S,val:null}};var O="WebExtension::onBeforeSendHeaders Error: ";var b="WebExtension::onAuth0BeforeRedirect: ";var q=[302];var L=function(e){var r=e.queryKey;return e.path==="/authorize"&&!!r.client_id&&!!r.redirect_uri&&!!r.scope&&!!r.state};t.onBeforeSendHeaders=function(e){var r={requestHeaders:[]};if(e.requestHeaders){r.requestHeaders=e.requestHeaders}try{var t=C.domains.val;var a=false;var n=u&&u(e.url);if(!n&&h){if(t&&t.customDomain&&t.oktaDomain){a=h(e.url,t.customDomain)}}if(n||a){var o=l(r.requestHeaders,function(e){return e.name.toLowerCase()===m.toLowerCase()});var s=f?f(C.dbgPluginSettings.val,C.allowListedAccounts.val,a?t:null):"";if(o){o.value+=" "+g}else{r.requestHeaders.push({name:m,value:g});r.requestHeaders.push({name:p,value:s})}}}catch(e){Log.error(O+e.message)}return r};t.onAuth0BeforeRedirect=function(o){return s.getPluginSettings().then(function(e){if(!e||!e.orgSettings||!e.orgSettings.pluginSocialLoginEnabled){return}if(!c(o.tabId)){return}if(!q.includes(o.statusCode)||o.method!="GET"){Log.info(b+"statusCode or method mismatch");return}var r=new d(o.url);if(!L(r)){Log.info(b+"not a valid auth0 authorize call");return}if(i.POktaIdPDomain.includes(r.host)){Log.info(b+"authorize from POkta Idp, skip");return}var t=l(o.responseHeaders,function(e){return e.name.toLowerCase()==="x-auth0-requestid"});if(!t){Log.info(b+"no auth0 x-auth0-requestid header");return}var a=r.queryKey;var n={signOnMode:"oauth_authorize",audience:decodeURIComponent(a.audience),host:r.host,auth0Client:a.auth0Client,clientId:a.client_id,scope:decodeURIComponent(a.scope),redirectUri:decodeURIComponent(a.redirect_uri),timeStamp:o.timeStamp};return s.setCurrentSelfServiceAppCredentials(o.tabId,n)})};t.initialize=function(){v(C);var e={urls:["<all_urls>"]};var r=o?{urls:["https://*.auth0.com/authorize*"]}:{urls:["https://*.auth0.com/authorize?*"]};chrome.webRequest.onBeforeSendHeaders.addListener(t.onBeforeSendHeaders,e,["requestHeaders","blocking"]);chrome.webRequest.onBeforeRedirect.addListener(t.onAuth0BeforeRedirect,r,["responseHeaders"])};return t};