/*! For license information please see product_page.js.LICENSE.txt */
!function(){var e={991:function(e,t,n){var r=n(3236).default;function o(){"use strict";e.exports=o=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,i=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new P(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return I()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=p;var h={};function f(){}function v(){}function g(){}var y={};l(y,s,(function(){return this}));var S=Object.getPrototypeOf,m=S&&S(S(w([])));m&&m!==n&&i.call(m,s)&&(y=m);var C=g.prototype=f.prototype=Object.create(y);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(o,a,s,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==r(p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return h;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var r=d(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,h;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function w(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=g,l(C,"constructor",g),l(g,"constructor",v),v.displayName=l(g,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,u,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},x(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new k(p(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(C),l(C,u,"Generator"),l(C,s,(function(){return this})),l(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=w,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:w(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},t}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},3236:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},8013:function(e,t,n){var r=n(991)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";function e(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function t(t){return function(){var n=this,r=arguments;return new Promise((function(o,i){var a=t.apply(n,r);function s(t){e(a,o,i,s,c,"next",t)}function c(t){e(a,o,i,s,c,"throw",t)}s(void 0)}))}}var r=n(8013),o=n.n(r);function i(e){return!e||!e.trim()}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function h(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g,y,S=s((function e(){c(this,e),v(this,"attribution",void 0),v(this,"couponCode",void 0),v(this,"title",void 0),v(this,"isLowSuccessRateCoupon",void 0),v(this,"isStackable",void 0),v(this,"successRate",void 0),v(this,"minimumPurchase",void 0),v(this,"shortHeader",void 0),v(this,"calculatedCutoffPrice",void 0),v(this,"discountPercent",void 0),v(this,"discountValue",void 0),v(this,"offerUrl",void 0)}));function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}!function(e){e[e.ConfirmedProductPage=0]="ConfirmedProductPage",e[e.ProductPage=1]="ProductPage",e[e.Homepage=2]="Homepage",e[e.CheckoutPage=3]="CheckoutPage"}(g||(g={})),function(e){e[e.Selector=0]="Selector",e[e.Automated=1]="Automated"}(y||(y={}));var C,x,k,b,A,E,P,w,I,D,O,T,R,M,F,B,N,L,G,U,V,_=function(e){p(n,e);var t=m(n);function n(){var e;c(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return v(u(e=t.call.apply(t,[this].concat(o))),"source",void 0),v(u(e),"extraction",void 0),v(u(e),"timestamp",void 0),e}return s(n)}(S),W=_;!function(e){e[e.Domains=0]="Domains",e[e.Deals=1]="Deals",e[e.Popup=2]="Popup",e[e.Overlay=3]="Overlay",e[e.BaseUXUrl=4]="BaseUXUrl",e[e.EventLogUrl=5]="EventLogUrl",e[e.PriceComparison=6]="PriceComparison",e[e.PriceNotification=7]="PriceNotification",e[e.ImageResize=8]="ImageResize",e[e.EdgeMobileOverlay=9]="EdgeMobileOverlay",e[e.ECOverlay=10]="ECOverlay",e[e.ShopRunnerOverlay=11]="ShopRunnerOverlay"}(C||(C={})),function(e){e.Get="GET",e.Post="POST"}(x||(x={})),function(e){e.Json="application/json",e.Text="text/plain"}(k||(k={})),function(e){e.Trace="Trace",e.Debug="Debug",e.Information="Information",e.Warning="Warning",e.Error="Error",e.Critical="Critical",e.None="None"}(b||(b={})),function(e){e.AutoApply="AutoApply",e.ButtonClick="ButtonClick",e.ClientError="ClientError",e.DebugMessage="DebugMessage",e.EdgeFlyoutStatus="EdgeFlyoutStatus",e.CheckoutPageValidation="CheckoutPageValidation",e.CashbackInfo="CashbackInfo",e.OtherSellers="OtherSellers",e.RewardsActivity="RewardsActivity",e.ExpressCheckout="ExpressCheckout",e.EdgeFlyoutStatusDiagnostic="EdgeFlyoutStatusDiagnostic",e.RenderTime="RenderTime",e.PrintableGroceryCouponsOverlay="PrintableGroceryCouponsOverlay",e.CartExtraction="CartExtraction",e.CartExtractionError="CartExtractionError",e.FeedbackClicked="FeedbackClicked",e.ActiveExperiments="ActiveExperiments",e.ProductPageValidation="ProductPageValidation",e.VisibleClippingSelectors="VisibleClippingSelectors",e.PlatformDetection="PlatformDetection",e.ClippingExist="ClippingExist",e.CollectedCoupons="CollectedCoupons",e.PurchaseConfirmation="PurchaseConfirmation",e.CheckoutValidationPerf="CheckoutValidationPerf",e.ManualCouponApplication="ManualCouponApplication",e.EdgeDriverStatus="EdgeDriverStatus",e.ShopRunnerOverlay="ShopRunnerOverlay",e.EstimatedCashback="EstimatedCashback",e.CashbackUpsell="CashbackUpsell",e.CatalogExtractionRating="CatalogExtractionRating",e.CatalogExtractionReviews="CatalogExtractionReviews"}(A||(A={})),function(e){e.PriceHistoryGraph="PriceHistoryGraph"}(E||(E={})),function(e){e.AutoApply="AutoApply",e.BackgroundAutoApplyPositive="BackgroundAutoApplyPositive",e.BackgroundAutoApplyNegative="BackgroundAutoApplyNegative",e.PopupClose="PopupClose",e.CouponCopied="CouponCopied",e.SeeMoreCoupons="SeeMoreCoupons",e.SeeMoreRetailers="SeeMoreRetailers",e.SeeMoreSellers="SeeMoreSellers",e.SeeMoreTopRetailers="SeeMoreTopRetailers",e.SeeMorePaymentOptions="SeeMorePaymentOptions",e.SeeMoreGroceryCoupons="SeeMoreGroceryCoupons",e.SeeMoreExclusiveCoupons="SeeMoreExclusiveCoupons",e.SeeAllPrintableCoupons="SeeAllPrintableCoupons",e.SeeMoreItemizedCashback="SeeMoreItemizedCashback",e.SeeAllTrendingDeals="SeeAllTrendingDeals",e.SubmitCommunityCoupons="SubmitCommunityCoupons",e.SubmitAnotherCommunityCoupons="SubmitAnotherCommunityCoupons",e.PrintableCouponSelected="PrintableCouponSelected",e.PrintGroceryCoupons="PrintGroceryCoupons",e.FREManage="FREManage",e.FlyoutManage="FlyoutManage",e.FREDismiss="FREDismiss",e.FlyoutDismiss="FlyoutDismiss",e.FlyoutSnooze="FlyoutSnooze",e.DoNotShow="DoNotShow",e.DoNotShowFeatureForDomain="DoNotShowFeatureForDomain",e.FlyoutSnoozeUndo="FlyoutSnoozeUndo",e.RemindLater="RemindLater",e.BannerDismiss="BannerDismiss",e.AutoShowTurnedOff="AutoShowTurnedOff",e.AutoShowTurnedOn="AutoShowTurnedOn",e.FREGotIt="FREGotIt",e.FRENoThanks="FRENoThanks",e.NavigatedToAnotherRetailer="NavigatedToAnotherRetailer",e.ProceedToCheckoutWithImport="ProceedToCheckoutWithImport",e.ProceedToCheckoutWithOutImport="ProceedToCheckoutWithOutImport",e.ProceedToCheckout="ProceedToCheckout",e.UseCoupon="UseCoupon",e.UseRebates="UseRebates",e.ActivateCashBack="ActivateCashBack",e.PreviousCashBack="PreviousCashBack",e.ExpandedPreviousCashBack="ExpandedPreviousCashBack",e.NotificationDismiss="NotificationDismiss",e.OrganicFlowTurnedOff="OrganicFlowTurnedOff",e.OrganicFlowTurnedOn="OrganicFlowTurnedOn",e.RebatesLearnMore="RebatesLearnMore",e.RebatesAccount="RebatesAccount",e.CouponCopiedStackableWithCashBack="CouponCopiedStackableWithCashBack",e.CouponCopiedNonStackableWithCashBack="CouponCopiedNonStackableWithCashBack",e.ShareFB="ShareFB",e.ShareTwitter="ShareTwitter",e.ShareWhatsapp="ShareWhatsapp",e.ShareClipboard="ShareClipboard",e.ScrollVideoReviews="ScrollVideoReviews",e.ClickInlineRating="ClickInlineRating",e.ClickExpertReview="ClickExpertReview",e.ClickVideoReview="ClickVideoReview",e.NavigateToRetailerOffer="NavigateToRetailerOffer",e.NavigateToRecommendedDeal="NavigateToRecommendedDeal",e.NavigateToOtherSeller="NavigateToOtherSeller",e.AddToCart="AddToCart",e.TipsGotIt="TipsGotIt",e.TipsDwellTime="TipsDwellTime",e.MicroNotificationClick="MicroNotificationClick",e.MicroNotificationDismiss="MicroNotificationDismiss",e.AAWithoutEC="AAWithoutEC",e.AAWithEC="AAWithEC",e.ExpressCheckout="EC",e.RewardSignIn="RewardSignIn",e.RewardRedeem="RewardRedeem",e.RewardAdditionalLink="RewardAdditionalLink",e.RewardInfo="RewardInfo",e.ActivateCashbackToEarnReward="ActivateCashbackToEarnReward",e.ActivateCashbackToEarnRewardFail="ActivateCashbackToEarnRewardFail",e.HomePageNotificationHover="HomePageNotificationHover",e.DeletePackageTrackerByGuid="DeletePackageTrackerByGuid",e.PackageTrackingOptIn="PackageTrackingOptIn",e.PackageTrackingOptOut="PackageTrackingOptOut",e.PackageTrackingOrderClick="PackageTrackingOrderClick",e.PriceHistoryGotItBtn="PriceHistoryGotItBtn",e.DigitalGroceryCouponClick="DigitalGroceryCouponClick",e.DigitalGroceryCouponSeeAll="DigitalGroceryCouponSeeAll",e.RewardsClick="RewardsClick",e.ViewAccountActivity="ViewAccountActivity",e.CashbackRetailer="CashbackRetailer",e.SustainabilityShop="SustainabilityShop",e.ECWithoutPayment="ECWithoutPayment",e.ECWithBNPL="ECWithBNPL",e.FeedbackLike="FeedbackLike",e.FeedbackDislike="FeedbackDislike",e.FeedbackDislikeMenu0="FeedbackDislikeMenu0",e.FeedbackDislikeMenu1="FeedbackDislikeMenu1",e.FeedbackDislikeMenu2="FeedbackDislikeMenu2",e.FeedbackDislikeMenu3="FeedbackDislikeMenu3",e.FeedbackDislikeMenu4="FeedbackDislikeMenu4",e.FeedbackClose="FeedbackClose",e.FeedbackSubmit="FeedbackSubmit",e.FeedbackDismiss="FeedbackDismiss",e.SustainabilityLearnMore="SustainabilityLearnMore",e.PinterestNavigateToAnotherRetailer="PinterestNavigateToAnotherRetailer",e.YoutubeNavigateToAnohterRetailer="YoutubeNavigateToAnohterRetailer",e.SaveExclusiveCoupons="SaveExclusiveCoupons",e.DontSaveExclusiveCoupons="DontSaveExclusiveCoupons",e.PriceDropProductPage="PriceDropProductPage",e.PriceDropProductPageHover="PriceDropProductPageHover",e.SustainabilityConfirmationHover="SustainabilityConfirmationHover",e.AttainableInfoIcon="AttainableInfoIcon",e.AttainableInfoIconNotif="AttainableInfoIconNotif",e.AttainableContinueShopping="AttainableContinueShopping",e.DismissGiftCard="DismissGiftCard",e.GroceryItemShopAndActivate="GroceryItemShopAndActivate",e.GroceryItemTooltipViewed="GroceryItemTooltipViewed",e.GrocerySectionTooltipViewed="GrocerySectionTooltipViewed",e.GroceryItemDisclaimer="GroceryItemDisclaimer",e.JoinNow="JoinNow",e.MaybeLater="MaybeLater",e.NavigatedToAutosMarketplace="NavigatedToAutosMarketplace",e.NavigatedToAutosMarketplaceRecommendation="NavigatedToAutosMarketplaceRecommendation",e.ActivatedGroceryItem="ActivatedGroceryItem",e.TrendingOffersCard="TrendingOffersCard",e.TrendingOffersShowMore="TrendingOffersShowMore",e.DailyDealsCard="DailyDealsCard",e.DailyDealsShowMore="DailyDealsShowMore",e.InfiniteCategoryFeedCard="InfiniteCategoryFeedCard",e.InfiniteCategoryFeedShowMore="InfiniteCategoryFeedShowMore",e.ShopRunnerSignUp="ShopRunnerSignUp",e.AbandonedCartTile="AbandonedCartTile",e.AbandonedCartNotificationButton="AbandonedCartNotificationButton",e.GroceryCashbackPendingClaim="GroceryCashbackPendingClaim",e.MicrosoftCashbackAccountButton="MicrosoftCashbackAccountButton",e.PendingCashbackDisclaimer="PendingCashbackDisclaimer",e.ClaimedPendingCashbackDisclaimer="ClaimedPendingCashbackDisclaimer",e.ClaimedPendingCashbackTooltipViewed="ClaimedPendingCashbackTooltipViewed",e.PendingCashbackTooltipViewed="PendingCashbackTooltipViewed",e.cashbackUpsellJoinNowPath="cashbackUpsellJoinNowPathsJoinCashback",e.surfaceUpsellActivateNow="surfaceUpsellActivateNow",e.Unknown="Unknown"}(P||(P={})),function(e){e.OpenedInCheckout="OpenedInCheckout",e.EmptyCoupons="EmptyCoupons",e.AutoTrigger="AutoTrigger",e.ErrorWrongAutoTrigger="ErrorWrongAutoTrigger",e.UserTrigger="UserTrigger",e.BannerRendered="BannerRendered",e.OnErrorInvoked="OnErrorInvoked",e.BestPrice="BestPrice",e.YouCanSave="YouCanSave",e.RebatesConfirmationNotification="RebatesConfirmationNotification",e.RebatesTurnedOffNotification="RebatesTurnedOffNotification",e.StackableCouponWithCashback="StackableCouponWithCashback",e.NonStackableCouponWithCashback="NonStackableCouponWithCashback",e.CashBackNotActiveAutoApply="CashBackNotActiveAutoApply",e.PriceHistoryPriceDrop="PriceHistoryPriceDrop",e.PriceHistoryPriceIncrease="PriceHistoryPriceIncrease",e.PriceHistoryPriceStable="PriceHistoryPriceStable",e.PriceHistoryDwellTimeHover="PriceHistoryDwellTimeHover",e.PriceHistoryInfoButtonDwellTimeHover="PriceHistoryInfoButtonDwellTimeHover",e.PriceHistoryNotificationHover="PriceHistoryNotificationHover",e.PriceHistoryNoImage="PriceHistoryNoImage",e.PriceHistoryShowMoreInfoTooltip="PriceHistoryShowMoreInfoTooltip",e.PriceHistoryHideMoreInfoTooltip="PriceHistoryHideMoreInfoTooltip",e.ActivateCashBackButton="ActivateCashBackButton",e.CashBackWillNotRender="CashBackWillNotRender",e.CashBackButtonShown="CashBackButtonShown",e.CashBackSignInButtonShown="CashBackSignInButtonShown",e.ErrorPageHandlerFunction="ErrorPageHandlerFunction",e.FlyoutAutoPriceHistoryTrigger="FlyoutAutoPriceHistoryTrigger",e.FlyoutDismissedPriceHistoryTrigger="FlyoutDismissedPriceHistoryTrigger",e.InlineRatingRendered="InlineRatingRendered",e.RatingsAndReviewsRendered="RatingsAndReviewsRendered",e.AutoOpenUsingUrlParam="AutoOpenUsingUrlParam",e.ContextMenuInfo="ContextMenuInfo",e.AddedToCartNotification="AddedToCartNotification",e.CashBackActivated="CashBackActivated",e.ErrorCashBackActivation="ErrorCashBackActivation",e.CheckoutUserDataInvalid="CUDInvalid",e.ExpressCheckout="ECOnly",e.OtherSeller="OtherSeller",e.ModuleViewed="ModuleViewed",e.RewardWillBeRendered="RewardWillBeRendered",e.RewardSignInSuccess="RewardSignInSuccess",e.ErrorRewardSignIn="ErrorRewardSignIn",e.RewardNotification="RewardNotification",e.PackageTrackingCardViewed="PackageTrackingCardViewed",e.ShownOnPinterest="ShownOnPinterest",e.ViewedProductPriceDrop="ViewedProductPriceDrop",e.SustainabilityConfirmation="SustainabilityConfirmation",e.SustainabilityPDP="SustainabilityPDP",e.AutosMarketplaceRenderNotification="AutosMarketplaceRenderNotification",e.AutosPriceInsightRenderNotification="AutosPriceInsightRenderNotification",e.AutosMarketplaceRenderViewModule="AutosMarketplaceRenderViewModule",e.AutosPriceInsightRenderViewModule="AutosPriceInsightRenderViewModule",e.AutosMarketplaceListingHovered="AutosMarketplaceListingHovered",e.AutosMarketDwellTimeHover="AutosMarketDwellTimeHover",e.AutosPriceInsightBarHovered="AutosPriceInsightBarHovered",e.AutosPriceInsightDwellTimeHover="AutosPriceInsightDwellTimeHover",e.PerfViewModule="PerfViewModule",e.PerfCreateAndRender="PerfCreateAndRender",e.PerfPauseAutoShow="PerfPauseAutoShow",e.PerfAddModulesToTabs="PerfAddModulesToTabs",e.PerfSelectorExtraction="PerfSelectorExtraction",e.ErrorToRecordEngagement="ErrorToRecordEngagement",e.ErrorPaneStuckLoadingState="ErrorPaneStuckLoadingState",e.SavingsFoundShown="SavingsFoundShown",e.ErrorRewardsAdded="ErrorRewardsAdded",e.ItemizedCashback="ICList",e.ItemizedCashbackActivated="ICActivedList",e.ItemizedCashbackActivatedSeeAll="ICActivedListSeeAll",e.ItemizedCashbackActivatedNavigateToRetailer="ICActivatedNavigateToRetailer",e.ItemizedCashbackActivatedHover="ICActivatedHover",e.ItemizedCashbackActivateClick="ICActivateClick",e.ItemizedCashbackOfferClick="ICOfferClick",e.ItemizedCashbackShopCartClick="ICActivateShopCartClick",e.ItemizedCashbackHover="ICHoverItem",e.ICActivatedNotification="ICItemActivatedNotification",e.ICActivatedNotificationHover="ICItemActivatedNotificationHover",e.ICSPBNotificationHover="ICItemSPBNotificationHover",e.ICPDPActivatedHover="ICPDPActivatedHover",e.ICPdpCashbackNotificationHover="ICPdpCashbackNotificationHover",e.ICConfirmationNotification="ICItemConfirmNotification",e.BlockedAutoOpenEngagement="BlockedAutoOpenEngagement",e.ICApiDataUnavailable="ICApiDataUnavailable",e.CouponExpectationTooltipOpen="CouponExpectationTooltipOpen",e.CouponExpectationTooltipRead="CouponExpectationTooltipRead",e.NotificationModuleRequired="NotificationModuleRequired",e.PersonalizedCashbackList="PersonalizedCashbackList",e.CategoryFilterClick="CategoryFilterClick",e.PersonalizedAutoTriggerOff="PersonalizedAutoTriggerOff",e.PaneTabClick="PaneTabClick",e.EstimatedCashbackShown="EstimatedCashbackShown",e.ICPendingCashbackNotificationHover="ICPendingCashbackNotificationHover",e.ICActivatedPendingCashbackNotificationHover="ICActivatedPendingCashbackNotificationHover",e.ICPendingCashbackClaimClick="ICPendingCashbackClaimClick",e.ICMicrosoftCashbackClick="ICMicrosoftCashbackClick",e.ICPendingCashbackNotification="ICPendingCashbackNotification",e.ICActivatedPendingCashbackNotification="ICActivatedPendingCashbackNotification",e.TermsClicked="TermsClicked",e.PrivacyAndCookiesClicked="PrivacyAndCookiesClicked",e.MicrosoftRebatesClicked="MicrosoftRebatesClicked",e.GroceryCouponsSeeMoreClick="GroceryCouponsSeeMoreClick",e.MicroNotificationTrigger="MicroNotificationTrigger",e.ErrorActivatingUpsell="ErrorActivatingUpsell"}(w||(w={})),function(e){e.HomePage="HomePage",e.PdpPage="ProductPage",e.SearchPage="SearchPage",e.CategorySearchPage="CategorySearchPage",e.ConfirmationPage="ConfirmationPage",e.ActivatedNotify="ActivatedNotify",e.PdpNotification="PdpNotification"}(I||(I={})),function(e){e.Error="Error",e.Negative="Negative",e.Positive="Positive",e.Cancelled="Cancelled",e.InProgress="InProgress"}(D||(D={})),function(e){e.CheckoutPage="CheckoutPage",e.ProductPage="ProductPage",e.HomePage="HomePage"}(O||(O={})),function(e){e.Error="Error",e.Negative="Negative",e.Positive="Positive"}(T||(T={})),function(e){e.Valid="Valid",e.NotApplicable="NotApplicable",e.LowSuccess="LowSuccess",e.MinPurchaseNotMet="MinPurchaseNotMet",e.CalculatedCutOffPriceNotMet="CalculatedCutOffPriceNotMet",e.WorseDiscountPercent="WorseDiscountPercent",e.WorseDiscountValue="WorseDiscountValue"}(R||(R={})),function(e){e[e.ApplyCouponsMessage=1]="ApplyCouponsMessage",e[e.AutoApplyCompletedMessage=2]="AutoApplyCompletedMessage",e[e.CheckoutPageMessage=3]="CheckoutPageMessage",e[e.CloseOverlayMessage=4]="CloseOverlayMessage",e[e.ClosedPopupMessage=5]="ClosedPopupMessage",e[e.CountElementsResponse=6]="CountElementsResponse",e[e.CreateOverlayMessage=7]="CreateOverlayMessage",e[e.CreatePopupMessage=8]="CreatePopupMessage",e[e.CreatePriceComparisonMessage=9]="CreatePriceComparisonMessage",e[e.EdgeApplyCouponsMessage=10]="EdgeApplyCouponsMessage",e[e.EmptyResponse=11]="EmptyResponse",e[e.ErrorResponse=12]="ErrorResponse",e[e.GetCompetingPricesMessage=13]="GetCompetingPricesMessage",e[e.GetCompetingPricesResponse=14]="GetCompetingPricesResponse",e[e.GetTextValueResponse=15]="GetTextValueResponse",e[e.GetUIStateMessage=16]="GetUIStateMessage",e[e.GetUIStateResponse=17]="GetUIStateResponse",e[e.MoveProgressBarMessage=18]="MoveProgressBarMessage",e[e.ShowResultMessage=19]="ShowResultMessage",e[e.TelemetryMessage=20]="TelemetryMessage",e[e.UpdateCurrentCouponMessage=21]="UpdateCurrentCouponMessage",e[e.OpalMessage=22]="OpalMessage",e[e.ProductPageMessage=23]="ProductPageMessage",e[e.ProductPageResponse=24]="ProductPageResponse",e[e.EdgeCreateOverlayMessage=25]="EdgeCreateOverlayMessage",e[e.EdgeShowResultMessage=26]="EdgeShowResultMessage",e[e.VerifySelectorsMessage=27]="VerifySelectorsMessage",e[e.VerifySelectorsResponse=28]="VerifySelectorsResponse",e[e.AutoApplyCancelledMessage=29]="AutoApplyCancelledMessage",e[e.ContentInitMessage=30]="ContentInitMessage",e[e.ClearDataMessage=31]="ClearDataMessage",e[e.DOMMutationMessage=32]="DOMMutationMessage",e[e.UpdateCurrencyMessage=33]="UpdateCurrencyMessage",e[e.CheckoutProgressMessage=34]="CheckoutProgressMessage",e[e.ECCreateOverlayMessage=35]="ECCreateOverlayMessage",e[e.ECShowResultMessage=36]="ECShowResultMessage",e[e.ECFieldErrorMessage=37]="ECFieldErrorMessage",e[e.ECCreateUpdatePaymentOverlayMessage=38]="ECCreateUpdatePaymentOverlayMessage",e[e.PrintableGroceryCouponsMessage=39]="PrintableGroceryCouponsMessage",e[e.WalletDrawerCreateOverlayMessage=40]="WalletDrawerCreateOverlayMessage",e[e.WalletDrawerCloseMessage=41]="WalletDrawerCloseMessage",e[e.BackgroundAutoApplyCancelledMessage=42]="BackgroundAutoApplyCancelledMessage",e[e.GetChcekedValueResponse=43]="GetChcekedValueResponse",e[e.SelectorSuccessResponse=44]="SelectorSuccessResponse",e[e.SelectorExtractionMessage=45]="SelectorExtractionMessage",e[e.SelectorExtractionResponse=46]="SelectorExtractionResponse",e[e.ShopRunnerOverlayMessage=47]="ShopRunnerOverlayMessage"}(M||(M={})),function(e){e[e.IOS=0]="IOS",e[e.Android=1]="Android"}(F||(F={})),function(e){e[e.PlainString=0]="PlainString",e[e.JsonString=1]="JsonString"}(B||(B={})),function(e){e[e.FromBackground=1]="FromBackground",e[e.FromContent=2]="FromContent"}(N||(N={})),function(e){e.HandleBackgroundMessage="HandleBackgroundMessage",e.HandleContentMessage="HandleContentMessage"}(L||(L={})),function(e){e.Opal="Opal",e.Extension="Extension",e.Edge="Edge",e.EdgeMobile="EdgeMobile",e.Sapphire="Sapphire",e.RBC="RBC"}(G||(G={})),function(e){e.AutoApplyCoupons="AutoApplyCoupons",e.CouponClipping="CouponClipping",e.BackgroundAutoApply="BackgroundAutoApply",e.FallBackAutoApply="FallBackAutoApply",e.ProductPageBackgroundAutoApply="ProductPageBackgroundAutoApply",e.BackgroundAAResult="BackgroundAAResult",e.AutoCouponClipping="AutoCouponClipping"}(U||(U={})),function(e){e.ProductPageBackgroundAutoApply="ProductPageBackgroundAutoApply",e.BackgroundAutoApply="BackgroundAutoApply",e.ForegroundAutoApply="ForegroundAutoApply"}(V||(V={}));var H,z,j,J,$,K,X,Y,Z,q;!function(e){e.VALIDATION_ERROR="VALIDATION_ERROR",e.SERVER_ERROR="SERVER_ERROR"}(H||(H={})),function(e){e.AMEX="A",e.DISCOVER="D",e.MASTERCARD="M",e.VISA="V",e.ZIP="Z"}(z||(z={})),function(e){e.ExpressCheckout="ExpressCheckout",e.ECWithBNPL="ECWithBNPL",e.ECWithoutPayment="ECWithoutPayment"}(j||(j={})),function(e){e.Wallet="Wallet",e.Shopping="Shopping"}(J||(J={})),function(e){e.AutoApplyTransactionsKey="ListOfAutoApplyTransactions",e.CouponClippingTransactionsKey="ListOfCouponClippingTransactions",e.CashbackTransactionsKey="ListOfCashbackTransactions"}($||($={})),function(e){e.UserCouponFailed="UserCouponFailed",e.BetterInitialPrice="BetterInitialPrice",e.CouponNotInOurCorpus="CouponNotInOurCorpus",e.ManuallyAppliedCouponNotInOurCorpus="ManuallyAppliedCouponNotInOurCorpus",e.SuggestedCoupon="SuggestedCoupon"}(K||(K={})),function(e){e.Flyout="Flyout",e.Validator="Validator",e.Driver="Driver",e.Controller="Controller"}(X||(X={})),function(e){e.High="High",e.Medium="Medium",e.Low="Low",e.None="None"}(Y||(Y={})),function(e){e[e.PositiveResultShown=6]="PositiveResultShown",e[e.NegativeResultShown=7]="NegativeResultShown",e[e.PositiveResultClicked=10]="PositiveResultClicked",e[e.NegativeResultClicked=11]="NegativeResultClicked"}(Z||(Z={})),function(e){e.Coupons="Coupons"}(q||(q={}));var Q=s((function e(){c(this,e),v(this,"BgAutoApplyInProgress",void 0),v(this,"ForegroundApplyingBestCoupon",void 0),v(this,"progressBarStartPos",void 0),v(this,"progressBarEndPos",void 0),v(this,"currentCoupon",void 0),v(this,"currentCouponIndex",void 0),v(this,"couponsTotal",void 0),v(this,"result",void 0)}));function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var te=function(e){p(n,e);var t=ee(n);function n(){var e;c(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return v(u(e=t.call.apply(t,[this].concat(o))),"StartTime",void 0),v(u(e),"CouponsApplied",void 0),v(u(e),"ContextID",void 0),v(u(e),"InitialPrice",void 0),v(u(e),"BestCoupon",void 0),v(u(e),"MaxDiscount",void 0),v(u(e),"CouponResults",void 0),v(u(e),"ImpressionId",void 0),v(u(e),"StringifiedMap",void 0),v(u(e),"ImportOptions",void 0),v(u(e),"Currency",void 0),v(u(e),"PageCurrency",void 0),v(u(e),"CashBackActive",void 0),v(u(e),"AppliedCoupon",void 0),v(u(e),"TrueInitialPrice",void 0),v(u(e),"BackgroundAACancelled",void 0),v(u(e),"BackgroundAAStatus",void 0),v(u(e),"SuggestedCoupons",void 0),v(u(e),"ExtractedInputBox",void 0),v(u(e),"ExtractedApplyButton",void 0),v(u(e),"ExtractedOrderTotalElement",void 0),e}return s(n,[{key:"StringifyMap",value:function(){this.StringifiedMap=JSON.stringify(Array.from(this.CouponsApplied.entries()))}},{key:"ToString",value:function(){return this.StringifyMap(),JSON.stringify(this)}}],[{key:"CreateNew",value:function(e,t){var r=new n(n.fourMinutesExpiryInSeconds);return r.ContextID=e,r.StartTime=Date.now(),r.CouponsApplied=new Map,r.MaxDiscount=0,r.CouponResults=[],r.BackgroundAAStatus=new Q,t&&(r.ImpressionId=t),r}},{key:"CreateFromObject",value:function(e){if(e&&null!==e.ContextID&&void 0!==e.ContextID){var t=n.CreateNew(e.ContextID);if(e.StringifiedMap)JSON.parse(e.StringifiedMap).forEach((function(e){var n=e[0],r=e[1];t.CouponsApplied.set(n,r)}));return e.BestCoupon&&(t.BestCoupon=e.BestCoupon),null!==e.InitialPrice&&void 0!==e.InitialPrice&&(t.InitialPrice=e.InitialPrice),null!==e.MaxDiscount&&void 0!==e.MaxDiscount&&(t.MaxDiscount=e.MaxDiscount),e.CouponResults&&(t.CouponResults=e.CouponResults),e.ImpressionId&&(t.ImpressionId=e.ImpressionId),e.ImportOptions&&(t.ImportOptions=e.ImportOptions),e.CashBackActive&&(t.CashBackActive=e.CashBackActive),e.Currency&&(t.Currency=e.Currency),e.PageCurrency&&(t.PageCurrency=e.PageCurrency),e.StartTime&&(t.StartTime=e.StartTime),e.AppliedCoupon&&(t.AppliedCoupon=e.AppliedCoupon),e.TrueInitialPrice&&(t.TrueInitialPrice=e.TrueInitialPrice),e.BackgroundAACancelled&&(t.BackgroundAACancelled=e.BackgroundAACancelled),e.BackgroundAAStatus&&(t.BackgroundAAStatus=e.BackgroundAAStatus),e.SuggestedCoupons&&(t.SuggestedCoupons=e.SuggestedCoupons),e.ExtractedInputBox&&(t.ExtractedInputBox=e.ExtractedInputBox),e.ExtractedApplyButton&&(t.ExtractedApplyButton=e.ExtractedApplyButton),e.ExtractedOrderTotalElement&&(t.ExtractedOrderTotalElement=e.ExtractedOrderTotalElement),t}return null}}]),n}(function(){function e(t,n){c(this,e),v(this,"Lifetime",void 0),v(this,"Timestamp",void 0),this.Lifetime=t,this.Timestamp=n||e.Now()}return s(e,[{key:"Expired",value:function(){return e.Now()-this.Timestamp>=this.Lifetime}}],[{key:"Now",value:function(){return Math.round((new Date).getTime()/1e3)}}]),e}());v(te,"fourMinutesExpiryInSeconds",480);var ne=te,re=function(){function e(){c(this,e)}return s(e,[{key:"ToString",value:function(){return JSON.stringify(this)}}]),e}();function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var ie=function(e){p(n,e);var t=oe(n);function n(e,r){var o;return c(this,n),v(u(o=t.call(this)),"Domain",void 0),v(u(o),"EntryPoint",void 0),v(u(o),"AutoApplyResult",void 0),v(u(o),"CouponResults",void 0),v(u(o),"AutoApplyProcessTime",void 0),v(u(o),"BestCoupon",void 0),v(u(o),"Discount",void 0),v(u(o),"StartingPrice",void 0),v(u(o),"ErrorName",void 0),v(u(o),"Currency",void 0),v(u(o),"PageCurrency",void 0),v(u(o),"IsStackable",void 0),v(u(o),"AutoApplyScenario",void 0),v(u(o),"ExtractedSelectors",void 0),o.Domain=e,o.EntryPoint=null!=r?r:J.Shopping,o}return s(n,[{key:"SetResultData",value:function(e,t,n,r,o,i,a,s,c){this.AutoApplyResult=e,this.AutoApplyProcessTime=t,this.BestCoupon=n,this.CouponResults=r,this.Discount=o,this.StartingPrice=i,this.IsStackable=a,this.AutoApplyScenario=s,this.ExtractedSelectors=c}},{key:"SetErrorData",value:function(e,t){this.AutoApplyResult=e,this.ErrorName=t}},{key:"SetCurrencyInfo",value:function(e,t){this.Currency=e,this.PageCurrency=t}}]),n}(re);function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var se=function(e){p(n,e);var t=ae(n);function n(e,r,o,i){var a;return c(this,n),v(u(a=t.call(this)),"Domain",void 0),v(u(a),"Data",void 0),v(u(a),"ErrorType",void 0),v(u(a),"StackTrace",void 0),a.Domain=e,a.StackTrace=i,a.Data=JSON.stringify(o),a.ErrorType=r,a}return s(n)}(re),ce=function(){function e(t){c(this,e),v(this,"Type",void 0),v(this,"ID",void 0),this.Type=t,this.ID=""}return s(e,[{key:"toString",value:function(){return JSON.stringify(this)}}],[{key:"uuidv4",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}}]),e}();function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var le=function(e){p(n,e);var t=ue(n);function n(e,r){var o;return c(this,n),v(u(o=t.call(this,M.MoveProgressBarMessage)),"StartPos",void 0),v(u(o),"EndPos",void 0),o.StartPos=e,o.EndPos=r,o}return s(n)}(ce);function pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var de=function(e){p(n,e);var t=pe(n);function n(e,r,o,i){var a;return c(this,n),v(u(a=t.call(this,M.UpdateCurrentCouponMessage)),"CurrentCoupon",void 0),v(u(a),"CurrentCouponIndex",void 0),v(u(a),"TotalCoupons",void 0),v(u(a),"CurrentBestDiscount",void 0),a.CurrentCoupon=e,a.CurrentCouponIndex=r,a.TotalCoupons=o,a.CurrentBestDiscount=i,a}return s(n)}(ce);function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var fe=function(e){p(n,e);var t=he(n);function n(e,r,o,i){var a;return c(this,n),v(u(a=t.call(this,e)),"Hostname",void 0),v(u(a),"ContextID",void 0),v(u(a),"Pathname",void 0),a.Hostname=o,a.ContextID=r,a.Pathname=i,a}return s(n)}(ce);function ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var ge=function(e){p(n,e);var t=ve(n);function n(e,r,o,i,a){var s;return c(this,n),v(u(s=t.call(this,M.EdgeApplyCouponsMessage,r,o,i)),"checkoutPageData",void 0),v(u(s),"startNew",void 0),s.checkoutPageData=e,s.startNew=a,s}return s(n)}(fe),ye=function(){function e(t,n){c(this,e),v(this,"messageType",void 0),v(this,"result",void 0),v(this,"bestCoupon",void 0),v(this,"maxDiscount",void 0),v(this,"initialPrice",void 0),v(this,"errorName",void 0),this.messageType=t,this.result=n}return s(e,[{key:"SetPositiveResultInfo",value:function(e,t,n){this.bestCoupon=e,this.maxDiscount=t,this.initialPrice=n}},{key:"SetErrorInfo",value:function(e){this.errorName=e}}]),e}(),Se=function(){function e(){c(this,e)}return s(e,null,[{key:"GetDomainNameFromHostname",value:function(e){if(!e)return"";var t=e.toLowerCase().match(/(w){3}.?\./);return t&&null!=t.index&&t[0]?e.substring(t.index+t[0].length):e}},{key:"GetMarket",value:function(e,t){return e||(t||"en-us")}}]),e}();function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Ce,xe=function(e){p(n,e);var t=me(n);function n(e,r){var o;return c(this,n),v(u(o=t.call(this,M.ErrorResponse)),"ErrorMsg",void 0),v(u(o),"ErrorName",void 0),o.ErrorMsg=e,o.ErrorName=r,o}return s(n)}(ce),ke=function(){function e(){c(this,e)}return s(e,null,[{key:"GenerateErrorMessage",value:function(e,t,n){var r=null!=e?e:"";return n&&(r+="\r\nDOM element path: '"+n+"'"),r+="\r\nFriendly name: '"+t+"'"}},{key:"GetDomainName",value:function(){return Se.GetDomainNameFromHostname(window.location.hostname)}},{key:"GetProcessedString",value:function(t,n,r){if(r&&(r===G.Opal||r===G.EdgeMobile||r===G.Sapphire||r===G.RBC)){if(n===B.PlainString)return e.escapePlainString(t);if(n===B.JsonString)return e.escapeJsonString(t)}return t}},{key:"escapeJsonString",value:function(e){return e?e.replace(/\"|'/g,'\\"'):e}},{key:"IsInframe",value:function(){try{return window.self!==window.top}catch(e){return!0}}},{key:"GenerateErrorResponse",value:function(t,n){return new xe(e.GetProcessedString(t,B.JsonString,n))}},{key:"ThrowError",value:function(e,t){var n=new Error(t);throw n.name=e,n}},{key:"GetPageUrl",value:function(){return window.location.toString()}},{key:"escapePlainString",value:function(e){return e?e.replace(/"|'/g,'\\"'):e}}]),e}();!function(e){e[e.PopupClosed=1]="PopupClosed",e[e.AutoApplyCompleted=2]="AutoApplyCompleted",e[e.IsInCheckout=4]="IsInCheckout",e[e.LeftCheckout=8]="LeftCheckout",e[e.CartChanged=16]="CartChanged",e[e.AutoApplyCancelled=32]="AutoApplyCancelled"}(Ce||(Ce={}));var be,Ae,Ee,Pe,we,Ie,De,Oe,Te,Re=function(){function e(){c(this,e),v(this,"Events",void 0),v(this,"Hostname",void 0)}return s(e,[{key:"SetState",value:function(e,t){try{t?this.Events|=e:this.Events&=1023&~e}catch(e){throw Error(ke.GenerateErrorMessage(e.message,"Set State"))}}},{key:"HasState",value:function(e){return this.Events&e}},{key:"NormalizeHostname",value:function(){this.Hostname=Se.GetDomainNameFromHostname(this.Hostname)}}],[{key:"CreateNew",value:function(t){var n=new e;return n.Events=0,n.Hostname=t,n.NormalizeHostname(),n}},{key:"CreateFromObject",value:function(t){var n=new e;return n.Events=t.Events,n.Hostname=t.Hostname,n.NormalizeHostname(),n}}]),e}();function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}!function(e){e.GetBoxValue="GetBoxValue",e.GetCurrentCheckoutPage="GetCurrentCheckoutPage",e.BetterInitialPrice="BetterInitialPrice",e.CheckoutPageWithoutCoupons="CheckoutPageWithoutCoupons",e.AutoApplyWithoutCoupons="AutoApplyWithoutCoupons",e.AutoApplyWithoutCheckout="AutoApplyWithoutCheckout",e.RemoveCouponFailure="RemoveCouponFailure",e.ApplyButtonUndefined="ApplyButtonUndefined",e.InputUndefined="InputUndefined",e.GetAppliedCoupon="GetAppliedCoupon",e.CouponClippingFailed="CouponClippingFailed",e.OtherSellerFailed="OtherSellerFailed",e.ContinueButtonUndefined="ContinueButtonUndefined",e.ECIframeResponseNotReceived="ECIframeResponseNotReceived",e.ECFrameNameUndefined="ECFrameNameUndefined",e.ECFrameOriginMisMatch="ECFrameOriginMisMatch",e.ExpressCheckoutBNPLFailed="ExpressCheckoutBNPLFailed",e.ErrorParsingBackgroundAutoApplyState="ErrorParsingBackgroundAutoApplyState",e.ExpiredBackgroundAAState="ExpiredBackgroundAAState",e.GetSuggestedCoupon="GetSuggestedCoupon",e.UndefinedState="UndefinedState",e.DomainDisabled="DomainDisabled",e.BackgroundAAError="BackgroundAAError",e.BackgroundAAPDPDisabled="BackgroundAAPDPDisabled",e.SavingsFoundTransactionFailure="SavingsFoundTransactionFailure",e.ApplyButtonDisabled="ApplyButtonDisabled",e.ContinueButtonDisabled="ContinueButtonDisabled"}(be||(be={})),function(e){e.LogScriptTelemetry="LogScriptTelemetry",e.ActivateCashback="ActivateRebates",e.AutoApplyStart="AutoApplyStart",e.AutoApplyComplete="AutoApplyComplete",e.AutoApplyClosed="AutoApplyClosed",e.AutoApplyError="AutoApplyError",e.SetAutoApplyState="SetAutoApplyState",e.ImportWhileCheckout="ImportWhileCheckout",e.AutoApplyOptionsStatus="AutoApplyOptionsStatus",e.ExpressCheckoutStart="ExpressCheckoutStart",e.ExpressCheckoutComplete="ExpressCheckoutComplete",e.ExpressCheckoutError="ExpressCheckoutError",e.ExpressCheckoutClosed="ExpressCheckoutClosed",e.SetExpressCheckoutState="SetExpressCheckoutState",e.SetStorageValue="SetStorageValue",e.OtherSellerComplete="OtherSellerComplete",e.OtherSellerError="OtherSellerError",e.OtherSellerClosed="OtherSellerClosed",e.OtherSellerStart="OtherSellerStart",e.SequenceSupported="SequenceSupported",e.ImportCheckboxShown="ImportCheckboxShown",e.TriggerImportFeature="TriggerImportFeature",e.SubscribedToBroadcastChannel="SubscribedToBroadcastChannel",e.ReleaseBackgroundAutoApply="ReleaseBackgroundAutoApply",e.ContinueToZip="ContinueToZip",e.ShoppingIframeRunner="ShoppingIframeRunner",e.UpdatePaymentDetailsComplete="UpdatePaymentDetailsComplete",e.PrintableCouponsStart="PrintableCouponsStart",e.PrintableCouponsComplete="PrintableCouponsComplete",e.PrintableCouponsError="PrintableCouponsError",e.PrintableCouponsClosed="PrintableCouponsClosed",e.OpenFlyout="OpenFlyout",e.EdgeDriverStateChange="EdgeDriverStateChange",e.RetailerPageRefresh="RetailerPageRefresh",e.WalletDrawerLog="WalletDrawerLog",e.ShoprunnerConfirmation="ShoprunnerConfirmation"}(Ae||(Ae={})),function(e){e.UseCoupon="UseCoupon",e.UseRebates="UseRebates"}(Ee||(Ee={})),function(e){e.AutoApplyStarted="AutoApplyStarted",e.AutoApplyFinished="AutoApplyFinished",e.ProgressBarUpdate="ProgressBarUpdate",e.CouponUpdate="CouponUpdate"}(Pe||(Pe={})),function(e){e.FinishAutoApply="FinishAutoApply",e.CancelAutoApply="CancelAutoApply",e.RestartAutoApply="RestartAutoApply"}(we||(we={})),function(e){e.CloseWalletCheckoutPane="CloseWalletCheckoutPane"}(Ie||(Ie={})),function(e){e.AutoApplyCancelled="AutoApplyCancelled",e.AutoApplyFail="AutoApplyFail",e.AutofillFail="AutofillFail",e.ECCancelled="ExpressCheckoutCancelled",e.ECFieldError="ExpressCheckoutFieldError",e.ECFormError="ExpressCheckoutFormError",e.InvalidInput="InvalidInput",e.SelectorError="SelectorError",e.ExecutionError="ExecutionError",e.OverlayError="OverlayError",e.TimeOut="TimeOut",e.Unknown="Unknown",e.Refresh="Refresh",e.IframePaymentFail="IframePaymentFail",e.IframeOriginInvalid="IframeOriginInvalid",e.IframeSelectorNotFound="IframeSelectorNotFound",e.InvalidCartValue="InvalidCartValue",e.CouponAlreadyApplied="CouponAlreadyApplied",e.AutoApplyShortcircuit="AutoApplyShortcircuit"}(De||(De={})),function(e){e.expressCheckout="expressCheckout",e.calculatedCutOffFiltering="calculatedCutOffFiltering",e.useBackgroundAutoApplyResult="useBackgroundAutoApplyResult",e.socialSharingUpdate="socialSharingUpdate",e.onlineSelectorExtraction="onlineSelectorExtraction",e.noCouponsCashbackUpsell="noCouponsCashbackUpsell"}(Oe||(Oe={})),function(e){e.UserId="userId",e.ActiveUrl="activeUrl",e.LocalizedStrings="LocalizedStrings",e.ClientName="ClientName",e.ImportOptions="ImportOptions",e.Icon="Icon",e.AppName="AppName",e.CashBackActive="CashBackActive",e.NudgeTips="NudgeTips",e.CheckoutUserData="CheckoutUserData",e.CheckoutElementsData="CheckoutElementsData",e.ExpressCheckoutState="ExpressCheckoutState",e.BackgroundAutoApply="BackgroundAutoApply",e.ForegroundAutoApply="ForegroundAutoApply",e.FallBackAutoApply="FallBackAutoApply",e.ProductPageBackgroundAutoApply="ProductPageBackgroundAutoApply",e.ApiResponse="ApiResponse",e.UseWalletDrawer="UseWalletDrawer",e.ExpressCheckoutGMVData="ExpressCheckoutGMVData",e.BackgroundAutoApplyState="BackgroundAutoApplyState",e.AutoOpenData="AutoOpenData",e.LastCleanedData="LastCleanedData"}(Te||(Te={}));var Fe=function(e){p(n,e);var t=Me(n);function n(e,r,o,i,a){var s;return c(this,n),v(u(s=t.call(this,M.CheckoutPageMessage)),"Command",void 0),v(u(s),"DomPath",void 0),v(u(s),"DomValue",void 0),v(u(s),"SelectorType",void 0),v(u(s),"AutoApplyScenario",void 0),s.DomPath=r,s.DomValue=o,s.Command=e,s.SelectorType=i,s.AutoApplyScenario=a,s}return s(n)}(ce);function Be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Ne,Le=function(e){p(n,e);var t=Be(n);function n(){return c(this,n),t.call(this,M.EmptyResponse)}return s(n)}(ce);function Ge(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ue(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}!function(e){e.SetValue="SetValue",e.ScrollIntoView="ScrollIntoView",e.Display="Display",e.GetAppliedCoupon="GetAppliedCoupon",e.GetTextValue="GetTextValue",e.setUpMutationObservor="setObserver",e.DisconnectDOMMutationObserver="disconnectObserver",e.SetBoxValue="SetBoxValue",e.CountMatchingElements="QueryPath",e.Click="Click",e.GetInnerText="GetInnerText",e.SelectorName="SelectorName",e.IframeOrigin="IframeOrigin",e.GetCheckedValue="GetCheckedValue",e.GetDisabledValue="GetDisabledValue",e.SetCheckBox="SetCheckBox",e.ExtractInputBox="ExtractInputBox",e.ExtractOrderTotal="ExtractOrderTotal",e.ExtractApplyButton="ExtractApplyButton"}(Ne||(Ne={}));var Ve=function(){function e(){c(this,e)}var n,r,i,a;return s(e,null,[{key:"Sleep",value:function(e){return new Promise((function(t){return setTimeout(t,e)}))}},{key:"StringifyMap",value:function(e,t){return t instanceof Map?{dataType:"Map",value:Array.from(t.entries())}:t}},{key:"ParseMap",value:function(e,t){return"object"===d(t)&&null!==t&&"Map"===t.dataType?new Map(t.value):t}},{key:"WaitForCondition",value:(a=t(o().mark((function t(n,r){var i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(new Date).getTime();case 2:return t.next=4,n();case 4:if(t.t0=!t.sent,!t.t0){t.next=7;break}t.t0=i+r>(new Date).getTime();case 7:if(!t.t0){t.next=12;break}return t.next=10,e.Sleep(100);case 10:t.next=2;break;case 12:return t.next=15,n();case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t)}))),function(e,t){return a.apply(this,arguments)})},{key:"WaitUntilCondition",value:(i=t(o().mark((function t(n,r){var i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(new Date).getTime();case 2:if(!(i+r>(new Date).getTime())){t.next=11;break}return t.next=5,n();case 5:if(!t.sent){t.next=7;break}return t.abrupt("return",!0);case 7:return t.next=9,e.Sleep(100);case 9:t.next=2;break;case 11:return t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t)}))),function(e,t){return i.apply(this,arguments)})},{key:"WaitForSyncCondition",value:(r=t(o().mark((function t(n,r){var i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(new Date).getTime();case 2:if(!(i+r>(new Date).getTime())){t.next=9;break}if(!n()){t.next=5;break}return t.abrupt("return",!0);case 5:return t.next=7,e.Sleep(100);case 7:t.next=2;break;case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t)}))),function(e,t){return r.apply(this,arguments)})},{key:"IsValidDataField",value:function(e){return null!=e&&e.length>0&&"null"!==e}},{key:"IsOnPage",value:function(t,n){if(e.IsValidDataField(t)){var r,o=t.toLowerCase().replace(/\s+/g,"").split(","),i=n.toLowerCase(),a=!1,s=Ge(o);try{for(s.s();!(r=s.n()).done;){var c=r.value;if(i.indexOf(c)>=0){a=!0;break}}}catch(e){s.e(e)}finally{s.f()}return a}return!1}},{key:"ObserveUntil",value:function(e,n){var r=new MutationObserver(t(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e()&&(r.disconnect(),n());case 1:case"end":return t.stop()}}),t)}))));r.observe(document.body,{attributeFilter:["offsetWidth","offsetHeight"],childList:!0,subtree:!0})}},{key:"MeasureExecutionTime",value:(n=t(o().mark((function e(t,n){var r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=performance.now(),e.next=3,t();case 3:return i=performance.now(),a=i-r,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})}]),e}(),_e=Ve,We=function(){function e(t){c(this,e),v(this,"platformSpecific",void 0),v(this,"isBgAAScenario",!1),v(this,"bgAutoApplyCancelled",!1),v(this,"isPDPBgAutoApply",!1),this.platformSpecific=t}var n,r,i;return s(e,[{key:"IsFieldVisible",value:(i=t(o().mark((function e(t,n,r){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_e.IsValidDataField(n)){e.next=7;break}return e.next=3,this.SendDomMessage(t,new Fe(Ne.CountMatchingElements,n,""),r,!1);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",i.NumElements>0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"IsFieldNotDisabled",value:(r=t(o().mark((function e(t,n,r){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_e.IsValidDataField(n)){e.next=7;break}return e.next=3,this.SendDomMessage(t,new Fe(Ne.GetDisabledValue,n,""),r,!1);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",!(null!=i&&i.DisabledValue));case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"SendDomMessage",value:(n=t(o().mark((function e(t,n,r,i){var a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(this.isBgAAScenario||this.isPDPBgAutoApply)&&this.bgAutoApplyCancelled&&ke.ThrowError(De.AutoApplyCancelled,"AutoApply Cancelled"),a=new Le,e.prev=2,e.next=5,this.platformSpecific.SendMessage(n,t);case 5:a=e.sent,e.next=21;break;case 8:if(e.prev=8,e.t0=e.catch(2),!i){e.next=21;break}if(!(n instanceof Fe)){e.next=16;break}throw s=n,Error(ke.GenerateErrorMessage(e.t0.ErrorMsg,r,s.DomPath));case 16:if(!e.t0.ErrorName){e.next=20;break}ke.ThrowError(e.t0.ErrorName,e.t0.ErrorMsg),e.next=21;break;case 20:throw Error(ke.GenerateErrorMessage(e.t0.ErrorMsg,r));case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e,t,r,o){return n.apply(this,arguments)})}]),e}(),He=We;function ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var je=function(e){p(y,e);var n,r,i,a,l,d,h,f,g=ze(y);function y(e,t,n,r,o,i,a){var s;return c(this,y),v(u(s=g.call(this,e)),"overlayService",void 0),v(u(s),"edgeMessageService",void 0),v(u(s),"logService",void 0),v(u(s),"stateService",void 0),v(u(s),"broadcastChannelService",void 0),v(u(s),"entryPointService",void 0),v(u(s),"checkoutPageData",void 0),v(u(s),"checkoutPageUrlData",void 0),v(u(s),"state",void 0),v(u(s),"timeoutHandler",void 0),v(u(s),"contextId",void 0),s.logService=t,s.overlayService=n,s.edgeMessageService=r,s.contextId=N.FromBackground,s.stateService=o,s.broadcastChannelService=i,s.entryPointService=a,s}return s(y,[{key:"CheckIfBgAAIsEnabled",value:function(){return this.checkoutPageUrlData.backgroundAAEnabled&&this.checkoutPageUrlData.edgeEnabled}},{key:"SetUpBackgroundAutoApply",value:(f=t(o().mark((function e(t,n,r,i){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.InitializeCheckoutPageUrlData(t)){e.next=2;break}return e.abrupt("return",!1);case 2:a=this.CheckIfBgAAIsEnabled(),e.t0=n,e.next=e.t0===V.BackgroundAutoApply?6:e.t0===V.ForegroundAutoApply?10:e.t0===V.ProductPageBackgroundAutoApply?18:23;break;case 6:if(!r||!a){e.next=9;break}return this.PrepareBgAutoApplyBackgroundScenario(),e.abrupt("break",25);case 9:return e.abrupt("return",!1);case 10:if(e.t1=a,!e.t1){e.next=15;break}return e.next=14,this.PrepareBgAutoApplyForegroundScenario(t);case 14:e.t1=e.sent;case 15:if(!e.t1){e.next=17;break}return e.abrupt("return",!1);case 17:return e.abrupt("break",25);case 18:if(!i){e.next=21;break}return this.PrepareProductPageBackgroundScenario(),e.abrupt("break",25);case 21:return this.LogError("SetUpBackgroundAutoApply",be.BackgroundAAPDPDisabled,"Called bgaa pdp scenario when exp is off"),e.abrupt("return",!1);case 23:return e.abrupt("break",25);case 25:return e.abrupt("return",!0);case 26:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return f.apply(this,arguments)})},{key:"GetBackgroundAutoApplyScenario",value:function(e,t){return!1===e.web_contents_is_hidden?t?V.ForegroundAutoApply:void 0:!0===e.web_contents_is_hidden?!0===e.is_pdp_scenario?V.ProductPageBackgroundAutoApply:V.BackgroundAutoApply:void 0}},{key:"PrepareBgAutoApplyForegroundScenario",value:(h=t(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,so.GetApplicatorStateService().LoadCouponApplicatorState();case 2:if(this.state=e.sent,!this.state){e.next=11;break}if(!this.state.BackgroundAAStatus.BgAutoApplyInProgress){e.next=8;break}this.state.BackgroundAAStatus.ForegroundApplyingBestCoupon?(so.GetLocalDataService().SaveLocalData(Te.ForegroundAutoApply,!0),n=new ge(this.checkoutPageData,N.FromBackground,ke.GetDomainName(),location.pathname,!1),so.GetBackgroundMessagingService().HandleMessage(n)):this.CreateBroadcastChannel(t,this.state,!0),e.next=9;break;case 8:return e.abrupt("return",!1);case 9:e.next=15;break;case 11:this.state=this.CreateState(),this.ClearUIState(),this.CreateBroadcastChannel(t,this.state);case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"PrepareBgAutoApplyBackgroundScenario",value:function(){so.GetLocalDataService().SaveLocalData(Te.BackgroundAutoApply,!0)}},{key:"PrepareProductPageBackgroundScenario",value:function(){so.GetLocalDataService().SaveLocalData(Te.ProductPageBackgroundAutoApply,!0)}},{key:"CreateBroadcastChannel",value:(d=t(o().mark((function e(t,n,r){var i,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkoutPageData=t,this.InitializeCheckoutPageUrlData(t)){e.next=3;break}return e.abrupt("return");case 3:return this.broadcastChannelService.GetBgAutoApplyChannel(),this.broadcastChannelService.setOnMessageEventHandler((function(e){a.BackgroundAutoApplyMessageHandler(e)})),r||this.SendSubscribedToBroadcastChannelMessage(),this.SetBgAutoApplyTimeout(null!==(i=this.checkoutPageUrlData.backgroundAutoApplyStartTimeout)&&void 0!==i?i:y.StartWaitTime,(function(){a.SwitchToRegularAutoApply()})),e.next=10,this.overlayService.OpenOverlay(this.contextId,n.BackgroundAAStatus.currentCoupon,n.BackgroundAAStatus.couponsTotal,n.MaxDiscount,this.checkoutPageUrlData,n.BackgroundAAStatus.currentCouponIndex,!0);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"SetBgAutoApplyTimeout",value:function(e,t){this.timeoutHandler=window.setTimeout(t,e)}},{key:"ClearBgAutoApplyTimeout",value:function(){this.timeoutHandler&&window.clearTimeout(this.timeoutHandler)}},{key:"ResetBgAutoApplyTimeout",value:function(e,t){this.ClearBgAutoApplyTimeout(),this.SetBgAutoApplyTimeout(e,t)}},{key:"SwitchToRegularAutoApply",value:(l=t(o().mark((function e(){var t,n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ClearBgAutoApplyTimeout(),this.edgeMessageService.SendDestructBgAutoApplyMessage(),this.broadcastChannelService.Close(),t=so.GetApplicatorStateService(),e.next=6,t.LoadCouponApplicatorState();case 6:(n=e.sent)||(n=this.state),n&&(n.BackgroundAAStatus=new Q),t.SaveCouponApplicatorState(n),so.GetLocalDataService().SaveLocalData(Te.FallBackAutoApply,!0),r=new ge(this.checkoutPageData,N.FromBackground,ke.GetDomainName(),location.pathname,!1),so.GetBackgroundMessagingService().HandleMessage(r);case 14:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"CleanUpCancelledAA",value:(a=t(o().mark((function e(){var t,n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.overlayService.CloseOverlay(this.contextId),this.edgeMessageService.SendDestructBgAutoApplyMessage(),t=so.GetLogService(),this.ClearBgAutoApplyTimeout(),this.broadcastChannelService.Close(),e.next=8,this.stateService.LoadCouponApplicatorState();case 8:n=e.sent,r=new ie(ke.GetDomainName(),this.entryPointService.GetEntryPoint()),n?(this.stateService.SaveCouponApplicatorState(null),r=this.GetTelemetryDataFromState(n,D.Cancelled)):r.SetResultData(D.Cancelled,-1,"",[],0,0,!1,U.BackgroundAutoApply),t.LogClientEventV2(b.Information,A.AutoApply,De.AutoApplyCancelled,r,null==n?void 0:n.ImpressionId);case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"SendSubscribedToBroadcastChannelMessage",value:function(){this.edgeMessageService.SendSubscribedToBroadcastChannelMessage()}},{key:"BackgroundAutoApplyMessageHandler",value:(i=t(o().mark((function e(t){var n,r,i,a,s,c,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.checkoutPageUrlData.backgroundAutoApplyInProgressTimeout,this.ResetBgAutoApplyTimeout(null!=n?n:y.InProgressWaitTime,(function(){u.SwitchToRegularAutoApply()})),r=JSON.parse(t.data),i=ne.CreateFromObject(r.state),r.messageType!==Pe.AutoApplyStarted){e.next=7;break}return e.abrupt("return");case 7:if(null!=i){e.next=12;break}throw this.ClearBgAutoApplyTimeout(),this.broadcastChannelService.Close(),this.stateService.SaveCouponApplicatorState(null),new Error("Auto Apply Error");case 12:if(r.messageType!==Pe.AutoApplyFinished){e.next=29;break}if(this.ClearBgAutoApplyTimeout(),r.result!==D.Error){e.next=21;break}return a=r.errorName+":"+r.errorMessage,this.overlayService.ShowResult(this.contextId,D.Error,this.checkoutPageData.retailerData.domainName,a,i,this.checkoutPageData.cashback,U.BackgroundAutoApply,this.checkoutPageData.coupons),this.broadcastChannelService.Close(),this.stateService.SaveCouponApplicatorState(null),e.abrupt("return");case 21:return i.BackgroundAAStatus.ForegroundApplyingBestCoupon=!0,this.stateService.SaveCouponApplicatorState(i),so.GetLocalDataService().SaveLocalData(Te.ForegroundAutoApply,!0),s=new ge(this.checkoutPageData,N.FromBackground,ke.GetDomainName(),location.pathname,!1),so.GetBackgroundMessagingService().HandleMessage(s),e.abrupt("return");case 29:if(c=i.BackgroundAAStatus,r.messageType!==Pe.ProgressBarUpdate){e.next=35;break}return this.stateService.SaveCouponApplicatorState(i),e.next=35,this.SendDomMessage(this.contextId,new le(c.progressBarStartPos,c.progressBarEndPos),"Progress Bar Update",!0);case 35:if(r.messageType!==Pe.CouponUpdate){e.next=40;break}return this.stateService.SaveCouponApplicatorState(i),e.next=40,this.SendDomMessage(this.contextId,new de(c.currentCoupon,c.currentCouponIndex,c.couponsTotal,i.MaxDiscount),"Current Coupon",!0);case 40:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"BackgroundAutoApplyCancelHandler",value:(r=t(o().mark((function e(t){var n,r,i,a,s,c,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ResetBgAutoApplyTimeout(null!==(n=this.checkoutPageUrlData.backgroundAutoApplyCancelTimeout)&&void 0!==n?n:y.CancelWaitTime,(function(){u.CleanUpCancelledAA()})),r=JSON.parse(t.data),i=ne.CreateFromObject(r.state),r.messageType===Pe.AutoApplyFinished){e.next=7;break}return null!=i&&i.BackgroundAACancelled||this.SendCancelMesssageToBgAutoApply(),e.abrupt("return");case 7:if(null!=i){e.next=10;break}return this.LogError("BackgroundAutoApplyCancelHandler",be.UndefinedState,"Got null state in background script message"),e.abrupt("return");case 10:r.result===D.Cancelled&&(this.ClearBgAutoApplyTimeout(),this.broadcastChannelService.Close(),this.stateService.SaveCouponApplicatorState(null),a=this.GetTelemetryDataFromState(i,D.Cancelled),this.logService.LogClientEventV2(b.Information,A.AutoApply,De.AutoApplyCancelled,a,null==i?void 0:i.ImpressionId)),r.result===D.Error&&(this.ClearBgAutoApplyTimeout(),this.broadcastChannelService.Close(),this.stateService.SaveCouponApplicatorState(null),s=r.errorName+":"+r.errorMessage,(c=this.GetTelemetryDataFromState(i,D.Error)).SetErrorData(D.Error,r.errorName),this.logService.LogClientEventV2(b.Information,A.AutoApply,s,c)),this.overlayService.CloseOverlay(this.contextId);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"GetTelemetryDataFromState",value:function(e,t,n){var r,o,i,a,s,c,u,l,p=null!==(r=null==e?void 0:e.MaxDiscount)&&void 0!==r?r:0,d=null!==(o=null==e?void 0:e.InitialPrice)&&void 0!==o?o:0,h=null===(i=e.BestCoupon)||void 0===i?void 0:i.couponCode,f=null!==(a=null===(s=e.BestCoupon)||void 0===s?void 0:s.isStackable)&&void 0!==a&&a,v=null!=e&&e.StartTime?Date.now()-e.StartTime:-1,g=new ie(ke.GetDomainName(),this.entryPointService.GetEntryPoint());return g.SetResultData(t,v,h,null!==(c=null==e?void 0:e.CouponResults)&&void 0!==c?c:[],p,d,f,null!=n?n:U.BackgroundAutoApply),g.SetCurrencyInfo(null!==(u=null==e?void 0:e.Currency)&&void 0!==u?u:"",null!==(l=null==e?void 0:e.PageCurrency)&&void 0!==l?l:""),g}},{key:"SendCancelMesssageToBgAutoApply",value:function(){var e,t=this;this.broadcastChannelService.PostMessage(new ye(we.CancelAutoApply,D.Cancelled)),this.ResetBgAutoApplyTimeout(null!==(e=this.checkoutPageUrlData.backgroundAutoApplyCancelTimeout)&&void 0!==e?e:y.CancelWaitTime,(function(){t.CleanUpCancelledAA()}))}},{key:"LogError",value:function(e,t,n){var r,o,i,a={EntryPoint:null===(r=this.entryPointService)||void 0===r?void 0:r.GetEntryPoint(),FunctionName:e},s=new se(null!==(o=null===(i=this.checkoutPageData)||void 0===i?void 0:i.retailerData.domainName)&&void 0!==o?o:ke.GetDomainName(),null!=t?t:be.BackgroundAAError,a,void 0);this.logService.LogClientErrorV2(null!=n?n:"",s)}},{key:"GetAutoApplyScenario",value:function(){var e=U.AutoApplyCoupons;try{var t=so.GetLocalDataService(),n=t.GetLocaData(Te.BackgroundAutoApply),r=t.GetLocaData(Te.ForegroundAutoApply),o=t.GetLocaData(Te.ProductPageBackgroundAutoApply),i=t.GetLocaData(Te.FallBackAutoApply),a=t.IsFeatureEnabled(Oe.useBackgroundAutoApplyResult);e=o?U.ProductPageBackgroundAutoApply:n||r?U.BackgroundAutoApply:a?U.BackgroundAAResult:i?U.FallBackAutoApply:e}catch(e){}return e}},{key:"CreateState",value:function(){var e=ne.CreateNew(this.contextId,this.checkoutPageData.impressionId);return e.BackgroundAAStatus.couponsTotal=this.checkoutPageData.coupons.length,e.BackgroundAAStatus.currentCoupon=this.checkoutPageData.coupons[0].couponCode,e.BackgroundAAStatus.currentCouponIndex=0,e.BackgroundAAStatus.BgAutoApplyInProgress=!0,e.MaxDiscount=0,e.ImportOptions=so.GetLocalDataService().GetLocaData(Te.ImportOptions),e.CashBackActive=so.GetLocalDataService().GetLocaData(Te.CashBackActive),this.stateService.SaveCouponApplicatorState(e),e}},{key:"InitializeCheckoutPageUrlData",value:function(e){this.checkoutPageData=e;var t=this.checkoutPageData.retailerData.GetCurrentCheckoutPage();if(t)return this.checkoutPageUrlData=t,!0;return this.LogError("InitializeCheckoutPageUrlData",be.AutoApplyWithoutCheckout,"Called BackgroundAAService without checkout page data"),!1}},{key:"ClearUIState",value:(n=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,so.GetApplicatorStateService().SaveUIState(new Re);case 2:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})}]),y}(He);v(je,"StartWaitTime",1e4),v(je,"InProgressWaitTime",45e3),v(je,"CancelWaitTime",1e4);var Je=je,$e=function(){function e(){c(this,e),v(this,"ChannelName","BgAutoApplyChannel"),v(this,"channel",void 0),this.channel=new BroadcastChannel(this.ChannelName)}return s(e,[{key:"GetBgAutoApplyChannel",value:function(){return this.channel||(this.channel=new BroadcastChannel(this.ChannelName)),this.channel}},{key:"PostMessage",value:function(e){this.channel&&this.channel.postMessage(e)}},{key:"GetNewInstance",value:function(){return new BroadcastChannel(this.ChannelName)}},{key:"setOnMessageEventHandler",value:function(e){this.channel&&(this.channel.onmessage=e)}},{key:"Close",value:function(){this.channel&&(this.channel.close(),this.channel=null)}}]),e}(),Ke=function(){function e(){c(this,e)}return s(e,null,[{key:"GetInstance",value:function(){return this.Instance}}]),e}();v(Ke,"Instance",new $e);var Xe=Ke,Ye=s((function e(t,n,r,o,i,a,s,u,l,p){c(this,e),v(this,"Name",void 0),v(this,"Type",void 0),v(this,"Value",void 0),v(this,"IsMandatory",void 0),v(this,"Format",void 0),v(this,"WaitForVisible",void 0),v(this,"WaitForNotDisabled",void 0),v(this,"WaitBefore",void 0),v(this,"WaitAfter",void 0),v(this,"NotAlwaysShown",void 0),this.Name=t,this.Type=n,this.Value=r,this.IsMandatory=o,this.Format=i,this.WaitForVisible=a,this.WaitForNotDisabled=s,this.WaitBefore=u,this.WaitAfter=l,this.NotAlwaysShown=p})),Ze=Ye;function qe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Qe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qe(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var et=s((function e(t,n,r){if(c(this,e),v(this,"PageUrl",void 0),v(this,"Type",void 0),v(this,"CheckoutElements",void 0),this.PageUrl=t,this.Type=n,this.CheckoutElements=new Map,r){var o,i=qe(r);try{for(i.s();!(o=i.n()).done;){var a=o.value;if(a){var s=a.Name,u=a.Value;s&&this.CheckoutElements.set(s,new Ze(s,a.Type,u,a.IsMandatory,a.Format,a.WaitForVisible,a.WaitForNotDisabled,a.WaitBefore,a.WaitAfter,a.NotAlwaysShown))}}}catch(e){i.e(e)}finally{i.f()}}}));function tt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var rt=function(){function e(t){if(c(this,e),v(this,"DomainName",void 0),v(this,"AllcheckoutCompletionPages",void 0),v(this,"AllCheckoutCompletionPagesStr",void 0),v(this,"IsExpressCheckoutEnabled",void 0),v(this,"CheckoutPageUrl",void 0),t){this.DomainName=t.domainName,this.CheckoutPageUrl=t.checkoutPageUrl,this.IsExpressCheckoutEnabled=t.isExpressCheckoutEnabled;var n=t.allCheckoutCompletionPagesStr;this.AllCheckoutCompletionPagesStr=n,n&&(this.AllcheckoutCompletionPages=e.CreateMap(n))}}return s(e,null,[{key:"CreateMap",value:function(e){var t,n=JSON.parse(atob(e)),r=new Map,o=tt(n);try{for(o.s();!(t=o.n()).done;){var i=t.value;if(i){var a=i.Type;a&&r.set(a,new et(i.PageUrl,a,i.checkoutElements))}}}catch(e){o.e(e)}finally{o.f()}return r}}]),e}();function ot(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var it,at,st=function(e){p(n,e);var t=ot(n);function n(e,r){var o;return c(this,n),v(u(o=t.call(this)),"Status",void 0),v(u(o),"EntryPoint",void 0),v(u(o),"Domain",void 0),v(u(o),"ECProcessTime",void 0),v(u(o),"ECType",void 0),o.Status=e,o.ECProcessTime=0,o.EntryPoint=null!=r?r:J.Shopping,o}return s(n)}(re);!function(e){e.AutoApplyDone="AutoApplyDone",e.AutoApplyProgress="AutoApplyProgress",e.AddressDone="AddressDone",e.PaymentDone="PaymentDone",e.CancelEC="CancelExpressCheckout",e.FieldError="FieldError",e.BNPLPaymentSuccess="BNPLPaymentSuccess",e.BNPLPaymentFail="BNPLPaymentFail",e.BillingAddressStart="BillingAddressStart",e.BillingAddressSuccess="BillingAddressSuccess",e.BillingAddressFail="BillingAddressFail"}(it||(it={})),function(e){e.Start="START",e.Success="SUCCESS",e.Error="ERROR",e.Cancelled="CANCELLED",e.BNPLSuccess="BNPLSuccess",e.BNPLFailed="BNPLFailed"}(at||(at={}));var ct,ut=function(){function e(){c(this,e),v(this,"Guid",void 0),v(this,"Email",void 0),v(this,"FirstName",void 0),v(this,"MiddleName",void 0),v(this,"LastName",void 0),v(this,"FullName",void 0),v(this,"AddressLines",void 0),v(this,"City",void 0),v(this,"State",void 0),v(this,"Country",void 0),v(this,"Zip",void 0),v(this,"PhoneNumber",void 0),v(this,"Honorific",void 0)}return s(e,[{key:"UpdateFields",value:function(e,t,n,r,o,i,a,s,c,u,l,p,d){this.Guid=d,this.Email=e,this.FirstName=t,this.MiddleName=n,this.LastName=r,this.FullName=o,this.AddressLines=i,this.City=a,this.State=s,this.Country=c,this.Zip=u,this.PhoneNumber=l,this.Honorific=p}}],[{key:"CreateFromCheckoutData",value:function(t){var n,r=t.cardholder;return null!=r&&r.address1&&(n=new e).UpdateFields("",r.firstName,r.middleName,r.lastName,r.name,r.address1+"\n"+r.address2,r.city,r.state,r.country,r.postalCode,"","",""),n}},{key:"CreateFromSettingsData",value:function(t){var n,r,o=new e;return o.UpdateFields(null===(n=t.Emails)||void 0===n?void 0:n[0],t.FirstName,t.MiddleName,t.LastName,t.FullName,t.AddressLines,t.City,t.State,t.Country,t.Zip,null===(r=t.PhoneNumbers)||void 0===r?void 0:r[0],t.Honorific,t.Guid),o}}]),e}(),lt=function(){function e(t){var n,r,o,i,a,s;c(this,e),v(this,"Guid",void 0),v(this,"Emails",void 0),v(this,"FirstName",void 0),v(this,"MiddleName",void 0),v(this,"LastName",void 0),v(this,"FullName",void 0),v(this,"AddressLines",void 0),v(this,"City",void 0),v(this,"State",void 0),v(this,"Country",void 0),v(this,"Zip",void 0),v(this,"PhoneNumbers",void 0),v(this,"Honorific",void 0),this.UpdateFields(t.guid,t.emailAddresses,null!==(n=null===(r=t.fullNameSplit)||void 0===r?void 0:r.firstName)&&void 0!==n?n:"",null!==(o=null===(i=t.fullNameSplit)||void 0===i?void 0:i.middleName)&&void 0!==o?o:"",null!==(a=null===(s=t.fullNameSplit)||void 0===s?void 0:s.lastName)&&void 0!==a?a:"",t.fullNames,t.honorific,t.addressLines,t.addressLevel2,t.addressLevel1,t.countryCode,t.postalCode,t.phoneNumbers)}return s(e,[{key:"UpdateFields",value:function(e,t,n,r,o,i,a,s,c,u,l,p,d){this.Guid=e,this.Emails=t,this.FirstName=n,this.MiddleName=r,this.LastName=o,this.FullName=null==i?void 0:i[0],this.AddressLines=s,this.City=c,this.State=u,this.Country=l,this.Zip=p,this.PhoneNumbers=d,this.Honorific=a}}]),e}(),pt=function(){function e(){c(this,e),v(this,"Guid",void 0),v(this,"ExpMonth",void 0),v(this,"ExpYear",void 0),v(this,"FullName",void 0),v(this,"CardNumber",void 0),v(this,"CardType",void 0),v(this,"CardCVC",void 0),v(this,"Address",void 0),v(this,"FirstName",""),v(this,"MiddleName",""),v(this,"LastName","")}return s(e,[{key:"UpdateFields",value:function(e,t,n,r,o,i,a,s){if(this.Guid=e,this.ExpMonth=t,this.ExpYear=n,this.FullName=r,this.CardNumber=o,this.CardType=i,this.CardCVC=null!=a?a:"",this.Address=s?ut.CreateFromSettingsData(new lt(s)):void 0,r){var c,u,l,p=r.split(" ");this.FirstName=null!==(c=p.shift())&&void 0!==c?c:"",this.LastName=null!==(u=p.pop())&&void 0!==u?u:"",this.MiddleName=null!==(l=p[0])&&void 0!==l?l:""}}}],[{key:"CreateFromCheckoutData",value:function(t){var n=t.card,r=t.cardholder,o=z[n.brand.toUpperCase().trim()],i=new e;return i.UpdateFields("",n.expirationMonth,n.expirationYear,null==r?void 0:r.name,n.number,o,n.cvc),i}},{key:"CreateFromSettingsData",value:function(t){var n=new e;return n.UpdateFields(t.Guid,t.ExpMonth,t.ExpYear,t.FullName,t.CardNumber,t.CardType,t.Cvv,t.Address),n}}]),e}(),dt=function(){function e(){c(this,e),v(this,"Profile",void 0),v(this,"Payment",void 0),v(this,"paymentGuid",void 0),v(this,"profileGuid",void 0),v(this,"SkipAutoApply",void 0),v(this,"IsSkipPayment",void 0),v(this,"IsSkipProfile",void 0),v(this,"BNPLProvider",void 0),v(this,"TotalAmountDialogData",void 0)}return s(e,[{key:"ToString",value:function(){return JSON.stringify(this)}}]),e}(),ht=function(){function e(t,n,r,o,i,a){c(this,e),v(this,"checkoutService",void 0),v(this,"contextId",void 0),v(this,"localDataService",void 0),v(this,"edgeMessageService",void 0),v(this,"overlayService",void 0),v(this,"logService",void 0),v(this,"entryPointService",void 0),this.checkoutService=t,this.contextId=N.FromBackground,this.localDataService=n,this.edgeMessageService=r,this.overlayService=o,this.logService=i,this.entryPointService=a}var n;return s(e,[{key:"UpdatePaymentDetails",value:(n=t(o().mark((function e(t,n){var r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.localDataService.SaveLocalData(Te.ExpressCheckoutState,it.AddressDone),r=new rt(t),i=this.GetUserData(n),a=Date.now(),e.prev=4,e.next=7,this.overlayService.OpenExpressCheckoutUpdatePaymentOverlay(this.contextId);case 7:return e.next=9,this.checkoutService.UpdatePaymentDetails(this.contextId,r,i);case 9:return e.next=11,this.checkoutService.UpdateBillingAddressDetails(this.contextId,r,i);case 11:if(this.edgeMessageService.SendUpdatePaymentDetailsResultMessage(!0),this.LogUpdatePaymentDetailsStatus(!0,a,r.DomainName),!this.EntryPointIsWallet()){e.next=17;break}return this.edgeMessageService.SendEdgeDriverStateChangeMessage(it.BNPLPaymentSuccess),e.next=17,this.overlayService.CloseWalletDrawer(this.contextId);case 17:e.next=28;break;case 19:if(e.prev=19,e.t0=e.catch(4),this.edgeMessageService.SendUpdatePaymentDetailsResultMessage(!1),this.LogUpdatePaymentDetailsStatus(!1,a,r.DomainName,e.t0),!this.EntryPointIsWallet()){e.next=28;break}return this.edgeMessageService.SendEdgeDriverStateChangeMessage(it.BNPLPaymentFail),e.next=28,this.overlayService.CloseWalletDrawer(this.contextId);case 28:return e.next=30,this.overlayService.CloseOverlay(this.contextId);case 30:case"end":return e.stop()}}),e,this,[[4,19]])}))),function(e,t){return n.apply(this,arguments)})},{key:"EntryPointIsWallet",value:function(){return this.entryPointService.GetEntryPoint()===J.Wallet}},{key:"GetUserData",value:function(e){var t=new dt;return t.Payment=pt.CreateFromCheckoutData(e),t.Profile=ut.CreateFromCheckoutData(e),t}},{key:"LogUpdatePaymentDetailsStatus",value:function(e,t,n,r){var o=new st(e?at.BNPLSuccess:at.BNPLFailed,this.entryPointService.GetEntryPoint());if(o.ECProcessTime=Date.now()-t,o.ECType=j.ECWithBNPL,this.logService.LogClientEventV2(b.Information,A.ExpressCheckout,"UpdatePaymentDetails",o),!e&&r){var i=new se(n,be.ExpressCheckoutBNPLFailed,{EntryPoint:this.entryPointService.GetEntryPoint()},r.stack);this.logService.LogClientErrorV2("UpdatePaymentDetails failed",i)}}}]),e}(),ft=ht,vt=function(){function e(){c(this,e),v(this,"IsAutoApplyIncluded",void 0),v(this,"CheckoutProgress",void 0),v(this,"IsShippingOptionsDone",void 0),v(this,"CouponApplicatorState",void 0)}return s(e,[{key:"ToString",value:function(){return this.CouponApplicatorState&&this.CouponApplicatorState.StringifyMap(),JSON.stringify(this)}}],[{key:"CreateFromObject",value:function(t){var n=new e;return t&&(void 0!==t.IsAutoApplyIncluded&&(n.IsAutoApplyIncluded=t.IsAutoApplyIncluded),void 0!==t.CheckoutProgress&&(n.CheckoutProgress=t.CheckoutProgress),void 0!==t.IsShippingOptionsDone&&(n.IsShippingOptionsDone=t.IsShippingOptionsDone),t.CouponApplicatorState&&(n.CouponApplicatorState=ne.CreateFromObject(t.CouponApplicatorState))),n}}]),e}();!function(e){e.Apply="Apply",e.Continue="Continue",e.ClickBefore="ClickBefore",e.Confirm="Confirm",e.LayoutClick="LayoutClick",e.FieldError="FieldError",e.FormError="FormError",e.IframeName="IframeName",e.IframeOrigin="IframeOrigin",e.CheckedValue="CheckedValue"}(ct||(ct={}));var gt,yt=ct;!function(e){e.CCNUpdate="CCNUpdate",e.CCName="CCName",e.CCExpiry="CCExpiry",e.CCSecurityCode="CCSecurityCode"}(gt||(gt={}));var St,mt,Ct=function(e){var t=function(){var e=new Map;return e.set("ALABAMA","AL"),e.set("ALASKA","AK"),e.set("ARIZONA","AZ"),e.set("ARKANSAS","AR"),e.set("CALIFORNIA","CA"),e.set("COLORADO","CO"),e.set("CONNECTICUT","CT"),e.set("DELAWARE","DE"),e.set("DISTRICT OF COLUMBIA","DC"),e.set("WASHINGTON DC","DC"),e.set("FLORIDA","FL"),e.set("GEORGIA","GA"),e.set("HAWAII","HI"),e.set("IDAHO","ID"),e.set("ILLINOIS","IL"),e.set("INDIANA","IN"),e.set("IOWA","IA"),e.set("KANSAS","KS"),e.set("KENTUCKY","KY"),e.set("LOUISIANA","LA"),e.set("MAINE","ME"),e.set("MARYLAND","MD"),e.set("MASSACHUSETTS","MA"),e.set("MICHIGAN","MI"),e.set("MINNESOTA","MN"),e.set("MISSISSIPPI","MS"),e.set("MISSOURI","MO"),e.set("MONTANA","MT"),e.set("NEBRASKA","NE"),e.set("NEVADA","NV"),e.set("NEW HAMPSHIRE","NH"),e.set("NEW JERSEY","NJ"),e.set("NEW MEXICO","NM"),e.set("NEW YORK","NY"),e.set("NORTH CAROLINA","NC"),e.set("NORTH DAKOTA","ND"),e.set("OHIO","OH"),e.set("OKLAHOMA","OK"),e.set("OREGON","OR"),e.set("PENNSYLVANIA","PA"),e.set("RHODE ISLAND","RI"),e.set("SOUTH CAROLINA","SC"),e.set("SOUTH DAKOTA","SD"),e.set("TENNESSEE","TN"),e.set("TEXAS","TX"),e.set("UTAH","UT"),e.set("VERMONT","VT"),e.set("VIRGINIA","VA"),e.set("WASHINGTON","WA"),e.set("WEST VIRGINIA","WV"),e.set("WISCONSIN","WI"),e.set("WYOMING","WY"),e.set("VIRGIN ISLANDS","VI"),e.set("U.S. VIRGIN ISLANDS","VI"),e.set("PALAU","PW"),e.set("N. MARIANA ISLANDS","MP"),e.set("NORTHERN MARIANA ISLANDS","MP"),e.set("GUAM","GU"),e.set("AMERICAN SAMOA","AS"),e.set("MICRONESIA","FM"),e.set("MARSHALL ISLANDS","MH"),e}(),n=new Set(t.values()),r=e.toUpperCase();if(n.has(r))return[r,!0];var o=t.get(r);return void 0!==o?[o,!0]:[r,!1]};function xt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return kt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}!function(e){e.ClickBefore="clickBefore",e.FirstName="firstName",e.MiddleName="middleName",e.LastName="lastName",e.Name="name",e.Address1="address1",e.Address2="address2",e.City="city",e.State="state",e.ZipCode="zipCode",e.Continue="continue",e.Confirm="confirm",e.FieldError="fieldError",e.FormError="formError",e.CardType="cardType",e.ExpiryMonth="expiryMonth",e.ExpiryYear="expiryYear",e.ExpiryDate="expiryDate",e.Email="email",e.ConfirmEmail="confirmEmail",e.RefreshAfterContinue="refreshAfterContinue",e.Check="check",e.Signup="signUp"}(St||(St={})),function(e){e.ShippingAddress="ShippingAddress",e.ContactInfo="ContactInfo",e.ShippingOptions="ShippingOptions",e.Payment="Payment",e.PaymentIframe="PaymentIframe"}(mt||(mt={}));var At=function(e){p(M,e);var n,r,i,a,l,d,h,f,g,y,S,m,C,x,k,E,P,w,I,D,O,T,R=bt(M);function M(e,t,n,r,o,i){var a;return c(this,M),v(u(a=R.call(this,e)),"localDataService",void 0),v(u(a),"overlayService",void 0),v(u(a),"edgeMessageService",void 0),v(u(a),"logService",void 0),v(u(a),"entryPointService",void 0),v(u(a),"shippingAddresskey","ShippingAddress"),v(u(a),"billingAddresskey","BillingAddress"),v(u(a),"paymentKey","Payment"),v(u(a),"contextId",void 0),v(u(a),"expressCheckoutState",void 0),v(u(a),"startTime",void 0),v(u(a),"domainName",void 0),v(u(a),"ccResponseMap",void 0),v(u(a),"ccwaitingguids",void 0),v(u(a),"allowedIfameOrigins",void 0),v(u(a),"iframeEventHandler",void 0),v(u(a),"selectorsNotFound",void 0),a.localDataService=t,a.overlayService=n,a.edgeMessageService=r,a.logService=o,a.entryPointService=i,a.contextId=N.FromBackground,a.expressCheckoutState=new vt,a.ccResponseMap=new Map,a.ccwaitingguids=new Set,a.allowedIfameOrigins=new Set,a.iframeEventHandler=a.IframeEventHandler.bind(u(a)),a.selectorsNotFound=[],a}return s(M,[{key:"StartExpressCheckout",value:(T=t(o().mark((function e(){var n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.StartExpressCheckoutAsync().catch(function(){var e=t(o().mark((function e(r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||r.ErrorName!==De.ECCancelled){e.next=6;break}n.LogECEvent(at.Cancelled),n.edgeMessageService.SendExpressCheckoutClosedMessage(),e.next=15;break;case 6:if(!r){e.next=15;break}if(r.ErrorName!==De.Refresh){e.next=12;break}setTimeout(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,n.HandleError(r);case 3:case"end":return e.stop()}}),e)}))),8e3),e.next=15;break;case 12:return e.next=15,n.HandleError(r);case 15:case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"HandleError",value:(O=t(o().mark((function e(t){var n,r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.expressCheckoutState.CheckoutProgress=it.FieldError,this.LogECEvent(at.Error,JSON.stringify(t)),this.edgeMessageService.SendExpressCheckoutErrorMessage(),!this.EntryPointIsWallet()){e.next=8;break}return a=JSON.stringify({ErrorMsg:t.ErrorMsg,ErrorName:t.ErrorName,SelectorsNotFound:this.selectorsNotFound}),this.edgeMessageService.SendEdgeDriverStateChangeMessage(De.AutofillFail,JSON.stringify({reason:a})),e.next=8,this.overlayService.CloseWalletDrawer(this.contextId);case 8:return e.next=10,this.overlayService.ShowExpressCheckoutResult(this.contextId,!0,this.expressCheckoutState.IsAutoApplyIncluded,null===(n=this.expressCheckoutState.CouponApplicatorState)||void 0===n?void 0:n.BestCoupon,null===(r=this.expressCheckoutState.CouponApplicatorState)||void 0===r?void 0:r.InitialPrice,null===(i=this.expressCheckoutState.CouponApplicatorState)||void 0===i?void 0:i.MaxDiscount,this.expressCheckoutState.CheckoutProgress);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"StartExpressCheckoutAsync",value:(D=t(o().mark((function e(){var t,n,r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.startTime=Date.now(),i=this.localDataService.GetLocaData(Te.CheckoutElementsData),this.domainName=i.DomainName,(a=this.localDataService.GetLocaData(Te.ExpressCheckoutState))?this.expressCheckoutState=a:(this.LogECEvent(at.Start),this.expressCheckoutState.IsAutoApplyIncluded=!1,this.expressCheckoutState.CouponApplicatorState=null),e.next=7,this.overlayService.OpenExpressCheckoutOverlay(this.contextId,this.expressCheckoutState.IsAutoApplyIncluded,this.expressCheckoutState.CheckoutProgress);case 7:return this.edgeMessageService.SendExpressCheckoutStartMessage(),e.next=10,this.ApplyCheckoutUserData(N.FromBackground,i);case 10:this.edgeMessageService.SendExpressCheckoutCompletedMessage(),this.LogECEvent(at.Success),this.overlayService.ShowExpressCheckoutResult(this.contextId,!0,this.expressCheckoutState.IsAutoApplyIncluded,null===(t=this.expressCheckoutState.CouponApplicatorState)||void 0===t?void 0:t.BestCoupon,null===(n=this.expressCheckoutState.CouponApplicatorState)||void 0===n?void 0:n.InitialPrice,null===(r=this.expressCheckoutState.CouponApplicatorState)||void 0===r?void 0:r.MaxDiscount,this.expressCheckoutState.CheckoutProgress);case 14:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"ApplyCheckoutUserDataFromAutoApplyAsync",value:(I=t(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.expressCheckoutState.CouponApplicatorState=n,this.expressCheckoutState.IsAutoApplyIncluded=!0,this.expressCheckoutState.CheckoutProgress=it.AutoApplyDone,r=this.localDataService.GetLocaData(Te.CheckoutElementsData),this.startTime=Date.now(),this.domainName=r.DomainName,this.LogECEvent(at.Start),e.next=9,_e.Sleep(2e3);case 9:return this.edgeMessageService.SendExpressCheckoutStartMessage(),e.next=12,this.ApplyCheckoutUserData(t,r);case 12:this.LogECEvent(at.Success),this.edgeMessageService.SendExpressCheckoutCompletedMessage();case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"ApplyCheckoutUserData",value:(w=t(o().mark((function e(t,n){var r,i,a,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.localDataService.GetLocaData(Te.CheckoutUserData),i=r.IsSkipPayment,r.IsSkipProfile){e.next=13;break}return e.next=5,this.UpdateContactDetails(t,n,r);case 5:if(this.expressCheckoutState.CheckoutProgress&&this.expressCheckoutState.CheckoutProgress!==it.AutoApplyDone){e.next=8;break}return e.next=8,this.UpdateShippingAddressDetails(t,n,r);case 8:if(this.expressCheckoutState.IsShippingOptionsDone){e.next=11;break}return e.next=11,this.UpdateShippingOptions(t,n);case 11:this.EntryPointIsWallet()&&this.edgeMessageService.SendEdgeDriverStateChangeMessage(it.AddressDone),this.overlayService.UpdateCheckoutProgress(N.FromBackground,it.AddressDone);case 13:if(i){e.next=22;break}return e.next=16,this.UpdatePaymentDetails(t,n,r);case 16:if(s=null==r||null===(a=r.Payment)||void 0===a?void 0:a.Address,!this.EntryPointIsWallet()){e.next=22;break}return s&&((c=new dt).Profile=s),e.next=21,this.UpdateBillingAddressDetails(t,n,c);case 21:this.edgeMessageService.SendEdgeDriverStateChangeMessage(it.PaymentDone);case 22:if(!this.EntryPointIsWallet()){e.next=25;break}return e.next=25,this.overlayService.CloseWalletDrawer(t);case 25:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"UpdatePaymentDetails",value:(P=t(o().mark((function e(t,n,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.AllcheckoutCompletionPages.get(mt.PaymentIframe)){e.next=6;break}return e.next=4,this.UpdatePaymentIframeDetails(t,n,r);case 4:e.next=8;break;case 6:return e.next=8,this.UpdatePaymentCardDetails(t,n,r);case 8:return e.next=10,this.overlayService.UpdateCheckoutProgress(t,it.PaymentDone);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return P.apply(this,arguments)})},{key:"UpdatePaymentCardDetails",value:(E=t(o().mark((function e(n,r,i){var a,s,c,u,l,p,d,h,f,v,g,y,S,m,C,x,k,b,A,E,P,w,I,D,O=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.AllcheckoutCompletionPages.get(this.paymentKey),c=i.Profile,u=null!==(a=null==c?void 0:c.Email)&&void 0!==a?a:"",null==s||!s.CheckoutElements||!i.Payment){e.next=73;break}if(l=i.Payment,!(p=s.CheckoutElements.get("WaitBeforePayment"))){e.next=9;break}return e.next=9,_e.Sleep(Number(p.Value));case 9:if(!(d=s.CheckoutElements.get("clickBefore"))){e.next=13;break}return e.next=13,this.ClickButtonWithWaiting(n,d,"Payment",void 0,void 0,void 0,2e3);case 13:if(!(h=s.CheckoutElements.get("visible"))){e.next=17;break}return e.next=17,this.SendCheckoutDomMessage(n,new Fe(Ne.Display,h.Value,""),"Visible",!1);case 17:if(!(f=s.CheckoutElements.get("cardNumber"))){e.next=31;break}return e.next=21,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.IsFieldVisible(n,f.Value,"cardNumber FieldVisible");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),f.WaitForVisible||8e3);case 21:return e.next=23,this.IsFieldVisible(n,f.Value,"cardNumber FieldVisible");case 23:if(e.sent){e.next=27;break}throw this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(f,"Payment")),new xe("cardNumber field is not visible",De.ExecutionError);case 27:return e.next=29,this.GetElementAndSetValue(s,St.CardType,l.CardType,"CardType","Payment");case 29:return e.next=31,this.SendCheckoutDomMessage(n,new Fe(Ne.SetBoxValue,f.Value,l.CardNumber),"cardNumber",!1);case 31:return e.next=33,this.GetElementAndSetValue(s,St.Name,l.FullName,"Card Name","Payment");case 33:return e.next=35,this.GetElementAndSetValue(s,St.FirstName,l.FirstName,"Card First Name","Payment");case 35:return e.next=37,this.GetElementAndSetValue(s,St.MiddleName,l.MiddleName,"Card Middle Name","Payment");case 37:return e.next=39,this.GetElementAndSetValue(s,St.LastName,l.LastName,"Card Last Name","Payment");case 39:if(!(v=s.CheckoutElements.get(St.ExpiryMonth))){e.next=46;break}return g=v.Format,y=l.ExpMonth,"M"===g&&(y=null===(S=parseInt(l.ExpMonth,10))||void 0===S?void 0:S.toString()),e.next=46,this.SetValue(v,y,"expiryMonth","Payment");case 46:if(!(m=s.CheckoutElements.get(St.ExpiryYear))){e.next=53;break}return C=m.Format,x=l.ExpYear,"YY"===C&&(x=null===(k=l.ExpYear)||void 0===k?void 0:k.slice(-2)),e.next=53,this.SetValue(m,x,"expiryYear","Payment");case 53:if(!(b=s.CheckoutElements.get(St.ExpiryDate))){e.next=60;break}return A=b.Format,E=l.ExpMonth+"/"+l.ExpYear,"1"!==A&&"MM/YY"!==A||(E=l.ExpMonth+"/"+(null===(P=l.ExpYear)||void 0===P?void 0:P.slice(-2))),e.next=60,this.SetValue(b,E,"expiryDate","Payment");case 60:return e.next=62,this.GetElementAndSetValue(s,St.Email,u,"Email update","Payment");case 62:return e.next=64,this.GetElementAndSetValue(s,St.ConfirmEmail,u,"Confirm Email","Payment");case 64:if(w=s.CheckoutElements.get("securityCode"),I=l.CardCVC,!w||!I){e.next=69;break}return e.next=69,this.SetValue(w,I,"securityCode","Payment");case 69:if(!(D=null==s?void 0:s.CheckoutElements.get(St.Continue))){e.next=73;break}return e.next=73,this.ClickButtonWithWaiting(n,D,"Payment",1e3,1e3);case 73:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return E.apply(this,arguments)})},{key:"UpdateBillingAddressDetails",value:(k=t(o().mark((function e(n,r,i){var a,s,c,u,l,p,d,h,f,v,g,y,S,m=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null==i?void 0:i.Profile,this.EntryPointIsWallet()&&a&&this.edgeMessageService.SendEdgeDriverStateChangeMessage(it.BillingAddressStart),e.prev=2,null==(s=r.AllcheckoutCompletionPages.get(this.billingAddresskey))||!s.CheckoutElements){e.next=62;break}if(!(c=null==s?void 0:s.CheckoutElements.get("WaitBeforeBillingAddress"))){e.next=9;break}return e.next=9,_e.Sleep(Number(c.Value));case 9:if(!(u=null==s?void 0:s.CheckoutElements.get("clickBefore"))){e.next=14;break}return e.next=14,this.ClickButtonWithWaiting(n,u,"BillingAddress");case 14:if(l=null==s?void 0:s.CheckoutElements.get("useDifferentAddress"),p=null==s?void 0:s.CheckoutElements.get("useShippingAddress"),d=null==s?void 0:s.CheckoutElements.get("useDifferentAddressLabel"),h=null==s?void 0:s.CheckoutElements.get("useShippingAddressLabel"),"inputRadio"!==(null==l?void 0:l.Type)||"inputRadio"!==(null==p?void 0:p.Type)||!d||!h){e.next=23;break}return e.next=21,this.Click(a?d.Value:h.Value,yt.Continue);case 21:e.next=31;break;case 23:if(!l||p){e.next=28;break}return e.next=26,this.ChangeUseDifferentAddressCheckedStatus(l,d,a);case 26:e.next=31;break;case 28:if(!p||l){e.next=31;break}return e.next=31,this.ChangeUseShippingAddressCheckedStatus(p,h,a);case 31:if(!a){e.next=58;break}if(!(f=s.CheckoutElements.get(St.Address1))){e.next=42;break}return e.next=36,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.IsFieldVisible(n,f.Value,"IsAddress FieldVisible");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),f.WaitForVisible||8e3);case 36:return e.next=38,this.IsFieldVisible(n,f.Value,"IsAddress FieldVisible");case 38:if(e.sent){e.next=42;break}throw this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(f,"BillingAddress")),new xe("Address1 field is not visible",De.ExecutionError);case 42:v=xt(s.CheckoutElements.keys()),e.prev=43,y=o().mark((function e(){var r,i,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.value,!(i=s.CheckoutElements.get(r))){e.next=19;break}if(c=m.GetProfileData(a,i.Name,i.Format),"input"!==i.Type&&"dropdown"!==i.Type){e.next=19;break}if(!c){e.next=19;break}if(!i.WaitForVisible){e.next=9;break}return e.next=9,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.IsFieldVisible(n,i.Value,"is ".concat(i.Name," Visible"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),i.WaitForVisible);case 9:return e.next=11,m.IsFieldVisible(n,i.Value,"is ".concat(i.Name," Visible"));case 11:if(!e.sent){e.next=18;break}return e.next=16,m.TypeCheckoutFieldData(i.Value,c);case 16:e.next=19;break;case 18:m.selectorsNotFound.push(m.GetSelectorsNotFoundItem(i,"BillingAddress"));case 19:case"end":return e.stop()}}),e)})),v.s();case 46:if((g=v.n()).done){e.next=50;break}return e.delegateYield(y(),"t0",48);case 48:e.next=46;break;case 50:e.next=55;break;case 52:e.prev=52,e.t1=e.catch(43),v.e(e.t1);case 55:return e.prev=55,v.f(),e.finish(55);case 58:if(!(S=null==s?void 0:s.CheckoutElements.get("continue"))){e.next=62;break}return e.next=62,this.ClickButtonWithWaiting(n,S,"BillingAddress",3e3,3e3);case 62:this.EntryPointIsWallet()&&a&&this.edgeMessageService.SendEdgeDriverStateChangeMessage(it.BillingAddressSuccess),e.next=72;break;case 65:if(e.prev=65,e.t2=e.catch(2),!this.EntryPointIsWallet()||!a){e.next=71;break}this.edgeMessageService.SendEdgeDriverStateChangeMessage(it.BillingAddressFail),e.next=72;break;case 71:throw e.t2;case 72:case"end":return e.stop()}}),e,this,[[2,65],[43,52,55,58]])}))),function(e,t,n){return k.apply(this,arguments)})},{key:"ChangeUseDifferentAddressCheckedStatus",value:(x=t(o().mark((function e(t,n,r){var i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(this.contextId,new Fe(Ne.GetCheckedValue,t.Value,"",yt.CheckedValue),"get useDifferentAddress checked value",!1);case 2:if(a=e.sent,s=null!==(i=null==a?void 0:a.CheckedValue)&&void 0!==i?i:"","checkBox"!==t.Type||!n){e.next=10;break}if(!(s&&!r||!s&&r)){e.next=8;break}return e.next=8,this.Click(n.Value,yt.Continue);case 8:e.next=14;break;case 10:if(!r){e.next=14;break}return e.next=14,this.Click(t.Value,yt.Continue);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return x.apply(this,arguments)})},{key:"ChangeUseShippingAddressCheckedStatus",value:(C=t(o().mark((function e(t,n,r){var i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(this.contextId,new Fe(Ne.GetCheckedValue,t.Value,"",yt.CheckedValue),"get useShippingAddress checked value",!1);case 2:if(a=e.sent,s=null!==(i=null==a?void 0:a.CheckedValue)&&void 0!==i?i:"","checkBox"!==t.Type||!n){e.next=10;break}if(!(s&&r||!s&&!r)){e.next=8;break}return e.next=8,this.Click(n.Value,yt.Continue);case 8:e.next=14;break;case 10:if(r){e.next=14;break}return e.next=14,this.Click(t.Value,yt.Continue);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return C.apply(this,arguments)})},{key:"EntryPointIsWallet",value:function(){return this.entryPointService.GetEntryPoint()===J.Wallet}},{key:"GetElementAndSetValue",value:(m=t(o().mark((function e(t,n,r,i,a){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(s=t.CheckoutElements.get(n))&&this.SetValue(s,r,i,a);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o){return m.apply(this,arguments)})},{key:"SetValue",value:(S=t(o().mark((function e(n,r,i,a){var s=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.WaitForVisible){e.next=3;break}return e.next=3,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.IsFieldVisible(s.contextId,n.Value,"is ".concat(n.Name," visible"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),n.WaitForVisible);case 3:return e.next=5,this.IsFieldVisible(this.contextId,n.Value,"is ".concat(n.Name," visible"));case 5:if(!e.sent){e.next=11;break}return e.next=9,this.SendCheckoutDomMessage(this.contextId,new Fe(Ne.SetBoxValue,n.Value,r),i,!1);case 9:e.next=12;break;case 11:this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(n,a));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return S.apply(this,arguments)})},{key:"getECTypeMetrics",value:function(){var e=this.localDataService.GetLocaData(Te.CheckoutUserData),t=e.BNPLProvider,n=e.IsSkipPayment&&!t;return t?j.ECWithBNPL:n?j.ECWithoutPayment:j.ExpressCheckout}},{key:"LogECEvent",value:function(e,t){var n=new st(e,this.entryPointService.GetEntryPoint()),r=void 0!==this.startTime?Date.now()-this.startTime:0;n.ECProcessTime=r,n.Domain=this.domainName,n.ECType=this.getECTypeMetrics(),this.logService.LogClientEventV2(b.Information,A.ExpressCheckout,null!=t?t:"",n)}},{key:"UpdateContactDetails",value:(y=t(o().mark((function e(n,r,i){var a,s,c,u,l,p,d,h,f,v,g,y=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.AllcheckoutCompletionPages.get(mt.ContactInfo),!(s=null==a?void 0:a.CheckoutElements.get("WaitBeforeContactInfo"))){e.next=5;break}return e.next=5,_e.Sleep(Number(s.Value));case 5:if(!(c=null==a?void 0:a.CheckoutElements.get(St.ClickBefore))){e.next=10;break}return e.next=10,this.ClickButtonWithWaiting(n,c,"ContactInfo");case 10:if(null==a||!a.CheckoutElements||!i.Profile){e.next=53;break}u=i.Profile,l=xt(a.CheckoutElements.keys()),e.prev=13,d=o().mark((function e(){var r,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.value,!(i=a.CheckoutElements.get(r))){e.next=19;break}if(s=y.GetProfileData(u,i.Name,i.Format),"input"!==i.Type&&"dropdown"!==i.Type){e.next=19;break}if(!s){e.next=19;break}if(!i.WaitForVisible){e.next=9;break}return e.next=9,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.IsFieldVisible(n,i.Value,"is ".concat(i.Name," Visible"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),i.WaitForVisible);case 9:return e.next=11,y.IsFieldVisible(n,i.Value,"is ".concat(i.Name," Visible"));case 11:if(!e.sent){e.next=18;break}return e.next=16,y.TypeCheckoutFieldData(i.Value,s);case 16:e.next=19;break;case 18:y.selectorsNotFound.push(y.GetSelectorsNotFoundItem(i,"ContactInfo"));case 19:case"end":return e.stop()}}),e)})),l.s();case 16:if((p=l.n()).done){e.next=20;break}return e.delegateYield(d(),"t0",18);case 18:e.next=16;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(13),l.e(e.t1);case 25:return e.prev=25,l.f(),e.finish(25);case 28:if(!(h=a.CheckoutElements.get(St.Signup))||!h.Value||"disableCheckBox"!==h.Type){e.next=32;break}return e.next=32,this.SendDomMessage(n,new Fe(Ne.SetCheckBox,h.Value,"false"),"disable signup",!1);case 32:if(!(f=null==a?void 0:a.CheckoutElements.get(St.Continue))){e.next=37;break}return e.next=36,this.ClickButtonWithWaiting(n,f,"ContactInfo",8e3,3e3,void 0,2e3);case 36:case 37:if(!(v=a.CheckoutElements.get(St.FieldError))||!v.Value){e.next=45;break}return e.next=41,this.IsFieldVisible(n,v.Value,"Update Contact Details");case 41:if(!e.sent){e.next=45;break}return e.next=45,this.CheckAndThrowError(v,"updating contact details",yt.FieldError,De.ECFieldError);case 45:if(!(g=a.CheckoutElements.get(St.FormError))){e.next=53;break}return e.next=49,this.IsFieldVisible(n,g.Value,"Update Contact Details");case 49:if(!e.sent){e.next=53;break}return e.next=53,this.CheckAndThrowError(g,"updating contact details",yt.FormError,De.ECFormError);case 53:case"end":return e.stop()}}),e,this,[[13,22,25,28]])}))),function(e,t,n){return y.apply(this,arguments)})},{key:"UpdateShippingAddressDetails",value:(g=t(o().mark((function e(n,r,i){var a,s,c,u,l,p,d,h,f,v,g,y,S,m,C,x,k,b,A,E,P,w=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(a=r.AllcheckoutCompletionPages.get(this.shippingAddresskey))||!a.CheckoutElements||!i.Profile){e.next=87;break}if(s=i.Profile,!(c=null==a?void 0:a.CheckoutElements.get("WaitBeforeShippingAddress"))){e.next=7;break}return e.next=7,_e.Sleep(Number(c.Value));case 7:if(!(u=null==a?void 0:a.CheckoutElements.get("clickBefore"))){e.next=11;break}return e.next=11,this.ClickButtonWithWaiting(n,u,"ShippingAddress",void 0,void 0,void 0,2e3);case 11:if(!(l=a.CheckoutElements.get(St.Address1))){e.next=29;break}return e.next=15,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.IsFieldVisible(n,l.Value,"IsAddress FieldVisible");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),l.WaitForVisible||8e3);case 15:return e.next=17,this.IsFieldVisible(n,l.Value,"IsAddress FieldVisible");case 17:if(e.sent){e.next=21;break}throw this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(l,"ShippingAddress")),new xe("Address1 field is not visible",De.ExecutionError);case 21:if(!(p=this.GetProfileData(s,St.Address1))){e.next=25;break}return e.next=25,this.TypeCheckoutFieldData(l.Value,p);case 25:if(!(d=a.CheckoutElements.get("address1Confirm"))){e.next=29;break}return e.next=29,this.ClickButtonWithWaiting(n,d,"ShippingAddress",2e3,2e3,void 0,2e3);case 29:h=xt(a.CheckoutElements.keys()),e.prev=30,v=o().mark((function e(){var r,i,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=f.value)!==St.Address1){e.next=3;break}return e.abrupt("return","continue");case 3:if(!(i=a.CheckoutElements.get(r))){e.next=21;break}if(c=w.GetProfileData(s,i.Name,i.Format),"input"!==i.Type&&"dropdown"!==i.Type){e.next=21;break}if(!c){e.next=21;break}if(!i.WaitForVisible){e.next=11;break}return e.next=11,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.IsFieldVisible(n,i.Value,"is ".concat(i.Name," Visible"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),i.WaitForVisible);case 11:return e.next=13,w.IsFieldVisible(n,i.Value,"is ".concat(i.Name," Visible"));case 13:if(!e.sent){e.next=20;break}return e.next=18,w.TypeCheckoutFieldData(i.Value,c);case 18:e.next=21;break;case 20:w.selectorsNotFound.push(w.GetSelectorsNotFoundItem(i,"ShippingAddress"));case 21:case"end":return e.stop()}}),e)})),h.s();case 33:if((f=h.n()).done){e.next=40;break}return e.delegateYield(v(),"t0",35);case 35:if("continue"!==e.t0){e.next=38;break}return e.abrupt("continue",38);case 38:e.next=33;break;case 40:e.next=45;break;case 42:e.prev=42,e.t1=e.catch(30),h.e(e.t1);case 45:return e.prev=45,h.f(),e.finish(45);case 48:if(!(g=a.CheckoutElements.get(St.Signup))||!g.Value||"disableCheckBox"!==g.Type){e.next=52;break}return e.next=52,this.SendDomMessage(n,new Fe(Ne.SetCheckBox,g.Value,"false"),"disable signup",!1);case 52:if(y=null==a?void 0:a.CheckoutElements.get("sameBillingAddress"),S=null==a?void 0:a.CheckoutElements.get("sameBillingAddressLabel"),!y){e.next=62;break}return e.next=57,this.SendDomMessage(this.contextId,new Fe(Ne.GetCheckedValue,y.Value,"",yt.CheckedValue),"get sameBillingAddress checked value",!1);case 57:if(C=e.sent,x=null!==(m=null==C?void 0:C.CheckedValue)&&void 0!==m?m:"","checkBox"!==y.Type||!S||x){e.next=62;break}return e.next=62,this.Click(S.Value,yt.Continue);case 62:if(this.expressCheckoutState.CheckoutProgress=it.AddressDone,this.edgeMessageService.SaveExpressCheckoutStatus(this.expressCheckoutState),this.EntryPointIsWallet()){e.next=67;break}return e.next=67,_e.Sleep(1e3);case 67:if(!(k=null==a?void 0:a.CheckoutElements.get("continue"))){e.next=72;break}return e.next=71,this.ClickButtonWithWaiting(n,k,"ShippingAddress",8e3,3e3,void 0,1e3);case 71:case 72:if(!(b=a.CheckoutElements.get(St.FieldError))||!b.Value){e.next=76;break}return e.next=76,this.CheckAndThrowError(b,"Updating Shipping Address",yt.FieldError,De.ECFormError);case 76:if(!(A=a.CheckoutElements.get(St.FormError))||!A.Value){e.next=80;break}return e.next=80,this.CheckAndThrowError(A,"Udpating Shipping Address",yt.FormError,De.ECFormError);case 80:if(!(E=a.CheckoutElements.get("confirm"))){e.next=84;break}return e.next=84,this.ClickButtonWithWaiting(n,E,"ShippingAddress",2e3,2e3,void 0,2e3);case 84:if(!(P=a.CheckoutElements.get(St.RefreshAfterContinue))||"true"!==P.Value){e.next=87;break}throw new xe("error at updating shipping adrress",De.Refresh);case 87:case"end":return e.stop()}}),e,this,[[30,42,45,48]])}))),function(e,t,n){return g.apply(this,arguments)})},{key:"CheckAndThrowError",value:(f=t(o().mark((function e(t,n,r,i){var a,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!t.Value){e.next=10;break}return e.next=3,this.IsFieldVisible(this.contextId,t.Value,n);case 3:if(!e.sent){e.next=10;break}return e.next=7,this.SendDomMessage(this.contextId,new Fe(Ne.GetInnerText,t.Value,"",r),r+" error",!1);case 7:throw s=e.sent,c=null!==(a=null==s?void 0:s.TextValue)&&void 0!==a?a:"",new xe("Error in "+n+":"+c,i);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return f.apply(this,arguments)})},{key:"UpdateShippingOptions",value:(h=t(o().mark((function e(n,r){var i,a,s,c,u,l,p=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.AllcheckoutCompletionPages.get(mt.ShippingOptions),!(a=null==i?void 0:i.CheckoutElements)){e.next=33;break}if(!(s=a.get("WaitBeforeShippingOptions"))){e.next=8;break}return e.next=8,_e.Sleep(Number(s.Value));case 8:if(!(c=a.get(St.Check))||!c.Value){e.next=33;break}return e.next=14,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.IsFieldVisible(n,c.Value,"is ".concat(c.Name," visible"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),c.WaitForVisible||8e3);case 14:return e.next=16,this.IsFieldVisible(n,c.Value,"is Shipping Visible");case 16:if(!e.sent){e.next=32;break}if(this.expressCheckoutState.CheckoutProgress=it.AddressDone,this.expressCheckoutState.IsShippingOptionsDone=!0,this.edgeMessageService.SaveExpressCheckoutStatus(this.expressCheckoutState),!(u=a.get(St.Continue))){e.next=26;break}return e.next=26,this.ClickButtonWithWaiting(n,u,"ShippingOptions",8e3,5e3,void 0,void 0);case 26:if(!(l=a.get(St.RefreshAfterContinue))||"true"!==l.Value){e.next=30;break}throw new xe("error at updating Shipping Options",De.Refresh);case 30:e.next=33;break;case 32:this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(c,"ShippingOptions"));case 33:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"IframeEventHandler",value:function(e){if(this.allowedIfameOrigins.has(e.origin)&&e.data){var t=e.data,n=t.guid;if(n&&this.ccwaitingguids.has(n)){var r=t.status;this.ccResponseMap.set(n,r),this.ccwaitingguids.delete(n)}}}},{key:"UpdatePaymentIframeDetails",value:(d=t(o().mark((function e(n,r,i){var a,s,c,u,l,p,d,h,f,v,g,y,S,m,C=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.Payment,!(s=r.AllcheckoutCompletionPages.get(mt.PaymentIframe))||!a){e.next=57;break}if(window.addEventListener("message",this.iframeEventHandler),u=r.AllCheckoutCompletionPagesStr,!(l=s.CheckoutElements.get("cardNumberIframe"))){e.next=18;break}return e.next=10,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.IsFieldVisible(n,l.Value,"Iframe FieldVisible");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),l.WaitForVisible||1e4);case 10:return e.next=12,this.IsFieldVisible(n,l.Value,"card number Iframe FieldVisible");case 12:if(e.sent){e.next=16;break}throw this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(l,"PaymentIframe")),new xe("card number iframe undefined.",De.IframeSelectorNotFound);case 16:e.next=19;break;case 18:throw new xe("card number iframe undefined.",De.IframeSelectorNotFound);case 19:if(p=s.CheckoutElements.get("cardNumberIframeOrigin"),!l||!p){e.next=25;break}return e.next=23,_e.Sleep(l.WaitBefore||1e3);case 23:return e.next=25,this.UpdateIframePaymentField(n,gt.CCNUpdate,u,l.Value,p.Value,i.Payment.CardNumber);case 25:if(d=s.CheckoutElements.get("nameOnCardIframe"),h=s.CheckoutElements.get("nameOnCardIframeOrigin"),f=null!==(c=i.Payment.FullName)&&void 0!==c?c:i.Profile.FullName,!d||!h){e.next=36;break}return e.next=31,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.IsFieldVisible(n,d.Value,"card name FieldVisible");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),d.WaitForVisible||1e4);case 31:if(!d.WaitBefore){e.next=34;break}return e.next=34,_e.Sleep(d.WaitBefore);case 34:return e.next=36,this.UpdateIframePaymentField(n,gt.CCName,u,d.Value,h.Value,f);case 36:if(v=s.CheckoutElements.get("expiryIframe"),g=s.CheckoutElements.get("expiryIframeOrigin"),!v||!g){e.next=46;break}return e.next=41,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.IsFieldVisible(n,v.Value,"expiry FieldVisible");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),v.WaitForVisible||1e4);case 41:if(!v.WaitBefore){e.next=44;break}return e.next=44,_e.Sleep(v.WaitBefore);case 44:return e.next=46,this.UpdateIframePaymentField(n,gt.CCExpiry,u,v.Value,g.Value,this.GetExpiryData(a));case 46:if(y=s.CheckoutElements.get("securityCodeIframe"),S=s.CheckoutElements.get("securityCodeIframeOrigin"),m=a.CardCVC,!(y&&m&&S)){e.next=56;break}return e.next=52,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.IsFieldVisible(n,y.Value,"securityCode FieldVisible");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),y.WaitForVisible||1e4);case 52:return e.next=54,_e.Sleep(y.WaitBefore||1e3);case 54:return e.next=56,this.UpdateIframePaymentField(n,gt.CCSecurityCode,u,y.Value,S.Value,m);case 56:window.removeEventListener("message",this.iframeEventHandler);case 57:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"UpdateIframePaymentField",value:(l=t(o().mark((function e(n,r,i,a,s,c){var u,l,p,d,h,f,v,g,y,S,m,C,x=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=this.localDataService.GetLocaData(Te.ExpressCheckoutState),!this.EntryPointIsWallet()||u!==it.CancelEC){e.next=3;break}throw new xe("ExpressCheckout cancelled",De.ECCancelled);case 3:return e.next=5,this.SendDomMessage(n,new Fe(Ne.IframeOrigin,a,"",yt.IframeOrigin),"Calling iframe origin",!1);case 5:if((l=e.sent).TextValue===s){e.next=11;break}throw p=new se(this.domainName,be.ECFrameOriginMisMatch,{EntryPoint:this.entryPointService.GetEntryPoint(),frameOrigin:l.TextValue},void 0),this.logService.LogClientErrorV2("wrong iframe",p),new xe("wrong iframe",De.IframeOriginInvalid);case 11:return this.allowedIfameOrigins.add(s),e.next=14,this.SendDomMessage(n,new Fe(Ne.SelectorName,a,"",yt.IframeName),"Calling iframe name",!1);case 14:return d=e.sent,(h=d.TextValue)||(f=new se(this.domainName,be.ECFrameNameUndefined,{EntryPoint:this.entryPointService.GetEntryPoint(),frameOrigin:l.TextValue},void 0),this.logService.LogClientErrorV2("iframe name invalid",f)),v=ce.uuidv4(),g={AllCheckoutCompletionPagesStr:i,CommandName:r,Guid:v,ParentOrigin:location.origin,Value:c},y=[v,h,JSON.stringify(g)],this.ccwaitingguids.add(v),this.edgeMessageService.SendIframeMessage(y),e.next=24,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",x.ccResponseMap.has(v));case 1:case"end":return e.stop()}}),e)}))),8e3);case 24:if(!(S=this.ccResponseMap.get(v))){e.next=30;break}if("SUCCESS"===S){e.next=28;break}throw new xe("",De.IframePaymentFail);case 28:e.next=33;break;case 30:m={EntryPoint:this.entryPointService.GetEntryPoint(),command:r,iframeName:h},C=new se(this.domainName,be.ECIframeResponseNotReceived,m,void 0),this.logService.LogClientErrorV2("iframe response not received.",C);case 33:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o,i){return l.apply(this,arguments)})},{key:"GetExpiryData",value:function(e){return e.ExpMonth+" / "+e.ExpYear.substr(e.ExpYear.length-2)}},{key:"SendCheckoutDomMessage",value:(a=t(o().mark((function e(t,n,r,i){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localDataService.GetLocaData(Te.ExpressCheckoutState)!==it.CancelEC){e.next=3;break}throw new xe("ExpressCheckout cancelled",De.ECCancelled);case 3:return e.next=5,this.SendDomMessage(t,n,r,i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"GetFormattedPhoneNumber",value:function(e,t){var n=e.replace(/\D/g,"");if(n&&n.length>=10&&(n=n.substr(n.length-10)),t&&"1"===t){var r=n.match(/^(\d{3})(\d{3})(\d{4})$/);if(r)return"("+r[1]+") "+r[2]+"-"+r[3]}return n}},{key:"GetProfileData",value:function(e,t,n){if(e)switch(t){case"email":return e.Email;case"name":return e.FullName;case"firstName":return e.FirstName;case"middleName":return e.MiddleName;case"lastName":return e.LastName;case"company":return"";case"address1":return this.GetAddressLine1(e.AddressLines);case"address2":return this.GetAddressLine2(e.AddressLines);case"city":return e.City;case"state":return Ct(e.State)[0];case"country":return this.GetCountry(e.Country,n);case"zipCode":return this.GetZip(e.Zip,n);case"phone":return this.GetFormattedPhoneNumber(e.PhoneNumber,n)}}},{key:"GetZip",value:function(e,t){return t&&"1"===t?e.substr(0,5):e}},{key:"GetCountry",value:function(e,t){if(!t)return e;var n=this.GetCountriesMap().get(e);if(void 0!==n){var r=n.get(t);if(void 0!==r)return r}return e}},{key:"GetAddressLine1",value:function(e){if(e){var t=e.split("\n");if(t.length>=1){var n=t[0];return n.endsWith(",")?n.substring(0,n.length-1):n}}return""}},{key:"GetAddressLine2",value:function(e){if(e){var t,n=e.split("\n");if(n.length>=2)return null!==(t=n[1])&&void 0!==t?t:""}return""}},{key:"Click",value:(i=t(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendCheckoutDomMessage(N.FromBackground,new Fe(Ne.Click,t,"",n),n,!0);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"TypeCheckoutFieldData",value:(r=t(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendCheckoutDomMessage(N.FromBackground,new Fe(Ne.SetBoxValue,t,n),"Checkout field input box",!0);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"GetCountriesMap",value:function(){var e=new Map,t=new Map;return t.set("1","United States"),e.set("US",t),e}},{key:"ClickButtonWithWaiting",value:(n=t(o().mark((function e(n,r,i,a,s,c,u){var l,p,d,h,f=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=r.WaitForVisible||a,p=r.WaitForNotDisabled||s,d=r.WaitBefore||c,h=r.WaitAfter||u,!l){e.next=7;break}return e.next=7,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.IsFieldVisible(n,r.Value,"is ".concat(r.Name," visible"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),l);case 7:return e.next=9,this.IsFieldVisible(n,r.Value,"is ".concat(r.Name," visible"));case 9:if(!e.sent){e.next=24;break}if(!p){e.next=14;break}return e.next=14,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.IsFieldNotDisabled(n,r.Value,"is ".concat(r.Name," not disabled"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),p);case 14:if(!d){e.next=17;break}return e.next=17,_e.Sleep(d);case 17:return e.next=19,this.Click(r.Value,yt.Continue);case 19:if(!h){e.next=22;break}return e.next=22,_e.Sleep(h);case 22:e.next=25;break;case 24:this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(r,i));case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,r,o,i,a,s){return n.apply(this,arguments)})},{key:"GetSelectorsNotFoundItem",value:function(e,t){return{Element:e,PageType:t}}}]),M}(He),Et=At;function Pt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var wt=function(e){p(n,e);var t=Pt(n);function n(e,r,o,i){var a;return c(this,n),v(u(a=t.call(this)),"Domain",void 0),v(u(a),"PreClippingVisibleSelectors",void 0),v(u(a),"PostClippingVisibleSelectors",void 0),v(u(a),"WasClippingSuccessful",void 0),a.Domain=e,a.PreClippingVisibleSelectors=r,a.PostClippingVisibleSelectors=o,a.WasClippingSuccessful=i,a}return s(n)}(re);function It(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Dt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ot=function(){function e(){c(this,e)}return s(e,null,[{key:"HasVisibleElement",value:function(t){return e.CountVisibleElements(t)>0}},{key:"CountVisibleElements",value:function(t){if(!_e.IsValidDataField(t))return 0;var n,r=It(t.split(";"));try{for(r.s();!(n=r.n()).done;){var o=n.value,i=e.CountVisibleElementsSingleSel(o);if(i>0)return i}}catch(e){r.e(e)}finally{r.f()}return 0}},{key:"HasVisibleElementSingleSel",value:function(t){return e.CountVisibleElementsSingleSel(t)>0}},{key:"RunQuerySelectorAll",value:function(e,t){var n,r=e.split("<");n=t?t.querySelectorAll(r[0]):document.querySelectorAll(r[0]);var o,i=It(r.slice(1));try{for(i.s();!(o=i.n()).done;){var a,s=o.value,c=null===(a=n[0])||void 0===a?void 0:a.shadowRoot;if(!c)return[];n=c.querySelectorAll(s)}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"IsElementVisible",value:function(e){return e&&e.offsetWidth>0&&e.offsetHeight>0}},{key:"GetFirstVisibleElement",value:function(t,n){if(_e.IsValidDataField(t)){var r,o=It(t.split(";"));try{for(o.s();!(r=o.n()).done;){var i=r.value;try{var a,s=It(e.RunQuerySelectorAll(i,n));try{for(s.s();!(a=s.n()).done;){var c=a.value;if(e.IsElementVisible(c))return c}}catch(e){s.e(e)}finally{s.f()}}catch(e){}}}catch(e){o.e(e)}finally{o.f()}}}},{key:"GetFirstVisibleElementSingleSel",value:function(t,n){if(_e.IsValidDataField(t))try{var r,o=It(e.RunQuerySelectorAll(t,n));try{for(o.s();!(r=o.n()).done;){var i=r.value;if(e.IsElementVisible(i))return i}}catch(e){o.e(e)}finally{o.f()}}catch(e){}}},{key:"GetAllVisibleElements",value:function(t){if(!_e.IsValidDataField(t))return[];var n,r=[],o=It(t.split(";"));try{for(o.s();!(n=o.n()).done;){var i,a=n.value,s=It(e.RunQuerySelectorAll(a));try{for(s.s();!(i=s.n()).done;){var c=i.value;e.IsElementVisible(c)&&r.push(c)}}catch(e){s.e(e)}finally{s.f()}}}catch(e){o.e(e)}finally{o.f()}return r}},{key:"GetTextValue",value:function(t,n){var r=t.split(";"),o=r[0],i=e.GetFirstVisibleElement(o,n),a=i,s=a.innerText;if(1===r.length)s=(a=e.NormalizeIfSuperscripted(i)).innerText;else{var c,u=a.cloneNode(!0),l=r[1],p=null!==(c=e.GetFirstVisibleElement(l,a))&&void 0!==c?c:e.GetFirstVisibleElement(l,n),d="";if(p&&p.innerText){if(d="."+p.innerText,a.contains(p)){var h=e.GetFirstElementSingleSel(l,u);if(null!=h&&h.innerText)u.removeChild(h);else{l.startsWith(o)&&(l=l.slice(o.length));var f=this.GetFirstElementSingleSel(l,u);null!=f&&f.innerText&&u.removeChild(f)}s=null!=u&&u.innerText?u.innerText:s}s+=d}if(r.length>2){var v,g=It(r.slice(2));try{for(g.s();!(v=g.n()).done;){var y=v.value,S=this.GetFirstElementSingleSel(y,u);null!=S&&S.innerText&&u.removeChild(S)}}catch(e){g.e(e)}finally{g.f()}s=null!=u&&u.innerText?u.innerText:s}s+=d}return e.StripInvalidJSONCharacters(s)}},{key:"StripInvalidJSONCharacters",value:function(e){return e.replace(/\n/gi,"")}},{key:"NormalizeIfSuperscripted",value:function(e){if(e&&e.innerHTML&&e.innerHTML.toLowerCase().indexOf("</sup>")>-1)try{for(var t=e.cloneNode(!0),n=t.childNodes.length,r=0;r<n;r++){var o=t.childNodes[r];if("SUP"===o.tagName){var i=o.innerText,a=/[0-9\.]+/g.exec(i);if(null!==a)return i="."+a[0],o.innerText=i,t}}}catch(t){return e}return e}},{key:"GetFirstElementSingleSel",value:function(t,n){if(_e.IsValidDataField(t)){var r,o=It(e.RunQuerySelectorAll(t,n));try{for(o.s();!(r=o.n()).done;){return r.value}}catch(e){o.e(e)}finally{o.f()}}}},{key:"CountVisibleElementsSingleSel",value:function(t){if(!_e.IsValidDataField(t))return 0;var n,r=0,o=It(e.RunQuerySelectorAll(t));try{for(o.s();!(n=o.n()).done;){var i=n.value;e.IsElementVisible(i)&&r++}}catch(e){o.e(e)}finally{o.f()}return r}}]),e}(),Tt=s((function e(t){c(this,e),v(this,"EventInfoTime",void 0),v(this,"EventInfoName",void 0),v(this,"Domain",void 0),v(this,"BestCoupon",void 0),v(this,"CashbackCategory",void 0),v(this,"StartingPrice",void 0),v(this,"CashbackSavings",void 0),v(this,"Discount",void 0),v(this,"AutoApplyScenario",void 0),v(this,"AutoApplyProcessTime",void 0),v(this,"ImpressionId",void 0),v(this,"JSVersion",void 0),v(this,"BuildVersion",void 0),v(this,"Currency",void 0),this.EventInfoTime=null==t?void 0:t.eventInfo_Time,this.EventInfoName=null==t?void 0:t.eventInfo_Name,this.Domain=null==t?void 0:t.domain,this.BestCoupon=null==t?void 0:t.bestCoupon,this.CashbackCategory=null==t?void 0:t.cashbackCategory,this.StartingPrice=null==t?void 0:t.startingPrice,this.CashbackSavings=null==t?void 0:t.cashbackSavings,this.Discount=null==t?void 0:t.discount,this.AutoApplyScenario=null==t?void 0:t.autoApplyScenario,this.AutoApplyProcessTime=null==t?void 0:t.autoApplyProcessTime,this.ImpressionId=null==t?void 0:t.impressionId,this.JSVersion=null==t?void 0:t.jSVersion,this.BuildVersion=null==t?void 0:t.buildVersion,this.Currency=null==t?void 0:t.currency}));function Rt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Mt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ft=function(){function e(){c(this,e)}return s(e,null,[{key:"IsOnCheckoutPage",value:function(e,t){return!(!t||!t.retailerData)&&t.retailerData.UpdateCurrentCheckoutPage(e)}},{key:"GetHtmlElement",value:function(e){var t,n=Rt(e.split(";"));try{for(n.s();!(t=n.n()).done;){var r=t.value;try{var o=document.querySelector(r);if(o)return o}catch(e){}}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"GetHtmlElements",value:function(e){var t,n=[],r=Rt(e.split(";"));try{for(r.s();!(t=r.n()).done;){var o=t.value;try{var i,a=Rt(document.querySelectorAll(o));try{for(a.s();!(i=a.n()).done;){var s=i.value;s&&n.push(s)}}catch(e){a.e(e)}finally{a.f()}}catch(e){}}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"getQuantity",value:function(e,t){var n,r=t.querySelector(e),o=null==r||null===(n=r.innerText)||void 0===n?void 0:n.trim(),i=Number(o);try{if(isNaN(i))if("select"===(null==r?void 0:r.nodeName.toLowerCase())){var a=t.querySelector(e);i=Number(a.value)}else{var s,c=null==r||null===(s=r.innerText)||void 0===s?void 0:s.trim().match(/[-]{0,1}[\d]*[.]{0,1}[\d]+/g);c&&(null==c?void 0:c.length)>0&&(i=Number(c[0]))}}catch(e){i=-1}return isNaN(i)&&(i=-1),i}},{key:"isElementDisabled",value:function(e){return"disabled"===e.getAttribute("disabled")}}]),e}();function Bt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Lt=function(){function e(){c(this,e)}return s(e,null,[{key:"GetInternationalSupportedMarkets",value:function(){return e.internationalSupportedMarkets}},{key:"GetPriceStringAsNumber",value:function(t){t=(t=t.replace(/\([^)]*\)/g,"")).replace(/[^0-9\.,]+/g,"");try{!1===e.IsUsCurrencyFormat(t)&&(t=e.SwapCommaAndPeriod(t))}catch(e){}return t=t.replace(/[,]+/g,""),parseFloat(t)}},{key:"IsUsCurrencyFormat",value:function(e){var t=e.lastIndexOf(","),n=e.lastIndexOf(".");return!(n>-1&&t>-1&&t>n)&&(!(n>-1&&e.length-n-1>2)&&!(t>-1&&e.length-t-1<=2))}},{key:"GetCurrencyString",value:function(t){return i(t)||!e.IsCurrencyValid(t)?"$":t}},{key:"GetCurrencyFromMarket",value:function(t){return e.marketCurrencyMap.get(t)}},{key:"GetCurrencyCodeFromSymbol",value:function(t){return e.symbolCurrencyCodeMap.get(t)}},{key:"GetOverridenCurrencyValue",value:function(t){var n;return t&&null!==(n=e.GetCurrencyFromMarket(t))&&void 0!==n?n:"$"}},{key:"GetStandardizedCurrency",value:function(t,n){return e.IsCurrencyValid(t)?t:e.GetOverridenCurrencyValue(n)}},{key:"IsCurrencyValid",value:function(t){return!(!t||!e.currencySet)&&e.currencySet.has(t)}},{key:"ExtractCurrencyString",value:function(t){var n,r=t.replace(/[0-9,. ]/g,"").trim(),o=Bt(e.currencySet);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(r.includes(a))return a}}catch(e){o.e(e)}finally{o.f()}return i(r)?"":r}},{key:"GetEscapedCurrency",value:function(e){return e.replace(/([^A-Za-z])/g,"\\$1")}},{key:"SwapCommaAndPeriod",value:function(e){return e.replace(/[,.]/g,(function(e){return","===e?".":","}))}}]),e}();v(Lt,"currencySet",new Set(["USD","INR","GBP","CAD","EUR","AUD","YEN","BRL","MXN","US$","CA$","AU$","MX$","C$","A$","R$","","","","","","","$","NZ$","NZD","","CNY","","KRW","","RUB","Rp","IDR","","PHP","","VND","","THB","NT$","TWD","E","EGP","kr.","DKK","Fr.","CHF","z","PLN","dr.","SEK","RM","MYR","NOK","S$","SGD","K","CZK","TL","TRY","COL$","COP","R","ZAR"])),v(Lt,"internationalSupportedMarkets",["en-us","en-gb","en-ca","en-au","en-in","fr-fr","de-de","ja-jp","it-it","nl-nl","es-es","en-nz","pt-br","zh-cn","es-mx","ko-kr","ru-ru","id-id","fil-ph","vi-vn","th-th","zh-tw","ar-eg","de-at","da-dk","de-ch","pl-pl","sv-se","en-my","no-no","en-sg","fi-fi","fr-be","cs-cz","tr-tr","es-co","en-za"]),v(Lt,"marketCurrencyMap",new Map([["en-us","$"],["en-gb",""],["en-ca","CA$"],["en-au","AU$"],["en-in",""],["fr-fr",""],["de-de",""],["ja-jp",""],["it-it",""],["nl-nl",""],["es-es",""],["en-nz","NZ$"],["pt-br","R$"],["zh-cn",""],["es-mx","MX$"],["ko-kr"," "],["ru-ru",""],["id-id","Rp"],["fil-ph",""],["vi-vn",""],["th-th",""],["zh-tw","NT$"],["ar-eg","E"],["de-at",""],["da-dk","kr."],["de-ch","Fr."],["pl-pl","z"],["sv-se","dr"],["en-my","RM"],["no-no","NOK"],["en-sg","S$"],["fi-fi",""],["fr-be",""],["cs-cz","K"],["tr-tr","TL"],["es-co","COL$"],["en-za","R"]])),v(Lt,"symbolCurrencyCodeMap",new Map([["$","USD"],["","INR"],["","GBP"],["","EUR"],["NZ$","NZD"],["R$","BRL"],["CA$","CAD"],["C$","CAD"],["A$","AUD"],["AU$","AUD"],["","YEN"],["","CNY"],["MX$","MXN"],["","GBP"],["","KRW"],["","RUB"],["Rp","IDR"],["","PHP"],["","VND"],["","THB"],["NT$","TWD"],["E","EGP"],["kr.","DKK"],["Fr.","CHF"],["z","PLN"],["dr.","SEK"],["RM","MYR"],["NOK","NOK"],["S$","SGD"],["K","CZK"],["TL","TRY"],["COL$","COP"],["R","ZAR"]]));var Gt=Lt,Ut=function(){function e(){c(this,e)}return s(e,null,[{key:"getInitialPrice",value:function(e){if(e)return Gt.GetPriceStringAsNumber(e)}},{key:"getAmazonClippingDiscount",value:function(e,t){var n;if(t&&e){var r=t.substring(t.search(/\d+/g)),o=r.search(/\s|%/),i=r;-1!==o&&(i=r.substring(0,o)),n=Gt.GetPriceStringAsNumber(i),t.search(/%/)>0&&(n=e*n/100)}return n}}]),e}();function Vt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return _t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _t(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function _t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Wt=function(){function e(t,n){c(this,e),v(this,"logService",void 0),v(this,"scenario",void 0),this.logService=t,this.scenario=n}var n,r,i;return s(e,[{key:"TryClipCoupons",value:(i=t(o().mark((function e(t,n,r,i){var a,s,c=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Date.now(),t.clipCouponSelector){e.next=4;break}return this.LogError(a,"ClipCoupon selector not found",n,r,i),e.abrupt("return",!1);case 4:return e.next=6,this.ClipCouponsAndLogResult(a,t,n,r,i).catch((function(e){return c.LogError(a,e.message,n,r,i),!1}));case 6:return s=e.sent,e.abrupt("return",s);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"ClipCouponsAndLogResult",value:(r=t(o().mark((function e(t,n,r,i,a){var s,c,u,l,p,d,h,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.GetPriceData(n,i),c=Ft.GetHtmlElements(n.clipCouponSelector),u=this.GetFirstVisibleIndices(n),0!==c.length){e.next=9;break}return l="Clip button not found, no AlreadyClipped selector",n.alreadyClippedSelector&&(p=Ot.GetFirstVisibleElement(n.alreadyClippedSelector),l=p?"Coupon Already Clipped":"Clip Button and Already Clipped not found"),this.LogError(t,l,r,s,a),this.LogVisibleSelectors(r,u,[],!1,a),e.abrupt("return",!1);case 9:d=!1,h=Vt(c);try{for(h.s();!(f=h.n()).done;)f.value.click(),d=!0}catch(e){h.e(e)}finally{h.f()}return this.GetPostClippingSelectorsAndLog(r,n,u,d,a),d?this.LogClippingResult(t,D.Positive,r,s,"Finished Clipping Coupon",a):this.LogError(t,"Coupon Clipping Failed",r,s,a),e.abrupt("return",d);case 15:case"end":return e.stop()}}),e,this)}))),function(e,t,n,o,i){return r.apply(this,arguments)})},{key:"GetPriceData",value:function(e,t){var n,r=null!==(n=t.initialPrice)&&void 0!==n?n:0,o=t.discount;try{if(!r&&e.orderTotalDataElementSelector){var i,a=null===(i=Ot.GetFirstVisibleElement(e.orderTotalDataElementSelector))||void 0===i?void 0:i.innerText;a&&(r=Gt.GetPriceStringAsNumber(a))}if(!o&&e.discountSelector){var s,c=null===(s=Ot.GetFirstVisibleElement(e.discountSelector))||void 0===s?void 0:s.innerText;o=Ut.getAmazonClippingDiscount(r,c)}}catch(e){}return{discount:o,initialPrice:r}}},{key:"GetPostClippingSelectorsAndLog",value:(n=t(o().mark((function e(t,n,r,i,a){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_e.Sleep(1e3);case 2:s=this.GetFirstVisibleIndices(n),this.LogVisibleSelectors(t,r,s,i,a);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r,o,i){return n.apply(this,arguments)})},{key:"GetFirstVisibleIndices",value:function(e){return[this.GetFirstVisibleElementIndex(e.clipCouponSelector),this.GetFirstVisibleElementIndex(e.discountSelector),this.GetFirstVisibleElementIndex(e.orderTotalDataElementSelector),this.GetFirstVisibleElementIndex(e.clippedDiscountSelector),this.GetFirstVisibleElementIndex(e.alreadyClippedSelector)]}},{key:"GetFirstVisibleElementIndex",value:function(e){if(!e)return-2;for(var t=e.split(";"),n=0;n<t.length;n++){var r=t[n];try{var o,i=Vt(document.querySelectorAll(r));try{for(i.s();!(o=i.n()).done;){var a=o.value;if(Ot.IsElementVisible(a))return n}}catch(e){i.e(e)}finally{i.f()}}catch(e){}}return-1}},{key:"LogVisibleSelectors",value:function(e,t,n,r,o){var i=A.VisibleClippingSelectors,a=b.Information,s=new wt(e,t,n,r);this.logService.SendLogMessage(a,i,"",s,o)}},{key:"LogClippingResult",value:function(e,t,n,r,o,i){var a,s,c=null!==(a=r.initialPrice)&&void 0!==a?a:0,u=null!==(s=r.discount)&&void 0!==s?s:0,l=Date.now()-e,p=new ie(n),d="Amazon Coupon";p.SetResultData(t,l,d,[],null!=u?u:0,c,!1,this.scenario);var h=A.AutoApply,f=b.Information;if(this.logService.SendLogMessage(f,h,o,p,i),t===D.Positive){this.logService.SendEdgeAAPositiveResult(d,c,u);try{var v=new Tt({});v.EventInfoTime=(new Date).toISOString(),v.Domain=n,v.BestCoupon=d,v.StartingPrice=c.toString(),v.Discount=u.toString(),v.AutoApplyScenario=this.scenario,v.AutoApplyProcessTime=l.toString(),this.logService.SaveSavingsTransactionToEdge(v)}catch(e){}}else this.logService.SendEdgeAANegativeResult()}},{key:"LogError",value:function(e,t,n,r,o){var i=be.CouponClippingFailed,a=new se(n,i,{FunctionName:"ClipCoupons"},void 0);this.logService.SendLogMessage(b.Error,A.ClientError,null!=t?t:"",a,o),this.logService.SendEdgeAAErrorMessage(i),this.LogClippingResult(e,D.Error,n,r,t,o)}}]),e}(),Ht=Wt,zt=function(){function e(t,n){c(this,e),v(this,"logService",void 0),v(this,"edgeMessageService",void 0),this.logService=t,this.edgeMessageService=n}return s(e,[{key:"SendLogMessage",value:function(e,t,n,r,o){this.logService.LogClientEventV2(e,t,n,r,o)}},{key:"SaveSavingsTransactionToEdge",value:function(e){this.edgeMessageService.SaveTransactionToEdgeLocalStore($.CouponClippingTransactionsKey,JSON.stringify(e))}},{key:"SendEdgeAANegativeResult",value:function(){this.edgeMessageService.SendAutoApplyNegativeMessage()}},{key:"SendEdgeAAPositiveResult",value:function(e,t,n){this.edgeMessageService.SendAutoApplyPositiveMessage(e,t,n)}},{key:"SendEdgeAAErrorMessage",value:function(e){this.edgeMessageService.SendAutoApplyErrorMessage(e)}}]),e}();function jt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function Jt(){return Jt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=jt(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Jt.apply(this,arguments)}var $t=function(){function e(t){c(this,e),v(this,"platformSpecific",void 0),this.platformSpecific=t}var n;return s(e,[{key:"GetUX",value:(n=t(o().mark((function e(t,n){var r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.platformSpecific.GetUrl(t),n&&(r=r+"?"+new URLSearchParams(n)),e.next=4,fetch(r).then((function(e){return e.text()}));case 4:if(!(i=e.sent)){e.next=9;break}return a=ke.GetProcessedString(i,B.PlainString,this.platformSpecific.GetAppInfoClientName()),e.abrupt("return",a);case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"GetUXStyles",value:function(e){}}]),e}();function Kt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Xt=function(e){p(i,e);var n,r=Kt(i);function i(e,t){var n;return c(this,i),v(u(n=r.call(this,e)),"overlayUX",void 0),v(u(n),"overlayCSS",void 0),v(u(n),"imageEndPoint","https://www.bing.com/api/shopping/v1/ux/images/"),v(u(n),"localDataService",void 0),n.localDataService=t,n.AddEdgeMobileStyles("Android"),n}return s(i,[{key:"GetUX",value:(n=t(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==C.Overlay){e.next=6;break}return this.overlayUX=this.GetOverlayHtml(),this.overlayCSS=this.GetOverlayCSS()+this.GetBNPLTotalAmountStyles(),e.abrupt("return",this.overlayUX);case 6:if(t!==C.ECOverlay){e.next=8;break}return e.abrupt("return",this.GetECOverlayHtml());case 8:return e.abrupt("return",Jt(f(i.prototype),"GetUX",this).call(this,t));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"GetUXStyles",value:function(e){return e===C.Overlay?this.overlayCSS:e===C.ECOverlay?this.GetECOvelayCSS()+this.GetBNPLTotalAmountStyles()+this.GetOverlayCSS():e===C.ShopRunnerOverlay?this.GetOverlayCSS()+this.GetShopRunnerCSS():void 0}},{key:"AddEdgeMobileStyles",value:function(e){e&&-1!==navigator.userAgent.indexOf(e)&&(this.overlayCSS+=this.GetEdgeMobileStyles())}},{key:"GetEdgeMobileStyles",value:function(){return"\n        .divOverlayContentWrapper{\n            max-width: 700px;\n            min-width: 0px;\n            height: min-content;\n            margin: 20px;\n            top: 0px;\n            left: 0px;\n            align-self: center;\n            flex-direction: column;\n            justify-content: space-between;\n            position: relative;\n            border-radius: 4px;\n            background: linear-gradient(0deg, #FFFFFF, #FFFFFF);\n            overflow:auto;\n            z-index: 21;\n        }"}},{key:"GetBNPLTotalAmountStyles",value:function(){return"\n        #bnplContinueButton {\n            width: auto;\n            min-width: 180px;\n            height: 40px;\n            display: block;\n            align-self: center;\n            padding: 5px;\n            align-items: center;\n            color: #FFFFFF;\n            outline:none;\n            box-sizing: border-box;\n            fill: inherit;\n            background: linear-gradient(90.05deg, #8300D4 0.59%, #0048D4 67.54%, #00D4A1 104.11%);\n            border-radius: 8px;\n            border:none;\n            border-color: transparent;\n            text-align: center;\n            cursor: pointer;\n            z-index: 25;\n            font-weight: 600;\n        }\n        #bnplContinueButton:hover {\n            outline: 2px solid transparent;\n            background: linear-gradient(90.05deg, #9E00FF 0.59%, #0048D4 67.54%, #00FFC2 104.11%);\n            color: #FFFFFF;\n        }\n        #bnplContinueButton:focus {\n            box-shadow: 0 0 0 2px inset #fbfdfe, 0 0 0 1px #878787;\n            border: 1px solid #878787;\n        }\n\n        #bnplTotalAmountContainer {\n            border-top: 1px solid rgba(0, 0, 0, 0.09);\n            display: flex;\n            flex: 1 0 100%;\n            flex-direction: column;\n        }\n        .bnpl-top-banner-section {\n            padding: 14px;\n            font-size: 14px;\n            text-align: center;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        .bnpl-top-banner-icon {\n            display: block;\n            width: 23px;\n            height: 23px;\n            margin-left: 6px;\n        }\n        @media (prefers-color-scheme: light) {\n            .bnpl-top-banner-section {\n                background: #EFF6FC;\n            }\n            .bnpl-top-banner-section-exp3 {\n                background: linear-gradient(90deg, #FFF9D9 0%, #E9FBFF 53.12%, #DDEBFF 100%) !important;\n            }\n        }\n        @media (prefers-color-scheme: dark) {\n            .bnpl-top-banner-section {\n                background: #004C87;\n            }\n            .bnpl-top-banner-section-exp3 {\n                background: linear-gradient(270deg, #4C6945 -1.16%, #427681 46.78%, #5D497C 99.98%) !important;\n            }\n        }\n        .bnplLogo {\n            padding-top: 26px;\n            display: flex;\n            justify-content: center;\n            width: 97px;\n            margin: 0 auto;\n        }\n        .bnplTitleSection {\n            padding-top: 20px;\n            text-align: center;\n            display: contents;\n        }\n        .bnplTitle {\n            line-height: 36px;\n            font-size: 28px;\n            font-weight: 500;\n        }\n        .bnplSubTitle {\n            font-size: 16px;\n            line-height: 22px;\n        }\n        .bnplFeeDescription {\n            font-size: 8px;\n            line-height: 11px;\n            width: 320px;\n            margin-inline: auto;\n            font-family: 'Segoe UI', sans-serif;\n        }\n        .bnplShoppingCartValue {\n            padding-top: 22px;\n            padding-bottom: 8px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            position: relative;\n        }\n        .bnplShoppingCartValue::after {\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            width: 230px;\n            height: 1px;\n            content: '';\n            background: #C6C3C5;\n            margin: auto;\n        }\n        .bnplCartValueInput {\n            width: 200px;\n            font-size: 40px;\n            line-height: 1.21;\n            height: 52px;\n            border: none !important;\n            box-shadow: none !important;\n            text-align: center;\n            padding: 0;\n            transition: none;\n            font-weight: 500;\n            outline: none;\n            background: transparent;\n            font-family: 'Segoe UI', sans-serif;\n        }\n        .bnplAmountReminder {\n            text-align: center;\n            font-size: 12px;\n        }\n        .bnplLicense {\n            text-align: center;\n            margin-top: 48px;\n            padding: 0 42px 10px;\n        }\n        .bnplLicense .bnplLicenseText {\n            font-size: 10px;\n        }\n        .bnplLicense .bnplLicenseText a {\n            color: #0066B4;\n        }\n        .bnplErrorMsgContainer {\n            margin: 0 10px 13px;\n        }\n        .bnplErrorMsg {\n            padding: 9px;\n            background-color: #FDE7E9;\n            border-radius: 4px;\n            display: flex;\n            align-items: center;\n        }\n        .bnplErrorIcon {\n            width: 20px;\n            height: 20px;\n            margin-right: 10px;\n        }\n        #bnplErrorText {\n            font-size: 12px;\n        }\n        .bnplTotalAmountFooter {\n            width: auto;\n            height: 64px;\n            display: flex;\n            flex-direction: row;\n            justify-content: space-between;\n            align-items: center;\n            border-top: 1px solid rgba(0, 0, 0, 0.09);\n            background: linear-gradient(180deg, #EEFCFF 20.31%, #F5F9FF 46.88%, #FFFFFF 98.44%);\n            box-sizing: border-box;\n        }\n        #bnplContinueButton:disabled {\n            opacity: 0.3;\n            cursor: not-allowed;\n        }\n        .bnplFooterBtns {\n            display: flex;\n            align-items: center;\n        }\n        #bnplFooterCancel {\n            color: #0066B4;\n            font-size: 14px;\n            margin-right: 12px;\n            cursor: pointer;\n            text-decoration: none;\n        }\n        #bnplContinueButton {\n            margin-right: 24px;\n        }\n        @media (prefers-color-scheme: dark) {\n            #bnplTotalAmountContainer {\n                border-top: 1px solid rgb(255, 255, 255, 0.09);\n            }\n            .bnplCartValueInput {\n                color: #FFFFFF;\n            }\n            .bnplLicense .bnplLicenseText a {\n                color: #86BFEB;\n            }\n            .bnplTotalAmountFooter {\n                background: #424242;\n            }\n            #bnplFooterCancel {\n                color: #86BFEB;\n            }\n        }\n        @media (forced-colors: active) {\n            #bnplContinueButton {\n                background-color: Highlight;\n                forced-color-adjust: none;\n                color: highlightText;\n            }\n            #bnplContinueButton:hover {\n                background: highlighttext;\n                color: highlight;\n                border: 1px solid highlight;\n            }\n            #bnplContinueButton:focus {\n                box-shadow: 0 0 0 2px HighlightText inset;\n                border-color: buttonText;\n            }\n            #bnplContinueButton:focus-visible {\n                border: 1px solid buttontext;\n                box-shadow: highlighttext 0px 0px 0px 2px inset;\n            }\n        }\n        @media (-ms-high-contrast: active) {\n            .bnplErrorIcon svg {\n                fill: ButtonText;\n            }\n        }"}},{key:"GetShortcircuitResultContainer",value:function(){return'\n        <div class="resultWrapper">\n            <div class="overlayContent" id="divOverlayResultShortCircuit">\n                <p class="txtLarge" id="txtResultShortcircuitTitle" role="heading" aria-level="1" style="font-size: 18px"></p>\n                <p class="txtMedium txtshortcircuitDetails" id="txtResultShortcircuitDetails"></p>\n                <button id="btnResultShortcircuitCoupon">\n                    <p id="txtResultShortcircuitCouponCode"></p>\n                    <p id="txtResultShortcircuitCouponDesc" style="margin: 0"></p>\n                </button>\n                <p class="txtMedium txtshortcircuitDetails" id="txtResultShortcircuitCalltoAction"></p>\n            </div>\n        </div>\n        '}},{key:"GetBNPLTotalAmountContainer",value:function(){return'\n        <div id="bnplTotalAmountContainer" class="divOverlayHide">\n            <div class="bnpl-top-banner-section">\n                <p class="txtMedium" id="bnpl-top-banner-content"></p>\n                <img class="bnpl-top-banner-icon" src="'.concat(this.imageEndPoint,'autoApply/EEPositiveIcon.png" aria-hidden="true"></img>\n            </div>\n            <div class="bnplLogo"></div>\n            <div class="bnplTitleSection" id="wallet-extra-title">\n                <p class="bnplTitle txtLarge"></p>\n                <p class="bnplSubTitle txtSmall divOverlayHide"></p>\n                <p class="bnplFeeDescription divOverlayHide"></p>\n            </div>\n            <div class="bnplShoppingCartValue">\n                <input type="text" class="bnplCartValueInput" aria-labelledby="wallet-extra-title" required />\n            </div>\n            <p class="bnplAmountReminder txtSmall"></p>\n            <div class="bnplLicense">\n                <p class="bnplMsDescription txtSmall"></p>\n                <p class="bnplLicenseText txtSmall"></p>\n            </div>\n            <div class="bnplErrorMsgContainer divOverlayHide">\n                <div class="bnplErrorMsg">\n                    <div class="bnplErrorIcon">\n                        <svg fill="#A80000" width="20" height="20" viewBox="0 0 20 20" aria-hidden=true>\n                            <path\n                            d=\'M10 2a8 8 0 110 16 8 8 0 010-16zm0 10.5a.75.75 0 100 1.5.75.75 0 000-1.5zM10 6a.5.5 0 00-.5.41v4.68a.5.5 0 001 0V6.41A.5.5 0 0010 6z\'\n                            fillRule=\'nonzero\'\n                            />\n                        </svg>\n                    </div>\n                    <span id="bnplErrorText" class="txtSmall"></span>\n                </div>\n            </div>\n        </div>')}},{key:"GetSocialSharingButton",value:function(){return this.localDataService.IsFeatureEnabled(Oe.socialSharingUpdate)?'\n            <button id="btnOverlayShareWhatsapp" class="btnSocialSharing divOverlayHide"></button>\n            <button id="btnOverlayShareClipboard" class="btnSocialSharing divOverlayHide">\n                <div id="txtCopyToClipboard" class="showMessage copyInfoTxtMargin">\n                    <p class="copyInfoTxtMargin">Copied link to clipboard</p>\n                </div>\n            </button>':""}},{key:"GetSocialSharingOverlayRefresh",value:function(){return this.localDataService.IsFeatureEnabled(Oe.socialSharingUpdate)?"\n            #divOverlayShare {\n                max-width: 100%;\n                width: 100%;\n                box-sizing: border-box;\n                border-radius: 4px;\n                flex-direction: column;\n                justify-content: flex-start;\n                align-self: flex-start;\n                margin-top: 15px;\n                grid-gap: 4px;\n                grid-template-columns: auto 35px 35px 35px 35px auto;\n            }\n            #txtOverlayShare {\n                font-family: 'Segoe UI', sans-serif;\n                font-size: 14px;\n                font-style: normal;\n                font-weight: normal;\n                line-height: 20px;\n                margin: 8px;\n                grid-column-start: 1;\n                grid-column-end: 2;\n                text-align: start;\n                margin-left: 0px;\n                margin-right: 8px;\n            }\n            .btnSocialSharing {\n                border-color: transparent;\n                background: transparent;\n                cursor: pointer;\n                width: 40px;\n                height: auto;\n                place-self: center;\n                align-items: center;\n                justify-content: center;\n                display: flex;\n            }\n            #txtCopyToClipboard {\n                display: none;\n                background: #FFFFFF;\n                box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.14);\n                border-radius: 4px;\n                transform:translateY(-100%);\n            }\n            .showMessage {\n                display: none;\n                position: fixed;\n                width: 173px;\n                height: 22px;\n                justify-items: center;\n                justify-content: center;\n                align-items: center;\n                align-content: center;\n                z-index: 1;\n                font-family: 'Segoe UI', sans-serif;\n                font-style: normal;\n                font-weight: 400;\n                font-size: 14px;\n                line-height: 20px;\n                text-align: center;\n                color: #1A1A1A;\n                padding: 14px 9px 14px 9px;\n            }\n            .copyInfoTxtMargin {\n                margin: 0;\n            }":"\n            #divOverlayShare {\n                max-width: 283px;\n                width: 100%;\n                box-sizing: border-box;\n                border-radius: 4px;\n                flex-direction: column;\n                justify-content: flex-start;\n                align-self: flex-start;\n                margin-top: 15px;\n                grid-gap: 4px;\n                grid-template-columns: auto 40px 40px;\n            }\n            #txtOverlayShare {\n                font-family: 'Segoe UI', sans-serif;\n                font-size: 14px;\n                font-style: normal;\n                font-weight: normal;\n                line-height: 20px;\n                margin: 8px;\n                grid-column-start: 1;\n                grid-column-end: 2;\n                text-align: start;\n                margin-left: 0px;\n                margin-right: 0px;\n            }\n            .btnSocialSharing {\n                border-color: transparent;\n                background: transparent;\n                cursor: pointer;\n                width: 40px;\n                height: auto;\n                place-self: center;\n                align-items: center;\n                justify-content: center;\n                display: flex;\n            }"}},{key:"GetBNPLTotalAmountFooter",value:function(){return'\n        <div class="bnplTotalAmountFooter divOverlayHide">\n            <div style="display:flex; flex-direction: row;">\n                <img aria-hidden="true" class="imgOverlayExtensionIcon"/>\n                <p class="txtMedium txtClientName"></p>\n            </div>\n            <div class="bnplFooterBtns">\n                <a class="txtSmall overlayClose" id="bnplFooterCancel" href="javascript:void(0)" role="button"></a>\n                <button id="bnplContinueButton" class="txtSmall"></button>\n            </div>\n        </div>'}},{key:"GetECOvelayCSS",value:function(){return"\n        #mainOverlayWrapper {\n            position: relative;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            justify-content: center;\n        }\n        .divOverlayContentWrapper{\n            width: auto;\n            height: auto;\n            min-width: 500px;\n            flex-direction: column;\n            justify-content: space-between;\n            place-self: center;\n            position: absolute;\n            border: 1px solid transparent;\n            border-radius: 4px;\n            background: linear-gradient(0deg, #FFFFFF, #FFFFFF);\n            background: #FFFFFF;\n            overflow:hidden;\n            z-index: 21;\n        }\n        .mainModals {\n            width: 500px;\n            height: 100%;\n            display: flex;\n            flex-direction: column;\n            align-content: center;\n            align-self: center;\n            max-height: calc(100vh - 64px); /* 64px is the footer height */\n            overflow: auto;\n        }\n        .imgOverlayExtensionIcon {\n            width: auto;\n            height: auto;\n            margin: 24px;\n            margin-right: 0px;\n            z-index: 25;\n        }\n        .txtLarge {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 24px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: 600;\n            line-height: 28px;\n            margin: 0px;\n        }\n        .txtMedium {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 14px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: normal;\n            line-height: 20px;\n            margin: 0px;\n        }\n        .txtSmall {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 12px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: normal;\n            line-height: 16px;\n            margin: 0px;\n        }\n        .divOverlayShow{\n            display: flex;\n        }\n        .divOverlayInlineShow{\n            display: inline;\n        }\n        .divOverlayGridShow{\n            display: grid;\n        }\n        .divOverlayHide{\n            display: none !important;\n        }\n        .overlayContent {\n            width: calc(100% - 30px);\n            align-self: center;\n            display: flex;\n            background-color: transparent;\n            flex-direction: column;\n            justify-content: flex-start;\n            align-content: center;\n            align-items: center;\n            text-align: center;\n            margin: 0px;\n            margin-top: 48px;\n            margin-bottom: 25px;\n            flex-grow: 2;\n            z-index: 1;\n        }\n        #txtBarTitle,\n        #txtBarCheckoutTitle {\n            width: calc(100% - 90px);\n            text-align: center;\n            align-self: center;\n        }\n        #txtProgressCouponTitle {\n            width: calc(100% - 90px);\n            text-align: center;\n            align-self: center;\n            margin-bottom: 15px;\n        }\n        #txtProgressTitle {\n            width: calc(100% - 90px);\n        }\n        .txtClientName {\n            font-weight: 500;\n            align-self: center;\n            margin-left: 5px;\n            margin-right: 5px;\n        }\n        #btnOverlayCancel {\n            width: auto;\n            min-width: 133px;\n            height: 32px;\n            display: block;\n            margin: 24px;\n            align-self: center;\n            padding: 5px;\n            align-items: center;\n            border-radius: 2px;\n            border-color: transparent;\n            background: rgba(0, 0, 0, 0.07);\n            outline:none;\n            box-sizing: border-box;\n            fill: inherit;\n            text-align: center;\n            cursor: pointer;\n            z-index: 25;\n        }\n        #btnOverlayClose, #btnOverlayCheckout {\n            width: auto;\n            min-width: 133px;\n            height: 32px;\n            display: block;\n            align-self: center;\n            padding: 5px;\n            align-items: center;\n            color: #FFFFFF;\n            box-sizing: border-box;\n            fill: inherit;\n            background-color: #0078D4;\n            border-radius: 2px;\n            border-color: transparent;\n            text-align: center;\n            cursor: pointer;\n            z-index: 25;\n        }\n        #btnOverlayRebates {\n            width: auto;\n            min-width: 133px;\n            height: 32px;\n            align-self: center;\n            margin-right: 8px;\n            padding: 5px;\n            align-items: center;\n            border-radius: 2px;\n            border-color: transparent;\n            background: rgba(0, 0, 0, 0.07);\n            outline:none;\n            box-sizing: border-box;\n            fill: inherit;\n            text-align: center;\n            cursor: pointer;\n            z-index: 25;\n        }\n        .closeIcon {\n            width: auto;\n            height: auto;\n            position: absolute;\n            right: 12px;\n            top: 12px;\n            cursor: pointer;\n            z-index: 25;\n        }\n        .resultWrapper {\n            width: 100%;\n            height: 100%;\n            top: 0px;\n            left: 0px;\n            flex-direction: column;\n            justify-content: stretch;\n            align-items: center;\n            border-radius: 4px;\n            background: transparent;\n            z-index: 21;\n        }\n        #divOverlayResultSavings {\n            display: flex;\n            align-self: center;\n            justify-content: center;\n            flex-direction: column;\n            text-align: center;\n            width: calc(100% - 165px);\n        }\n        #divOverlayResultPositive {\n            width: inherit;\n        }\n        #divPositiveCouponDetails {\n            width: 100%;\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            text-align: center;\n            margin-top: 16px;\n            color: rgba(0, 0, 0, 0.55);\n        }\n        #divOverlayResultNegative {\n            width: 100%;\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            text-align: start;\n            margin-top: 0px;\n            margin-bottom: 0px;\n        }\n        .txtOverlayResultPositive {\n            margin-top: 0px;\n            margin-bottom: 15px;\n            letter-spacing: unset;\n        }\n        #divOverlayResultCoupon {\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            align-self: center;\n            margin-top: 15px;\n        }\n        #divOverlayShare {\n            width: 283px;\n            border: 1px solid rgba(0, 0, 0, 0.09);\n            box-sizing: border-box;\n            border-radius: 4px;\n            flex-direction: column;\n            justify-content: center;\n            align-self: center;\n            margin-top: 15px;\n            grid-gap: 4px;\n            grid-template-columns: 50% auto auto;\n        }\n        #txtOverlayShare {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 14px;\n            font-style: normal;\n            font-weight: normal;\n            line-height: 20px;\n            margin: 8px;\n            grid-column-start: 1;\n            grid-column-end: 2;\n            text-align: start;\n        }\n        .btnSocialSharing {\n            border-color: transparent;\n            background: transparent;\n            cursor: pointer;\n            width: 40px;\n            height: auto;\n            place-self: center;\n            align-items: center;\n            display: flex;\n            justify-content: center;\n        }\n        #txtResultPositiveCoupon {\n            display: inline;\n            margin-right: 1px;\n            align-self: center;\n            text-transform: uppercase;\n            font-weight: 600;\n            letter-spacing: unset;\n        }\n        .divOverlayFooter {\n            width: auto;\n            height: 64px;\n            display: flex;\n            flex-direction: row;\n            justify-content: space-between;\n            align-items: center;\n            border-top: 1px solid rgba(0, 0, 0, 0.09);\n            background: #F7F7F7;\n            box-sizing: border-box;\n        }\n        #btnOverlayClose:hover, #btnOverlayCheckout:hover {\n            outline: 2px solid transparent;\n            background-color: ButtonFace;\n            color: ButtonText;\n            border-color: ButtonText;\n        }\n        #btnOverlayCancel:hover {\n            outline: 2px solid transparent;\n            background-color: ButtonFace;\n            color: ButtonText;\n            border-color: ButtonText;\n        }\n        #btnOverlayRebates:hover {\n            outline: 2px solid transparent;\n            background-color: ButtonFace;\n            color: ButtonText;\n            border-color: ButtonText;\n        }\n        #btnOverlayClose:focus, #btnOverlayCheckout:focus {\n            border-color: #000000;\n            box-shadow: 0 0 0px 2px #ffffff inset;\n        }\n        #btnOverlayCancel:focus {\n            border-color: #000000;\n            box-shadow: 0 0 0px 2px #ffffff inset;\n        }\n        #btnOverlayRebates:focus {\n            border-color: #000000;\n            box-shadow: 0 0 0px 2px #ffffff inset;\n        }\n        #divImportBrowser {\n            flex-direction: column;\n            align-self: center;\n            margin-top: 15px;\n        }\n        #divJoinRebates {\n            flex-direction: column;\n            align-self: center;\n            margin-top: 10px;\n            width: calc(100% - 100px);\n        }\n        #divImportBrowserWrapper {\n            width: calc(100% - 60px);\n            display: flex;\n            flex-direction: row;\n            align-self: center;\n            margin-top: 15px;\n        }\n        #divJoinRebatesWrapper {\n            display: flex;\n            flex-direction: row;\n            align-self: center;\n            margin-top: 15px;\n        }\n        .hrDivider {\n            width: calc(100% - 20px);\n            margin-bottom: 16px;\n            height: 0px;\n            border: 1px solid rgba(0, 0, 0, 0.1);\n            border-width: 0px;\n            border-top-width: 1px;\n            position: absolute;\n            left: 0;\n            right: 0;\n        }\n        #txtJoinRebates {\n            width: 100%;\n            display: flex;\n            flex-direction: column;\n            flex-grow: 2;\n            margin: 20px;\n            margin-left: 0px;\n            justify-content: center;\n        }\n        #imgPositiveResult {\n            position: absolute;\n            align-self: center;\n            margin-top: 13px;\n        }\n        /* The dots/bullets/indicators */\n        .dot {\n        cursor: pointer;\n        height: 8px;\n        width: 8px;\n        margin: 0 2px;\n        background-color: #bbb;\n        border-radius: 50%;\n        display: inline-block;\n        transition: background-color 0.6s ease;\n        }\n        .active, .dot:hover {\n        background-color: #717171;\n        }\n        /* Fading animation */\n        .fade {\n        -webkit-animation-name: fade;\n        -webkit-animation-duration: 1.5s;\n        animation-name: fade;\n        animation-duration: 1.5s;\n        }\n        @-webkit-keyframes fade {\n        from {opacity: .4}\n        to {opacity: 1}\n        }\n        @keyframes fade {\n        from {opacity: .4}\n        to {opacity: 1}\n        }\n        .show {\n            display:flex;\n        }\n        .hide {\n            display:none;\n        }\n        .ecspan {\n            color: rgba(0, 0, 0, 0.83);\n            display: inline;\n        }\n        .ecspangrey {\n            color: grey;\n        }\n        @media (prefers-color-scheme: dark) {\n            p {\n              color: #FFFFFF!important;\n            }\n            .closeIcon > svg > path {\n                fill: #FFFFFF;\n            }\n            .divOverlayFooter {\n                background: #424242;\n            }\n            .divOverlayContentWrapper {\n                background: #4A4A4A;\n            }\n            #btnOverlayCancel {\n                background: rgba(255, 255, 255, 0.09);\n                color: #FFFFFF;\n            }\n            #btnOverlayRebates {\n                background: rgba(255, 255, 255, 0.09);\n                color: #FFFFFF;\n            }\n            #divOverlayShare {\n                border: 1px solid rgba(255, 255, 255, 0.09);\n            }\n            #divOverlayResultNegative {\n                margin-top: 20px;\n                margin-bottom: 20px;\n            }\n            .ecspan {\n                color: #FFFFFF;\n            }\n        }\n        @media (forced-colors: active) {\n            #btnOverlayClose, #btnOverlayCheckout {\n                background-color: Highlight;\n                forced-color-adjust: none;\n                color: highlightText;\n            }\n            .btnCashbackUpsellCloseOverlay{\n                color:buttontext;\n                border-color:buttontext;\n            }\n            #btnOverlayCancel {\n                background-color: Highlight;\n                forced-color-adjust: none;\n                color: highlightText;\n            }\n            #btnOverlayClose: focus, #btnOverlayCheckout:focus {\n                box-shadow: 0 0 0 2px HighlightText inset;\n                border-color: buttonText;\n            }\n            #btnOverlayCancel: focus {\n                box-shadow: 0 0 0 2px HighlightText inset;\n                border-color: buttonText;\n            }\n            #btnOverlayRebates: focus {\n                box-shadow: 0 0 0 2px HighlightText inset;\n                border-color: buttonText;\n            }\n            #imgPositiveResult {\n                display: none;\n            }\n            .btnSocialSharing {\n                border: none;\n            }\n            #divOverlayProgress {\n                border: 1px solid buttontext;\n            }\n            .textContent {\n                width: calc(100% - 40px);\n            }\n        }\n        @media (max-width: 500px) {\n            .divOverlayContentWrapper{\n                max-width: 500px;\n                height: 100%;\n                top: 0px;\n                left: 0px;\n                align-self: center;\n                flex-direction: column;\n                justify-content: space-between;\n                position: relative;\n                border-radius: 4px;\n                background: linear-gradient(0deg, #FFFFFF, #FFFFFF);\n                overflow:auto;\n                z-index: 21;\n            }\n            .overlayContent {\n                margin-top: 0px;\n                margin-bottom: 0px;\n            }\n            .resultWrapper {\n                height: auto;\n                width: auto;\n                max-width: 500px;\n                top: 0px;\n                left: 0px;\n                flex-direction: column;\n                align-items: center;\n                border-radius: 4px;\n                background: transparent;\n                z-index: 21;\n            }\n            .mainModals {\n                width: 100%;\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                align-content: center;\n                align-self: center;\n            }\n            #txtBarTitle {\n                width: 100%;\n            }\n            #txtProgressTitle {\n                width: 100%;\n            }\n            .txtSmall {\n                display: inline-block;\n            }\n            .txtMedium {\n                display: inline-block;\n            }\n            .txtLarge {\n                display: inline-block;\n            }\n            .divOverlayFooter {\n                width: 100%;\n            }\n        }"}},{key:"GetECOverlayHtml",value:function(){return'\n        <div id="mainOverlayWrapper"><div role="dialog" aria-labelledby="txtProgressTitle" class="divOverlayHide divOverlayContentWrapper divOverlayContentWrapperCheckout" id="divOverlayTestingCouponsWrapper" aria-modal="true">\n            <div class="mainModals mainModalsCheckout">\n                <div class="overlayContent overlayContentCheckout">\n                    <p aria-live="polite" role="heading" aria-level="1" class="txtLargeCheckout txtProgressTitleCheckout" id="txtProgressTitle"></p>\n                    <span id="spanTestingCoupons" role="alert" style="top: 0px; position: fixed;\n                    opacity: 0;"></span>\n                    <div id="divOverlayProgressCheckout">\n                        <div id="divOverlayBar" class="divOverlayBarCheckout" aria-hidden="true"></div>\n                    </div>\n                    <p id="txtBarCheckoutTitle" class="divOverlayHide txtSmall txtBarCheckoutTitleCheckout" style="margin: 16px 0;color: rgba(0, 0, 0, 0.55);" aria-hidden="true"></p>\n                </div>\n            </div>\n            <div class="divOverlayFooter">\n                <div style="display:flex; flex-direction: row;">\n                    <img aria-hidden="true" class="imgOverlayExtensionIcon"/>\n                    <p class="txtMedium txtClientName"></p>\n                </div>\n                <button id="btnOverlayCancel" class="txtSmall overlayClose" autofocus></button>\n            </div>\n        </div>\n        <div class="divOverlayHide divOverlayContentWrapper divOverlayContentWrapperCheckout" id="divOverlayResultWrapper" role="dialog" aria-live="assertive" aria-relevant="text" aria-hidden="true" aria-modal="true">\n            <div class="mainModals mainModalsCheckout">\n                <div class="resultWrapper divOverlayHide">\n                    <div class="overlayContent overlayContentCheckout" id="divOverlayResultPositive">\n                        <div id="divOverlayResultSavings" class="divOverlayHide">\n                            <p class="txtLargeCheckout txtOverlayResultPositive" id="txtPositiveHeader" role="heading" aria-level="1"></p>\n                        </div>\n                        <div id="divOverlayResultCoupon" class="divOverlayHide">\n                            <div style="display: flex; flex-direction: row; justify-content: center; align-self: center;">\n                                <p class="txtMedium"\n                                id="txtResultPositiveCouponDetails" style="margin-left:3px; font-size: 16px; line-height: 24px;"></p>\n                            </div>\n                            <div id="divPositiveCouponDetails">\n                            </div>\n                        </div>\n                        <div id="divOverlayResultCheckoutTitle">\n                            <p class="txtLargeCheckout txtOverlayResultPositive" id="txtECPositiveHeader" role="heading" aria-level="1"></p>\n                            <img id="divCVVSVG" src="'.concat(this.imageEndPoint,'autoApply/EEPositiveIcon.png" aria-hidden="true"></img>\n                        </div>\n                        <div id="divOverlayResultCheckoutDetails">\n                            <p class="txtSmall"\n                                id="txtResultPositiveCheckoutCvv" style="margin-left:3px;color: rgba(0, 0, 0, 0.55);"></p>\n                        </div>\n                    </div>\n                </div>\n                <div class="resultWrapper divOverlayHide">\n                    <div class="overlayContent overlayContentCheckout">\n                        <p class="txtLargeCheckout"\n                                id="txtECResultNegativeTitle" role="heading" aria-level="1"></p>\n                        <div id="divOverlayResultCheckoutTitle">\n                            <p class="txtLargeCheckout txtOverlayResultPositive" id="txtECNegativeHeader" role="heading" aria-level="1"></p>\n                        </div>\n                        <div id="divOverlayResultCheckoutDetails">\n                            <p class="txtSmall"\n                                id="txtResultNegativeCheckoutCvv" style="margin-left:3px;color: rgba(0, 0, 0, 0.55);"></p>\n                        </div>\n                    </div>\n                </div>\n                ').concat(this.GetBNPLTotalAmountContainer(),'\n            </div>\n            <div class="divOverlayFooter divOverlayShow">\n                <div style="display:flex; flex-direction: row;">\n                    <img aria-hidden="true" class="imgOverlayExtensionIcon"/>\n                    <p class="txtMedium txtClientName"></p>\n                </div>\n                <div style="display: flex; flex-direction: row; margin-right: 24px; align-items: center;">\n                    <button id="btnOverlayCheckout" class="txtSmall" autofocus></button>\n                </div>\n            </div>\n            ').concat(this.GetBNPLTotalAmountFooter(),"\n        </div></div>")}},{key:"GetShopRunnerCSS",value:function(){return"\n            .shopRunnerContentWrapper {\n                min-width: 500px;\n                width: 500px;\n                padding: 45px;\n                color: #444444;\n            }\n\n            #shopRunnerContentHeading {\n                display: flex;\n                align-items: center;\n                margin-bottom: 45px;\n            }\n\n            .verticalLine {\n                width: 1.5px;\n                height: 20px;\n                background-color: #A2B0AF;\n                margin-left: 12px;\n                margin-right: 6px;\n            }\n\n            #shopRunnerContentHeading #microsoftLogo {\n                width: 115px;\n            }\n\n            #shopRunnerContentHeading #shopRunnerLogo {\n                width: 150px;\n            }\n\n            #shopRunnerMainContent p {\n                margin-bottom: 10px;\n            }\n\n            #shopRunnerMainContent #btnOverlayClose {\n                float: right;\n                margin-top: 20px;\n                margin-bottom: 20px;\n            }\n\n            #shopRunnerStepsImg {\n                max-width: 500px;\n                margin-top: 15px;\n            }\n\n            .shopRunnerContentFooter {\n                border-top: 1px solid #EBEBEB;\n                padding-top: 20px;\n            }\n        "}},{key:"GetOverlayCSS",value:function(){return"\n        #mainOverlayWrapper {\n            --text-green-savings-color: #008A21;\n        }\n        #mainOverlayWrapper {\n            position: relative;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            justify-content: center;\n        }\n        .divOverlayContentWrapper {\n            width: auto;\n            height: auto;\n            min-width: 700px;\n            flex-direction: column;\n            justify-content: space-between;\n            place-self: center;\n            position: absolute;\n            border: 1px solid transparent;\n            border-radius: 4px;\n            background: linear-gradient(0deg, #FFFFFF, #FFFFFF);\n            background: #FFFFFF;\n            overflow:hidden;\n            z-index: 21;\n        }\n        .divOverlayContentWrapperCheckout {\n            min-width: 500px;\n        }\n        .mainModals {\n            width: 700px;\n            height: 100%;\n            display: flex;\n            flex-direction: column;\n            align-content: center;\n            align-self: center;\n        }\n        .mainModalsCheckout {\n            width: 500px;\n        }\n        .divCommissionValue {\n            display: inline-block;\n            margin: 0px;\n            vertical-align: middle;\n        }\n        .spanCommisionValue {\n            display: flex;\n            height: 30px;\n            line-height: 28px;\n            font-size: 24px;\n            background: #0078D4;\n            color: #fff;\n            font-weight: 500;\n            float: left;\n        }\n        .imgCBTag {\n            display: none;\n        }\n        .imgOverlayExtensionIcon {\n            width: auto;\n            height: auto;\n            margin: 24px;\n            margin-right: 0px;\n            z-index: 25;\n        }\n        .txtLarge {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 24px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: 600;\n            line-height: 28px;\n            margin: 0px;\n        }\n        .txtLargeCheckout {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 26px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: 600;\n            line-height: 36px;\n            margin: 0px;\n        }\n        .txtMedium {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 14px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: normal;\n            line-height: 20px;\n            margin: 0px;\n        }\n        .txtSmall {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 12px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: normal;\n            line-height: 16px;\n            margin: 0px;\n        }\n        .textContent {\n            display: flex;\n            flex-direction: column;\n            align-items: flex-start;\n            justify-content: center;\n            min-height: 300px;\n            margin-top: 10px;\n            margin-bottom: 10px;\n            margin-left: 20px;\n            width: 100%;\n            max-width: 350px;\n        }\n        .txtCashbackUpsellOffer {\n            position: absolute;\n            display: inline-block;\n            width: 343px;\n            height: 64px;\n            left: 40px;\n            top: 105px;\n            font-family: 'Segoe UI', sans-serif;\n            font-style: normal;\n            font-size: 26px;\n            font-weight: 600;\n            line-height: 28px;\n            margin-top: 0px;\n            margin-bottom: 0px;\n            color: #1A1A1A;\n        }\n        .txtCashbackUpsellStoreName{\n            position: absolute;\n            margin-top:0px;\n            margin-bottom:0px;\n            width: 343px;\n            height: 16px;\n            left: 61px;\n            top: 83px;\n            font-family: 'Segoe UI Variable Static Small', sans-serif;\n            font-style: normal;\n            font-weight: 400;\n            font-size: 12px;\n            line-height: 16px;\n            align-items: center;\n            text-align: left;\n            color: #1A1A1A;\n        }\n        .txtCashbackUpsellTitle{\n            position: absolute;\n            margin-top: 0px;\n            margin-bottom: 0px;\n            width: 450px;\n            height: 20px;\n            left: 40px;\n            top: 40px;\n            font-family: 'Segoe UI', sans-serif;\n            font-style: normal;\n            font-weight: 400;\n            font-size: 14px;\n            line-height: 20px;\n            color: #1A1A1A;\n        }\n        .txtCashbackUpsellPrivacy{\n            position: absolute;\n            left: 6.14%;\n            right: 44.7%;\n            top: 64.96%;\n            bottom: 27.49%;\n            font-family: 'Segoe UI Variable Static Small', sans-serif;\n            font-style: normal;\n            font-weight: 400;\n            font-size: 10px;\n            line-height: 14px;\n            color: #7A7A7A;\n        }\n        .txtCashbackUpsellCloseOverlay{\n            font-family: 'Segoe UI Variable Static Text', sans-serif;\n            font-style: normal;\n            font-weight: 400;\n            font-size: 14px;\n            line-height: 20px;\n            color: #036AC4;\n        }\n        .imgStoreLogo{\n            position: absolute;\n            margin-top: 0px;\n            margin-bottom: 0px;\n            width: 16px;\n            height: 16px;\n            left: 41px;\n            top: 83px;\n        }\n        .vdoAutoApply {\n            max-height: 300px;\n        }\n        .divOverlayShow{\n            display: flex;\n        }\n        .divOverlayBlockShow {\n            display: block;\n        }\n        .divOverlayInlineShow{\n            display: inline;\n        }\n        .divOverlayGridShow{\n            display: grid;\n        }\n        .divOverlayHide{\n            display: none!important;\n        }\n        .overlayContent {\n            width: calc(100% - 30px);\n            align-self: center;\n            display: flex;\n            background-color: transparent;\n            flex-direction: row;\n            justify-content: flex-start;\n            align-content: center;\n            align-items: center;\n            text-align: left;\n            margin: 0px;\n            flex-grow: 2;\n            z-index: 1;\n            min-height: 300px;\n        }\n        .overlayContentCheckout {\n            min-height: 172px;\n            flex-direction: column;\n            justify-content: center;\n            text-align: center;\n        }\n        #txtBarTitle,\n        #txtBarCheckoutTitle {\n            width: 100%;\n            text-align: center;\n            align-self: flex-start;\n            text-align: left;\n        }\n        #txtProgressCouponTitle {\n            width: 100%;\n            text-align: center;\n            align-self: flex-start;\n            margin-bottom: 15px;\n            text-align: left;\n        }\n        #divOverlayProgress {\n            width: 100%;\n            align-self: flex-start;\n            margin-top: 12px;\n            margin-bottom: 12px;\n            background-color: rgba(0, 0, 0, 0.07);\n            border-radius: 8px;\n        }\n        #txtProgressTitle {\n            width: 100%;\n            align-text: start;\n            margin-bottom: 40px;\n            font-weight: 500;\n        }\n        .txtProgressTitleCheckout {\n            margin-bottom: 23px!important;\n            margin-top: 53px!important;\n        }\n        .txtClientName {\n            font-weight: 400;\n            align-self: center;\n            margin-left: 5px;\n            margin-right: 5px;\n        }\n        #divOverlayBar {\n            width: 1%;\n            height: 8px;\n            background: linear-gradient(90deg, #CB5CFF 0%, #35CFFF 50%, #64E816 100%);\n            border-radius: 8px;\n        }\n        .divOverlayBarCheckout {\n            background: linear-gradient(90deg, #E70780 0%, #FFA318 32.29%, #01C190 58.33%, #01ADA5 70.83%, #00A9FF 98.96%)!important;\n        }\n        .txtSavingsColor {\n            color: var(--text-green-savings-color);\n            font-size: 28px;\n            line-height: 33px;\n            font-weight: 500;\n        }\n        #btnOverlayCancel {\n            width: auto;\n            min-width: 130px;\n            height: 38px;\n            display: block;\n            margin: 24px;\n            align-self: center;\n            padding: 5px;\n            align-items: center;\n            border-radius: 8px;\n            background: #FFFFFF;\n            border: 1px solid #008076;\n            outline:none;\n            box-sizing: border-box;\n            fill: inherit;\n            text-align: center;\n            cursor: pointer;\n            z-index: 25;\n            color: #008076;\n            font-weight: 600;\n        }\n        #btnOverlayClose, #btnOverlayCheckout {\n            box-sizing: border-box;\n            width: auto;\n            min-width: 196px;\n            height: 40px;\n            display: block;\n            align-self: center;\n            padding: 5px;\n            align-items: center;\n            color: #FFFFFF;\n            box-sizing: border-box;\n            background: linear-gradient(#036EC9,#036EC9) padding-box, linear-gradient(180deg, #1C7DCE 90%, #024C8B 100%) border-box;\n            border-radius: 8px;\n            fill: inherit;\n            border-color: transparent;\n            text-align: center;\n            cursor: pointer;\n            z-index: 25;\n            font-weight: 600;\n            border: 1px solid transparent;\n        }\n        #btnOverlayRebates {\n            width: auto;\n            min-width: 196px;\n            height: 38px;\n            display: block;\n            margin-right: 8px;\n            align-self: center;\n            padding: 5px;\n            align-items: center;\n            border-radius: 8px;\n            background: #FFFFFF;\n            border: 1px solid #008076;\n            outline:none;\n            box-sizing: border-box;\n            fill: inherit;\n            text-align: center;\n            cursor: pointer;\n            z-index: 25;\n            color: #008076;\n            font-weight: 600;\n        }\n        .closeIcon {\n            width: auto;\n            height: auto;\n            position: absolute;\n            right: 12px;\n            top: 12px;\n            cursor: pointer;\n            z-index: 25;\n        }\n        .resultWrapper {\n            width: 100%;\n            height: 100%;\n            top: 0px;\n            left: 0px;\n            flex-direction: column;\n            justify-content: stretch;\n            align-items: center;\n            border-radius: 4px;\n            background: transparent;\n            z-index: 21;\n        }\n        #divOverlayResultSavings {\n            display: flex;\n            align-self: flex-start;\n            justify-content: center;\n            flex-direction: column;\n            text-align: left;\n            width: 100%;\n        }\n        #divOverlayResultPositive {\n            width: inherit;\n        }\n        #divPositiveCouponDetails {\n            width: 100%;\n            display: flex;\n            flex-direction: row;\n            justify-content: flex-start;\n            text-align: left;\n            color: rgba(0, 0, 0, 0.55);\n            grid-template-rows: auto 5% auto;\n            align-items: baseline;\n        }\n        #divOverlayResultNegative {\n            width: 100%;\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            text-align: left;\n            margin-top: 0px;\n            margin-bottom: 0px;\n        }\n        .txtOverlayResultPositive {\n            margin-top: 0px;\n            margin-bottom: 15px;\n            letter-spacing: unset;\n            font-weight: 500;\n        }\n        #divOverlayResultCoupon {\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            align-self: flex-start;\n            margin-top: 10px;\n            row-gap: 3px;\n        }\n        ".concat(this.GetSocialSharingOverlayRefresh(),"\n        #txtResultPositiveCoupon {\n            display: inline;\n            margin-right: 1px;\n            align-self: flex-start;\n            text-transform: uppercase;\n            font-weight: 600;\n            letter-spacing: unset;\n            text-align: left;\n        }\n        .divOverlayFooter {\n            width: auto;\n            height: 64px;\n            display: flex;\n            flex-direction: row;\n            justify-content: space-between;\n            align-items: center;\n            border-top: 1px solid rgba(0, 0, 0, 0.09);\n            background: linear-gradient(180deg, #EEFCFF 20.31%, #F5F9FF 46.88%, #FFFFFF 98.44%);\n            box-sizing: border-box;\n        }\n        #btnOverlayClose:hover, #btnOverlayCheckout:hover {\n            background: #006cbe;\n            color: #FFFFFF;\n        }\n        #btnOverlayCancel:hover, #btnOverlayRebates:hover {\n            outline: 2px solid transparent;\n            background: linear-gradient(267.73deg, #F0FEFF -9.53%, #DBFFFB 45.72%, #F8FDFF 97.76%);\n            color: #008076;\n            border-color: #008076;\n        }\n        #btnOverlayClose:focus, #btnOverlayCheckout:focus {\n            box-shadow: 0 0 0 2px inset #fbfdfe, 0 0 0 1px #878787;\n            border: 1px solid #878787;\n        }\n        #btnOverlayCancel:focus {\n            box-shadow: 0 0 0 2px inset #fbfdfe, 0 0 0 1px #878787;\n            border: 1px solid #878787;\n        }\n        #btnOverlayRebates:focus {\n            box-shadow: 0 0 0 2px inset #fbfdfe, 0 0 0 1px #878787;\n            border: 1px solid #878787;\n        }\n        #divImportBrowser {\n            flex-direction: column;\n            align-self: flex-start;\n            margin-top: 15px;\n        }\n        #divJoinRebates {\n            flex-direction: column;\n            align-self: flex-start;\n            margin-top: 10px;\n            width: 100%;\n        }\n        #divImportBrowserWrapper {\n            width: calc(100% - 60px);\n            display: flex;\n            flex-direction: row;\n            align-self: flex-start;\n            margin-top: 15px;\n        }\n        #divJoinRebatesWrapper {\n            display: flex;\n            flex-direction: row;\n            align-self: flex-start;\n            margin-top: 10px;\n        }\n        .hrDivider {\n            width: 100%;\n            height: 0px;\n            border: 1px solid rgba(0, 0, 0, 0.1);\n            border-width: 0px;\n            border-top-width: 1px;\n            left: 0;\n            right: 0;\n        }\n        #txtJoinRebates {\n            width: 100%;\n            display: flex;\n            flex-direction: column;\n            flex-grow: 2;\n            margin: 20px;\n            margin-left: 0px;\n            justify-content: center;\n        }\n        #divOverlayResultCheckoutTitle {\n            display: flex;\n            flex-direction: row;\n            column-gap: 4px;\n            justify-content: center;\n            align-items: center;\n            margin-bottom: 23px;\n        }\n        #txtECPositiveHeader {\n            margin: 0px;\n        }\n        #txtBarCheckoutTitle {\n            text-align: center;\n        }\n        .txtBarCheckoutTitleCheckout {\n            margin-bottom: 41px!important;\n        }\n        #divOverlayProgressCheckout {\n            width: calc(100% - 50px);\n            align-self: center;\n            margin-top: 12px;\n            margin-bottom: 12px;\n            background-color: rgba(0, 0, 0, 0.07);\n            border-radius: 8px;\n        }\n        #imgPositiveResult {\n            position: absolute;\n            align-self: center;\n            margin-top: 13px;\n        }\n        #divOverlayPromptPos, #divOverlayPromptNeg {\n            display: flex;\n            column-gap: 9px;\n        }\n        #divIconPromptPos, #divIconPromptNeg {\n            width: 24px;\n            height: 24px;\n        }\n        #txtAttCouponPromptPos, #txtAttCouponPromptNeg {\n            font-size: 18px;\n            line-height: 24px;\n            color: #949494;\n        }\n        #btnColorfulPos, #btnColorfulNeg {\n            background: linear-gradient(88.14deg, #018DC8 0.49%, #01CC83 53.44%, #0CBFC9 104.22%);\n            height: 36px;\n            width: auto;\n            max-width: 147px;\n            border-radius: 8px;\n            padding: 1.5px;\n            margin-top: 16px;\n        }\n        #btnTransparentNeg{\n            background: transparent;\n            border-color: #1C7DCE;\n            border-radius: 4px;\n            position: absolute;\n            width: 258px;\n            height: 32px;\n            left: 369px;\n            top: 319px;\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            align-items: center;\n            padding: 2px;\n        }\n        #btnSolidColorNeg {\n            background: linear-gradient(0deg, #036EC9, #036EC9), linear-gradient(180deg, #1C7DCE 90%, #024C8B 100%);\n            border-radius:4px;\n            width: 200px;\n            height: 32px;\n            left: 40px;\n            top: 190px;\n            padding: 2px;\n            position: absolute;\n        }\n        #btnContinueShoppingPos, #btnContinueShoppingNeg {\n            background: white;\n            height: calc(100%);\n            width: calc(100%);\n            border-radius: 6px;\n            line-height: 20px;\n            color: #008076;\n            font-weight: 500;\n            border: none;\n            cursor: pointer;\n        }\n        #btnJoinAndActivate{\n            background: linear-gradient(0deg, #036EC9, #036EC9), linear-gradient(180deg, #1C7DCE 90%, #024C8B 100%);\n            border-radius:4px;\n            border-color: transparent;\n            height: calc(100%);\n            width: calc(100%);\n            font-weight:400;\n            font-size: 14px;\n            line-height:20px;\n        }\n        #btnCashbackUpsellCloseOverlay{\n            background: transparent;\n            justifyContent: center;\n            border-style:solid;\n            border-radius: 4px;\n            width: 258px;\n            height: 32px;\n            font-weight: 400;\n        }\n        /* The dots/bullets/indicators */\n        .dot {\n            cursor: pointer;\n            height: 8px;\n            width: 8px;\n            margin: 0 2px;\n            background-color: #bbb;\n            border-radius: 50%;\n            display: inline-block;\n            transition: background-color 0.6s ease;\n        }\n        .active, .dot:hover {\n            background-color: #717171;\n        }\n        /* Fading animation */\n        .fade {\n            -webkit-animation-name: fade;\n            -webkit-animation-duration: 1.5s;\n            animation-name: fade;\n            animation-duration: 1.5s;\n        }\n        @-webkit-keyframes fade {\n            from {opacity: .4}\n            to {opacity: 1}\n        }\n        @keyframes fade {\n            from {opacity: .4}\n            to {opacity: 1}\n        }\n        .show {\n            display:flex;\n        }\n        .hide {\n            display:none;\n        }\n        .ecspan {\n            color: rgba(0, 0, 0, 0.83);\n            display: inline;\n        }\n        #divOverlayResultError, #divOverlayResultShortCircuit {\n            flex-direction: column;\n            justify-content: center;\n        }\n        .txtshortcircuitDetails {\n            margin-top: 15px;\n            width: calc(100% - 100px);\n            font-size: 16px;\n            line-height: 24px;\n            text-align: center;\n        }\n        #btnResultShortcircuitCoupon {\n            cursor: pointer;\n            margin-top: 15px;\n            width: 350px;\n            height: 100px;\n            border-radius: 10px;\n            border-style: dashed;\n            border-width: 1px;\n            border-color: #A6C6E3;\n            display: flex;\n            flex-direction: column;\n            justify-content: space-around;\n            align-items: center;\n            padding: 10px;\n            background-color: transparent;\n        }\n        #btnResultShortcircuitCoupon:hover {\n            background-color: rgba(0, 87, 173, 0.05);\n        }\n        #txtResultShortcircuitCouponCode {\n            margin: 0;\n            font-size: 26px;\n            color: #0056AE;\n            font-weight: bold\n        }\n        @media (prefers-color-scheme: dark) {\n            p {\n              color: #FFFFFF!important;\n            }\n            .closeIcon > svg > path {\n                fill: #FFFFFF;\n            }\n            .divOverlayFooter {\n                background: #424242;\n            }\n            .divOverlayContentWrapper {\n                background: #4A4A4A;\n            }\n            #btnOverlayCancel {\n                background: rgba(255, 255, 255, 0.09);\n                color: #FFFFFF;\n            }\n            #txtCopyToClipboard {\n                background: #454446;\n            }\n            #btnOverlayRebates {\n                background: rgba(255, 255, 255, 0.09);\n                color: #FFFFFF;\n            }\n            .ecspan {\n                color: #FFFFFF;\n            }\n            .overlayContent {\n                background: #454446;\n            }\n            .mainModals {\n                background: #454446;\n            }\n            #btnContinueShoppingPos, #btnContinueShoppingNeg {\n                background: #454446;\n                color: #02d9c8;\n            }\n        }\n        @media (forced-colors: active) {\n            #btnOverlayClose, #btnOverlayCheckout {\n                background: Highlight;\n                forced-color-adjust: none;\n                color: highlightText;\n            }\n            #btnCashbackUpsellCloseOverlay{\n                color:buttontext;\n                border-color:buttontext;\n            }\n            #btnOverlayClose:hover, #btnOverlayCheckout:hover {\n                background: highlighttext;\n                color: highlight;\n                border: 1px solid highlight;\n            }\n            #btnOverlayCancel {\n                background: Highlight;\n                forced-color-adjust: none;\n                color: highlightText;\n            }\n            #btnOverlayCancel:hover {\n                background: highlighttext;\n                color: highlight;\n                border: 1px solid highlight;\n            }\n            #divOverlayBar {\n                background: Highlight;\n                forced-color-adjust: none;\n            }\n            #btnOverlayClose:focus-visible, #bnplContinueButton:focus-visible, #btnOverlayCheckout:focus-visible {\n                outline: 2px solid transparent;\n                border: 1px solid buttontext;\n                box-shadow: highlighttext 0px 0px 0px 2px inset;\n            }\n            #btnOverlayCancel:focus-visible {\n                box-shadow: 0 0 0 2px HighlightText inset;\n                border-color: buttonText;\n            }\n            #btnOverlayRebates:hover, #btnOverlayRebates:focus-visible {\n                outline: 2px solid transparent;\n                background: highlighttext;\n                color: highlight;\n                border: 1px solid highlight;\n            }\n            #imgPositiveResult {\n                display: none;\n            }\n            .vdoAutoApply {\n                display: none;\n            }\n            .btnSocialSharing {\n                border: none;\n            }\n            #divOverlayProgress {\n                border: 1px solid buttontext;\n            }\n            .textContent {\n                width: calc(100% - 40px);\n            }\n        }\n        @media (max-width: 700px) {\n            .divOverlayContentWrapper{\n                max-width: 700px;\n                height: 100%;\n                top: 0px;\n                left: 0px;\n                align-self: flex-start;\n                flex-direction: column;\n                justify-content: space-between;\n                position: relative;\n                border-radius: 4px;\n                background: linear-gradient(0deg, #FFFFFF, #FFFFFF);\n                overflow:auto;\n                z-index: 21;\n            }\n            .textContent {\n                min-height: unset;\n            }\n            .overlayContent {\n                margin-top: 0px;\n                margin-bottom: 0px;\n            }\n            .resultWrapper {\n                height: 100%;\n                width: auto;\n                max-width: 700px;\n                top: 0px;\n                left: 0px;\n                flex-direction: column;\n                align-items: center;\n                border-radius: 4px;\n                background: transparent;\n                z-index: 21;\n            }\n            .mainModals {\n                width: 100%;\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                align-content: center;\n                align-self: center;\n            }\n            #txtBarTitle {\n                width: 100%;\n            }\n            #txtProgressTitle {\n                width: 100%;\n            }\n            #divOverlayProgress {\n                width: 100%;\n                align-self: flex-start;\n                margin-top: 12px;\n                margin-bottom: 12px;\n                background-color: rgba(0, 0, 0, 0.07);\n                border-radius: 8px;\n            }\n            #divOverlayBar {\n                width: 1%;\n                height: 8px;\n                background-color: #0078D4;\n                border-radius: 8px;\n            }\n            .txtSmall {\n                display: inline-block;\n            }\n            .txtMedium {\n                display: inline-block;\n            }\n            .txtLarge {\n                display: inline-block;\n            }\n            .divOverlayFooter {\n                width: 100%;\n            }\n            .vdoAutoApply {\n                display: none;\n            }\n        }")}},{key:"GetOverlayHtml",value:function(){return'<div id="mainOverlayWrapper"><div role="dialog" aria-labelledby="txtProgressTitle" class="divOverlayHide divOverlayContentWrapper" id="divOverlayTestingCouponsWrapper" aria-modal="true">\n        <div class="mainModals">\n            <div class="overlayContent">\n                <div class="textContent">\n                    <p aria-live="polite" role="heading" aria-level="1" class="txtLarge" id="txtProgressTitle"></p>\n                    <span id="spanTestingCoupons" role="alert" style="top: 0px; position: fixed;\n                    opacity: 0;"></span>\n                    <p id="txtBarCheckoutTitle" class="divOverlayHide txtSmall" style="margin: 16px 0;color: rgba(0, 0, 0, 0.55);" aria-hidden="true"></p>\n                    <p id="txtBarTitle" class="txtSmall" ></p>\n                    <div id="divOverlayProgress">\n                        <div id="divOverlayBar" aria-hidden="true"></div>\n                    </div>\n                    <p class="txtMedium" id="txtProgressCouponTitle"></p>\n                    <p id="txtECCurrentProgressTitle" class="divOverlayHide txtSmall"></p>\n                </div>\n                <video aria-hidden="true" muted="true" loop name="media" class="vdoAutoApply"><source id="vdoTestingCoupons" type="video/mp4"></video>\n            </div>\n        </div>\n        <div class="divOverlayFooter">\n            <div style="display:flex; flex-direction: row;">\n                <img aria-hidden="true" class="imgOverlayExtensionIcon"/>\n                <p class="txtMedium txtClientName"></p>\n            </div>\n            <button id="btnOverlayCancel" class="txtMedium overlayClose" autofocus></button>\n        </div>\n    </div>\n    <div class="divOverlayHide divOverlayContentWrapper" id="divOverlayResultWrapper" role="dialog" aria-live="assertive" aria-relevant="text" aria-hidden="true" aria-modal="true">\n        <div class="mainModals">\n            <div class="resultWrapper">\n                <div class="overlayContent" id="divOverlayResultPositive">\n                    <div class="textContent" style="margin-left: 36px;">\n                        <div id="divOverlayResultSavings">\n                            <p class="txtLarge txtOverlayResultPositive" id="txtPositiveHeader" role="heading" aria-level="1"></p>\n                        </div>\n                        <div id="divOverlayResultCoupon">\n                            <div style="display: flex; flex-direction: row; align-self: flex-start;">\n                                <p class="txtMedium"\n                                id="txtResultPositiveCouponDetails" style="font-size: 12px; line-height: 20px; text-align: left;"></p>\n                            </div>\n                            <div class="txtMedium"\n                            id="txtResultPositiveCashBackDetails" style="display: none; margin-bottom: 10px; font-size: 12px; line-height: 20px; text-align: left;"></div>\n                            <div id="divPositiveCouponDetails">\n                            </div>\n                        </div>\n                        <div id="divOverlayAttCouponPos" class="divOverlayHide">\n                            <div id="divOverlayPromptPos"><div id="iconPromptPos" aria-hidden="true"></div><p class="txtLarge" id="txtAttCouponPromptPos"></p></div>\n                            <p class="txtLarge" id="txtAttCouponTitlePos" role="heading" aria-level="2" style="font-size: 20px;"></p>\n                            <div id="btnColorfulPos"><button class="txtMedium" id="btnContinueShoppingPos"></button></div>\n                        </div>\n                        <div id="divOverlayResultExpressCheckoutPositive" class="divOverlayHide" style="margin-top:17px;">\n                            <div id="divOverlayResultCheckoutTitle">\n                                <p class="txtSmall txtOverlayResultPositive" id="txtECPositiveHeader" style="line-height:24px;color:rgba(0, 0, 0, 0.83);" role="heading" aria-level="1"></p>\n                            </div>\n                            <div id="divOverlayResultCheckoutDetails">\n                                <svg style="margin:auto; margin-top:10px; margin-bottom:5px" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                <rect x="1" y="8" width="30" height="16" rx="1" fill="#1F65F1"/>\n                                <rect x="1" y="10" width="30" height="3" fill="#1243A6"/>\n                                <rect x="2" y="14" width="14" height="4" rx="1" fill="#F5F5F5"/>\n                                <circle cx="24" cy="20" r="7.5" fill="white" stroke="#FFAC01"/>\n                                <path d="M21.5947 20.2495L20.3906 20.4561L21.2344 21.4624L20.6104 21.8931L19.96 20.7505L19.3096 21.8931L18.6812 21.4624L19.5293 20.4561L18.3208 20.2495L18.5713 19.5464L19.7007 19.999L19.5601 18.6982H20.3599L20.2192 19.999L21.3486 19.5464L21.5947 20.2495ZM25.5059 20.2495L24.3018 20.4561L25.1455 21.4624L24.5215 21.8931L23.8711 20.7505L23.2207 21.8931L22.5923 21.4624L23.4404 20.4561L22.2319 20.2495L22.4824 19.5464L23.6118 19.999L23.4712 18.6982H24.271L24.1304 19.999L25.2598 19.5464L25.5059 20.2495ZM29.417 20.2495L28.2129 20.4561L29.0566 21.4624L28.4326 21.8931L27.7822 20.7505L27.1318 21.8931L26.5034 21.4624L27.3516 20.4561L26.1431 20.2495L26.3936 19.5464L27.5229 19.999L27.3823 18.6982H28.1821L28.0415 19.999L29.1709 19.5464L29.417 20.2495Z" fill="#1F65F1"/>\n                                <path d="M3 20H7" stroke="#F5F5F5" stroke-linecap="round"/>\n                                <path d="M3 22H6" stroke="#F5F5F5" stroke-linecap="round"/>\n                                </svg>\n                                <p class="txtSmall"\n                                    id="txtResultPositiveCheckoutCvv" style="margin-left:3px;color: rgba(0, 0, 0, 0.55);"></p>\n                            </div>\n                        </div>\n                        <div id="divOverlayShare" class="divOverlayHide" role="group" aria-labelledby="txtOverlayShare">\n                        <p id="txtOverlayShare" class="divOverlayInlineShow"></p>\n                        <button id="btnOverlayShareFB" class="btnSocialSharing divOverlayHide"></button>\n                        <button id="btnOverlayShareTwitter" class="btnSocialSharing divOverlayHide"></button>\n                        '.concat(this.GetSocialSharingButton(),'\n                        <button id="btnOverlayShareWhatsapp" class="btnSocialSharing divOverlayHide"></button>\n                        <button id="btnOverlayShareClipboard" class="btnSocialSharing divOverlayHide">\n                            <div id="txtCopyToClipboard" class="showMessage copyInfoTxtMargin">\n                                <p class="copyInfoTxtMargin">Copied link to clipboard</p>\n                            </div>\n                        </button>\n                        </div>\n                        <div id="divJoinRebates" class="divOverlayHide">\n                        <hr class="hrDivider"></hr>\n                        </div>\n                        <div id="divImportBrowser" class="divOverlayHide">\n                        <hr class="hrDivider"></hr>\n                        </div>\n                    </div>\n                    <video aria-hidden="true" name="media" class="vdoAutoApply"><source id="vdoResultPositive" type="video/mp4"></video>\n                </div>\n            </div>\n            <div class="resultWrapper">\n                <div class="overlayContent" id="divOverlayResultNegative" >\n                    <div id="txtContentNegative" style="display: flex; flex-direction: column;">\n                        <p class="txtLarge"\n                            id="txtResultNegativeTitle" role="heading" aria-level="1"></p>\n                        <div id="divOverlayResultExpressCheckoutNegative" class="divOverlayHide" style="margin-top:30px;">\n                            <div id="divOverlayResultCheckoutTitle">\n                                <p class="txtMedium" id="txtECNegativeHeader" style="line-height:24px;color:rgba(0, 0, 0, 0.83);" role="heading" aria-level="1"></p>\n                            </div>\n                            <div id="divOverlayResultCheckoutDetails">\n                                <svg style="margin:auto; margin-top:10px; margin-bottom:5px" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                <rect x="1" y="8" width="30" height="16" rx="1" fill="#1F65F1"/>\n                                <rect x="1" y="10" width="30" height="3" fill="#1243A6"/>\n                                <rect x="2" y="14" width="14" height="4" rx="1" fill="#F5F5F5"/>\n                                <circle cx="24" cy="20" r="7.5" fill="white" stroke="#FFAC01"/>\n                                <path d="M21.5947 20.2495L20.3906 20.4561L21.2344 21.4624L20.6104 21.8931L19.96 20.7505L19.3096 21.8931L18.6812 21.4624L19.5293 20.4561L18.3208 20.2495L18.5713 19.5464L19.7007 19.999L19.5601 18.6982H20.3599L20.2192 19.999L21.3486 19.5464L21.5947 20.2495ZM25.5059 20.2495L24.3018 20.4561L25.1455 21.4624L24.5215 21.8931L23.8711 20.7505L23.2207 21.8931L22.5923 21.4624L23.4404 20.4561L22.2319 20.2495L22.4824 19.5464L23.6118 19.999L23.4712 18.6982H24.271L24.1304 19.999L25.2598 19.5464L25.5059 20.2495ZM29.417 20.2495L28.2129 20.4561L29.0566 21.4624L28.4326 21.8931L27.7822 20.7505L27.1318 21.8931L26.5034 21.4624L27.3516 20.4561L26.1431 20.2495L26.3936 19.5464L27.5229 19.999L27.3823 18.6982H28.1821L28.0415 19.999L29.1709 19.5464L29.417 20.2495Z" fill="#1F65F1"/>\n                                <path d="M3 20H7" stroke="#F5F5F5" stroke-linecap="round"/>\n                                <path d="M3 22H6" stroke="#F5F5F5" stroke-linecap="round"/>\n                                </svg>\n                                <p class="txtSmall"\n                                    id="txtResultNegativeCheckoutCvv" style="margin-left:3px;color: rgba(0, 0, 0, 0.55);"></p>\n                            </div>\n                        </div>\n                        <p class="txtMedium"\n                            id="txtResultNegativeDetails" style="margin-top: 10px; font-size: 16px; line-height: 24px; color: #767676;"></p>\n                        <div id="divOverlayAttCouponNeg" class="divOverlayHide">\n                            <div id="divOverlayPromptNeg"><div id="iconPromptNeg" aria-hidden="true"></div><p class="txtLarge" id="txtAttCouponPromptNeg"></p></div>\n                            <p class="txtLarge" id="txtAttCouponTitleNeg" role="heading" aria-level="2" style="font-size: 20px;"></p>\n                            <div id="btnColorfulNeg"><button class="txtMedium" id="btnContinueShoppingNeg"></button></div>\n                        </div>\n                    </div>\n                    <video aria-hidden="true" name="media" class="vdoAutoApply"><source id="vdoResultNegative" type="video/mp4"></video>\n                </div>\n            </div>\n            <div class="resultWrapper">\n                <div class="overlayContent" id="divOverlayResultNegativeCashbackUpsell" >\n                    <div class="textContent" id="txtContentNegativeCashbackUpsell" style="display: flex; flex-direction: column; top: 0px;">\n                        <p class="txtCashbackUpsellTitle"\n                            id="txtResultNegativeCashbackUpsellTitle" ></p>\n                        <p class="txtCashbackUpsellStoreName" id="txtStore"></p>\n                        <img class="imgStoreLogo" id="imgStoreLogo" style="position:absolute; left:41px; top: 83px; width:16px; height:16px;"></img>\n                        <div class="txtCashbackUpsellOffer"\n                            id="txtResultNegativeCashbackUpsellDetails"></div>\n                            <a id=infoIcon class="infoIcon" part="control" href="#" style="display:inline-block; position: absolute;"></a>\n                        <div id="btnSolidColorNeg"><button class="txtMedium" id="btnJoinAndActivate" style="color:#FFFFFF"></button></div>\n                        <p class="txtCashbackUpsellPrivacy" id="txtCashbackUpsellPrivacyTerms"></p>\n                        <div id="divOverlayAttCouponNeg" class="divOverlayHide">\n                            <div id="divOverlayPromptNeg"><div id="iconPromptNeg" aria-hidden="true"></div><p class="txtLarge" id="txtAttCouponPromptNeg"></p></div>\n                            <p class="txtLarge" id="txtAttCouponTitleNeg" role="heading" aria-level="2" style="font-size: 20px;"></p>\n                            <div id="btnContinueShoppingNeg"><button class="txtMedium" id="btnCashbackUpsellCloseOverlay" style="color:#FFFFFF"></button></div>\n                        </div>\n                    </div>\n                    <video aria-hidden="true" name="media" class="vdoAutoApply"><source id="vdoResultNegativeCashbackUpsell" type="video/mp4"></video>\n                </div>\n            </div>\n            <div class="resultWrapper">\n                <div class="overlayContent" id="divOverlayResultError">\n                    <p class="txtLarge" id="txtResultErrorTitle" role="heading" aria-level="1"></p>\n                    <p class="txtMedium" id="txtResultErrorDetails" style="margin-top: 15px; width: calc(100% - 100px); font-size: 16px; line-height: 24px; text-align: center; color: rgba(121, 121, 121, 0.55);"></p>\n                </div>\n            </div>\n            ').concat(this.GetShortcircuitResultContainer(),"\n            ").concat(this.GetBNPLTotalAmountContainer(),'\n        </div>\n        <div class="divOverlayFooter">\n            <div style="display:flex; flex-direction: row;">\n                <img aria-hidden="true" class="imgOverlayExtensionIcon"/>\n                <p aria-hidden="true" id="edgeShoppingLabel" class="txtMedium txtClientName"></p>\n            </div>\n            <div style="display: flex; flex-direction: row; margin-right: 24px; align-items: center;">\n                <button id="btnOverlayRebates" class="txtSmall" style="display: none;"></button>\n                <button id="btnOverlayClose" class="txtMedium" autofocus></button>\n            </div>\n        </div>\n        ').concat(this.GetBNPLTotalAmountFooter(),"\n    </div></div>")}}]),i}($t),Yt=Xt,Zt=function(){function e(){c(this,e)}return s(e,[{key:"SaveTransactionToEdgeLocalStore",value:function(e,t){this.SetStorageValue(e,t)}},{key:"SendAutoApplyStartMessage",value:function(){this.SendMessage(Ae.AutoApplyStart,[])}},{key:"SendExpressCheckoutStartMessage",value:function(){this.SendMessage(Ae.ExpressCheckoutStart,[])}},{key:"SendOtherSellersStartMessage",value:function(){this.SendMessage(Ae.OtherSellerStart,[])}},{key:"SendOtherSellersCompleteMessage",value:function(e,t,n){var r=[n,e.toString(),t.toString()];this.SendMessage(Ae.OtherSellerComplete,r)}},{key:"SendPrintCouponsStartMessage",value:function(){this.SendMessage(Ae.PrintableCouponsStart,[])}},{key:"SendPrintCouponsCompleteMessage",value:function(){this.SendMessage(Ae.PrintableCouponsComplete,[])}},{key:"SendOtherSellersClosedMessaged",value:function(){this.SendMessage(Ae.OtherSellerClosed,[])}},{key:"SendOtherSellersErrorMessage",value:function(){this.SendMessage(Ae.OtherSellerError,[])}},{key:"SendActivateCashbackMessage",value:function(){this.SendMessage(Ae.ActivateCashback,[])}},{key:"SendAutoApplyPositiveMessage",value:function(e,t,n){var r=null!=n?n:0,o=[e?"true":"false",(null!=t?t:0).toString(),r.toFixed(2),null!=e?e:""];this.SendMessage(Ae.AutoApplyComplete,o)}},{key:"SendAutoApplyNegativeMessage",value:function(){this.SendMessage(Ae.AutoApplyComplete,["false"])}},{key:"SendAutoApplyErrorMessage",value:function(e){var t=null!=e?e:De.Unknown;this.SendMessage(Ae.AutoApplyError,[t])}},{key:"SendAutoApplyCancelledMessage",value:function(){this.SendMessage(Ae.AutoApplyClosed,[])}},{key:"SaveExpressCheckoutStatus",value:function(e){var t="";e&&(t=e.ToString()),this.SendMessage(Ae.SetExpressCheckoutState,[t])}},{key:"SendExpressCheckoutCompletedMessage",value:function(){this.SendMessage(Ae.ExpressCheckoutComplete,[])}},{key:"SetStorageValue",value:function(e,t){this.SendMessage(Ae.SetStorageValue,[e,t])}},{key:"DeleteStorageValue",value:function(e){this.SendMessage(Ae.SetStorageValue,[e,JSON.stringify({value:null})])}},{key:"SendExpressCheckoutClosedMessage",value:function(){this.SendMessage(Ae.ExpressCheckoutClosed,[])}},{key:"SendExpressCheckoutErrorMessage",value:function(){this.SendMessage(Ae.ExpressCheckoutError,[])}},{key:"SendSequenceSupportedMessage",value:function(){this.SendMessage(Ae.SequenceSupported,[])}},{key:"SendImportCheckboxShownMessage",value:function(){this.SendMessage(Ae.ImportCheckboxShown,[])}},{key:"SendTriggerImportFeature",value:function(){this.SendMessage(Ae.TriggerImportFeature,[])}},{key:"SendSubscribedToBroadcastChannelMessage",value:function(){this.SendMessage(Ae.SubscribedToBroadcastChannel,[])}},{key:"SendDestructBgAutoApplyMessage",value:function(){this.SendMessage(Ae.ReleaseBackgroundAutoApply,[])}},{key:"SendIframeMessage",value:function(e){this.SendMessage(Ae.ShoppingIframeRunner,e)}},{key:"SendUpdatePaymentDetailsResultMessage",value:function(e){this.SendMessage(Ae.UpdatePaymentDetailsComplete,[String(e)])}},{key:"SendOpenFlyoutMessage",value:function(e){this.SendMessage(Ae.OpenFlyout,[e])}},{key:"SendEdgeDriverStateChangeMessage",value:function(e,t){this.SendMessage(Ae.EdgeDriverStateChange,t?[e,t]:[e]),this.SendMessage(Ae.WalletDrawerLog,[e,String(Date.now())])}},{key:"SendRetailerPageRefreshMessage",value:function(){this.SendMessage(Ae.RetailerPageRefresh,[]),this.SendMessage(Ae.WalletDrawerLog,["retailerPageRefresh",String(Date.now())])}},{key:"SendMessage",value:function(e,t){window.autoApplyRuntime.postMessageToHost(e,t)}}]),e}(),qt=function(){function e(t){c(this,e),v(this,"localDataService",void 0),this.localDataService=t}return s(e,[{key:"GetEntryPoint",value:function(){return this.localDataService.GetLocaData(Te.UseWalletDrawer)?J.Wallet:J.Shopping}}]),e}();function Qt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var en=function(e){p(n,e);var t=Qt(n);function n(e,r,o){var i;return c(this,n),v(u(i=t.call(this)),"timestamp",void 0),v(u(i),"couponIds",void 0),v(u(i),"hashCode",void 0),i.timestamp=e,i.couponIds=r,i.hashCode=o,i}return s(n)}(re);function tn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return nn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var on,an=function(e){p(i,e);var n,r=rn(i);function i(e,t,n,o){var a;return c(this,i),v(u(a=r.call(this,e)),"overlayService",void 0),v(u(a),"logService",void 0),v(u(a),"contextId",void 0),v(u(a),"edgeMessageService",void 0),a.overlayService=t,a.logService=n,a.contextId=N.FromBackground,a.edgeMessageService=o,a}return s(i,[{key:"LaunchPrintableGroceryCouponsOverlay",value:(n=t(o().mark((function e(t){var n,r,i,a,s,c,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null!=t&&t.NationalOffers&&(null==t?void 0:t.NationalOffers.length)>0&&null!=t&&t.HashCode)){e.next=12;break}this.edgeMessageService.SendPrintCouponsStartMessage(),n=t.HashCode,r="",i=tn(t.NationalOffers);try{for(i.s();!(a=i.n()).done;)(s=a.value).couponId&&(r+=s.couponId+",")}catch(e){i.e(e)}finally{i.f()}return c=(c="https://www.coupons.com/clippartner/printid/?pid=27641&nid=10&zid=ej07&nosw=1&authprint-clipped-coupons-list="+r+"&securePrintFlag=1&hash_code="+n).replace("&amp;","&"),this.logEvent(b.Information,r,n,"User launching printable grocery coupons overlay"),e.next=11,this.overlayService.OpenPrintableGroceryCouponsOverlay(this.contextId,c).catch((function(e){u.logEvent(b.Error,r,n,e)}));case 11:this.edgeMessageService.SendPrintCouponsCompleteMessage();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"logEvent",value:function(e,t,n,r){var o=new en(Date.now(),t,n);this.logService.LogClientEventV2(e,A.PrintableGroceryCouponsOverlay,null!=r?r:"",o)}}]),i}(He),sn=an;!function(e){e.ruleBasedTriggering="msShoppingExp0",e.onlineSelectorExtraction="msShoppingExp1",e.cashbackCallToActionString="msShoppingExp3",e.cashbackExclusiveOffer="msShoppingExp4",e.chinaTrendingDeals="msShoppingExp6",e.autoOpenController="msShoppingExp7",e.manualCoupon="msShoppingExp9",e.groceryCashback="msShoppingExp10",e.footerExperiments="msShoppingExp12",e.shopRunner="msShoppingExp13",e.smallNotification="msShoppingExp14",e.autosVinExtraction="msShoppingExp17",e.pcbrefresh="msShoppingExp18",e.oSAutoShowRestriction="msShoppingExp19",e.phExpandedGraph="msShoppingExp20",e.footerInAA="msShoppingExp21",e.implicitPriceTrackingFootet="msShoppingExp23",e.groceryAutoshow="msShoppingExp24",e.calculatedCutOffPriceFiltering="msShoppingExp25",e.privacyBadge="msShoppingExp27",e.newStandardStyle="msShoppingExp28",e.htmlfragmentCollection="msShoppingExp30",e.cashbackEstimate="msShoppingExp31",e.startShoppingHomeModules="msShoppingExp32",e.autosPriceInsightsAutoShow="msShoppingExp33",e.productTracking="msShoppingExp34",e.amazongiftCardExp="msShoppingExp35",e.autosSERPExperience="msShoppingExp37",e.spbCashBack="msShoppingExp38",e.rewardNotification="msShoppingExp41",e.awarenessExpansion="msShoppingExp42",e.showProdCollections="msShoppingExp43",e.singleCouponPerRow="msShoppingExp44",e.inboxCoupons="msShoppingExp45",e.overlayCashbackUpsellForCouponFailure="msShoppingExp46",e.communityCouponModule="msShoppingExp47",e.microNotificationFeature="msShoppingExp48",e.snoozeTriggeredNotification="msShoppingExp49",e.surfaceUpsell="msShoppingExp50",e.newRanking="msShoppingExp51",e.shorelineinboxcoupons="msShoppingExp52",e.couponsConfidenceThreshold="msShoppingExp53",e.aaConsent="msShoppingExp54",e.sustainability="msShoppingExp100",e.groceryAnonymous="msShoppingTestExp1",e.shopRunnerFlag="msShoppingTestExp2",e.autoShowControlForFeature="msEdgeShoppingAutoShowControlForFeature",e.autofillAutoPopup="msAutofillAutoPopup",e.backgroundAutoApply="msEdgeShoppingBackgroundAutoApply",e.bannerShowCashback="msEdgeShoppingBannerRebates",e.bannerShowCoupons="msEdgeShoppingBannerCoupons",e.bannerShowPriceComparison="msEdgeShoppingBannerPriceCompare",e.bannerShowPriceHistory="msEdgeShoppingBannerPriceHistory",e.clarity="msEdgeShoppingClarityEnabled",e.clarityWithCookies="msEdgeShoppingClarityEnabledWithCookies",e.clientUrlNavigation="msEdgeShoppingClientUrlNavigation",e.coloredHeader="msShoppingColoredHeader",e.couponsUX="msEdgeShoppingCouponsUXExperimentation",e.expressCheckout="msEdgeShoppingExpressCheckout",e.expressCheckoutFillDetails="msEdgeShoppingExpressCheckoutFillDetails",e.microNotification="msEdgeShoppingNotifications",e.msWalletBNPL="msWalletBNPL",e.pcBannerUXExperimentation1="msEdgeShoppingPCBannerUXExperimentation1",e.pcBannerUXExperimentation2="msEdgeShoppingPCBannerUXExperimentation2",e.pcBannerUXExperimentation3="msEdgeShoppingPCBannerUXExperimentation3",e.pcBannerUXExperimentation4="msEdgeShoppingPCBannerUXExperimentation4",e.pcBannerUXExperimentation5="msEdgeShoppingPCBannerUXExperimentation5",e.pcBannerUXExperimentation6="msEdgeShoppingPCBannerUXExperimentation6",e.muidNotifications="msEdgeShoppingPwiloNotifications",e.priceDropNotification="msEdgeShoppingServerNotifications",e.ProductPageBackgroundAutoApply="msEdgeShoppingBackgroundAutoApplyForPDPAndHomePage",e.rewardFlyout="msEdgeShoppingRewards",e.serverSideRenderingEnabled="msEdgeServerSideShopping",e.showAmazonOtherSellers="msEdgeShoppingOtherSeller",e.showNudgeTipsOverlay="msShoppingExpNudge",e.showPaymentOptions="msZipPayVirtualCard",e.showPaymentOptionsOnProductPage="msEdgeShoppingProductFlyoutWallet",e.showProductHistory="msWebAssistQuery",e.showWalletFooter="msEnableWallet",e.signinRebates="msEdgeShoppingRebatesSignUp",e.signinRewards="msEdgeShoppingRewardsSignUp",e.socialSharingUpdate="msShoppingSocialSharingUpdate",e.youtubeCoupons="msEdgeShoppingExclusiveCoupons",e.youtubeCouponsAutoShow="msEdgeShoppingExclusiveCouponsAutoShow",e.autoOpenControllerScript="msEdgeShoppingAutoOpenControllerScript"}(on||(on={}));var cn=function(){function e(t){var n,r;c(this,e),v(this,"clarityEnabled",!1),null!==(n=t.experimentData)&&void 0!==n&&n.isExperimentActive(on.clarity||(null===(r=t.experimentData)||void 0===r?void 0:r.isExperimentActive(on.clarityWithCookies)))&&(this.clarityEnabled=!0)}var n,r;return s(e,[{key:"WaitForClarityToLoad",value:(r=t(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case 1:if(window.hasOwnProperty(e.clarityKey)){t.next=6;break}return t.next=4,new Promise((function(e){setTimeout(e,1e3)}));case 4:t.next=1;break;case 6:case 7:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}],[{key:"CreateInstance",value:function(t){e.instance=new e(t)}},{key:"SetTag",value:(n=t(o().mark((function t(n,r){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.instance&&r&&e.instance.clarityEnabled&&e.instance.WaitForClarityToLoad().then((function(){window[e.clarityKey]("set",n,r)}));case 1:case"end":return t.stop()}}),t)}))),function(e,t){return n.apply(this,arguments)})},{key:"ReportClientInfo",value:function(t,n,r){e.reportedClientContextInfo||(e.SetTag(e.TAGNAME_CLIENTNAME,t),e.SetTag(e.TAGNAME_JSVERSION,n),e.SetTag(e.TAGNAME_EDGEVERSION,r),e.reportedClientContextInfo=!0)}}]),e}();v(cn,"TAGNAME_DOMAIN","domain"),v(cn,"TAGNAME_FLIGHT","flight"),v(cn,"TAGNAME_VIEW","view"),v(cn,"TAGNAME_CLIENTNAME","appinfoclientname"),v(cn,"TAGNAME_JSVERSION","jsversion"),v(cn,"TAGNAME_EDGEVERSION","edgeversion"),v(cn,"clarityKey","clarity"),v(cn,"instance",void 0),v(cn,"reportedClientContextInfo",!1);var un=cn,ln=s((function e(t,n,r){c(this,e),v(this,"AppInfoClientName",void 0),v(this,"JSVersion",void 0),v(this,"BuildVersion",void 0),this.AppInfoClientName=t,this.JSVersion=n,this.BuildVersion=r,un.ReportClientInfo(t,n,r)})),pn=function(){function e(t,n,r,o,i,a){c(this,e),v(this,"EventType",void 0),v(this,"JsonData",void 0),v(this,"LogLevel",void 0),v(this,"Message",void 0),v(this,"ClientContext",void 0),v(this,"ImpressionId",void 0),v(this,"EventTime",void 0),this.LogLevel=t,this.EventType=n,this.JsonData=r,this.Message=o,this.ClientContext=a,this.ImpressionId=i,this.EventTime=(new Date).getTime()}return s(e,[{key:"ToString",value:function(){return JSON.stringify(this)}}]),e}(),dn=function(){function e(){c(this,e)}return s(e,null,[{key:"GetBuildVersion",value:function(){try{var e=navigator.userAgent.match(/Edg\/([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)/);if(e&&e.length>1&&e[0]&&e[0].length>4)return e[0].substr(4)}catch(e){}}},{key:"CompareBuildVersions",value:function(e,t){if(e&&t){var n=e.split("."),r=t.split(".");if(4!==n.length||4!==r.length)return;for(var o=0;o<4;o++){var i=parseInt(n[o],10),a=parseInt(r[o],10);if(i>a)return 1;if(a>i)return-1}return 0}}},{key:"IsOtherSellersExpActive",value:function(e,t){return"walmart.com"===t||e.isExperimentActive(on.showAmazonOtherSellers)}}]),e}();function hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var fn=function(e){p(n,e);var t=hn(n);function n(){return c(this,n),t.call(this)}return s(n)}(re),vn=function(){function e(t){c(this,e),v(this,"platformSpecific",void 0),this.platformSpecific=t}var n,r;return s(e,[{key:"LogMessage",value:(r=t(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now().toString(),e.next=3,this.LogClientEventV2(b.Debug,A.DebugMessage,n+": "+t,new fn);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"LogClientErrorV2",value:(n=t(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.LogClientEventV2(b.Error,A.ClientError,t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]),e}();function gn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var yn=function(e){p(a,e);var n,r,i=gn(a);function a(e,t){var n;return c(this,a),v(u(n=i.call(this,e)),"applicatorService",void 0),v(u(n),"buildVersion",void 0),n.applicatorService=t,n.buildVersion=dn.GetBuildVersion(),n}return s(a,[{key:"LogClientEventV2",value:(r=t(o().mark((function e(t,n,r,i,a){var s,c,u,l,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="",!a){e.next=5;break}s=a,e.next=9;break;case 5:return e.next=7,this.applicatorService.LoadCouponApplicatorState();case 7:null!=(c=e.sent)&&c.ImpressionId&&(s=c.ImpressionId);case 9:return u=new ln(this.platformSpecific.GetAppInfoClientName(),this.platformSpecific.GetVersion(),this.buildVersion),l=new pn(t,n,i.ToString(),r,s,u),p=[l.ToString()],window.autoApplyRuntime.postMessageToHost(Ae.LogScriptTelemetry,p),e.abrupt("return");case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n,o,i){return r.apply(this,arguments)})},{key:"Flush",value:(n=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})}]),a}(vn),Sn=yn;function mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Cn=function(e){p(n,e);var t=mn(n);function n(e,r,o){return c(this,n),t.call(this,M.AutoApplyCancelledMessage,e,r,o)}return s(n)}(fe);function xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var kn=function(e){p(n,e);var t=xn(n);function n(e,r,o,i){var a;return c(this,n),v(u(a=t.call(this)),"wasTyped",void 0),v(u(a),"wasVerified",void 0),a.couponCode=e,a.wasTyped=r,a.wasVerified=o,a.isStackable=i,a}return s(n)}(S);function bn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var An=function(e){p(y,e);var n,r,i,a,l,d,h,f,g=bn(y);function y(e,t,n){var r;return c(this,y),v(u(r=g.call(this,e)),"checkoutPageUrlData",void 0),v(u(r),"checkoutPageData",void 0),v(u(r),"contextID",void 0),v(u(r),"logService",void 0),v(u(r),"entryPointService",void 0),v(u(r),"autoApplyScenario",U.AutoApplyCoupons),r.logService=t,r.entryPointService=n,r}return s(y,[{key:"WaitForOrderElement",value:(f=t(o().mark((function e(n,r,i){var a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkoutPageUrlData.supportedNoOrderTotal){e.next=4;break}return e.next=3,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.IsFieldVisible(n,r,"Check Order Data Exsits");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"WaitForOrderElementInBackground",value:(h=t(o().mark((function e(){var n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.GetOrderTotal();case 2:return e.t0=e.sent,e.abrupt("return",e.t0>0);case 4:case"end":return e.stop()}}),e)}))),3e3);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return h.apply(this,arguments)})},{key:"GetErrorStatusMessage",value:(d=t(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.IsFieldVisible(t,n,"Is Error Message Visible");case 2:if(!e.sent){e.next=13;break}return e.prev=3,e.next=6,this.SendDomMessage(t,new Fe(Ne.GetTextValue,n,""),"Get error Message",!1);case 6:return r=e.sent,e.abrupt("return",null==r?void 0:r.TextValue);case 10:e.prev=10,e.t0=e.catch(3);case 13:return e.abrupt("return",void 0);case 14:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(e,t){return d.apply(this,arguments)})},{key:"GetPageCurrency",value:(l=t(o().mark((function e(){var t,n,r,i,a,s,c,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkoutPageUrlData.orderTotalDataElementSelector){e.next=27;break}t="Get Currency",n=this.checkoutPageUrlData.orderTotalDataElementSelector,r=n.split(","),i=0;case 5:if(!(i<r.length)){e.next=25;break}return a=r[i],e.prev=7,e.next=10,this.GetCurrencyValue(a,t);case 10:return e.abrupt("return",e.sent);case 13:if(e.prev=13,e.t0=e.catch(7),(null===e.t0||void 0===e.t0?void 0:e.t0.name)!==De.AutoApplyCancelled){e.next=17;break}throw e.t0;case 17:if(i!==r.length-1){e.next=22;break}return c={DomElement:a,EntryPoint:null===(s=this.entryPointService)||void 0===s?void 0:s.GetEntryPoint(),FunctionName:t,Scenario:this.autoApplyScenario},u=new se(this.checkoutPageData.retailerData.domainName,be.GetBoxValue,c,e.t0.stack),this.logService.LogClientErrorV2(e.t0.message,u),e.abrupt("return","$");case 22:i++,e.next=5;break;case 25:e.next=31;break;case 27:if(!this.checkoutPageUrlData.supportedNoOrderTotal){e.next=31;break}if(!(l=window.sessionStorage.getItem("pageCurrency"))){e.next=31;break}return e.abrupt("return",l);case 31:return e.abrupt("return","$");case 32:case"end":return e.stop()}}),e,this,[[7,13]])}))),function(){return l.apply(this,arguments)})},{key:"GetOrderTotal",value:(a=t(o().mark((function e(){var t,n,r,i,a,s,c,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkoutPageUrlData.orderTotalDataElementSelector){e.next=27;break}t="Get order total",n=this.checkoutPageUrlData.orderTotalDataElementSelector,r=n.split(","),i=0;case 5:if(!(i<r.length)){e.next=25;break}return a=r[i],e.prev=7,e.next=10,this.GetBoxValue(a,t);case 10:return e.abrupt("return",e.sent);case 13:if(e.prev=13,e.t0=e.catch(7),(null===e.t0||void 0===e.t0?void 0:e.t0.name)!==De.AutoApplyCancelled){e.next=17;break}throw e.t0;case 17:if(i!==r.length-1){e.next=22;break}throw c={DomElement:a,EntryPoint:null===(s=this.entryPointService)||void 0===s?void 0:s.GetEntryPoint(),FunctionName:t,Scenario:this.autoApplyScenario},u=new se(this.checkoutPageData.retailerData.domainName,be.GetBoxValue,c,e.t0.stack),this.logService.LogClientErrorV2(e.t0.message,u),e.t0;case 22:i++,e.next=5;break;case 25:e.next=31;break;case 27:if(!this.checkoutPageUrlData.supportedNoOrderTotal){e.next=31;break}if(!(l=window.sessionStorage.getItem("orderTotal"))){e.next=31;break}return e.abrupt("return",JSON.parse(l));case 31:return e.abrupt("return",-1);case 32:case"end":return e.stop()}}),e,this,[[7,13]])}))),function(){return a.apply(this,arguments)})},{key:"GetAppliedCoupon",value:(i=t(o().mark((function e(){var t,n,r,i,a,s,c,u,l,p,d,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="Get applied coupon",r=this.checkoutPageUrlData.inputBoxSelector,i=null!==(t=this.checkoutPageUrlData.appliedCouponSelector)&&void 0!==t?t:r,!_e.IsValidDataField(i)){e.next=19;break}return e.prev=4,e.next=7,this.SendDomMessage(this.contextID,new Fe(Ne.GetAppliedCoupon,i,""),n,!0);case 7:if(a=e.sent,(s=a.TextValue)||i!==r||(u=Ot.GetFirstVisibleElement(r),l=null!==(c=null==u?void 0:u.getAttribute("value"))&&void 0!==c?c:"",s=l.replace(/[^a-z0-9]/gim,"")),!s||this.IsUserCouponInOurCorpus(s)){e.next=12;break}return e.abrupt("return",new kn(s,!1,!1,!1));case 12:e.next=19;break;case 14:e.prev=14,e.t0=e.catch(4),d={DomElement:i,EntryPoint:null===(p=this.entryPointService)||void 0===p?void 0:p.GetEntryPoint(),FunctionName:n,Scenario:this.autoApplyScenario},h=new se(this.checkoutPageData.retailerData.domainName,be.GetAppliedCoupon,d,e.t0.stack),this.logService.LogClientErrorV2(e.t0.message,h);case 19:return e.abrupt("return",void 0);case 20:case"end":return e.stop()}}),e,this,[[4,14]])}))),function(){return i.apply(this,arguments)})},{key:"GetAutoApplyTime",value:function(e){return null!=e&&e.StartTime?Date.now()-e.StartTime:-1}},{key:"IsUserCouponInOurCorpus",value:function(e){return void 0!==this.checkoutPageData.coupons.find((function(t){return!t.isLowSuccessRateCoupon&&t.couponCode.toLowerCase()===e.toLowerCase()}))}},{key:"GetBoxValue",value:(r=t(o().mark((function e(t,n){var r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_e.IsValidDataField(t)){e.next=11;break}return e.prev=1,e.next=4,this.SendDomMessage(this.contextID,new Fe(Ne.GetTextValue,t,""),n,!0);case 4:return r=e.sent,e.abrupt("return",Gt.GetPriceStringAsNumber(r.TextValue));case 8:e.prev=8,e.t0=e.catch(1),ke.ThrowError(null!==(i=null===e.t0||void 0===e.t0?void 0:e.t0.name)&&void 0!==i?i:"",null===e.t0||void 0===e.t0?void 0:e.t0.message);case 11:return e.abrupt("return",-1);case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e,t){return r.apply(this,arguments)})},{key:"GetCurrencyValue",value:(n=t(o().mark((function e(t,n){var r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_e.IsValidDataField(t)){e.next=11;break}return e.prev=1,e.next=4,this.SendDomMessage(this.contextID,new Fe(Ne.GetTextValue,t,""),n,!0);case 4:return r=e.sent,e.abrupt("return",Gt.ExtractCurrencyString(r.TextValue));case 8:e.prev=8,e.t0=e.catch(1),ke.ThrowError(null!==(i=null===e.t0||void 0===e.t0?void 0:e.t0.name)&&void 0!==i?i:"",null===e.t0||void 0===e.t0?void 0:e.t0.message);case 11:return e.abrupt("return","$");case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e,t){return n.apply(this,arguments)})}]),y}(He),En=An;function Pn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var wn=function(e){p(n,e);var t=Pn(n);function n(e,r,o,i,a,s){var l;return c(this,n),v(u(l=t.call(this)),"CouponCode",void 0),v(u(l),"Domain",void 0),v(u(l),"Scenario",void 0),v(u(l),"PageUrl",void 0),v(u(l),"data",void 0),v(u(l),"description",void 0),l.CouponCode=e,l.Domain=r,l.Scenario=o,l.PageUrl=i,l.data=null!=a?a:"",l.description=s,l}return s(n)}(re);function In(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Dn=function(e){p(n,e);var t=In(n);function n(e,r,o,i,a,s){var l;return c(this,n),v(u(l=t.call(this)),"EdgeFlyoutStatus",void 0),v(u(l),"ComparableOffersCount",void 0),v(u(l),"SavingsAmount",void 0),v(u(l),"Domain",void 0),v(u(l),"Metadata",void 0),v(u(l),"PageType",void 0),v(u(l),"FlyoutId",void 0),l.EdgeFlyoutStatus=e,l.ComparableOffersCount=r,l.SavingsAmount=o,l.Domain=i,l.Metadata=a,l.PageType=s,l}return s(n)}(re),On=function(){function e(t,n){c(this,e),v(this,"messageType",void 0),v(this,"result",void 0),v(this,"state",void 0),v(this,"errorName",void 0),v(this,"errorMessage",void 0),this.messageType=t,this.state=n}return s(e,[{key:"SetErrorDetails",value:function(e,t){this.errorName=e,this.errorMessage=t}}]),e}();function Tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Rn=function(e){p(n,e);var t=Tn(n);function n(e,r){var o;return c(this,n),v(u(o=t.call(this,M.SelectorExtractionMessage)),"Command",void 0),v(u(o),"InputPath",void 0),o.Command=e,o.InputPath=r,o}return s(n)}(ce);function Mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Fn,Bn=function(e){p(n,e);var t=Mn(n);function n(e,r,o){var i;return c(this,n),v(u(i=t.call(this,r,"","")),"ContextID",void 0),v(u(i),"Command",void 0),v(u(i),"checkoutPageUrlData",void 0),i.ContextID=e,i.Command=r,i.checkoutPageUrlData=o,i}return s(n)}(Fe);function Nn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ln(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ln(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Ln(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}!function(e){e.RemoveButtonRemoved="RemoveButtonRemoved",e.RemoveButtonAdded="RemoveButtonAdded",e.PriceElementAdded="PriceElementAdded",e.ResultMessageAdded="ResultMessageAdded",e.PriceElementChanged="PriceElementChanged",e.PriceCharDataChanged="PriceCharDataChanged",e.FixedWaitTime="FixedWaitTime",e.Refresh="Refresh",e.NoRemoveButton="NoRemoveButton",e.RemovalNotNeeded="RemovalNotNeeded",e.NotApplied="NotApplied",e.RemoveButtonDetected="RemoveButtonDetected"}(Fn||(Fn={}));var Un=function(e){p(ce,e);var n,r,i,a,l,d,h,f,y,S,m,C,x,k,E,P,I,O,T,M,F,B,N,L,G,V,_,W,H,z,j,X,Y,Z,q,Q,ee,te,re,oe,ae=Gn(ce);function ce(e,t,n,r,o,i,a,s,l){var p;return c(this,ce),v(u(p=ae.call(this,i,r,l)),"overlayService",void 0),v(u(p),"stateService",void 0),v(u(p),"localDataService",void 0),v(u(p),"edgeMessageService",void 0),v(u(p),"applied",!1),v(u(p),"removed",!1),v(u(p),"signal",Fn.FixedWaitTime),v(u(p),"restartAA",!1),v(u(p),"extractedInputBox",""),v(u(p),"extractedApplyButton",""),v(u(p),"extractedOrderTotalElement",""),v(u(p),"isForegroundAAScenario",!1),p.checkoutPageData=e,p.contextID=t,p.stateService=n,p.overlayService=o,p.localDataService=a,p.edgeMessageService=s,p}return s(ce,[{key:"SetRetailerData",value:function(e){this.checkoutPageData=e}},{key:"SetCouponApplyState",value:function(e,t,n){!this.applied&&t&&(this.signal=e,this.applied=t),!this.removed&&n&&(this.signal=e,this.removed=n)}},{key:"ApplyCoupons",value:(oe=t(o().mark((function e(n,r){var i,a,s,c,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null,this.ResetUIState(),this.InitializeCheckoutPageUrlData()){e.next=4;break}return e.abrupt("return",!1);case 4:if(this.isBgAAScenario=this.localDataService.GetLocaData(Te.BackgroundAutoApply),this.isForegroundAAScenario=this.localDataService.GetLocaData(Te.ForegroundAutoApply),this.isPDPBgAutoApply=this.localDataService.GetLocaData(Te.ProductPageBackgroundAutoApply),a=this.localDataService.GetLocaData(Te.FallBackAutoApply),s=this.localDataService.IsFeatureEnabled(Oe.useBackgroundAutoApplyResult),this.isForegroundAAScenario||this.edgeMessageService.SendAutoApplyStartMessage(),(this.isBgAAScenario||this.isPDPBgAutoApply)&&this.SetUpBackgroundScriptMessageHandler(),this.isPDPBgAutoApply?this.autoApplyScenario=U.ProductPageBackgroundAutoApply:this.isBgAAScenario||this.isForegroundAAScenario?this.autoApplyScenario=U.BackgroundAutoApply:this.autoApplyScenario=s?U.BackgroundAAResult:a?U.FallBackAutoApply:this.autoApplyScenario,!n){e.next=26;break}if(!s){e.next=23;break}return i=this.GetBackgroundAutoApplyResultState(),e.next=19,this.ReValidateBackgroundAutoApplyState(i);case 19:e.sent||(i=this.CreateState(),this.autoApplyScenario=U.AutoApplyCoupons),e.next=24;break;case 23:i=this.CreateState();case 24:e.next=52;break;case 26:if(!r){e.next=30;break}this.Cancel(i,this.autoApplyScenario),e.next=52;break;case 30:return e.next=32,this.IsFakeRefreshEvent();case 32:if(e.t1=e.sent,!e.t1){e.next=35;break}e.t1=!this.isForegroundAAScenario;case 35:if(e.t0=e.t1,!e.t0){e.next=38;break}e.t0=!a;case 38:if(!e.t0){e.next=40;break}return e.abrupt("return",!1);case 40:return e.next=43,this.LoadState();case 43:if(null!==(i=e.sent)){e.next=48;break}i=this.CreateState(),e.next=51;break;case 48:if(!this.isBgAAScenario||!i.BackgroundAACancelled){e.next=51;break}return this.Cancel(i,this.autoApplyScenario),e.abrupt("return",!1);case 51:this.RestoreExtractedSelectors(i);case 52:if(null===i){e.next=60;break}return this.isBgAAScenario&&so.GetBroadcastChannelService().PostMessage(JSON.stringify(new On(Pe.AutoApplyStarted,i))),c=!1,e.next=57,this.ApplyCouponsAsync(i,this.autoApplyScenario).catch(function(){var e=t(o().mark((function e(t){var n,r,a,s,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.name!==De.Refresh){e.next=5;break}c=!0,e.next=40;break;case 5:if(t.name!==De.AutoApplyCancelled){e.next=12;break}if(c=!1,!u.restartAA){e.next=9;break}return e.abrupt("return");case 9:u.Cancel(i,u.autoApplyScenario),e.next=40;break;case 12:if(t.name!==De.InvalidInput){e.next=22;break}c=!1,(r=new ie(u.checkoutPageData.retailerData.domainName,null===(n=u.entryPointService)||void 0===n?void 0:n.GetEntryPoint())).SetErrorData(D.Error,t.name),r.AutoApplyScenario=u.autoApplyScenario,u.LogAutoApplyError(r,t.message),u.EntryPointIsWallet()&&u.edgeMessageService.SendEdgeDriverStateChangeMessage(De.AutoApplyFail),e.next=40;break;case 22:if(!i){e.next=38;break}if(!u.isPDPBgAutoApply){e.next=27;break}return e.next=26,u.FinalizePDPBackgroundAutoApply(i,(null==t?void 0:t.name)+":"+(null==t?void 0:t.message),D.Error);case 26:return e.abrupt("return");case 27:if(!u.isBgAAScenario){e.next=34;break}return(a=new On(Pe.AutoApplyFinished,i)).result=D.Error,a.SetErrorDetails(t.name,t.message),so.GetBroadcastChannelService().PostMessage(JSON.stringify(a)),u.edgeMessageService.SendAutoApplyErrorMessage(null==t?void 0:t.name),e.abrupt("return");case 34:return u.isForegroundAAScenario?((s=new ye(we.FinishAutoApply,D.Error)).SetErrorInfo(null==t?void 0:t.name),so.GetBroadcastChannelService().PostMessage(s),so.GetBroadcastChannelService().Close()):u.edgeMessageService.SendAutoApplyErrorMessage(null==t?void 0:t.name),l=t.name===De.AutoApplyShortcircuit&&!u.EntryPointIsWallet(),e.next=38,u.overlayService.ShowResult(u.contextID,D.Error,u.checkoutPageData.retailerData.domainName,(null==t?void 0:t.name)+":"+(null==t?void 0:t.message),i,u.checkoutPageData.cashback,u.autoApplyScenario,u.checkoutPageData.coupons,u.GetExtractedSelectors(),l);case 38:u.EntryPointIsWallet()&&u.edgeMessageService.SendEdgeDriverStateChangeMessage(De.AutoApplyFail);case 40:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).finally(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c?u.SaveState(i):u.restartAA?u.Restart(i):u.ClearState();case 1:case"end":return e.stop()}}),e)}))));case 57:return e.abrupt("return",!0);case 60:return e.abrupt("return",!1);case 61:case"end":return e.stop()}}),e,this)}))),function(e,t){return oe.apply(this,arguments)})},{key:"ApplyCouponsAsync",value:(re=t(o().mark((function e(t,n){var r,i,a,s,c,u,l,p,d,h,f,v,g,y,S,m,C,x,k,b,A,E,P,w,I,O,T,M,F,B,N,L,G,U,V,_,W,H,z,j,J,$,K=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.AddSuggestedCoupons(t);case 2:if(this.checkoutPageData.HasCoupons()||this.LogAndThrowError("ApplyCouponsAsync",be.AutoApplyWithoutCoupons,"Called ApplyCoupons without coupons"),r=t.CouponsApplied.size,t.CouponsApplied.size>0&&(i=this.checkoutPageData.coupons[t.CouponsApplied.size-1].couponCode,((a=t.CouponsApplied.get(i))&&!a.wasVerified||r===this.checkoutPageData.coupons.length)&&(r-=1)),!t.Currency){e.next=8;break}return e.next=8,this.overlayService.UpdateCurrency(this.contextID,t.Currency);case 8:return s=this.checkoutPageData.coupons[r].couponCode,e.next=11,this.overlayService.OpenOverlay(this.contextID,s,this.checkoutPageData.coupons.length,t.MaxDiscount,this.checkoutPageUrlData,r);case 11:if(!_e.IsValidDataField(this.checkoutPageUrlData.layoutClickSelector)){e.next=27;break}if(-1!==(c=this.checkoutPageUrlData.clickBeforeStartSelector).indexOf(",")&&(c=this.checkoutPageUrlData.clickBeforeStartSelector.substring(0,c.indexOf(","))),u=this.checkoutPageUrlData.inputBoxSelector,l=!1,!_e.IsValidDataField(c)){e.next=20;break}return e.next=19,this.IsFieldVisible(this.contextID,c,"Click Before visible");case 19:l=e.sent;case 20:if(l){e.next=24;break}return e.next=23,this.IsFieldVisible(this.contextID,u,"Input box visible");case 23:l=e.sent;case 24:if(l){e.next=27;break}return e.next=27,this.SendDomMessage(this.contextID,new Fe(Ne.Click,this.checkoutPageUrlData.layoutClickSelector,"",yt.LayoutClick),"First Click to see checkout fields.",!1);case 27:return e.next=29,this.WaitForOrderElement(this.contextID,this.checkoutPageUrlData.orderTotalDataElementSelector,8e3);case 29:if(!this.isPDPBgAutoApply){e.next=32;break}return e.next=32,this.WaitForOrderElement(this.contextID,this.checkoutPageUrlData.orderTotalDataElementSelector,3e4);case 32:if(!this.isBgAAScenario&&!this.isPDPBgAutoApply){e.next=38;break}return e.next=35,this.WaitForOrderElementInBackground();case 35:if(p=e.sent,!this.isPDPBgAutoApply||p){e.next=38;break}throw new Error(De.InvalidCartValue);case 38:if(!this.localDataService.IsFeatureEnabled(Oe.onlineSelectorExtraction)){e.next=41;break}return e.next=41,this.ExtractOrderTotalElementIfNotVisible(t);case 41:if(t.TrueInitialPrice||t.InitialPrice){e.next=54;break}return e.next=44,this.GetAppliedCoupon();case 44:if(t.AppliedCoupon=e.sent,!t.AppliedCoupon){e.next=53;break}return e.next=49,this.GetOrderTotal();case 49:t.TrueInitialPrice=e.sent,this.SaveState(t),e.next=54;break;case 53:case 54:if(t.TrueInitialPrice||!_e.IsValidDataField(this.checkoutPageUrlData.removeCouponButtonSelector)){e.next=60;break}return e.next=57,this.GetOrderTotal();case 57:t.TrueInitialPrice=e.sent,this.SaveState(t);case 60:if(t.InitialPrice){e.next=73;break}return e.next=63,this.RemoveCoupon(!0);case 63:return t.MaxDiscount=0,e.next=66,this.GetOrderTotal();case 66:return t.InitialPrice=e.sent,e.next=69,this.GetPageCurrency();case 69:return t.PageCurrency=e.sent,t.Currency=Gt.GetStandardizedCurrency(t.PageCurrency,Se.GetMarket(null===(d=this.checkoutPageData)||void 0===d?void 0:d.market,null===(h=this.checkoutPageData)||void 0===h||null===(f=h.retailerData)||void 0===f?void 0:f.exclusiveMarket)),e.next=73,this.overlayService.UpdateCurrency(this.contextID,t.Currency);case 73:v=0,g=!1,y=this.checkoutPageData.coupons,S=0;case 78:if(!(S<y.length)){e.next=143;break}if(k=y[S],b=k.couponCode,A=null!==(m=k.isStackable)&&void 0!==m&&m,!this.checkoutPageUrlData.successfulAlertSelector||null===(C=t.BestCoupon)||void 0===C||!C.couponCode){e.next=84;break}return e.abrupt("break",143);case 84:if(E=S===y.length-1,!(P=this.isCouponInapplicable(t,k,E))){e.next=89;break}return this.SaveInapplicableCouponStatus(t,k,P),e.abrupt("continue",140);case 89:if(this.checkoutPageUrlData.refreshAfterApplying){e.next=92;break}return e.next=92,this.MoveProgressBar(S,t);case 92:if(w=void 0,null!==(x=t.CouponsApplied.get(b))&&void 0!==x&&x.wasTyped){e.next=100;break}if(!this.checkoutPageUrlData.refreshAfterApplying){e.next=97;break}return e.next=97,this.MoveProgressBar(S,t);case 97:return e.next=99,this.ApplyCoupon(b,t,S+1,y.length,t.MaxDiscount,A);case 99:w=e.sent;case 100:if(!(I=t.CouponsApplied.get(b))||I.wasVerified){e.next=140;break}return e.next=104,this.WasCouponAccepted();case 104:if(!e.sent){e.next=106;break}case 106:return e.next=108,this.GetDiscount(t.InitialPrice,k);case 108:if(T=e.sent,e.t0=this.checkoutPageUrlData.supportedNoOrderTotal,!e.t0){e.next=114;break}return e.next=113,this.WasCouponAccepted();case 113:e.t0=e.sent;case 114:if(!e.t0){e.next=118;break}return this.SaveCouponDiscountStatus(t,T,b,A,k.attribution,void 0,w,R.Valid),g=!0,e.abrupt("break",143);case 118:return e.next=120,this.GetErrorStatusMessage(this.contextID,this.checkoutPageUrlData.errorMessageSelector);case 120:return M=e.sent,this.SaveCouponDiscountStatus(t,T,b,A,k.attribution,M,w),e.next=124,this.CloseErrorMessage();case 124:if(S!==y.length-1&&!this.checkoutPageUrlData.successfulAlertSelector||(null===(O=t.BestCoupon)||void 0===O?void 0:O.couponCode)!==b||this.IsUserCouponBetter(t)||this.isBgAAScenario||this.isPDPBgAutoApply){e.next=131;break}t.BestCoupon.wasTyped=!0,v=T,t.BestCoupon.wasVerified=!0,this.SaveCouponStatus(t,b,!0,!0,A,!0),e.next=140;break;case 131:if(!this.checkoutPageUrlData.couponRemovalNotNeeded||this.isPDPBgAutoApply&&S===kn.length-1){e.next=136;break}F={CompletedSignal:Fn.RemovalNotNeeded,WaitTime:-1},this.SaveRemoveCouponResult(t,F),e.next=140;break;case 136:return e.next=138,this.RemoveCoupon(void 0,t);case 138:B=e.sent,this.SaveRemoveCouponResult(t,B);case 140:S++,e.next=78;break;case 143:if(!this.ShouldReApplyUserCoupon(t)){e.next=157;break}return e.next=147,this.GetUserCouponDiscount(t,y.length);case 147:if(e.t2=N=e.sent,e.t1=null!==e.t2,!e.t1){e.next=151;break}e.t1=void 0!==N;case 151:if(!e.t1){e.next=155;break}e.t3=N,e.next=156;break;case 155:e.t3=v;case 156:v=e.t3;case 157:if(!this.isBgAAScenario){e.next=161;break}return L=new On(Pe.AutoApplyFinished,t),so.GetBroadcastChannelService().PostMessage(JSON.stringify(L)),e.abrupt("return",!0);case 161:if(!this.isPDPBgAutoApply){e.next=165;break}return e.next=164,this.FinalizePDPBackgroundAutoApply(t,ce.AutoApplyComplete);case 164:return e.abrupt("return",!0);case 165:if(this.checkoutPageUrlData.supportedNoOrderTotal){e.next=173;break}return e.next=168,this.applyBestCoupon(t,y,v);case 168:return v=e.sent,e.next=171,this.GetOrderTotal();case 171:((G=e.sent)>t.InitialPrice||G>t.TrueInitialPrice)&&(V={CouponResults:t.CouponResults,EntryPoint:null===(U=this.entryPointService)||void 0===U?void 0:U.GetEntryPoint(),ExtractedSelectors:this.GetExtractedSelectors(),FinalDiscount:v,FinalPrice:G,InitialPrice:t.InitialPrice,Scenario:this.autoApplyScenario,TrueInitialPrice:t.TrueInitialPrice},_=new se(this.checkoutPageData.retailerData.domainName,be.BetterInitialPrice,V,void 0),this.logService.LogClientErrorV2("",_));case 173:return W=ce.AutoApplyComplete,H=D.Negative,v>0||g?((z=this.localDataService.GetLocaData(Te.ImportOptions))&&z.shouldShowImportCheckBox&&z.primaryBrowserName&&(W="Finished Auto apply with import Browser options"),H=D.Positive,this.isForegroundAAScenario||this.edgeMessageService.SendAutoApplyPositiveMessage(null===(j=t.BestCoupon)||void 0===j?void 0:j.couponCode,t.InitialPrice,t.MaxDiscount)):this.isForegroundAAScenario||this.edgeMessageService.SendAutoApplyNegativeMessage(),this.isForegroundAAScenario&&(J=new ye(we.FinishAutoApply,H),H===D.Positive&&J.SetPositiveResultInfo(null===($=t.BestCoupon)||void 0===$?void 0:$.couponCode,t.InitialPrice,t.MaxDiscount),so.GetBroadcastChannelService().PostMessage(J)),this.EntryPointIsWallet()&&setTimeout((function(){K.edgeMessageService.SendEdgeDriverStateChangeMessage(it.AutoApplyDone,JSON.stringify({finalDiscount:v}))}),1e3),e.next=181,this.overlayService.ShowResult(this.contextID,H,this.checkoutPageData.retailerData.domainName,W,t,this.checkoutPageData.cashback,n,this.checkoutPageData.coupons,this.GetExtractedSelectors());case 181:return this.CreateAndSaveTransactionToEdgeLocalStore(t,n,H,v),this.isForegroundAAScenario&&so.GetBroadcastChannelService().Close(),e.abrupt("return",!0);case 184:case"end":return e.stop()}}),e,this)}))),function(e,t){return re.apply(this,arguments)})},{key:"ClearUIState",value:(te=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SaveUIState(new Re);case 2:case"end":return e.stop()}}),e,this)}))),function(){return te.apply(this,arguments)})},{key:"UpdateUIState",value:(ee=t(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.GetUIState(t);case 3:if(!(r=e.sent)){e.next=11;break}return r.Events|=n.Events,e.next=10,this.SaveUIState(r);case 10:return e.abrupt("return",!0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return ee.apply(this,arguments)})},{key:"GetUIState",value:(Q=t(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stateService.GetUIState(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"CancelBackgroundAutoApply",value:(q=t(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.bgAutoApplyCancelled){e.next=5;break}return e.next=3,this.LoadState();case 3:(t=e.sent)&&(t.BackgroundAACancelled=!0,this.bgAutoApplyCancelled=!0,this.SaveState(t));case 5:case"end":return e.stop()}}),e,this)}))),function(){return q.apply(this,arguments)})},{key:"ExtractOrderTotalElementIfNotVisible",value:(Z=t(o().mark((function e(n){var r,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkoutPageUrlData.supportedNoOrderTotal){e.next=9;break}return e.next=3,this.IsFieldVisible(this.contextID,this.checkoutPageUrlData.orderTotalDataElementSelector,"Order total visible");case 3:if(e.sent){e.next=9;break}return e.next=6,_e.MeasureExecutionTime(t(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.SendDomMessage(i.contextID,new Rn(Ne.ExtractOrderTotal),"Extracting order total element selector",!0);case 2:if(""!==(t=e.sent).Selector){e.next=5;break}throw ke.ThrowError(De.AutoApplyFail,"Unable to extract order total selector");case 5:i.extractedOrderTotalElement=t.Selector;case 6:case"end":return e.stop()}}),e)}))),"Extracting order total element if invisible");case 6:r=e.sent,this.LogSelectorExtractionPerf(r,"OrderTotalElementExtraction"),this.checkoutPageUrlData.orderTotalDataElementSelector=n.ExtractedOrderTotalElement=this.extractedOrderTotalElement;case 9:case"end":return e.stop()}}),e,this)}))),function(e){return Z.apply(this,arguments)})},{key:"CreateAndSaveTransactionToEdgeLocalStore",value:function(e,t,n,r){try{if(n===D.Positive&&r>0){var o,i,a,s=new Tt({});s.EventInfoTime=(new Date).toISOString(),s.Domain=null===(o=this.checkoutPageData)||void 0===o||null===(i=o.retailerData)||void 0===i?void 0:i.domainName,s.BestCoupon=null===(a=e.BestCoupon)||void 0===a?void 0:a.couponCode,s.Discount=r.toString(),null!=e&&e.InitialPrice&&(s.StartingPrice=e.InitialPrice.toString()),s.AutoApplyScenario=t;var c=e.StartTime?Date.now()-e.StartTime:-1;c>0&&(s.AutoApplyProcessTime=c.toString()),so.GetEdgeMessageService().SaveTransactionToEdgeLocalStore($.AutoApplyTransactionsKey,JSON.stringify(s))}}catch(e){this.LogError("CreateAndSaveTransactionToEdgeLocalStore",be.SavingsFoundTransactionFailure,null==e?void 0:e.message)}}},{key:"ShouldReApplyUserCoupon",value:function(e){if(e.AppliedCoupon&&e.TrueInitialPrice){if(this.IsUserCouponBetter(e))return!0;var t,n="";try{n=btoa(e.AppliedCoupon.couponCode)}catch(e){}var r=e.InitialPrice-e.TrueInitialPrice,o={CouponResults:e.CouponResults,DiscountFromServerCoupons:e.MaxDiscount,DiscountFromUserCoupon:r,EntryPoint:null===(t=this.entryPointService)||void 0===t?void 0:t.GetEntryPoint(),FinalDiscount:e.MaxDiscount,InitialPrice:e.InitialPrice,Scenario:this.autoApplyScenario,TrueInitialPrice:e.TrueInitialPrice},i=new wn(n,this.checkoutPageData.retailerData.domainName,K.CouponNotInOurCorpus,location.pathname,JSON.stringify(o));this.logService.LogClientEventV2(b.Information,A.CollectedCoupons,"User had a coupon we didn't have",i,null==e?void 0:e.ImpressionId)}return!1}},{key:"IsUserCouponBetter",value:function(e){if(e.AppliedCoupon&&e.TrueInitialPrice){var t=e.InitialPrice-e.TrueInitialPrice;if(e.MaxDiscount<=0&&t>=0||t>0&&t>e.MaxDiscount)return!0}return!1}},{key:"GetUserCouponDiscount",value:(Y=t(o().mark((function e(t,n){var r,i,a,s,c,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ApplyUserCoupon(t,n);case 2:i=e.sent,a=t.MaxDiscount,s="";try{s=t.AppliedCoupon?btoa(t.AppliedCoupon.couponCode):""}catch(e){}if(c={CouponResults:t.CouponResults,DiscountFromServerCoupons:a,EntryPoint:null===(r=this.entryPointService)||void 0===r?void 0:r.GetEntryPoint(),FinalDiscount:i,InitialPrice:t.InitialPrice,Scenario:this.autoApplyScenario,TrueInitialPrice:t.TrueInitialPrice},!(t.AppliedCoupon&&i&&i>0&&i>=a)){e.next=18;break}return t.MaxDiscount=i,t.BestCoupon=new kn(t.AppliedCoupon.couponCode,!0,!0,!1),this.SaveState(t),u=new wn(s,this.checkoutPageData.retailerData.domainName,K.BetterInitialPrice,location.pathname,JSON.stringify(c)),this.logService.LogClientEventV2(b.Information,A.CollectedCoupons,"User coupon had the best or similar discount",u,null==t?void 0:t.ImpressionId),e.abrupt("return",i);case 18:return l=new wn(s,this.checkoutPageData.retailerData.domainName,K.UserCouponFailed,location.pathname,JSON.stringify(c)),this.logService.LogClientEventV2(b.Information,A.CollectedCoupons,"User coupon did not have a better discount",l,null==t?void 0:t.ImpressionId),e.next=24,this.CloseErrorMessage();case 24:return e.next=26,this.RemoveCoupon();case 26:return e.abrupt("return",void 0);case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return Y.apply(this,arguments)})},{key:"ApplyUserCoupon",value:(X=t(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.AppliedCoupon){e.next=11;break}if(t.AppliedCoupon.wasTyped){e.next=5;break}return e.next=5,this.ApplyCoupon(t.AppliedCoupon.couponCode,t,n,n,t.MaxDiscount,t.AppliedCoupon.isStackable,!1,!0);case 5:if(t.AppliedCoupon.wasVerified){e.next=10;break}return e.next=8,this.GetDiscount(t.InitialPrice);case 8:r=e.sent,this.SaveCouponStatus(t,t.AppliedCoupon.couponCode,!0,!0,t.AppliedCoupon.isStackable,!1,!0);case 10:return e.abrupt("return",r);case 11:return e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return X.apply(this,arguments)})},{key:"SaveUIState",value:(j=t(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stateService.SaveUIState(t);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"WaitForRefresh",value:(z=t(o().mark((function e(n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.overlayunloaded);case 1:case"end":return e.stop()}}),e)}))),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return z.apply(this,arguments)})},{key:"LoadState",value:(H=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stateService.LoadCouponApplicatorState();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return H.apply(this,arguments)})},{key:"ClearState",value:function(){this.SaveState(null)}},{key:"CreateState",value:function(){var e=ne.CreateNew(this.contextID,this.checkoutPageData.impressionId);return e.ImportOptions=this.localDataService.GetLocaData(Te.ImportOptions),e.CashBackActive=this.localDataService.GetLocaData(Te.CashBackActive),this.isBgAAScenario&&(e.BackgroundAAStatus.BgAutoApplyInProgress=!0),this.stateService.SaveCouponApplicatorState(e),e}},{key:"SaveState",value:function(e){(!this.isBgAAScenario&&!this.isPDPBgAutoApply||!this.bgAutoApplyCancelled||null!=e&&e.BackgroundAACancelled)&&this.stateService.SaveCouponApplicatorState(e)}},{key:"AddSuggestedCoupons",value:(W=t(o().mark((function e(t){var n,r,i,a,s,c=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.SuggestedCoupons){e.next=7;break}if(!this.isPDPBgAutoApply){e.next=5;break}return e.next=5,so.GetSuggestedCouponService().update(g.CheckoutPage,this.checkoutPageData.coupons,null===(n=this.checkoutPageUrlData)||void 0===n?void 0:n.suggestedCouponElementSelector,null===(r=this.checkoutPageUrlData)||void 0===r?void 0:r.suggestedCouponRegex,this.checkoutPageData.impressionId,!0);case 5:t.SuggestedCoupons=so.GetSuggestedCouponService().getSuggestedCoupons(),this.SaveState(t);case 7:if(t.SuggestedCoupons&&t.SuggestedCoupons.length>0){i=Nn(t.SuggestedCoupons);try{for(s=function(){var e=a.value,t=e,n=c.checkoutPageData.coupons.findIndex((function(t){return t.couponCode.toLowerCase()===e.couponCode.toLowerCase()}));-1!==n&&(t=c.checkoutPageData.coupons.splice(n,1)[0]),c.checkoutPageData.coupons.unshift(t)},i.s();!(a=i.n()).done;)s()}catch(e){i.e(e)}finally{i.f()}"jcpenney.com"===this.checkoutPageData.retailerData.domainName&&this.checkoutPageData.coupons.splice(1)}e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),this.LogError("AddSuggestedCoupons",be.GetSuggestedCoupon,null===e.t0||void 0===e.t0?void 0:e.t0.message);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e){return W.apply(this,arguments)})},{key:"RestoreExtractedSelectors",value:function(e){e&&(e.ExtractedInputBox&&(this.extractedInputBox=this.checkoutPageUrlData.inputBoxSelector=e.ExtractedInputBox),e.ExtractedApplyButton&&(this.extractedApplyButton=this.checkoutPageUrlData.applyButtonSelector=e.ExtractedApplyButton),e.ExtractedOrderTotalElement&&(this.checkoutPageUrlData.orderTotalDataElementSelector=e.ExtractedOrderTotalElement))}},{key:"CloseModalDialogOnRetailerPage",value:(_=t(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.checkoutPageUrlData.closeModal)){e.next=12;break}return e.next=4,this.IsFieldVisible(this.contextID,t,"close modal visible");case 4:if(!e.sent){e.next=12;break}return e.next=7,this.CouponApplied(this.checkoutPageUrlData.removeCouponButtonSelector);case 7:return n=e.sent,e.next=10,this.SendDomMessage(this.contextID,new Fe(Ne.Click,t,""),"Close modal",!1);case 10:return e.next=12,this.WaitForCouponApply(n);case 12:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"ApplyCoupon",value:(V=t(o().mark((function e(n,r,i,a,s,c,u,l){var p,d,h,f,v,g,y=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.EntryPointIsWallet()&&this.edgeMessageService.SendEdgeDriverStateChangeMessage(it.AutoApplyProgress,JSON.stringify({coupon:n,currentCouponIndex:i,totalCoupons:a,currentBestDiscount:s})),this.UpdateCurrentCoupon(n,i,a,s,r),e.next=4,this.CouponApplied(this.checkoutPageUrlData.removeCouponButtonSelector);case 4:if(p=e.sent,!this.checkoutPageUrlData.waitBeforeTypingNextCoupon){e.next=8;break}return e.next=8,_e.Sleep(this.checkoutPageUrlData.waitBeforeTypingNextCoupon);case 8:return e.next=11,this.TypeCoupon(n,r);case 11:if(this.SaveCouponStatus(r,n,!0,!1,c,u,l),e.t0=this.checkoutPageData.retailerData.shortCircuitAAEnabled,!e.t0){e.next=17;break}return e.next=16,_e.WaitForCondition(t(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!(null!==(t=Ot.GetFirstVisibleElement(y.checkoutPageUrlData.applyButtonSelector))&&void 0!==t&&t.disabled));case 1:case"end":return e.stop()}}),e)}))),ce.WaitTime);case 16:e.t0=!e.sent;case 17:if(!e.t0){e.next=19;break}throw ke.ThrowError(De.AutoApplyShortcircuit,"Auto Apply Short-Circuited");case 19:return d=""===this.extractedApplyButton?this.checkoutPageUrlData.applyButtonSelector:this.extractedApplyButton,e.next=23,this.setupDOMMutationObserver();case 23:return this.applied=!1,e.next=26,this.ClickApplyButton(d);case 26:if(h=e.sent,!this.localDataService.IsFeatureEnabled(Oe.onlineSelectorExtraction)){e.next=41;break}if(h){e.next=41;break}return e.next=31,this.disconnectDOMMutationObserver();case 31:return e.next=33,_e.MeasureExecutionTime(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.SendDomMessage(y.contextID,new Rn(Ne.ExtractApplyButton,""===y.extractedInputBox?y.checkoutPageUrlData.inputBoxSelector:y.extractedInputBox),"Extracting apply button selector",!0);case 2:if(""!==(f=e.sent).Selector){e.next=5;break}throw ke.ThrowError(De.AutoApplyFail,"Unable to extract apply button selector");case 5:y.extractedApplyButton=f.Selector;case 6:case"end":return e.stop()}}),e)}))),"Extracting apply button");case 33:return v=e.sent,this.LogSelectorExtractionPerf(v,"ApplyButtonExtraction"),this.checkoutPageUrlData.applyButtonSelector=r.ExtractedApplyButton=this.extractedApplyButton,e.next=38,this.setupDOMMutationObserver();case 38:return this.applied=!1,e.next=41,this.ClickApplyButton(this.extractedApplyButton);case 41:return this.SaveCouponStatus(r,n,!0,!1,c,u,l),e.next=44,this.WaitForCouponApply(p);case 44:return g=e.sent,e.next=47,this.disconnectDOMMutationObserver();case 47:return e.next=49,this.CloseModalDialogOnRetailerPage();case 49:if(!this.checkoutPageUrlData.refreshAfterApplying){e.next=54;break}return e.next=52,this.WaitForRefresh(4e3);case 52:if(!e.sent){e.next=54;break}ke.ThrowError(De.Refresh);case 54:return e.next=56,this.showOverlayIfHidden(n,i,r);case 56:return e.abrupt("return",g);case 57:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o,i,a,s){return V.apply(this,arguments)})},{key:"isCouponInapplicable",value:function(e,t,n){if(!(n&&e.CouponResults.filter((function(e){return e.ApplyWaitCompletedSignal!==Fn.NotApplied})).length<=0)){if(t.isLowSuccessRateCoupon)return R.LowSuccess;if(this.localDataService.IsFeatureEnabled(Oe.calculatedCutOffFiltering)&&e.InitialPrice&&t.calculatedCutoffPrice&&e.InitialPrice<t.calculatedCutoffPrice)return R.CalculatedCutOffPriceNotMet;if(e.InitialPrice&&t.minimumPurchase&&e.InitialPrice<t.minimumPurchase)return R.MinPurchaseNotMet;if(this.checkoutPageData.retailerData.couponsFilteringEnabled&&e.MaxDiscount){if(t.discountPercent&&t.discountPercent<=this.GetDiscountPercent(e.MaxDiscount,e.InitialPrice))return R.WorseDiscountPercent;if(t.discountValue&&t.discountValue<=e.MaxDiscount)return R.WorseDiscountValue}}}},{key:"WaitForCouponApply",value:(G=t(o().mark((function e(n){var r,i,a,s,c,u,l=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!1,i=(new Date).getTime(),a=Fn.FixedWaitTime,!this.IsDomMutationEnabled()){e.next=14;break}return e.next=6,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l.applied);case 1:case"end":return e.stop()}}),e)}))),this.checkoutPageUrlData.waitAfterApplyingCurrentCoupon);case 6:if(r=e.sent,c=null!==(s=this.checkoutPageUrlData.couponApplyMinWaitTime)&&void 0!==s?s:1e3,!r){e.next=12;break}return e.next=11,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(new Date).getTime()-i>c);case 1:case"end":return e.stop()}}),e)}))),c);case 11:a=this.signal;case 12:e.next=24;break;case 14:if(!(!n&&_e.IsValidDataField(this.checkoutPageUrlData.removeCouponButtonSelector)&&ce.WaitTime>=this.checkoutPageUrlData.waitAfterApplyingCurrentCoupon&&!0!==this.checkoutPageUrlData.refreshAfterApplying)){e.next=21;break}return e.next=17,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.CouponApplied(l.checkoutPageUrlData.removeCouponButtonSelector);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),ce.WaitTime);case 17:e.sent&&(a=Fn.RemoveButtonDetected),e.next=24;break;case 21:if(!(this.checkoutPageUrlData.waitAfterApplyingCurrentCoupon>0)){e.next=24;break}return e.next=24,_e.Sleep(this.checkoutPageUrlData.waitAfterApplyingCurrentCoupon);case 24:return u={CompletedSignal:a,WaitTime:(new Date).getTime()-i},e.abrupt("return",u);case 26:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"GetDiscount",value:(L=t(o().mark((function e(n,r){var i,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.checkoutPageUrlData.orderTotalDataElementSelector){e.next=8;break}return e.next=3,this.GetOrderTotal();case 3:if(i=e.sent,!(n>0&&i>0)){e.next=6;break}return e.abrupt("return",n-i);case 6:e.next=23;break;case 8:if(!this.checkoutPageUrlData.supportedNoOrderTotal){e.next=23;break}return e.next=11,this.WasCouponRejected();case 11:if(e.sent){e.next=23;break}return e.next=15,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.CouponApplied(a.checkoutPageUrlData.removeCouponButtonSelector);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),1e4);case 15:if(!(e.sent&&r&&n>0)){e.next=23;break}if(!r.discountValue){e.next=21;break}return e.abrupt("return",r.discountValue);case 21:if(!r.discountPercent){e.next=23;break}return e.abrupt("return",n*r.discountPercent/100);case 23:return e.abrupt("return",0);case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"GetDiscountPercent",value:function(e,t){return Math.round(e/t*100*100)/100}},{key:"RemoveCoupon",value:(N=t(o().mark((function e(t,n){var r,i,a,s,c,u,l,p,d,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.checkoutPageUrlData.removeCouponButtonSelector,a="",2===(s=this.GetRemoveButtonActionLink(this.checkoutPageUrlData)).length&&(a=s[0],i=s[1]),e.next=6,this.IsFieldVisible(this.contextID,a,"Click before remove visible");case 6:if(!e.sent){e.next=12;break}return e.next=9,this.IsFieldVisible(this.contextID,i,"Remove path visible");case 9:if(e.sent){e.next=12;break}return e.next=12,this.SendDomMessage(this.contextID,new Fe(Ne.Click,a,""),"click before remove",!1);case 12:return e.next=14,this.IsFieldVisible(this.contextID,i,"Remove coupon");case 14:if(!e.sent){e.next=39;break}if(!this.isPDPBgAutoApply||!t){e.next=17;break}throw new Error(De.CouponAlreadyApplied);case 17:return e.next=19,this.setupDOMMutationObserver();case 19:return this.removed=!1,e.next=22,this.SendDomMessage(this.contextID,new Fe(Ne.Click,i,""),"Remove coupon",!1);case 22:return e.next=24,this.WaitForCouponRemoval(i);case 24:return r=e.sent,e.next=27,this.disconnectDOMMutationObserver();case 27:return e.next=29,this.CloseModalDialogOnRetailerPage();case 29:if(!this.checkoutPageUrlData.refreshAfterRemoving){e.next=34;break}return e.next=32,this.WaitForRefresh(4e3);case 32:if(!e.sent){e.next=34;break}ke.ThrowError(De.Refresh);case 34:if(!n){e.next=39;break}return d=null!==(c=(null==n?void 0:n.CouponsApplied.size)-1)&&void 0!==c?c:0,h=null!==(u=null===(l=this.checkoutPageData)||void 0===l||null===(p=l.coupons[d])||void 0===p?void 0:p.couponCode)&&void 0!==u?u:"",e.next=39,this.showOverlayIfHidden(h,d,n);case 39:return e.abrupt("return",r);case 40:case"end":return e.stop()}}),e,this)}))),function(e,t){return N.apply(this,arguments)})},{key:"WaitForCouponRemoval",value:(B=t(o().mark((function e(n){var r,i,a,s,c,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!1,i=(new Date).getTime(),!this.IsDomMutationEnabled()){e.next=12;break}return e.next=5,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u.removed);case 1:case"end":return e.stop()}}),e)}))),this.checkoutPageUrlData.waitBeforeReApplyingNextCoupon);case 5:if(r=e.sent,s=null!==(a=this.checkoutPageUrlData.couponRemoveMinWaitTime)&&void 0!==a?a:1e3,!r){e.next=10;break}return e.next=10,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(new Date).getTime()-i>s);case 1:case"end":return e.stop()}}),e)}))),s);case 10:e.next=24;break;case 12:if(!(_e.IsValidDataField(n)&&ce.WaitTime>=this.checkoutPageUrlData.waitBeforeReApplyingNextCoupon&&!0!==this.checkoutPageUrlData.refreshAfterRemoving)){e.next=21;break}return e.next=15,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!u.CouponApplied(n));case 1:case"end":return e.stop()}}),e)}))),ce.WaitTime);case 15:return e.next=17,this.CouponApplied(n);case 17:if(!e.sent){e.next=19;break}this.LogError("Failed to remove applied coupon",be.RemoveCouponFailure,"Called RemoveCoupon on a checkout page");case 19:e.next=24;break;case 21:if(!(this.checkoutPageUrlData.waitBeforeReApplyingNextCoupon>0)){e.next=24;break}return e.next=24,_e.Sleep(this.checkoutPageUrlData.waitBeforeReApplyingNextCoupon);case 24:return c={CompletedSignal:r?this.signal:Fn.FixedWaitTime,WaitTime:(new Date).getTime()-i},e.abrupt("return",c);case 26:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"CloseErrorMessage",value:(F=t(o().mark((function e(){var n,r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.checkoutPageUrlData.errorMessageCloseButtonSelector,!_e.IsValidDataField(n)){e.next=6;break}return e.next=4,this.SendDomMessage(this.contextID,new Fe(Ne.Click,n,""),"Close error message",!1);case 4:return e.next=6,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,!r.ErrorMessageButtonExists();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),ce.WaitTime);case 6:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"CouponApplied",value:(M=t(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.IsFieldVisible(this.contextID,t,"Coupon applied");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"WasCouponAccepted",value:(T=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.IsFieldVisible(this.contextID,this.checkoutPageUrlData.couponAcceptedMessageElementSelector,"Was coupon accepted");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"WasCouponRejected",value:(O=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.IsFieldVisible(this.contextID,this.checkoutPageUrlData.errorMessageSelector,"Was coupon rejected");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)})},{key:"ErrorMessageButtonExists",value:(I=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.IsFieldVisible(this.contextID,this.checkoutPageUrlData.errorMessageCloseButtonSelector,"Error message button exists");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"ClickBeforeStart",value:(P=t(o().mark((function e(){var n,r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.checkoutPageUrlData.clickBeforeStartSelector,!_e.IsValidDataField(n)){e.next=6;break}return e.next=4,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.IsFieldVisible(r.contextID,n,"Wait for button to become visible");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),ce.WaitTime);case 4:return e.next=6,this.SendDomMessage(this.contextID,new Fe(Ne.Click,n,""),"Click before button",!0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"TypeCoupon",value:(E=t(o().mark((function e(n,r){var i,a,s,c=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=""===this.extractedInputBox?this.checkoutPageUrlData.inputBoxSelector:this.extractedInputBox,e.next=3,this.IsFieldVisible(this.contextID,i,"Type coupon");case 3:if(e.sent){e.next=6;break}return e.next=6,this.ClickBeforeStart();case 6:if(e.t0=this.localDataService.IsFeatureEnabled(Oe.onlineSelectorExtraction)&&this.extractedInputBox,!e.t0){e.next=11;break}return e.next=10,this.IsFieldVisible(this.contextID,i,"Type coupon");case 10:e.t0=!e.sent;case 11:if(!e.t0){e.next=14;break}return e.next=14,this.ClickBeforeStart();case 14:return e.next=16,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.IsFieldVisible(c.contextID,i,"Type coupon");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),5e3);case 16:return e.next=18,this.SetInputBoxValue(i,n);case 18:if(a=e.sent,!this.localDataService.IsFeatureEnabled(Oe.onlineSelectorExtraction)){e.next=28;break}if(a){e.next=28;break}return e.next=23,_e.MeasureExecutionTime(t(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.SendDomMessage(c.contextID,new Rn(Ne.ExtractInputBox),"Extracting input box selector",!0);case 2:if(""!==(t=e.sent).Selector){e.next=5;break}throw ke.ThrowError(De.AutoApplyFail,"Unable to extract input box selector");case 5:c.extractedInputBox=t.Selector;case 6:case"end":return e.stop()}}),e)}))),"Extracting input box");case 23:return s=e.sent,this.LogSelectorExtractionPerf(s,"InputBoxExtraction"),this.checkoutPageUrlData.inputBoxSelector=r.ExtractedInputBox=this.extractedInputBox,e.next=28,this.SetInputBoxValue(this.extractedInputBox,n);case 28:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"SetInputBoxValue",value:(k=t(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(this.contextID,new Fe(Ne.SetBoxValue,t,n.trim(),void 0,this.autoApplyScenario),"Coupon input box",!0);case 2:return r=e.sent,e.abrupt("return",r.SelectorSuccess);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"ClickApplyButton",value:(x=t(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(this.contextID,new Fe(Ne.Click,t,"",yt.Apply,this.autoApplyScenario),"Coupon apply",!0);case 2:return n=e.sent,e.abrupt("return",n.SelectorSuccess);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"LogSelectorExtractionPerf",value:function(e,t){this.logService.LogClientEventV2(b.Information,A.EdgeFlyoutStatus,e.toString(),new Dn(w.PerfSelectorExtraction,void 0,void 0,this.checkoutPageData.retailerData.domainName,t))}},{key:"GetRemoveButtonActionLink",value:function(e){return e.removeCouponButtonSelector?e.removeCouponButtonSelector.split(";"):[]}},{key:"SaveCouponStatus",value:function(e,t,n,r,o,i,a){if(i&&e.BestCoupon)e.BestCoupon.wasTyped=n,e.BestCoupon.wasVerified=r,e.BestCoupon.isStackable=o;else if(a&&e.AppliedCoupon)e.AppliedCoupon.wasTyped=n,e.AppliedCoupon.wasVerified=r;else{var s=new kn(t,n,r,o);e.CouponsApplied.set(t,s)}this.SaveState(e)}},{key:"SaveCouponDiscountStatus",value:function(e,t,n,r,o,i,a,s){t>=0&&(!e.MaxDiscount||t>e.MaxDiscount)&&(e.MaxDiscount=t,e.BestCoupon=new kn(n,!1,!1,r),e.BestCoupon.discountValue=t);var c={Applicability:null!=s?s:t>0?R.Valid:R.NotApplicable,ApplyWaitCompletedSignal:(null==a?void 0:a.CompletedSignal)||Fn.Refresh,ApplyWaitTime:(null==a?void 0:a.WaitTime)||-1,Attribution:o,Code:n,Discount:Math.round(100*t)/100,DiscountPercent:this.GetDiscountPercent(t,e.InitialPrice),RemoveWaitCompletedSignal:void 0,RemoveWaitTime:void 0,StatusMessage:i};e.CouponResults.push(c);var u=new kn(n,!0,!0,r);e.CouponsApplied.set(n,u),this.isPDPBgAutoApply&&(e.BackgroundAAStatus.result=D.InProgress,this.edgeMessageService.SetStorageValue("BackgroundAutoApplyData_"+location.pathname,JSON.stringify({value:JSON.stringify(e)}))),this.SaveState(e)}},{key:"SaveRemoveCouponResult",value:function(e,t){var n=e.CouponResults[e.CouponResults.length-1];n.RemoveWaitCompletedSignal=(null==t?void 0:t.CompletedSignal)||Fn.NoRemoveButton,n.RemoveWaitTime=(null==t?void 0:t.WaitTime)||-1,this.SaveState(e)}},{key:"SaveInapplicableCouponStatus",value:function(e,t,n){var r;if(null===(r=e.CouponsApplied.get(t.couponCode))||void 0===r||!r.wasVerified){var o,i={CompletedSignal:Fn.NotApplied,WaitTime:-1};this.SaveCouponDiscountStatus(e,-1,t.couponCode,null!==(o=t.isStackable)&&void 0!==o&&o,t.attribution,void 0,i,n)}}},{key:"LogCancelledStatus",value:function(e,t){var n,r,o,i,a,s=new ie(this.checkoutPageData.retailerData.domainName,null===(n=this.entryPointService)||void 0===n?void 0:n.GetEntryPoint()),c=this.GetAutoApplyTime(e);if(s.SetResultData(D.Cancelled,c,void 0,null!==(r=null==e?void 0:e.CouponResults)&&void 0!==r?r:[],0,null!==(o=null==e?void 0:e.InitialPrice)&&void 0!==o?o:0,!1,t,this.GetExtractedSelectors()),s.SetCurrencyInfo(null!==(i=null==e?void 0:e.Currency)&&void 0!==i?i:"",null!==(a=null==e?void 0:e.PageCurrency)&&void 0!==a?a:""),s.SetErrorData(D.Cancelled,De.AutoApplyCancelled),this.isBgAAScenario){var u=new On(Pe.AutoApplyFinished,e);u.result=D.Cancelled,so.GetBroadcastChannelService().PostMessage(JSON.stringify(u)),so.GetBroadcastChannelService().Close()}else this.logService.LogClientEventV2(b.Information,A.AutoApply,De.AutoApplyCancelled,s,this.checkoutPageData.impressionId);if(this.isForegroundAAScenario){var l=new ye(we.FinishAutoApply,D.Cancelled);so.GetBroadcastChannelService().PostMessage(l),so.GetBroadcastChannelService().Close()}else this.edgeMessageService.SendAutoApplyCancelledMessage();this.ClearState()}},{key:"LogAutoApplyError",value:function(e,t){if(this.isBgAAScenario||this.logService.LogClientEventV2(b.Information,A.AutoApply,t,e),this.isForegroundAAScenario){var n,r=new ye(we.FinishAutoApply,D.Error);r.SetErrorInfo(null!==(n=e.ErrorName)&&void 0!==n?n:""),so.GetBroadcastChannelService().PostMessage(r),so.GetBroadcastChannelService().Close()}else if(this.edgeMessageService.SendAutoApplyErrorMessage(e.ErrorName),this.isBgAAScenario){var o,i=new On(Pe.AutoApplyFinished,null);return i.result=D.Error,i.SetErrorDetails(null!==(o=e.ErrorName)&&void 0!==o?o:"",t),void so.GetBroadcastChannelService().PostMessage(JSON.stringify(i))}}},{key:"GetExtractedSelectors",value:function(){return{ApplyButton:""!==this.extractedApplyButton?this.extractedApplyButton:void 0,InputBox:""!==this.extractedInputBox?this.extractedInputBox:void 0,OrderTotalElement:""!==this.extractedOrderTotalElement?this.extractedOrderTotalElement:void 0}}},{key:"MoveProgressBar",value:(C=t(o().mark((function e(t,n){var r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isBgAAScenario&&n&&this.checkoutPageData.coupons.length>0&&(r=this.overlayService.GetPositions(t,this.checkoutPageData.coupons.length),n.BackgroundAAStatus.progressBarStartPos=r[0],n.BackgroundAAStatus.progressBarEndPos=r[1],i=new On(Pe.ProgressBarUpdate,n),so.GetBroadcastChannelService().PostMessage(JSON.stringify(i))),e.next=3,this.overlayService.MoveProgressBar(this.contextID,t,this.checkoutPageData.coupons.length);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"UpdateCurrentCoupon",value:(m=t(o().mark((function e(t,n,r,i,a){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isBgAAScenario&&a&&(a.BackgroundAAStatus.currentCoupon=t,a.BackgroundAAStatus.currentCouponIndex=n,a.BackgroundAAStatus.couponsTotal=r,s=new On(Pe.CouponUpdate,a),so.GetBroadcastChannelService().PostMessage(JSON.stringify(s))),e.next=3,this.overlayService.UpdateCurrentCoupon(this.contextID,t,n,r,i);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o){return m.apply(this,arguments)})},{key:"ResetUIState",value:function(){this.SaveUIState(Re.CreateNew(ke.GetDomainName()))}},{key:"LogAndThrowError",value:function(e,t,n){throw this.LogError(e,t,n),new Error(n)}},{key:"EntryPointIsWallet",value:function(){var e;return(null===(e=this.entryPointService)||void 0===e?void 0:e.GetEntryPoint())===J.Wallet}},{key:"LogError",value:function(e,t,n){var r,o={EntryPoint:null===(r=this.entryPointService)||void 0===r?void 0:r.GetEntryPoint(),FunctionName:e,Scenario:this.autoApplyScenario},i=new se(this.checkoutPageData.retailerData.domainName,t,o,void 0);this.logService.LogClientErrorV2(null!=n?n:"",i)}},{key:"setupDOMMutationObserver",value:(S=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.IsDomMutationEnabled()){e.next=3;break}return e.next=3,this.SendDomMessage(this.contextID,new Bn(this.contextID,Ne.setUpMutationObservor,this.checkoutPageUrlData),"set dom mutation observer",!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"IsDomMutationEnabled",value:function(){return this.checkoutPageUrlData.domMutationEnabled}},{key:"disconnectDOMMutationObserver",value:(y=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.IsDomMutationEnabled()){e.next=3;break}return e.next=3,this.SendDomMessage(this.contextID,new Fe(Ne.DisconnectDOMMutationObserver,"",""),"disconnect mutation observer",!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"IsFakeRefreshEvent",value:(f=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!0!==this.checkoutPageUrlData.refreshAfterApplying&&!0!==this.checkoutPageUrlData.refreshAfterRemoving,!e.t0){e.next=5;break}return e.next=4,this.overlayService.OverlayVisible(this.contextID);case 4:e.t0=e.sent;case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"InitializeCheckoutPageUrlData",value:function(){var e=this.checkoutPageData.retailerData.GetCurrentCheckoutPage();return e?(this.checkoutPageUrlData=e,!0):(this.LogError("ApplyCouponsAsync",be.AutoApplyWithoutCheckout,"Called ApplyCoupons when not on a checkout page"),!1)}},{key:"SetUpBackgroundScriptMessageHandler",value:function(){var e=this;so.GetBroadcastChannelService().GetBgAutoApplyChannel(),so.GetBroadcastChannelService().setOnMessageEventHandler(function(){var n=t(o().mark((function t(n){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(r=n.data).messageType===we.FinishAutoApply&&(r.result===D.Positive?e.edgeMessageService.SendAutoApplyPositiveMessage(r.bestCoupon,r.initialPrice,r.maxDiscount):r.result===D.Negative?e.edgeMessageService.SendAutoApplyNegativeMessage():r.result===D.Cancelled?e.edgeMessageService.SendAutoApplyCancelledMessage():e.edgeMessageService.SendAutoApplyErrorMessage(r.errorName),so.GetBroadcastChannelService().Close()),r.messageType===we.CancelAutoApply&&e.CancelBackgroundAutoApply(),r.messageType===we.RestartAutoApply&&(e.restartAA=!0,e.CancelBackgroundAutoApply());case 4:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}())}},{key:"FinalizePDPBackgroundAutoApply",value:(h=t(o().mark((function e(t,n,r){var i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=r)||(i=t.MaxDiscount>0?D.Positive:D.Negative),(a=so.GetBackgroundAutoApplyService().GetTelemetryDataFromState(t,i,U.ProductPageBackgroundAutoApply)).ExtractedSelectors=this.GetExtractedSelectors(),this.logService.LogClientEventV2(b.Information,A.AutoApply,n,a,null==t?void 0:t.ImpressionId),t.BackgroundAAStatus.result=i,this.edgeMessageService.SetStorageValue("BackgroundAutoApplyData_"+location.pathname,JSON.stringify({value:JSON.stringify(t)})),e.next=9,this.CheckIfCartValueIncreased(t,i);case 9:r===D.Positive?this.edgeMessageService.SendAutoApplyPositiveMessage(null===(s=t.BestCoupon)||void 0===s?void 0:s.couponCode,t.InitialPrice,t.MaxDiscount):r===D.Negative?this.edgeMessageService.SendAutoApplyNegativeMessage():r===D.Error?this.edgeMessageService.SendAutoApplyErrorMessage():this.edgeMessageService.SendAutoApplyCancelledMessage();case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return h.apply(this,arguments)})},{key:"applyBestCoupon",value:(d=t(o().mark((function e(n,r,i){var a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!n.BestCoupon){e.next=16;break}if(!this.isForegroundAAScenario){e.next=4;break}return e.next=4,this.RemoveCoupon();case 4:if(n.BestCoupon.wasTyped){e.next=8;break}return e.next=8,this.ApplyCoupon(n.BestCoupon.couponCode,n,r.length,r.length,n.MaxDiscount,n.BestCoupon.isStackable,!0);case 8:if(n.BestCoupon.wasVerified){e.next=16;break}return e.next=11,this.GetDiscount(n.InitialPrice,n.BestCoupon);case 11:if(!(0===(i=e.sent)&&n.MaxDiscount>0)){e.next=15;break}return e.next=15,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.GetDiscount(n.InitialPrice);case 2:return i=e.sent,e.abrupt("return",i>0);case 4:case"end":return e.stop()}}),e)}))),ce.WaitTime);case 15:this.SaveCouponStatus(n,n.BestCoupon.couponCode,!0,!0,n.BestCoupon.isStackable,!0);case 16:return e.abrupt("return",i);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"CheckIfCartValueIncreased",value:(l=t(o().mark((function e(t,n){var r,i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.GetOrderTotal();case 3:(r=e.sent)>t.InitialPrice&&(a={BackgroundAutoApplyResult:n,CouponResults:t.CouponResults,EntryPoint:null===(i=this.entryPointService)||void 0===i?void 0:i.GetEntryPoint(),FinalPrice:r,InitialPrice:t.InitialPrice,Scenario:U.ProductPageBackgroundAutoApply},s=new se(this.checkoutPageData.retailerData.domainName,be.BetterInitialPrice,a,void 0),this.logService.LogClientErrorV2("",s)),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e,t){return l.apply(this,arguments)})},{key:"Cancel",value:(a=t(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isPDPBgAutoApply&&(t&&(t.BackgroundAAStatus.result=D.Cancelled),this.edgeMessageService.SetStorageValue("BackgroundAutoApplyData_"+location.pathname,JSON.stringify({value:JSON.stringify(t)}))),n!==U.AutoApplyCoupons&&n!==U.FallBackAutoApply||!t||!(t.MaxDiscount>0)){e.next=5;break}return r=this.checkoutPageData.coupons,e.next=5,this.applyBestCoupon(t,r,0);case 5:this.LogCancelledStatus(t,n),this.overlayService.CloseOverlay(this.contextID);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"Restart",value:(i=t(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.restartAA=!1,this.bgAutoApplyCancelled=!1,this.ClearState(),(r=new ie(this.checkoutPageData.retailerData.domainName,null===(n=this.entryPointService)||void 0===n?void 0:n.GetEntryPoint())).AutoApplyScenario=U.ProductPageBackgroundAutoApply,r.AutoApplyProcessTime=this.GetAutoApplyTime(t),r.ExtractedSelectors=this.GetExtractedSelectors(),this.logService.LogClientEventV2(b.Information,A.AutoApply,"Auto Apply Restarted",r),e.next=10,this.RemoveCoupon();case 10:location.reload();case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"GetBackgroundAutoApplyResultState",value:function(){try{var e=so.GetLocalDataService().GetLocaData(Te.BackgroundAutoApplyState);if(e)return ne.CreateFromObject(JSON.parse(e))}catch(e){this.LogError("GetBackgroundAAState",be.ErrorParsingBackgroundAutoApplyState,null==e?void 0:e.message)}return null}},{key:"ReValidateBackgroundAutoApplyState",value:(r=t(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this.GetOrderTotal();case 4:if(n=e.sent,t.InitialPrice!==n&&t.TrueInitialPrice!==n&&t.InitialPrice-t.MaxDiscount!==n){e.next=12;break}return t.StartTime=Date.now(),this.SaveState(t),e.next=10,this.RemoveCoupon(!0);case 10:e.next=17;break;case 12:this.edgeMessageService.DeleteStorageValue("BackgroundAutoApplyData_"+location.pathname),r="Called edge driver with expired bgaa state.";try{window.ResetBackgroundAAValidationMessage()}catch(e){r+=" Unable to clear validation"}return this.LogError("ValidateBackgroundAAState",be.ExpiredBackgroundAAState,r),e.abrupt("return",!1);case 17:return e.abrupt("return",!0);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"showOverlayIfHidden",value:(n=t(o().mark((function e(t,n,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.overlayService.OverlayVisible(this.contextID);case 2:if(e.t1=e.sent,e.t0=!1===e.t1,!e.t0){e.next=6;break}e.t0=!this.EntryPointIsWallet();case 6:if(!e.t0){e.next=9;break}return e.next=9,this.overlayService.OpenOverlay(this.contextID,t,this.checkoutPageData.coupons.length,r.MaxDiscount,this.checkoutPageUrlData,n);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})}]),ce}(En);v(Un,"WaitTime",2e3),v(Un,"AutoApplyComplete","Finished auto applying coupons");var Vn=Un;function _n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Wn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Wn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var zn=function(e){p(l,e);var n,r,i,a=Hn(l);function l(e,t,n,r,o,i,s){var p;return c(this,l),v(u(p=a.call(this)),"couponApplicatorMap",void 0),v(u(p),"stateService",void 0),v(u(p),"logService",void 0),v(u(p),"overlayService",void 0),v(u(p),"platformInstance",void 0),v(u(p),"localDataService",void 0),v(u(p),"edgeMessageService",void 0),v(u(p),"entryPointService",void 0),p.couponApplicatorMap=new Map,p.stateService=e,p.logService=t,p.overlayService=n,p.platformInstance=r,p.localDataService=o,p.edgeMessageService=i,p.entryPointService=s,p}return s(l,[{key:"ApplyCoupons",value:function(e,t,n,r,o){this.GetApplicator(e,t).ApplyCoupons(n,r).then((function(e){o&&o(e)})).catch((function(){o&&o(!1)}))}},{key:"UpdateUIState",value:(i=t(o().mark((function e(t,n,r,i){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.GetApplicator(t,i),e.next=3,a.UpdateUIState(n,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"ClearAllStates",value:(r=t(o().mark((function e(){var t,n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_n(this.couponApplicatorMap.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=10;break}return r=n.value,i=this.couponApplicatorMap.get(r),e.next=8,null==i?void 0:i.ClearUIState();case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),t.e(e.t0);case 15:return e.prev=15,t.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])}))),function(){return r.apply(this,arguments)})},{key:"GetUIState",value:(n=t(o().mark((function e(t,n,r){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.GetApplicator(t,r),e.next=3,i.GetUIState(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"SetCouponApplyState",value:function(e,t,n,r){this.GetApplicator(e).SetCouponApplyState(t,n,r)}},{key:"GetApplicator",value:function(e,t){var n=this.couponApplicatorMap.get(e);if(n)t&&n.SetRetailerData(t);else{if(!t)throw Error("CheckoutPageData must be there.");n=new Vn(t,e,this.stateService,this.logService,this.overlayService,this.platformInstance,this.localDataService,this.edgeMessageService,this.entryPointService),this.couponApplicatorMap.set(e,n)}return n}}],[{key:"GetInstance",value:function(){return this.Instance||(this.Instance=new l(so.GetApplicatorStateService(),so.GetLogService(),so.GetOverlayService(),so.GetPlatformInstance(),so.GetLocalDataService(),so.GetEdgeMessageService(),so.GetEntryPointService())),this.Instance}}]),l}(s((function e(){c(this,e)})));v(zn,"Instance",void 0);var jn=zn,Jn=function(){function e(){c(this,e)}return s(e,null,[{key:"GetInstance",value:function(){return this.Instance||(this.Instance=jn.GetInstance()),this.Instance}}]),e}();v(Jn,"Instance",void 0);var $n=Jn,Kn=function(){function e(t){c(this,e),v(this,"logService",void 0),this.logService=t}var n;return s(e,[{key:"HandleMessage",value:(n=t(o().mark((function e(t){var n,r,i,a,s,c,u,l,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,r=new Le,n){e.next=4;break}return e.abrupt("return",r);case 4:if((i=n.Type)!==M.TelemetryMessage){e.next=10;break}a=n,this.logService.LogClientEventV2(a.LogLevel,a.EventType,a.Message,a.Data),e.next=30;break;case 10:if(i!==M.ClosedPopupMessage&&i!==M.AutoApplyCompletedMessage&&i!==M.AutoApplyCancelledMessage){e.next=23;break}return c=(s=n).Hostname,e.next=15,$n.GetInstance().GetUIState(s.ContextID,c);case 15:if(u=e.sent,l=!1,u&&(i===M.ClosedPopupMessage?(u.SetState(Ce.PopupClosed,!0),l=!0):i===M.AutoApplyCompletedMessage?(u.SetState(Ce.AutoApplyCompleted,!0),u.SetState(Ce.CartChanged,!1),l=!0):i===M.AutoApplyCancelledMessage&&(u.SetState(Ce.AutoApplyCancelled,!0),l=!0)),!l){e.next=21;break}return e.next=21,$n.GetInstance().UpdateUIState(s.ContextID,c,u);case 21:case 27:e.next=30;break;case 23:if(i!==M.DOMMutationMessage){e.next=29;break}return p=n,e.next=27,$n.GetInstance().SetCouponApplyState(p.ContextID,p.couponResultSignal,p.isApplyReady,p.isRemoveReady);case 29:case 30:return e.abrupt("return",r);case 31:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),e}();function Xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Yn=function(e){p(i,e);var n,r=Xn(i);function i(e,t){var n;return c(this,i),v(u(n=r.call(this,e)),"entryPointService",void 0),n.entryPointService=t,n}return s(i,[{key:"HandleMessage",value:(n=t(o().mark((function e(t){var n,r,a,s,c,u,l,p,d,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=t).Type,a=new Le,r!==M.EdgeApplyCouponsMessage){e.next=15;break}return c=(s=n).checkoutPageData,e.next=8,$n.GetInstance().GetUIState(s.ContextID,s.Hostname,s.checkoutPageData);case 8:u=e.sent,l=!1,u&&u.HasState(Ce.AutoApplyCancelled)&&(l=!0),s.startNew&&((p=new ie(s.checkoutPageData.retailerData.domainName,this.entryPointService.GetEntryPoint())).AutoApplyScenario=so.GetBackgroundAutoApplyService().GetAutoApplyScenario(),this.logService.LogClientEventV2(b.Information,A.AutoApply,"Auto Apply Initiated",p,c.impressionId)),$n.GetInstance().ApplyCoupons(s.ContextID,c,s.startNew,l),e.next=24;break;case 15:if(r!==M.BackgroundAutoApplyCancelledMessage){e.next=23;break}d=so.GetBackgroundAutoApplyService(),so.GetBroadcastChannelService().setOnMessageEventHandler((function(e){d.BackgroundAutoApplyCancelHandler(e)})),d.SendCancelMesssageToBgAutoApply(),h=n,Jt(f(i.prototype),"HandleMessage",this).call(this,new Cn(h.ContextID,h.Hostname,h.Pathname)),e.next=24;break;case 23:return e.abrupt("return",Jt(f(i.prototype),"HandleMessage",this).call(this,n));case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),i}(Kn),Zn=Yn;function qn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Qn=function(e){p(n,e);var t=qn(n);function n(){var e;c(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return v(u(e=t.call.apply(t,[this].concat(o))),"Domain",void 0),v(u(e),"Savings",void 0),v(u(e),"InitialPrice",void 0),v(u(e),"Currency",void 0),v(u(e),"Result",void 0),v(u(e),"PageCurrency",void 0),e}return s(n,[{key:"SetResultData",value:function(e,t,n,r,o,i){this.Domain=e,this.Savings=null!=t?t:0,this.InitialPrice=null!=n?n:0,this.Currency=r,this.PageCurrency=o,this.Result=i}}]),n}(re),er=Qn;function tr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var nr=function(e){p(f,e);var n,r,a,l,d,h=tr(f);function f(e,t,n,r){var o;return c(this,f),v(u(o=h.call(this,e)),"overlayService",void 0),v(u(o),"edgeMessageService",void 0),v(u(o),"logService",void 0),v(u(o),"checkoutPageData",void 0),v(u(o),"checkoutPageUrlData",void 0),v(u(o),"otherSellerData",void 0),v(u(o),"iframeID","OtherSellersIframe"),v(u(o),"contextId",void 0),o.logService=t,o.overlayService=n,o.edgeMessageService=r,o.contextId=N.FromBackground,o}return s(f,[{key:"AddToCart",value:(d=t(o().mark((function e(t,n){var r,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.edgeMessageService.SendOtherSellersStartMessage(),this.checkoutPageData=t,this.otherSellerData=n,this.InitializeCheckoutPageUrlData(t)){e.next=5;break}return e.abrupt("return");case 5:if(r="",n){e.next=10;break}return r="Called OtherSellerService with empty storage data",this.FinalizeOtherSellersScenario(T.Error,0,0,"",r),e.abrupt("return");case 10:this.AddOtherItemToCart().catch((function(e){r="Unknown OtherSellersService error: "+e,i.FinalizeOtherSellersScenario(T.Error,0,0,"",r)}));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"GetOtherSellerDiscount",value:function(){var e,t,n,r,o=null===(e=this.otherSellerData)||void 0===e||null===(t=e.OtherSeller)||void 0===t?void 0:t.OriginalItemPrice,i=null===(n=this.otherSellerData)||void 0===n||null===(r=n.OtherSeller)||void 0===r?void 0:r.ItemPrice;if(o&&i){var a=o-i;return Math.round(100*a)/100}return-1}},{key:"AddOtherItemToCart",value:(l=t(o().mark((function e(){var t,n,r,a,s,c,u,l,p,d,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=this.GetOtherSellerDiscount(),p="$",i(null===(t=this.otherSellerData)||void 0===t||null===(n=t.OtherSeller)||void 0===n?void 0:n.Currency)||(p=this.otherSellerData.OtherSeller.Currency),e.next=5,this.overlayService.UpdateCurrency(N.FromBackground,p);case 5:return e.next=7,this.overlayService.OpenOverlay(this.contextId,"OtherSeller",1,l,this.checkoutPageUrlData,0);case 7:return d=null===(r=this.otherSellerData)||void 0===r||null===(a=r.OtherSeller)||void 0===a?void 0:a.ItemIndex,h=null!==(s=null===(c=this.otherSellerData)||void 0===c||null===(u=c.OtherSeller)||void 0===u?void 0:u.OriginalItemPrice)&&void 0!==s?s:-1,e.next=11,this.AddItemToCart(d,l,h,p);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"AddItemToCart",value:(a=t(o().mark((function e(t,n,r,i){var a,s,c,u,l,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="",void 0!==t){e.next=7;break}return e.next=4,this.overlayService.MoveProgressBar(this.contextId,1,1);case 4:return s="Unable to get item: ItemIndex was null",this.FinalizeOtherSellersScenario(T.Error,n,r,i,s),e.abrupt("return",!1);case 7:if(c=document.querySelectorAll("#"+this.iframeID)[0],u=null==c||null===(a=c.contentDocument)||void 0===a?void 0:a.body,(l=null==u?void 0:u.querySelectorAll(this.checkoutPageUrlData.otherSellerSelectors.otherSellerOfferElementSelector))&&!(l.length<=t)){e.next=16;break}return e.next=13,this.overlayService.MoveProgressBar(this.contextId,1,1);case 13:return s="Unable to find list of sellers element",this.FinalizeOtherSellersScenario(T.Error,n,r,i,s),e.abrupt("return",!1);case 16:if(p=l[t],!this.checkoutPageData.retailerData.domainName.includes("amazon")){e.next=21;break}return e.abrupt("return",this.AddItemToAmazonCart(c,p,n,r,i));case 21:if("walmart.com"!==this.checkoutPageData.retailerData.domainName){e.next=23;break}return e.abrupt("return",this.AddItemToWalmartCart(c,p,n,r,i));case 23:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"AddItemToAmazonCart",value:(r=t(o().mark((function e(n,r,i,a,s){var c,u,l,p,d,h,f,v,g,y,S,m,C,x,k,b,A;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=this.checkoutPageUrlData.otherSellerSelectors.otherSellerAddButtonSelector,u=this.checkoutPageUrlData.otherSellerSelectors.otherSellerAddedConfirmationSelector,l=r.querySelector(c),(p=r.querySelector(u))&&(d=p.children),!l||!d){e.next=21;break}return l.click(),h=-1,e.next=12,_e.WaitForCondition(t(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=3;break}for(t=0;t<d.length;t++)d[t].className.includes("hidden")||(h=t);return e.abrupt("return",-1!==h);case 3:return e.abrupt("return",!1);case 4:case"end":return e.stop()}}),e)}))),7e3);case 12:return f=!1,-1!==h&&(f=d[h].className.includes("success")),e.next=18,this.overlayService.MoveProgressBar(this.contextId,1,1);case 18:f?this.FinalizeOtherSellersScenario(T.Positive,i,a,s):this.FinalizeOtherSellersScenario(T.Negative,i,a,s),e.next=36;break;case 21:if(!l){e.next=32;break}return m="gp/huc",l.click(),e.next=26,_e.WaitForCondition(t(o().mark((function e(){var t,r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0===(null===(t=n)||void 0===t||null===(r=t.contentDocument)||void 0===r||null===(i=r.location)||void 0===i||null===(a=i.href)||void 0===a?void 0:a.includes(m)));case 2:case"end":return e.stop()}}),e)}))),5e3);case 26:return e.next=28,this.overlayService.MoveProgressBar(this.contextId,1,1);case 28:null!==(v=n)&&void 0!==v&&null!==(g=v.contentDocument)&&void 0!==g&&null!==(y=g.location)&&void 0!==y&&null!==(S=y.href)&&void 0!==S&&S.includes(m)?(n=document.querySelectorAll("#"+this.iframeID)[0],b=null===(C=n)||void 0===C||null===(x=C.contentDocument)||void 0===x?void 0:x.body,(A=null==b?void 0:b.querySelector("[id*='order-row-confirm-text']"))&&null!==(k=A.className)&&void 0!==k&&k.includes("success")?this.FinalizeOtherSellersScenario(T.Positive,i,a,s):this.FinalizeOtherSellersScenario(T.Negative,i,a,s)):this.FinalizeOtherSellersScenario(T.Negative,i,a,s),e.next=36;break;case 32:return e.next=34,this.overlayService.MoveProgressBar(this.contextId,1,1);case 34:this.FinalizeOtherSellersScenario(T.Negative,i,a,s,"Unable to find add button");case 36:return e.abrupt("return",!0);case 37:case"end":return e.stop()}}),e,this)}))),function(e,t,n,o,i){return r.apply(this,arguments)})},{key:"AddItemToWalmartCart",value:(n=t(o().mark((function e(n,r,i,a,s){var c,u,l,p,d,h,f,v,g,y,S=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=this.checkoutPageUrlData.otherSellerSelectors.otherSellerAddButtonSelector,u=this.checkoutPageUrlData.otherSellerSelectors.otherSellerAddedConfirmationSelector,l=r.querySelector(c),p=0,d=!1,!l){e.next=20;break}return null!==(h=l.getAttribute("aria-label"))&&void 0!==h&&h.includes("in cart")?(l.click(),p=this.GetItemQuantity(r,u),(g=r.querySelector(c))&&(null==g||g.click()),this.GetItemQuantity(r,u)===p+1&&(d=!0)):null!==(f=l.getAttribute("aria-label"))&&void 0!==f&&f.includes("Add to cart")&&(l.click(),this.GetItemQuantity(r,u)===p+1&&(d=!0)),e.next=11,_e.WaitForCondition(t(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y=null==n||null===(t=n.contentDocument)||void 0===t?void 0:t.body.querySelector(S.checkoutPageUrlData.errorMessageSelector),e.abrupt("return",null!=y);case 2:case"end":return e.stop()}}),e)}))),3e3);case 11:return(y=null==n||null===(v=n.contentDocument)||void 0===v?void 0:v.body.querySelector(this.checkoutPageUrlData.errorMessageSelector))&&(d=!1),e.next=17,this.overlayService.MoveProgressBar(this.contextId,1,1);case 17:d?this.FinalizeOtherSellersScenario(T.Positive,i,a,s):this.FinalizeOtherSellersScenario(T.Negative,i,a,s),e.next=24;break;case 20:return e.next=22,this.overlayService.MoveProgressBar(this.contextId,1,1);case 22:this.FinalizeOtherSellersScenario(T.Negative,i,a,s,"Unable to find add button");case 24:return e.abrupt("return",!0);case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,r,o,i){return n.apply(this,arguments)})},{key:"GetItemQuantity",value:function(e,t){var n=e.querySelector(t),r=null==n?void 0:n.innerText.match(/[0-9]+/);return r&&r.length>0?parseFloat(r[0]):0}},{key:"FinalizeOtherSellersScenario",value:function(e,t,n,r,o){var i,a="";if(e===T.Positive){var s,c=null!==(s=Gt.GetCurrencyCodeFromSymbol(r))&&void 0!==s?s:"USD";this.edgeMessageService.SendOtherSellersCompleteMessage(n,t,c),a="Finished Adding item to cart"}else this.edgeMessageService.SendOtherSellersErrorMessage(),a="Unable to add item to cart";var u=new er;u.SetResultData(this.checkoutPageData.retailerData.domainName,t,n,r,r,e),this.logService.LogClientEventV2(b.Information,A.OtherSellers,null!=o?o:a,u,null===(i=this.checkoutPageData)||void 0===i?void 0:i.impressionId);var l={ProductAddedNotification:!0,Url:location.pathname};this.edgeMessageService.SetStorageValue("OtherSellersNotificationData_"+location.pathname,JSON.stringify({value:JSON.stringify(l)}));var p={Savings:t,Success:e===T.Positive};this.edgeMessageService.SetStorageValue("OtherSellersConfirmationData_"+location.pathname,JSON.stringify({value:JSON.stringify(p)})),location.reload()}},{key:"InitializeCheckoutPageUrlData",value:function(e){var t=e.retailerData.GetCurrentCheckoutPage();if(t)return this.checkoutPageUrlData=t,!0;return this.FinalizeOtherSellersScenario(T.Error,0,0,"","Called OtherSellerService when not on a checkout page"),!1}}]),f}(He),rr=nr;function or(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var ir=function(e){p(n,e);var t=or(n);function n(e){var r;return c(this,n),v(u(r=t.call(this,M.CheckoutProgressMessage)),"Status",void 0),r.Status=e,r}return s(n)}(ce);function ar(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var sr=function(e){p(n,e);var t=ar(n);function n(){return c(this,n),t.call(this,M.CloseOverlayMessage)}return s(n)}(ce);function cr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var ur=function(e){p(n,e);var t=cr(n);function n(e,r,o,i,a,s,l,p){var d;return c(this,n),v(u(d=t.call(this,M.CreateOverlayMessage)),"ContextID",void 0),v(u(d),"CurrentCoupon",void 0),v(u(d),"CurrentCouponIndex",void 0),v(u(d),"TotalCoupons",void 0),v(u(d),"ProgBarStart",void 0),v(u(d),"ProgBarEnd",void 0),v(u(d),"InnerHTML",void 0),v(u(d),"CurrentBestDiscount",void 0),d.ContextID=e,d.CurrentCoupon=r,d.ProgBarStart=a,d.ProgBarEnd=s,d.InnerHTML=p,d.CurrentCouponIndex=o,d.TotalCoupons=i,d.CurrentBestDiscount=l,d}return s(n)}(ce);function lr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var pr=function(e){p(n,e);var t=lr(n);function n(e,r,o,i,a){var s;return c(this,n),v(u(s=t.call(this,M.ECCreateOverlayMessage)),"ContextID",void 0),v(u(s),"InlineCSS",void 0),v(u(s),"InlineHtml",void 0),v(u(s),"checkoutProgress",void 0),v(u(s),"IsAutoApplyIncluded",void 0),s.ContextID=e,s.InlineCSS=r,s.InlineHtml=o,s.checkoutProgress=a,s.IsAutoApplyIncluded=i,s}return s(n)}(ce);function dr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var hr=function(e){p(n,e);var t=dr(n);function n(e,r,o){var i;return c(this,n),v(u(i=t.call(this,M.ECCreateUpdatePaymentOverlayMessage)),"ContextID",void 0),v(u(i),"InlineCSS",void 0),v(u(i),"InlineHtml",void 0),i.ContextID=e,i.InlineCSS=r,i.InlineHtml=o,i}return s(n)}(ce);function fr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var vr=function(e){p(n,e);var t=fr(n);function n(e,r,o,i,a,s){var l;return c(this,n),v(u(l=t.call(this,M.ECShowResultMessage)),"IsECSuccess",void 0),v(u(l),"IsAutoApplyIncluded",void 0),v(u(l),"CheckoutProgress",void 0),v(u(l),"InitialPrice",void 0),v(u(l),"BestCoupon",void 0),v(u(l),"MaxDiscount",void 0),l.IsECSuccess=e,l.IsAutoApplyIncluded=r,l.CheckoutProgress=s,l.InitialPrice=i,l.BestCoupon=o,l.MaxDiscount=a,l}return s(n)}(ce);function gr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var yr=function(e){p(n,e);var t=gr(n);function n(e,r,o,i,a,s,l,p,d,h,f){var g;return c(this,n),v(u(g=t.call(this,e,r,o,i,a,s,p,l)),"inlineCSS",void 0),v(u(g),"retailerData",void 0),v(u(g),"bgAAScenario",void 0),g.inlineCSS=d,g.retailerData=h,g.bgAAScenario=f,g.Type=M.EdgeCreateOverlayMessage,g}return s(n)}(ur);function Sr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var mr=function(e){p(n,e);var t=Sr(n);function n(e,r,o,i,a){var s;return c(this,n),v(u(s=t.call(this,M.ShowResultMessage)),"Result",void 0),v(u(s),"Discount",void 0),v(u(s),"OriginalPrice",void 0),v(u(s),"BestCoupon",void 0),v(u(s),"IsStackable",void 0),s.Result=e,s.Discount=r,s.OriginalPrice=o,s.BestCoupon=i,s.IsStackable=a,s}return s(n)}(ce);function Cr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var xr=function(e){p(n,e);var t=Cr(n);function n(e,r,o,i,a,s,l,p){var d;return c(this,n),v(u(d=t.call(this,e,r,o,i,s)),"cashBackInfo",void 0),v(u(d),"coupons",void 0),v(u(d),"isShortcircuit",void 0),d.Type=M.EdgeShowResultMessage,d.cashBackInfo=a,d.coupons=l,d.isShortcircuit=p,d}return s(n)}(mr);function kr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var br=function(e){p(n,e);var t=kr(n);function n(e,r){var o;return c(this,n),v(u(o=t.call(this,M.PrintableGroceryCouponsMessage)),"ContextID",void 0),v(u(o),"IFrameSrc",void 0),o.ContextID=e,o.IFrameSrc=r,o}return s(n)}(ce);function Ar(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Er=function(e){p(n,e);var t=Ar(n);function n(e,r,o){var i;return c(this,n),v(u(i=t.call(this,M.ShopRunnerOverlayMessage)),"ContextID",void 0),v(u(i),"MsaData",void 0),v(u(i),"InlineCSS",void 0),i.ContextID=e,i.MsaData=r,i.InlineCSS=o,i}return s(n)}(ce);function Pr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var wr=function(e){p(n,e);var t=Pr(n);function n(e){var r;return c(this,n),v(u(r=t.call(this,M.UpdateCurrencyMessage)),"Currency",void 0),r.Currency=e,r}return s(n)}(ce);function Ir(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Dr=function(e){p(n,e);var t=Ir(n);function n(e){var r;return c(this,n),v(u(r=t.call(this,M.WalletDrawerCloseMessage)),"IsStopProgress",void 0),r.IsStopProgress=e,r}return s(n)}(ce);function Or(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Tr=function(e){p(n,e);var t=Or(n);function n(e){var r;return c(this,n),v(u(r=t.call(this,M.WalletDrawerCreateOverlayMessage)),"ContextID",void 0),r.ContextID=e,r}return s(n)}(ce);function Rr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Mr=function(e){p(R,e);var n,r,i,a,l,d,h,g,y,S,m,x,k,E,P,w,I,O,T=Rr(R);function R(e,t,n,r){var o;return c(this,R),v(u(o=T.call(this,e)),"logService",void 0),v(u(o),"uxDataService",void 0),v(u(o),"entryPointService",void 0),o.logService=t,o.uxDataService=n,o.entryPointService=r,o}return s(R,[{key:"OpenExpressCheckoutOverlay",value:(O=t(o().mark((function e(t,n,r){var i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.EntryPointIsWallet()){e.next=2;break}return e.abrupt("return",this.WalletDrawerCreateOverlay(t));case 2:return e.next=4,this.GetUXData(C.ECOverlay);case 4:if(!(i=e.sent)){e.next=11;break}return a=this.uxDataService.GetUXStyles(C.ECOverlay),e.next=9,this.CloseOverlay(t);case 9:return e.next=11,this.SendDomMessage(t,new pr(t,a||"",i,n,r),"ECCreateOverlay",!0);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return O.apply(this,arguments)})},{key:"OpenExpressCheckoutUpdatePaymentOverlay",value:(I=t(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.EntryPointIsWallet()){e.next=2;break}return e.abrupt("return",this.WalletDrawerCreateOverlay(t));case 2:return e.next=4,this.GetUXData(C.ECOverlay);case 4:if(!(n=e.sent)){e.next=11;break}return r=this.uxDataService.GetUXStyles(C.ECOverlay),e.next=9,this.CloseOverlay(t);case 9:return e.next=11,this.SendDomMessage(t,new hr(t,r||"",n),"ECCreateUpdatePaymentOverlay",!0);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"OpenPrintableGroceryCouponsOverlay",value:(w=t(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(t,new br(t,n),"Printable Grocery Coupons",!0);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"OpenShopRunnerTermsAndConditionsOverlay",value:(P=t(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.uxDataService.GetUXStyles(C.ShopRunnerOverlay),e.next=3,this.SendDomMessage(t,new Er(t,n,r||""),"ShopRunner Terms and Conditions Overlay",!0);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"ShowExpressCheckoutResult",value:(E=t(o().mark((function e(t,n,r,i,a,s,c){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(t,new vr(n,r,i,a,s,c),"ECShowResults",!0);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o,i,a){return E.apply(this,arguments)})},{key:"OpenOverlay",value:(k=t(o().mark((function e(t,n,r,i,a,s,c){var u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.EntryPointIsWallet()){e.next=2;break}return e.abrupt("return",this.WalletDrawerCreateOverlay(t));case 2:return e.next=4,this.GetUXData(C.Overlay);case 4:if(!(u=e.sent)){e.next=10;break}return e.next=8,this.CloseOverlay(t);case 8:return e.next=10,this.CreateOverlay(t,n,r,u,i,a,s,c);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o,i,a){return k.apply(this,arguments)})},{key:"MoveProgressBar",value:(x=t(o().mark((function e(t,n,r){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r>0)){e.next=4;break}return i=this.GetPositions(n,r),e.next=4,this.SendDomMessage(t,new le(i[0],i[1]),"Progress Bar Update",!0);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return x.apply(this,arguments)})},{key:"ShowResult",value:(m=t(o().mark((function e(t,n,r,i,a,s,c,u,l,p){var d,h,f,v,g,y,S,m,C,x,k,E,P,w,I,O,T,R;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v=this.platformSpecific.GetAppInfoClientName(),g=null===(d=a.BestCoupon)||void 0===d?void 0:d.couponCode,y=null!==(h=null===(f=a.BestCoupon)||void 0===f?void 0:f.isStackable)&&void 0!==h&&h,S=a.InitialPrice,m=a.MaxDiscount,C=[],a.CouponResults&&(C=a.CouponResults),v!==G.Edge&&v!==G.EdgeMobile&&v!==G.Sapphire){e.next=12;break}return e.next=10,this.SendDomMessage(t,new xr(n,m,S,g,s,y,u,p),"Show Result Page",!0);case 10:e.next=14;break;case 12:return e.next=14,this.SendDomMessage(t,new mr(n,m,S,g,y),"Show Result Page",!0);case 14:x=a.StartTime?Date.now()-a.StartTime:-1,k=new ie(r,this.entryPointService.GetEntryPoint()),E=n,P=null!=m?m:0,n===D.Error&&p&&(null!=(w=u[0])&&w.discountValue||S&&null!=w&&w.discountPercent)&&(E=D.Positive,P=null!==(I=null!==(O=null==w?void 0:w.discountValue)&&void 0!==O?O:(null==w?void 0:w.discountPercent)*S/100)&&void 0!==I?I:0),k.SetResultData(E,x,g,C,P,null!=S?S:0,y,c,l),k.SetCurrencyInfo(a.Currency,a.PageCurrency),T=A.AutoApply,R=b.Information,this.logService.LogClientEventV2(R,T,i,k);case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o,i,a,s,c,u){return m.apply(this,arguments)})},{key:"UpdateCurrentCoupon",value:(S=t(o().mark((function e(t,n,r,i,a){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(t,new de(n,r,i,a),"Update Current Coupon",!0);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,o){return S.apply(this,arguments)})},{key:"UpdateCurrency",value:(y=t(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(t,new wr(n),"Update Currency",!0);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"OverlayVisible",value:(g=t(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.IsFieldVisible(t,"#divOverlayWrapper","Check overlay visible");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"UpdateCheckoutProgress",value:(h=t(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(t,new ir(n),"AutoapplyDone",!1);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"CloseOverlay",value:(d=t(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(t,new sr,"Close Coupons Overlay",!1);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"GetPositions",value:function(e,t){var n=100/t;return[n*e,n*(e+1)]}},{key:"CloseWalletDrawer",value:(l=t(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SendDomMessage(t,new Dr(n),"Stop Wallet Drawer Auto Apply and Autofill",!1);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"WalletDrawerCreateOverlay",value:(a=t(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.SendDomMessage(t,new Tr(t),"Wallet Drawer Create Overlay",!0));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"SendDomMessage",value:(i=t(o().mark((function e(t,n,r,i){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[M.WalletDrawerCreateOverlayMessage,M.CloseOverlayMessage,M.WalletDrawerCloseMessage,M.AutoApplyCancelledMessage,M.MoveProgressBarMessage],!this.EntryPointIsWallet()||a.includes(n.Type)){e.next=3;break}return e.abrupt("return",new Le);case 3:return e.abrupt("return",Jt(f(R.prototype),"SendDomMessage",this).call(this,t,n,r,i));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"EntryPointIsWallet",value:function(){return this.entryPointService.GetEntryPoint()===J.Wallet}},{key:"CreateOverlay",value:(r=t(o().mark((function e(t,n,r,i,a,s,c,u){var l,p,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=this.GetPositions(c,r),(p=this.platformSpecific.GetAppInfoClientName())!==G.Edge&&p!==G.EdgeMobile&&p!==G.Sapphire){e.next=8;break}return d=this.uxDataService.GetUXStyles(C.Overlay),e.next=6,this.SendDomMessage(t,new yr(t,n,c+1,r,l[0],l[0],i,a,d||"",s,u),"Edge Create Overlay",!0);case 6:e.next=10;break;case 8:return e.next=10,this.SendDomMessage(t,new ur(t,n,c+1,r,l[0],l[0],a,i),"Create Overlay",!0);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n,o,i,a,s,c){return r.apply(this,arguments)})},{key:"GetUXData",value:(n=t(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.uxDataService.GetUX(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]),R}(He),Fr=Mr;function Br(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Nr=function(e){p(n,e);var t=Br(n);function n(e){var r;return c(this,n),v(u(r=t.call(this)),"EmailId",void 0),v(u(r),"IsMsaSignedIn",void 0),r.EmailId=null==e?void 0:e.email_id,r.IsMsaSignedIn=null==e?void 0:e.is_msa_signed_in,r}return s(n)}(re);function Lr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var Gr=function(e){p(a,e);var n,r=Lr(a);function a(e,t,n){var o;return c(this,a),v(u(o=r.call(this,e)),"overlayService",void 0),v(u(o),"logService",void 0),v(u(o),"contextId",void 0),o.overlayService=t,o.logService=n,o.contextId=N.FromBackground,o}return s(a,[{key:"LaunchShopRunnerTermsAndConditionsOverlay",value:(n=t(o().mark((function e(t){var n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t&&!i(null==t?void 0:t.EmailId)&&!0===(null==t?void 0:t.IsMsaSignedIn)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.overlayService.OpenShopRunnerTermsAndConditionsOverlay(this.contextId,t).catch((function(e){n.logEvent(b.Error,e)}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"logEvent",value:function(e,t){this.logService.LogClientEventV2(e,A.ShopRunnerOverlay,null!=t?t:"",new Nr({}))}}]),a}(He),Ur=Gr,Vr=function(){function e(t){c(this,e),v(this,"platformSpecific",void 0),v(this,"CouponApplicatorUIStateKey","CouponApplicatorUIState"),v(this,"couponApplicatorState",void 0),this.platformSpecific=t,this.couponApplicatorState=null}var n,r;return s(e,[{key:"LoadCouponApplicatorState",value:function(){var e=this;return new Promise((function(t,n){e.couponApplicatorState?t(e.couponApplicatorState):(e.SaveCouponApplicatorState(null),t(null))}))}},{key:"SaveCouponApplicatorState",value:function(e){this.couponApplicatorState=e;var t="";e&&(t=e.ToString());var n=[t];window.autoApplyRuntime.postMessageToHost(Ae.SetAutoApplyState,n)}},{key:"GetUIState",value:(r=t(o().mark((function e(t){var n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n.platformSpecific.ReadFromStorage(n.CouponApplicatorUIStateKey,(function(r){if(r&&r[n.CouponApplicatorUIStateKey]){var o=Re.CreateFromObject(r[n.CouponApplicatorUIStateKey]);if(!o||o.Hostname!==t){o=Re.CreateNew(t);var i=v({},n.CouponApplicatorUIStateKey,o);n.platformSpecific.WriteToStorage(i)}e(o)}else{var a=Re.CreateNew(t),s=v({},n.CouponApplicatorUIStateKey,a);n.platformSpecific.WriteToStorage(s),e(a)}}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"SaveUIState",value:(n=t(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=v({},this.CouponApplicatorUIStateKey,t),this.platformSpecific.WriteToStorage(n);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),e}(),_r=Vr;function Wr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Hr(e){return function(e){if(Array.isArray(e))return Wr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Wr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wr(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var zr;!function(e){e.LogScriptTelemetry="LogScriptTelemetry",e.ItemAddedToCart="ItemAddedToCart",e.SetStorageValue="SetStorageValue"}(zr||(zr={}));var jr,Jr=function(){function e(){c(this,e),v(this,"traceId",void 0),v(this,"impressionId",void 0)}return s(e,[{key:"SetTraceId",value:function(e){this.traceId=e}},{key:"SetImpressionId",value:function(e){this.impressionId=e}},{key:"SendItemAddedToCartMessage",value:function(){e.SendMessage(zr.ItemAddedToCart,[this.traceId,""])}},{key:"SendLogEventMessage",value:function(t,n,r,o){var i={};i.JsonData=JSON.stringify(t),i.EventType=n,i.LogLevel=o,i.Message=r,i.ClientContext=new ln("Edge","0.805",dn.GetBuildVersion()),this.impressionId&&(i.ImpressionId=this.impressionId);var a=[JSON.stringify(i)];e.SendMessage(zr.LogScriptTelemetry,a)}},{key:"GetCurrentPathName",value:function(){return location.pathname}},{key:"SendProductPageStatusLog",value:function(e,t,n){var r={Domain:ke.GetDomainName(),PageUrl:ke.GetPageUrl(),Status:t};this.SendLogEventMessage(r,null!=n?n:A.ProductPageValidation,e,b.Information)}}],[{key:"SendMessage",value:function(e,t){window.productPageScriptRuntime.postMessageToHost(e,t)}},{key:"SendStorageMessage",value:function(e,t){this.SendMessage(zr.SetStorageValue,[e,t])}}]),e}();!function(e){e.CheckoutPageValidationError="CheckoutPageValidationError",e.LogScriptTelemetry="LogScriptTelemetry",e.PageStatus="PageStatus",e.CheckoutPageGMV="CheckoutPageGMV",e.ExpressCheckoutPageGMV="ExpressCheckoutPageGMV",e.CheckoutPageValidationStatus="CheckoutPageValidationStatus",e.PurchaseCompleted="PurchaseCompleted",e.SetStorageValue="SetStorageValue",e.GuestDomain="GuestDomain",e.BackgroundAutoApplyStateValid="BackgroundAutoApplyStateValid",e.PlatformExpansionDomain="PlatformExpansionDomain",e.UpdateAddressBar="UpdateAddressBar",e.RecordShoppingUserEngagement="RecordShoppingUserEngagement",e.RecordShoppingUserAction="RecordShoppingUserAction",e.GetCashBack="GetCashBack",e.NavigateToUrlBackground="NavigateToUrlBackground",e.StartEdgeDriver="StartEdgeDriver",e.UpdateLoadTimeData="UpdateLoadTimeData"}(jr||(jr={}));var $r=function(){function e(){c(this,e)}return s(e,null,[{key:"GetBoxValue",value:function(t){if(_e.IsValidDataField(t))try{var n=e.GetTextValue(t);return n?n.trim():n}catch(e){throw Error(e.message)}return""}},{key:"ParseBackgroundAutoApplyStateData",value:function(t,n){var r=e.GetBackgroundAutoApplyStateString(t,n);return i(r)?null:ne.CreateFromObject(JSON.parse(r))}},{key:"GetBackgroundAutoApplyStateString",value:function(e,t){return t["BackgroundAutoApplyData_"+e]}},{key:"parseDate",value:function(e){var t,n=null==e?void 0:e.split(","),r="";if(1===(null==n?void 0:n.length)){var o=(new Date).getDate(),i=new Date;if(i.setHours(0,0,0,0),i.setDate(o+1),t=i,!(r=n[0].trim().split("-")[1]))throw new Error("Unable to parse date: ".concat(e))}else if(2===(null==n?void 0:n.length)){var a=n[1].trim(),s=n[0].trim().split(""),c=s[1].trim(),u=s[0].trim();t=new Date("".concat(c," ").concat(u," ").concat(a))}else if(3===(null==n?void 0:n.length)){if(n[0].toLowerCase().includes("today"))(t=new Date).setHours(0,0,0,0);else{var l=(new Date).getFullYear(),p=n[1].trim().split(" "),d=p[1].trim(),h=p[0].trim();t=new Date("".concat(h," ").concat(d,", ").concat(l))}if(!(r=n[2].trim().split("-")[1]))throw new Error("Unable to parse date: ".concat(e))}else t=new Date("");if(!r)return t;try{var f=this.parseHour(r);if(Number.isNaN(f))return t;t.setHours(f)}catch(e){}return t}},{key:"parseHour",value:function(e){var t=+(null==e?void 0:e.match(/\d{1,2}/i)[0]);return"pm"===(null==e?void 0:e.match(/(A|P)M/i)[0]).toLowerCase()&&(t+=12),+t}},{key:"SendLogEvent",value:function(t,n,r,o,i,a,s){var c={Currency:i,Domain:ke.GetDomainName(),EdgeFlyoutStatus:null==s?void 0:s.EdgeFlyoutStatus,Metadata:null==s?void 0:s.Metadata,PageUrl:ke.GetPageUrl(),StartingPrice:null!=o?o:-1,Status:r};e.SendLogEventMessage(c,null!=a?a:A.CheckoutPageValidation,t,n,b.Information)}},{key:"SendLogEventMessage",value:function(t,n,r,o,i){var a={};a.JsonData=JSON.stringify(t),a.EventType=n,a.LogLevel=i,a.Message=o,a.ClientContext=new ln("Edge","1.991",dn.GetBuildVersion()),r&&(a.ImpressionId=r);var s=[JSON.stringify(a)];e.SendMessage(jr.LogScriptTelemetry,s)}},{key:"SendMessage",value:function(e,t){window.checkoutPageValidatorRuntime.postMessageToHost(e,t)}},{key:"StartEdgeDriver",value:function(e,t){this.Invoke(jr.StartEdgeDriver,e,t)}},{key:"SendStorageMessage",value:function(t,n){e.SendMessage(jr.SetStorageValue,[t,n])}},{key:"SendNavigateToUrlMessage",value:function(t){e.SendMessage(jr.NavigateToUrlBackground,[t,t])}},{key:"SendStringStorageMessage",value:function(t,n){e.SendMessage(jr.SetStorageValue,[t,JSON.stringify({value:n})])}},{key:"SendPurchaseConfirmationLog",value:function(t,n,r,o,i){var a,s={CartId:o,Currency:null==i?void 0:i.Currency,Domain:ke.GetDomainName(),PageCurrency:null==i?void 0:i.PageCurrency,PageUrl:ke.GetPageUrl(),StartingPrice:null!==(a=null==i?void 0:i.OrderTotal)&&void 0!==a?a:-1,Status:r};e.SendLogEventMessage(s,A.PurchaseConfirmation,t,n,b.Information)}},{key:"GetValidationLogMessage",value:function(e,t,n){return e?"Checkout Page is Valid":t?"Checkout Page is disabled or does not exist":n?"Checkout Page is Invalid - Invalid Selectors":"Checkout Page is Invalid"}},{key:"GetOrderTotalString",value:function(t,n){for(var r=t.split(","),o=0;o<r.length;o++){var i=r[o];try{return e.GetBoxValuePageQueryUtils(i,n)}catch(e){if(o===r.length-1)return""}}return""}},{key:"Invoke",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];window.checkoutPageValidatorRuntime.postMessageToHost("Invoke",[e].concat(n))}},{key:"GetBoxValuePageQueryUtils",value:function(e,t){if(_e.IsValidDataField(e))try{return Ot.GetTextValue(e,t)}catch(e){throw Error(e.message)}return""}},{key:"GetTextValue",value:function(e){var t=e.split(";"),n=Ot.GetFirstVisibleElementSingleSel(t[0]),r=n;if(void 0===r)return"";var o=r.innerText;if(1===t.length)o=(r=Ot.NormalizeIfSuperscripted(n)).innerText;else{var i=Ot.GetFirstVisibleElementSingleSel(t[1]);if(i&&i.innerText){var a="."+i.innerText;if(r.contains(i)){var s=r.cloneNode(!0);s.childNodes.forEach((function(e){e.nodeType===Node.ELEMENT_NODE&&s.removeChild(e)})),o=null!=s&&s.innerText?s.innerText:o}o+=a}}return Ot.StripInvalidJSONCharacters(o)}}]),e}(),Kr=$r,Xr=function(){function e(t){c(this,e),v(this,"EXPIRY_PERIOD",432e6),v(this,"PAGE_WAIT_TIME",5e3),v(this,"MAX_SUGGESTED_COUPONS_COUNT",3),v(this,"domainName",void 0),v(this,"key",void 0),v(this,"suggestedCoupons",void 0),v(this,"logService",void 0),this.logService=t}var n;return s(e,[{key:"getSuggestedCoupons",value:function(){return this.suggestedCoupons}},{key:"init",value:function(e,t){this.domainName=e,this.key="SuggestedCoupons_".concat(e),this.suggestedCoupons=t[this.key]?JSON.parse(t[this.key]):[]}},{key:"update",value:(n=t(o().mark((function e(n,r,a,s,c,u){var l,p=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=this.PAGE_WAIT_TIME,!u){e.next=6;break}if(l=0,!a){e.next=6;break}return e.next=6,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ot.HasVisibleElementSingleSel(a));case 1:case"end":return e.stop()}}),e)}))),this.PAGE_WAIT_TIME);case 6:return e.next=8,_e.Sleep(l).then((function(){if(a){var e,t=Ot.GetFirstVisibleElement(a);if(void 0===s||i(s))e=null==t?void 0:t.textContent;else{var o,u=null==t||null===(o=t.textContent)||void 0===o?void 0:o.match(s);e=u&&u[1]?u[1]:""}i(e)||p.addCoupons([e],r,n,y.Selector,c)}var l=Hr(new Set(Hr(document.body.innerHTML.matchAll(/[^\w](?:(?:coupon)?code|promotion)"?(?::|\s|<\w+>|>)+"?(\w+)/gi)).map((function(e){return e[1]})).filter((function(e){return e.length>3&&(/\d/.test(e)||e===e.toUpperCase())}))));p.addCoupons(l,r,n,y.Automated,c),p.suggestedCoupons.sort((function(e,t){return t.timestamp-e.timestamp})),p.suggestedCoupons=p.suggestedCoupons.slice(0,p.MAX_SUGGESTED_COUPONS_COUNT),p.suggestedCoupons=p.suggestedCoupons.filter((function(e){return e.timestamp+p.EXPIRY_PERIOD>Date.now()})),p.suggestedCoupons.sort((function(e,t){return p.getScore(e)-p.getScore(t)})),p.updateStorage(n)})).catch((function(e){}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r,o,i,a){return n.apply(this,arguments)})},{key:"updateStorage",value:function(e){e===g.ProductPage?Jr.SendStorageMessage(this.key,JSON.stringify({value:JSON.stringify(this.suggestedCoupons)})):Kr.SendStorageMessage(this.key,JSON.stringify({value:JSON.stringify(this.suggestedCoupons)}))}},{key:"addCoupons",value:function(e,t,n,r,o){var i=this;e&&e.length>0&&e.forEach((function(e){var a=i.findCoupon(t,e),s=i.findCoupon(i.suggestedCoupons,e);if(s)s.timestamp=Date.now(),s.extraction=Math.min(s.extraction,r),n<s.source&&(s.source=n,s.title="Coupon suggested by ".concat(i.domainName));else{var c=new W;if(c.attribution=i.domainName,c.title="Coupon suggested by ".concat(i.domainName),c.couponCode=e,c.extraction=r,c.source=n,c.timestamp=Date.now(),i.suggestedCoupons.push(c),!a){var u=new wn(e,i.domainName,K.SuggestedCoupon,location.pathname,JSON.stringify(c));i.logService.LogClientEventV2(b.Information,A.CollectedCoupons,"Site suggested a coupon we didn't have",u,o)}}}))}},{key:"findCoupon",value:function(e,t){return e.find((function(e){return e.couponCode.toLocaleLowerCase()===t.toLocaleLowerCase()}))}},{key:"getScore",value:function(e){return 10*e.extraction+e.source}}]),e}(),Yr=Xr,Zr=function(){function e(t){c(this,e),v(this,"contextID",void 0),v(this,"overlayService",void 0),this.contextID=N.FromBackground,this.overlayService=t}var n,r;return s(e,[{key:"HandleMessageFromHost",value:(r=t(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t===Ie.CloseWalletCheckoutPane&&this.StopWalletDrawer();case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"StopWalletDrawer",value:(n=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.overlayService.CloseWalletDrawer(this.contextID,!0));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),e}(),qr=Zr,Qr=function(){function e(){c(this,e),v(this,"resourcesMap",new Map),this.initializeResources()}var n;return s(e,[{key:"GetUrl",value:function(e,t){return""}},{key:"UpdateLocalData",value:function(e,t){e===Te.LocalizedStrings&&(this.resourcesMap=new Map([].concat(Hr(this.resourcesMap),Hr(Object.entries(t)))))}},{key:"GetResourceString",value:function(e){var t;return null!==(t=this.resourcesMap.get(e))&&void 0!==t?t:""}},{key:"ReadFromStorage",value:function(e,t){t(this.ReadFromStorageSync(e))}},{key:"WriteToStorage",value:function(e,t){if(window.sessionStorage)for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];window.sessionStorage.setItem(n,JSON.stringify(r))}t&&t()}},{key:"SendMessage",value:(n=t(o().mark((function e(n,r){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r,e.abrupt("return",new Promise(function(){var e=t(o().mark((function e(t,r){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||i!==N.FromBackground){e.next=7;break}return e.next=3,window[L.HandleBackgroundMessage](n);case 3:(a=e.sent).Type===M.ErrorResponse?r(a):t(a),e.next=10;break;case 7:return e.next=9,window[L.HandleContentMessage](n);case 9:t(new Le);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"GetVersion",value:function(){return"1.985"}},{key:"GetAppInfoClientName",value:function(){return G.Edge}},{key:"ReadFromStorageSync",value:function(e){var t=null;if(window.sessionStorage){var n=window.sessionStorage.getItem(e);null!==n&&(t=JSON.parse(n))}var r={};return null!==t&&(r[e]=t),r}},{key:"initializeResources",value:function(){var e=this.ResourcesJSONString(),t=JSON.parse(e);this.resourcesMap=new Map(Object.entries(t))}},{key:"ResourcesJSONString",value:function(){return'{\n            "ERROR_DIALOGUE_SUBTEXT": "Click the promotional codes box on the checkout page and try to apply available coupons.",\n            "ERROR_DIALOGUE_TITLE": "We can\'t automatically apply coupons right now",\n            "ERROR_EXIT_BUTTON": "Return to checkout",\n            "IN_PROGRESS_DIALOGUE_TITLE": "Microsoft Edge is testing available coupons for your cart",\n            "OTHER_SELLER_IN_PROGRESS_DIALOGUE_TITLE": "Edge is adding selected item to your cart",\n            "IN_PROGRESS_EXIT_BUTTON": "Cancel",\n            "IN_PROGRESS_LOADER_TEXT_BOTTOM": "Testing code $1",\n            "OTHER_SELLER_IN_PROGRESS_LOADER_TEXT_BOTTOM" : "Adding item to cart",\n            "IN_PROGRESS_LOADER_TEXT_TOP": "$1 out of $2",\n            "NO_COUPONS_DIALOGUE_SUBTEXT": "Available coupons don\'t apply to your cart",\n            "BEST_DEAL_TITLE": "You already have the best deal!",\n            "BEST_PRICE_TITLE": "You have the best price!",\n            "BEST_PRICE_SUBTITLE": "Available coupons don\'t apply to your cart",\n            "NO_COUPONS_DIALOGUE_TITLE": "We are working hard to find you more coupons",\n            "NO_COUPONS_EXIT_BUTTON": "Proceed to checkout",\n            "SUCCESS_DIALOGUE_SUBTEXT": "$1 was applied to your cart",\n            "SUCCESS_DIALOGUE_TITLE": "You saved $1 with Microsoft Edge!",\n            "3DSUCCESS_DIALOGUE_TITLE": "Congrats! You saved $1 with Microsoft Edge!",\n            "3DSUCCESS_DIALOGUE_TITLE_NOT": "We applied the best coupon for you!",\n            "SUCCESS_EXIT_BUTTON": "Proceed to checkout",\n            "EC_EXIT_BUTTON": "Continue to checkout",\n            "SUCCESS_IMPORT_EXIT_BUTTON": "Import and check out",\n            "IMPORT_FROM_PRIMARY_BROWSER_MESSAGE": "Import passwords, addresses and more from $1 to check out faster and continue saving on Microsoft Edge",\n            "IN_PROGRESS_DIALOGUE_SAVINGS": "You have saved $1 so far!",\n            "IN_PROGRESS_DIALOGUE_SAVINGS_NOT": "Valid coupons are found!",\n            "SUCCESS_DIALOGUE_TITLE_WITH_CASHBACK": "You saved $1 & got $2 cash back with Microsoft Edge!",\n            "SUCCESS_DIALOGUE_TITLE_WITH_NON_STACK_CASHBACK": "Save $1 with code $2 OR earn up to $3 Bing Rebates with Microsoft Edge!",\n            "SUCCESS_DIALOGUE_SUBTEXT_COUPON": "Coupon applied: $1",\n            "SUCCESS_DIALOGUE_SUBTEXT_CASHBACK": "Cash back from Bing Rebates: $1",\n            "SUCCESS_DIALOGUE_SUBTEXT_NON_STACK_COUPON": "Sorry, you cant use this coupon and Bing Rebates",\n            "SUCCESS_DIALOGUE_SUBTEXT_NON_STACK_COUPON_REFRESH": "Bing Rebates and $1 code can\'t be used at the same time",\n            "USE_REBATES": "Use Bing Rebates",\n            "EARN_REBATES": "Earn Bing Rebates",\n            "USE_COUPON": "Use Coupon",\n            "SUCCESS_UPSELL_CASHBACK": "You can save even more next time by getting cash back from Bing Rebates.",\n            "SUCCESS_LEARN_MORE_CASHBACK": "Learn more",\n            "EC_IN_PROGRESS_DIALOGUE_TITLE": "Microsoft Edge is filling your address and payment details",\n            "EC_ADDRESS_IN_PROGRESS_DIALOGUE_TITLE": "Microsoft Edge is filling your address details",\n            "EC_PAYMENT_IN_PROGRESS_DIALOGUE_TITLE": "Microsoft Edge is filling your payment details",\n            "EC_AUTOAPPLY_IN_PROGRESS_DIALOGUE_TITLE": "Microsoft Edge is trying coupons and filling your details",\n            "EC_SUCCESS_DAILOGUE_TITLE": "Your details have been filled up",\n            "EC_ADDRESS_SUCCESS_DIALOGUE_TITLE": "Your shipping address has been filled up",\n            "EC_SUCCESS_DAILOGUE_SUBTEXT": "Input your CVV on the website to finish checkout",\n            "EC_PROGRESS_DETAILS_APPLY_COUPONS": "Apply coupons",\n            "EC_PROGRESS_DETAILS_FILL_ADDRESS_DETAILS": "Fill address details",\n            "EC_PROGRESS_DETAILS_FILL_PAYMENT_DETAILS": "Fill payment details",\n            "EC_ERROR_TITLE": "Unfortunately we could not fill your details",\n            "EC_ERROR_SUBTITLE": "please fill in your details manually",\n            "EC_PROGRESS_ADDRESS": "Filling in your address details",\n            "EC_PROGRESS_PAYMENT": "Filling in your payment details",\n            "EC_IN_PROGRESS_LOADER_TEXT_TOP": "Step $1 of $2",\n            "SHOPPING_IN_EDGE_TEXT": "Shopping in Microsoft Edge",\n            "PRIVACY_STATEMENT_LABEL": "Microsoft Privacy Statement",\n            "EC_WALLET_PROGRESS_DETAILS_CHECKOUT_BUTTON": "Checkout with $1",\n            "EC_WALLET_INSTALLMENT_ZIP": "Zip",\n            "EC_WALLET_ADDRESS_AND_OTHER_PAYMENT_IN_PROGRESS_DIALOGUE_TITLE": "Microsoft Edge is filling your address details and connecting you with $1",\n            "EC_WALLET_AUTOAPPLY_AND_OTHER_PAYMENT_IN_PROGRESS_DIALOGUE_TITLE": "Microsoft Edge is trying coupons and connecting you with $1",\n            "EC_WALLET_OTHER_PAYMENT_IN_PROGRESS_DIALOGUE_TITLE": "Microsoft Edge is connecting you with $1",\n            "EC_WALLET_EXTRA_DIALOG_TITLE": "Enter your total purchase amount",\n            "EC_WALLET_EXTRA_DIALOG_SUB_TITLE": "See if you qualify to pay overtime",\n            "EC_WALLET_EXTRA_DIALOG_LICENSE": "By continuing, you agree to our $1 and acknowledge that your total purchase amount will be shared with $2, in accordance with $3.",\n            "EC_WALLET_EXTRA_DIALOG_TERMS_OF_USE": "Terms of Use",\n            "EC_WALLET_EXTRA_DIALOG_PRIVACY": "Microsoft Privacy Statement",\n            "EC_WALLET_EXTRA_DIALOG_VALIDATION_ERROR": "To spend with $1, your purchase must be between $2 and $3. Please update your cart so that your total purchase amount is more than $4 but less than $5.",\n            "EC_WALLET_EXTRA_DIALOG_CONNECT_ISSUE": "Unable to connect to $1. Please try again.",\n            "EC_WALLET_EXTRA_DIALOG_TOTAL_ORDER_AMOUNT": "Total purchase amount",\n            "EC_WALLET_EXTRA_DIALOG_CONTINUE_BUTTON": "Continue to $1",\n            "EC_WALLET_FILLING_VIRTUAL_CARD_INFO": "Microsoft Edge is filling your $1 virtual card information",\n            "EC_WALLET_INSTALLMENT_ZIP_LOGO_DESC": "Zip, buy now, pay later",\n            "EC_WALLET_AMOUNT_TAX_SHIPPING_REMINDER": "Don\'t forget to include tax + shipping!",\n            "EC_WALLET_EXTRA_ZIP_PAY_MICROSOFT_STATEMENT": "Microsoft does not charge you or get paid by this provider for the transaction.",\n            "EC_WALLET_TOP_BANNER": "With Microsoft Edge, you have $1 options to pay",\n            "EC_WALLET_TOP_BANNER_BOLD_TEXT": "more",\n            "COUPON_SHARE_SAVINGS": "Share your savings with everybody!",\n            "COUPON_SHARE_SAVINGS_REFRESH": "Let your friends know!",\n            "COUPON_SHARE_SAVINGS_FACEBOOK": "Share on Facebook",\n            "COUPON_SHARE_SAVINGS_TWITER": "Share on Twitter",\n            "COUPON_SHARE_SAVINGS_WHATSAPP":"Share on Whatsapp",\n            "COUPON_SHARE_SAVINGS_CLIPBOARD":"Share on Clipboard",\n            "SAVINGS_WITH_COUPON": "With coupon: |$1|",\n            "SAVINGS_WITHOUT_COUPON": "Without coupon: $1",\n            "ATT_COUPON_PROMPT": "Unlock a better deal!",\n            "ATT_COUPON_TITLE": "Get $1 when you boost your cart to $2!",\n            "ATT_COUPON_BUTTON": "Continue Shopping",\n            "COUPON_SHARE_SAVINGS_MESSAGE": "I just saved with Microsoft Edge",\n            "COUPON_SHARE_SAVINGS_MESSAGE_WITH_PRICE": "I saved $1 by shopping on Edge browser!",\n            "SHOPRUNNER_TERMS_AND_CONDITIONS_OVERLAY_MSG1": "Your email id will be used for ShopRunner membership. Keep an eye on your inbox. ShopRunner will send you an email to set up your password.",\n            "SHOPRUNNER_TERMS_AND_CONDITIONS_OVERLAY_MSG2": "Visit your $1 account for more details.",\n            "SHOPRUNNER_TERMS_AND_CONDITIONS_OVERLAY_FOOTER_MSG": "Have more questions? Visit the $1.",\n            "CASHBACK_UPSELL_TOP_TEXT": "We didn\'t find any qualifying coupons, but you could get cash back!",\n            "CASHBACK_UPSELL_OFFER": "Get up to $1 cash back on this purchase",\n            "CASHBACK_UPSELL_ESTIMATE": "(estimated based on your cart)",\n            "CASHBACK_UPSELL_PRIVACY": "You will be signed in to Microsoft Edge which will back up your browsing data and let you see your favorites, passwords, history and more on all your devices. You will also join and receive emails about $1, which include offers about partner products. $2 | $3",\n            "CASHBACK_UPSELL_MICROSOFT_REWARDS": "Microsoft Rewards,",\n            "CASHBACK_UPSELL_PRIVACY_NEXT": "which include offers about partner products. ",\n            "CASHBACK_UPSELL_TERMS": "Terms",\n            "CASHBACK_UPSELL_PRIVACY_COOKIES": "Privacy & Cookies",\n            "CASHBACK_UPSELL_EXIT": "No thanks, proceed to checkout",\n            "CASHBACK_UPSELL_INFO_BUTTON_TEXT": "See offer details on Bing Rebates. Edge Shopping is powered by Bing Rebates, part of Microsoft Rewards",\n            "CASHBACK_UPSELL_JOIN_NOW": "Join now to save",\n            "SHORTCIRCUIT_TITLE": "This site doesn\'t support automatically applying coupons, but hold on...",\n            "SHORTCIRCUIT_SUBTITLE": "You can still save by entering this coupon code yourself at checkout!",\n            "SHORTCIRCUIT_EXIT_BUTTON": "Return to checkout",\n            "SHORTCIRCUIT_COPY": "COPY",\n            "SHORTCIRCUIT_COPIED": "COPIED ",\n            "SHORTCIRCUIT_CALL_TO_ACTION": "Click to copy coupon"\n        }'}}]),e}(),eo=Qr,to=function(){function e(){c(this,e)}return s(e,null,[{key:"GetInstance",value:function(){return this.Instance||(this.Instance=new eo),this.Instance}}]),e}();v(to,"Instance",void 0);var no=to,ro=function(){function e(){c(this,e),v(this,"localData",void 0),v(this,"featureData",void 0),this.localData=new Map,this.featureData=new Map}return s(e,[{key:"clear",value:function(){this.localData.clear(),this.featureData.clear()}},{key:"GetLocaData",value:function(e){return this.localData.get(e)}},{key:"SaveLocalData",value:function(e,t){this.localData||(this.localData=new Map),this.localData.set(e,t)}},{key:"SaveFeature",value:function(e,t){this.featureData.set(e,t)}},{key:"IsFeatureEnabled",value:function(e){var t=this.featureData.get(e);return void 0!==t&&t}}]),e}(),oo=function(){function e(){c(this,e)}return s(e,null,[{key:"GetPlatformInstance",value:function(){return this.platformInstance}},{key:"GetLocalDataService",value:function(){return this.localDataService}}]),e}();function io(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}v(oo,"localDataService",new ro),v(oo,"platformInstance",no.GetInstance());var ao=function(e){p(n,e);var t=io(n);function n(){return c(this,n),t.apply(this,arguments)}return s(n,null,[{key:"GetBackgroundMessagingService",value:function(){return this.backgroundMessagingService}},{key:"GetApplicatorStateService",value:function(){return this.applicatorStateService}},{key:"GetLogService",value:function(){return this.logService}},{key:"GetOverlayService",value:function(){return this.overlayService}},{key:"GetCheckoutService",value:function(){return this.checkoutService}},{key:"GetCheckoutPaymentUpdateService",value:function(){return this.checkoutPaymentUpdateService}},{key:"GetEdgeMessageService",value:function(){return this.edgeMessageService}},{key:"GetOtherSellersService",value:function(){return this.otherSellersService}},{key:"GetBackgroundAutoApplyService",value:function(){return this.backgroundAutoApplyService}},{key:"GetBroadcastChannelService",value:function(){return this.broadcastChannelService}},{key:"GetGroceryService",value:function(){return this.groceryService}},{key:"GetClippingService",value:function(){return this.clippingService}},{key:"GetWalletDrawerService",value:function(){return this.walletDrawerService}},{key:"GetEntryPointService",value:function(){return this.entryPointService}},{key:"GetSuggestedCouponService",value:function(){return this.suggestedCouponsService}},{key:"GetShopRunnerService",value:function(){return this.shopRunnerService}},{key:"GetUXDataService",value:function(){return this.uxDataService}},{key:"GetClippingServiceLogger",value:function(){return this.clippingServiceLogger}}]),n}(oo);v(ao,"entryPointService",new qt(ao.GetLocalDataService())),v(ao,"edgeMessageService",new Zt),v(ao,"uxDataService",new Yt(ao.GetPlatformInstance(),ao.GetLocalDataService())),v(ao,"applicatorStateService",new _r(ao.GetPlatformInstance())),v(ao,"logService",new Sn(ao.GetPlatformInstance(),ao.GetApplicatorStateService())),v(ao,"overlayService",new Fr(ao.GetPlatformInstance(),ao.GetLogService(),ao.GetUXDataService(),ao.GetEntryPointService())),v(ao,"backgroundMessagingService",new Zn(ao.GetLogService(),ao.GetEntryPointService())),v(ao,"walletDrawerService",new qr(ao.GetOverlayService())),v(ao,"checkoutService",new Et(ao.GetPlatformInstance(),ao.GetLocalDataService(),ao.GetOverlayService(),ao.GetEdgeMessageService(),ao.GetLogService(),ao.GetEntryPointService())),v(ao,"otherSellersService",new rr(ao.GetPlatformInstance(),ao.GetLogService(),ao.GetOverlayService(),ao.GetEdgeMessageService())),v(ao,"broadcastChannelService",Xe.GetInstance()),v(ao,"backgroundAutoApplyService",new Je(ao.GetPlatformInstance(),ao.GetLogService(),ao.GetOverlayService(),ao.GetEdgeMessageService(),ao.GetApplicatorStateService(),ao.GetBroadcastChannelService(),ao.GetEntryPointService())),v(ao,"checkoutPaymentUpdateService",new ft(ao.GetCheckoutService(),ao.GetLocalDataService(),ao.GetEdgeMessageService(),ao.GetOverlayService(),ao.GetLogService(),ao.GetEntryPointService())),v(ao,"groceryService",new sn(ao.GetPlatformInstance(),ao.GetOverlayService(),ao.GetLogService(),ao.GetEdgeMessageService())),v(ao,"clippingServiceLogger",new zt(ao.GetLogService(),ao.GetEdgeMessageService())),v(ao,"clippingService",new Ht(ao.GetClippingServiceLogger(),U.CouponClipping)),v(ao,"suggestedCouponsService",new Yr(ao.GetLogService())),v(ao,"shopRunnerService",new Ur(ao.GetPlatformInstance(),ao.GetOverlayService(),ao.GetLogService()));var so=ao,co=s((function e(){c(this,e),v(this,"retailerData",void 0),v(this,"impressionId",void 0),v(this,"coupons",void 0),v(this,"market",void 0),v(this,"userPersonalizationInfo",void 0),v(this,"cashback",void 0)})),uo=function(){function e(){c(this,e),v(this,"hasLink",void 0),v(this,"couponCodeElement",void 0),v(this,"couponCodeHash",void 0),v(this,"retailerElement",void 0),v(this,"retailerHash",void 0),v(this,"channelId",void 0)}return s(e,null,[{key:"Create",value:function(t){var n=new e;return n.hasLink=t.hasLink,n.couponCodeElement=t.couponCodeElement,n.couponCodeHash=t.couponCodeHash,n.retailerElement=t.retailerElement,n.retailerHash=t.retailerHash,n.channelId=t.channelId,n}}]),e}(),lo=function(){function e(){c(this,e),v(this,"domainSelector",void 0),v(this,"productTitleSelector",void 0),v(this,"productImageSelector",void 0),v(this,"productLinkSelector",void 0)}return s(e,null,[{key:"Create",value:function(t){var n=new e;return n.domainSelector=t.domainSelector,n.productTitleSelector=t.productTitleSelector,n.productImageSelector=t.productImageSelector,n.productLinkSelector=t.productLinkSelector,n}}]),e}(),po=function(){function e(){c(this,e),v(this,"descriptionSelector",void 0),v(this,"profileImageSelector",void 0),v(this,"influencerInfoSelector",void 0),v(this,"influencerIdSelector",void 0),v(this,"influencerFollowers",void 0)}return s(e,null,[{key:"Create",value:function(t){var n=new e;return n.descriptionSelector=t.descriptionSelector,n.profileImageSelector=t.profileImageSelector,n.influencerInfoSelector=t.influencerInfoSelector,n.influencerIdSelector=t.influencerIdSelector,n.influencerFollowers=t.influencerFollowers,n}}]),e}(),ho=function(){function e(){c(this,e),v(this,"cartSelector",void 0),v(this,"productSelector",void 0),v(this,"productTitleSelector",void 0),v(this,"productPriceSelector",void 0),v(this,"productImageSelector",void 0),v(this,"productUrlSelector",void 0),v(this,"productQuantitySelector",void 0),v(this,"productSellerSelector",void 0),v(this,"productSellerRegex",void 0),v(this,"productIdSkuSelector",void 0),v(this,"productIdSkuRegex",void 0),v(this,"productIdSkuAttribute",void 0),v(this,"productPriceRegex",void 0)}return s(e,null,[{key:"Create",value:function(t){var n=new e;return n.cartSelector=t.cartSelector,n.productSelector=t.productSelector,n.productTitleSelector=t.productTitleSelector,n.productPriceSelector=t.productPriceSelector,n.productImageSelector=t.productImageSelector,n.productUrlSelector=t.productUrlSelector,n.productQuantitySelector=t.productQuantitySelector,n.productSellerSelector=t.productSellerSelector,n.productSellerRegex=t.productSellerRegex,n.productIdSkuSelector=t.productIdSkuSelector,n.productIdSkuRegex=t.productIdSkuRegex,n.productIdSkuAttribute=t.productIdSkuAttribute,n.productPriceRegex=t.productPriceRegex,n}}]),e}(),fo=function(){function e(){c(this,e),v(this,"productTitleSelector",void 0),v(this,"aggregateRatingSelector",void 0),v(this,"aggregateRatingNumberOfRatingsSelector",void 0),v(this,"reviewSelector",void 0),v(this,"reviewRatingSelector",void 0)}return s(e,null,[{key:"Create",value:function(t){var n=new e;return n.productTitleSelector=t.productTitleSelector,n.aggregateRatingSelector=t.aggregateRatingSelector,n.productTitleSelector=t.productTitleSelector,n.aggregateRatingNumberOfRatingsSelector=t.aggregateRatingNumberOfRatingsSelector,n.reviewSelector=t.reviewSelector,n.reviewRatingSelector=t.reviewRatingSelector,n}}]),e}(),vo=function(){function e(){c(this,e),v(this,"clipCouponSelector",void 0),v(this,"signedInSelector",void 0),v(this,"discountSelector",void 0),v(this,"orderTotalDataElementSelector",void 0),v(this,"clippedDiscountSelector",void 0),v(this,"alreadyClippedSelector",void 0)}return s(e,null,[{key:"Create",value:function(t){var n=new e;return n.clipCouponSelector=t.clipCouponSelector,n.signedInSelector=t.signedInSelector,n.discountSelector=t.discountSelector,n.orderTotalDataElementSelector=t.orderTotalDataElementSelector,n.clippedDiscountSelector=t.clippedDiscountSelector,n.alreadyClippedSelector=t.alreadyClippedSelector,n}}]),e}(),go=function(){function e(){c(this,e),v(this,"otherSellersOverlayLinkSelector",void 0),v(this,"otherSellerOfferElementSelector",void 0),v(this,"otherSellerHeadingSelector",void 0),v(this,"otherSellerPriceSelector",void 0),v(this,"otherSellerNameSelector",void 0),v(this,"productImageSelector",void 0),v(this,"otherSellerRatingSelector",void 0),v(this,"otherSellerDeliverySelector",void 0),v(this,"otherSellerAddButtonSelector",void 0),v(this,"otherSellerAddedConfirmationSelector",void 0),v(this,"otherSellerLowestPriceSelector",void 0),v(this,"jSVersionThreshold",void 0)}return s(e,null,[{key:"Create",value:function(t){var n=new e;return n.otherSellersOverlayLinkSelector=t.otherSellersOverlayLinkSelector,n.otherSellerOfferElementSelector=t.otherSellerOfferElementSelector,n.otherSellerHeadingSelector=t.otherSellerHeadingSelector,n.otherSellerPriceSelector=t.otherSellerPriceSelector,n.otherSellerNameSelector=t.otherSellerNameSelector,n.productImageSelector=t.productImageSelector,n.otherSellerRatingSelector=t.otherSellerRatingSelector,n.otherSellerDeliverySelector=t.otherSellerDeliverySelector,n.otherSellerAddButtonSelector=t.otherSellerAddButtonSelector,n.otherSellerAddedConfirmationSelector=t.otherSellerAddedConfirmationSelector,n.otherSellerLowestPriceSelector=t.otherSellerLowestPriceSelector,n.jSVersionThreshold=t.jSVersionThreshold,n}}]),e}(),yo=function(){function e(){c(this,e),v(this,"inputBoxSelector",void 0),v(this,"applyButtonSelector",void 0),v(this,"removeCouponButtonSelector",void 0),v(this,"orderTotalDataElementSelector",void 0),v(this,"disabled",void 0),v(this,"checkoutPageUrl",void 0),v(this,"layoutClickSelector",void 0),v(this,"clickBeforeStartSelector",void 0),v(this,"finalCheckoutButtonSelector",void 0),v(this,"edgeEnabled",void 0),v(this,"orderSubTotalElementSelector",void 0),v(this,"couponAcceptedMessageElementSelector",void 0),v(this,"closeModal",void 0),v(this,"appliedCouponSelector",void 0),v(this,"errorMessageSelector",void 0),v(this,"enabledTips",void 0),v(this,"otherSellerSelectors",void 0),v(this,"clippingSelectors",void 0),v(this,"cartSelectors",void 0),v(this,"catalogSelectors",void 0),v(this,"socialSelectors",void 0),v(this,"pinterestSelectors",void 0),v(this,"automatedCartExtractionEnabled",void 0),v(this,"shipmentSelector",void 0),v(this,"preTaxSelector",void 0),v(this,"estimatedTaxSelector",void 0),v(this,"waitAfterApplyingCurrentCoupon",void 0),v(this,"manualCouponApplyTrackingEnabled",void 0),v(this,"autosDataSelector",void 0),v(this,"suggestedCouponElementSelector",void 0),v(this,"suggestedCouponRegex",void 0),v(this,"suggestedCouponsOnlyPage",void 0),v(this,"supportedNoOrderTotal",void 0),v(this,"domMutationEnabled",void 0),v(this,"pageType",void 0)}return s(e,null,[{key:"Create",value:function(t){var n=new e;return n.inputBoxSelector=t.inputBoxSelector,n.removeCouponButtonSelector=t.removeCouponButtonSelector,n.orderTotalDataElementSelector=t.orderTotalDataElementSelector,n.checkoutPageUrl=t.checkoutPageUrl,n.clickBeforeStartSelector=t.clickBeforeStartSelector,n.layoutClickSelector=t.layoutClickSelector,n.finalCheckoutButtonSelector=t.finalCheckoutButtonSelector,n.disabled=t.disabled,n.edgeEnabled=t.edgeEnabled,n.orderSubTotalElementSelector=t.orderSubTotalElementSelector,n.couponAcceptedMessageElementSelector=t.couponAcceptedMessageElementSelector,n.closeModal=t.closeModal,n.appliedCouponSelector=t.appliedCouponSelector,n.errorMessageSelector=t.errorMessageSelector,n.enabledTips=t.enabledTips,n.automatedCartExtractionEnabled=t.automatedCartExtractionEnabled,n.shipmentSelector=t.shipmentSelector,n.preTaxSelector=t.preTaxSelector,n.estimatedTaxSelector=t.estimatedTaxSelector,n.applyButtonSelector=t.applyButtonSelector,n.waitAfterApplyingCurrentCoupon=t.waitAfterApplyingCurrentCoupon,n.manualCouponApplyTrackingEnabled=t.manualCouponApplyTrackingEnabled,n.autosDataSelector=t.autosDataSelector,n.suggestedCouponElementSelector=t.suggestedCouponElementSelector,n.suggestedCouponRegex=t.suggestedCouponRegex,n.suggestedCouponsOnlyPage=t.suggestedCouponsOnlyPage,n.supportedNoOrderTotal=t.supportedNoOrderTotal,n.domMutationEnabled=t.domMutationEnabled,n.pageType=t.pageType,t.otherSellerSelectors&&(n.otherSellerSelectors=go.Create(t.otherSellerSelectors)),t.clippingSelectors&&(n.clippingSelectors=vo.Create(t.clippingSelectors)),t.cartSelectors&&(n.cartSelectors=ho.Create(t.cartSelectors)),t.catalogSelectors&&(n.catalogSelectors=fo.Create(t.catalogSelectors)),t.socialSelectors&&(n.socialSelectors=po.Create(t.socialSelectors)),t.pinterestSelectors&&(n.pinterestSelectors=lo.Create(t.pinterestSelectors)),n}}]),e}(),So=function(){function e(){c(this,e),v(this,"productPageUrl",void 0),v(this,"addToCartButtonSelector",void 0),v(this,"backgroundAAEnabled",void 0),v(this,"productAddedConfirmationSelector",void 0),v(this,"addToCartButtonContainer",void 0),v(this,"suggestedCouponElementSelector",void 0),v(this,"suggestedCouponRegex",void 0)}return s(e,null,[{key:"Create",value:function(t){var n=new e;return n.productPageUrl=t.productPageUrl,n.addToCartButtonSelector=t.addToCartButtonSelector,n.backgroundAAEnabled=t.backgroundAAEnabled,n.productAddedConfirmationSelector=t.productAddedConfirmationSelector,n.addToCartButtonContainer=t.addToCartButtonContainer,n.suggestedCouponElementSelector=t.suggestedCouponElementSelector,n.suggestedCouponRegex=t.suggestedCouponRegex,n}}]),e}();function mo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Co(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Co(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Co(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var xo=function(){function e(){c(this,e),v(this,"domainName",void 0),v(this,"orderConfirmationPageUrl",void 0),v(this,"allCheckoutPages",void 0),v(this,"allFinalCheckoutPages",void 0),v(this,"checkoutPageKey",void 0),v(this,"finalCheckoutPageKey",void 0),v(this,"productPageKey",void 0),v(this,"exclusiveMarket",void 0),v(this,"multiMsgValidationEnabled",void 0),v(this,"youtubeTemplates",void 0),v(this,"allProductPages",void 0),v(this,"exactCheckoutPageUrl",void 0),v(this,"productOutOfStockSelector",void 0),v(this,"productNameSelector",void 0),v(this,"productImageSelector",void 0),v(this,"aaConsentEnabled",void 0)}return s(e,[{key:"updateCurrentCheckoutPage",value:function(e){var t=this.findCurrentPage(e,this.allCheckoutPages);return-1!==t?(this.checkoutPageKey=t,!0):(this.checkoutPageKey=null,!1)}},{key:"getCurrentCheckoutPage",value:function(){if(null!=this.checkoutPageKey)return this.allCheckoutPages[this.checkoutPageKey]}},{key:"updateCurrentFinalCheckoutPage",value:function(e){var t=this.findCurrentPage(e,this.allFinalCheckoutPages);return-1!==t?(this.finalCheckoutPageKey=t,!0):(this.finalCheckoutPageKey=null,!1)}},{key:"getCurrentFinalCheckoutPage",value:function(){if(null!=this.finalCheckoutPageKey)return this.allFinalCheckoutPages[this.finalCheckoutPageKey]}},{key:"getCurrentProductPage",value:function(e){if(null!=this.productPageKey)return this.allProductPages[this.productPageKey];var t=this.findCurrentProductPage(e,this.allProductPages);return-1!==t?(this.productPageKey=t,this.allProductPages[this.productPageKey]):void(this.productPageKey=null)}},{key:"createCheckoutPageList",value:function(e){if(this.allCheckoutPages=[],e.allCheckoutPages&&e.allCheckoutPages.length>0){var t,n=mo(e.allCheckoutPages);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.allCheckoutPages.push(yo.Create(r))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createFinalCheckoutPageList",value:function(e){if(this.allFinalCheckoutPages=[],e.allFinalCheckoutPages&&e.allFinalCheckoutPages.length>0){var t,n=mo(e.allFinalCheckoutPages);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.allFinalCheckoutPages.push(yo.Create(r))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createProductPagesList",value:function(e){if(this.allProductPages=[],e.allProductPages&&e.allProductPages.length>0){var t,n=mo(e.allProductPages);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.allProductPages.push(So.Create(r))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createYoutubeTemplateList",value:function(e){if(this.youtubeTemplates=[],e.youtubeTemplates&&e.youtubeTemplates.length>0){var t,n=mo(e.youtubeTemplates);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.youtubeTemplates.push(uo.Create(r))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"findCurrentPage",value:function(e,t){for(var n=0;n<t.length;n++){if(_e.IsOnPage(t[n].checkoutPageUrl,e))return t[n].disabled?-1:n}return-1}},{key:"findCurrentProductPage",value:function(e,t){for(var n=0;n<t.length;n++){if(_e.IsOnPage(t[n].productPageUrl,e))return n}return-1}}],[{key:"Create",value:function(t){var n=new e;return n.domainName=t.domainName,n.orderConfirmationPageUrl=t.orderConfirmationPageUrl,n.exclusiveMarket=t.exclusiveMarket,n.multiMsgValidationEnabled=t.multiMsgValidationEnabled,n.exactCheckoutPageUrl=t.exactCheckoutPageUrl,n.productOutOfStockSelector=t.productOutOfStockSelector,n.productNameSelector=t.productNameSelector,n.productImageSelector=t.productImageSelector,n.aaConsentEnabled=t.aaConsentEnabled,n.createCheckoutPageList(t),n.createFinalCheckoutPageList(t),n.createYoutubeTemplateList(t),n.createProductPagesList(t),n}}]),e}();function ko(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return bo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bo(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function bo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ao=function(){function e(n){var r=this;c(this,e),v(this,"addToCartButtonClass","BGAAListener"),v(this,"validator",void 0),v(this,"productPageSelectors",void 0),v(this,"AddToCartClickHandler",t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,r.WaitUntilProductIsAdded();case 3:r.validator.SendItemAddedToCartMessage(),r.validator.SendProductPageStatusLog("Product added to cart",zr.ItemAddedToCart);case 5:case"end":return e.stop()}}),e)})))),this.validator=n}var n,r,i;return s(e,[{key:"SetUpAddToCartListener",value:(i=t(o().mark((function e(n){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.productPageSelectors=n,e.next=3,_e.WaitForCondition(t(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.addToCartButtonSelector,r=Ot.HasVisibleElement(t),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)}))),5e3).then(function(){var e=t(o().mark((function e(i){var a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="product page ",a+=i?"valid":"invalid",r.validator.SendProductPageStatusLog(a,i?"true":"false"),!n.backgroundAAEnabled){e.next=11;break}return e.next=7,r.ListenForCartAdditions();case 7:(s=document.querySelector(n.addToCartButtonContainer))&&new MutationObserver(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.ListenForCartAdditions();case 2:case"end":return e.stop()}}),e)})))).observe(s,{childList:!0,subtree:!0}),e.next=12;break;case 11:case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){var t;r.validator.SendProductPageStatusLog(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"product page error.","error")}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"ListenForCartAdditions",value:(r=t(o().mark((function e(){var t,n,r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Ot.GetAllVisibleElements(this.productPageSelectors.addToCartButtonSelector),n=ko(t);try{for(n.s();!(r=n.n()).done;)(i=r.value).className.includes(this.addToCartButtonClass)||(i.addEventListener("click",this.AddToCartClickHandler),null===(a=i.classList)||void 0===a||a.add(this.addToCartButtonClass))}catch(e){n.e(e)}finally{n.f()}case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"WaitUntilProductIsAdded",value:(n=t(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.productPageSelectors.productAddedConfirmationSelector)){e.next=10;break}return e.next=6,_e.WaitForCondition(t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ot.HasVisibleElementSingleSel(n));case 1:case"end":return e.stop()}}),e)}))),1e4);case 6:e.sent,e.next=11;break;case 10:_e.Sleep(500);case 11:case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),e}(),Eo=Ao,Po=function(){function e(){c(this,e)}return s(e,null,[{key:"GetValidatorModule",value:function(){return this.validator||(this.validator=new Jr),this.validator}},{key:"GetProductAddService",value:function(){return this.productAddService||(this.productAddService=new Eo(this.GetValidatorModule())),this.productAddService}}]),e}();v(Po,"validator",new Jr),v(Po,"productAddService",void 0);var wo=Po,Io=function(){function e(){c(this,e)}return s(e,[{key:"raiseMessageFromHost",value:function(e){var t=e.shift();if(t&&"MonitorUserActions"===t)try{"interactive"===document.readyState||"complete"===document.readyState?window.IsProductPageValid(e):window.addEventListener&&window.addEventListener("DOMContentLoaded",(function(t){window.CheckAndIsProductPageValid(e)}))}catch(e){}}},{key:"postMessageToHost",value:function(e,t){try{productPageNativeHandler&&productPageNativeHandler.sendMessageToHost(e,t)}catch(e){}}},{key:"initialize",value:function(e){return e.splice(0,2),!0}}]),e}();function Do(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Oo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Oo(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Oo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var To=wo.GetValidatorModule();function Ro(e){return Mo.apply(this,arguments)}function Mo(){return(Mo=t(o().mark((function e(t){var n,r,a,s,c,u,l,p,d,h,f,v,y,S;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(To.SetTraceId(t[1]),n="",e.prev=2,c=t[0],u=JSON.parse(c),l=Fo(u),n=null!==(r=l.impressionId)&&void 0!==r?r:"",To.SetImpressionId(n),l.retailerData&&(null==l||null===(a=l.coupons)||void 0===a?void 0:a.length)>0!=!1){e.next=10;break}return e.abrupt("return",!1);case 10:if(p=To.GetCurrentPathName(),d=l.retailerData.getCurrentProductPage(p)){e.next=15;break}return e.abrupt("return",!1);case 15:if(t.length>2)try{i(h=t[2])||(f=JSON.parse(h),so.GetSuggestedCouponService().init(l.retailerData.domainName,f))}catch(e){Bo(null!=(v="Error while getting storage data. "+e)?v:"productpage error.")}if(so.GetSuggestedCouponService().update(g.ProductPage,l.coupons,d.suggestedCouponElementSelector,d.suggestedCouponRegex,n),l.retailerData.updateCurrentCheckoutPage(null!==(s=l.retailerData.exactCheckoutPageUrl)&&void 0!==s?s:""),y=l.retailerData.getCurrentCheckoutPage()){e.next=23;break}return Bo("Unable to find target checkout page."),e.abrupt("return",!1);case 23:if(null==y||!y.edgeEnabled){e.next=29;break}return wo.GetProductAddService().SetUpAddToCartListener(d),e.abrupt("return",!0);case 29:return e.abrupt("return",!1);case 31:e.next=38;break;case 33:return e.prev=33,e.t0=e.catch(2),Bo(null!==(S=null===e.t0||void 0===e.t0?void 0:e.t0.message)&&void 0!==S?S:"productpage error."),e.abrupt("return",!1);case 38:case"end":return e.stop()}}),e,null,[[2,33]])})))).apply(this,arguments)}function Fo(e){if(e){var t=new co;if(e.retailerData&&(t.retailerData=xo.Create(e.retailerData)),e.impressionId&&(t.impressionId=e.impressionId),e.coupons){t.coupons=[];var n,r=Do(e.coupons);try{for(r.s();!(n=r.n()).done;){var o=n.value;t.coupons.push(o)}}catch(e){r.e(e)}finally{r.f()}}return t}return new co}function Bo(e,t){try{To.SendProductPageStatusLog(e,"error",t)}catch(e){}}window.CheckAndIsProductPageValid=function(e){ke.IsInframe()||Ro(e)},window.IsProductPageValid=Ro;var No=new Io;window.productPageScriptRuntime=No}()}();